(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{1010:function(s,a,t){"use strict";t.r(a);var e=t(12),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("视频名称：Crontab 不知疲倦的时间表"),t("br"),s._v("\n视频地址：http://www.imooc.com/learn/1009"),t("br"),s._v("\n简介：本门课程老师通过案例详细讲解如何通过 crontab 设置周期性执行的任务。课程先从 crontab 入门讲起，讲解 crontab 的安装配置以及指令操作等，然后通过日志、备份数据库、备份源码、设置防火墙、调用 Python 脚本等案例进行讲解，最后讲解 crontab 在 Jenkins 上的扩展。"),t("br"),s._v("\n我的评价：★★★★★")])]),s._v(" "),t("p",[s._v("[TOC]")]),s._v(" "),t("h2",{attrs:{id:"第-1-章-课程简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第-1-章-课程简介"}},[s._v("#")]),s._v(" 第 1 章 课程简介")]),s._v(" "),t("p",[s._v("整体介绍整门课程的结构，以及我们为什么要使用 Crontab 和 Crontab 的案例应用。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-课程内容-01-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-课程内容-01-17"}},[s._v("#")]),s._v(" 1-1 课程内容 (01:17)")]),s._v(" "),t("div",{staticClass:"language-mermaid line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-mermaid"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("graph")]),s._v(" TD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n初识crontab"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("入门"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n入门"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("安装配置"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n入门"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("实战"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n实战"),t("span",{pre:!0,attrs:{class:"token arrow operator"}},[s._v("--\x3e")]),s._v("编写表单"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_1-2-什么是-crontab-01-52"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-什么是-crontab-01-52"}},[s._v("#")]),s._v(" 1-2 什么是 crontab (01:52)")]),s._v(" "),t("ul",[t("li",[s._v("crontab 是一个用于设置周期性执行任务的工具(MacOS、Linux),cron——计划任务,tab——表")])]),s._v(" "),t("h3",{attrs:{id:"_1-3-为什么要使用-crontab-02-17"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-为什么要使用-crontab-02-17"}},[s._v("#")]),s._v(" 1-3 为什么要使用 crontab (02:17)")]),s._v(" "),t("ul",[t("li",[s._v("每分钟需要执行一个脚本进行系统 Health Check")]),s._v(" "),t("li",[s._v("每天凌晨对过去的一天系统数据进行统计")]),s._v(" "),t("li",[s._v("每周对系统日志进行备份切割")]),s._v(" "),t("li",[s._v("每个月对系统关键数据进行备份")])]),s._v(" "),t("h2",{attrs:{id:"第-2-章-crontab-入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第-2-章-crontab-入门"}},[s._v("#")]),s._v(" 第 2 章 Crontab 入门")]),s._v(" "),t("p",[s._v("本章主要介绍 Crontab 的简单的应用操作，包括安装配置，简单指令，环境变量等。")]),s._v(" "),t("h3",{attrs:{id:"_2-1-相关工具介绍-08-10"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-相关工具介绍-08-10"}},[s._v("#")]),s._v(" 2-1 相关工具介绍 (08:10)")]),s._v(" "),t("p",[s._v("相关工具推荐：")]),s._v(" "),t("ul",[t("li",[s._v("Git Bash(Windows)——模拟 Linux 命令行、自带强大的命令库。安装完之后可以直接使用 ssh 连接远程服务器"),t("code",[s._v("ssh username@host")]),s._v("。自带 Linux 指令集,比如可以 ls(Windows 只能 dir),curl("),t("code",[s._v("curl http://www.baidu.com")]),s._v(")等。")]),s._v(" "),t("li",[s._v("Terminal(Linux,MacOS)——系统原生、操作简单、功能库强大")])]),s._v(" "),t("h3",{attrs:{id:"_2-2-crontab-安装-03-28"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-crontab-安装-03-28"}},[s._v("#")]),s._v(" 2-2 crontab 安装 (03:28)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# CentOS7下安装crond服务和crontab工具,一般腾讯云阿里云的都自带了,\n# 可以使用yum list installed查看所有已经安装的包,yum search XXX可以搜索\nyum clean all   # 清理yum缓存\nyum update      # 更新系统的安装包到最新版本,保证系统安全\nyum install -y cronie crontabs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-3-验证-crond-服务-05-03"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-验证-crond-服务-05-03"}},[s._v("#")]),s._v(" 2-3 验证 crond 服务 (05:03)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 验证crond服务是否安装及启动\nyum list cronie && systemctl status crond\n# yum list cronie——查看是否安装了cronie这个软件包\n# &&  systemctl status crond——&&前面的命令执行成功后才执行,检查crond是否已经安装到系统服务\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 检查crontab工具是否安装：\nyum list crontabs && which crontab && crontab -l\n# which crontab——查看crontab的安装目录\n# crontab -l——返回当前crontab的任务列表\n# 我腾讯云输出的小彩蛋：start.sh > /dev/null 2>&1 &\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-4-crontab-架构-05-03"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-crontab-架构-05-03"}},[s._v("#")]),s._v(" 2-4 crontab 架构 (05:03)")]),s._v(" "),t("p",[s._v("文件——>解析——>守护进程")]),s._v(" "),t("ul",[t("li",[s._v("文件：\n"),t("ul",[t("li",[s._v("按照格式编写定时任务")]),s._v(" "),t("li",[s._v("格式：* * * * * my command (分时日月周)")])])]),s._v(" "),t("li",[s._v("解析：crontab 工具")]),s._v(" "),t("li",[s._v("守护进程\n"),t("ul",[t("li",[s._v("crond")]),s._v(" "),t("li",[s._v("定时检查是否有任务需要执行")])])])]),s._v(" "),t("p",[s._v("进入计划任务编辑表单："),t("code",[s._v("crontab -e")]),s._v("\n查看计划任务表单："),t("code",[s._v("crontab -l")]),s._v("\n重启 crond 服务："),t("code",[s._v("systemctl restart crond")])]),s._v(" "),t("h3",{attrs:{id:"_2-5-crontab-配置文件格式-06-33"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-crontab-配置文件格式-06-33"}},[s._v("#")]),s._v(" 2-5 crontab 配置文件格式 (06:33)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("* * * * * my command\n分时日月周  要运行的命令\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("*")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("*")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("*")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("*")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("*")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("my command")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("分")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("时")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("日")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("月")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("周")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("要运行的命令")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("0~59")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("0~23")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("1~31")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("1~12")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("0~6")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("命令或脚本")])])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("可以使用的符号：\n* 代表范围内的所有数字\n\\ 代表'每',比如*/5代表每5分钟\n- 区间：比如2-5\n, 分割：比如2,10 代表第2分钟和第10分钟\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("注意：一行只能写一个任务;写完任务后需要重启 crond 服务来让新任务生效\nExample：")]),s._v(" "),t("ul",[t("li",[s._v("每分钟打印一行 shell 输入并写入文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('crontab -e  # 进入任务编辑\n# tips：vim在命令模式下,同时按下de可以删除光标所在行的内容(光标后面的内容)\n# 按下i进入编辑模式,输入下面这一行\n* * * * * echo -e "This is a test oupput" > /root/test.out\n# 按下esc退出编辑模式,切换为命令模式,输入:wq或者:x保存\n# 接下来重启crond：systemctl restart crond\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-6-配置文件-07-47"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-配置文件-07-47"}},[s._v("#")]),s._v(" 2-6 配置文件 (07:47)")]),s._v(" "),t("p",[s._v("系统配置文件：/etc/crontab\n查看该配置文件：vim /etc/crontab,内容如下")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SHELL=/bin/bash # 表示用什么来执行shell\nPATH=/sbin:/bin:/usr/sbin:/usr/bin # crontab默认环境变量\nMAILTO=root # 每触发一个任务,就给root用户发一个系统内部邮件\n\n# For details see man 4 crontabs\n\n# Example of job definition:\n# .---------------- minute (0 - 59)\n# |  .------------- hour (0 - 23)\n# |  |  .---------- day of month (1 - 31)\n# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...\n# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat\n# |  |  |  |  |\n# *  *  *  *  * user-name  command to be executed\n\n~\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("系统用户 crontab 配置文件保存目录(crontab -e),其实是在将任务写到/var/spool/cron/,假如是 root 用户,那就是/var/spool/cron/root,加入是 user01 用户,那就是/var/spool/cron/user01")]),s._v(" "),t("p",[s._v("添加一个用户：useradd user01—切换到该用户—>su - user01—编辑该用户的 crontab—>crontab -e")]),s._v(" "),t("h3",{attrs:{id:"_2-7-环境变量-12-24"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-环境变量-12-24"}},[s._v("#")]),s._v(" 2-7 环境变量 (12:24)")]),s._v(" "),t("ul",[t("li",[s._v("添加 PATH 到/etc/crontab\n"),t("ul",[t("li",[s._v("PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/jdk1.8.0_111/bin")])])]),s._v(" "),t("li",[s._v("在执行具体任务前引入系统/用户环境变量(推荐)\n"),t("ul",[t("li",[s._v("30 2 * * * source /etc/profile;sh /root/test.sh # 添加系统环境变量")]),s._v(" "),t("li",[s._v("30 2 * * * source ~/.bash_profile;sh /root/test.sh # 添加当前用户的环境变量")]),s._v(" "),t("li",[s._v("systemctl restart crond")])])]),s._v(" "),t("li",[s._v("编辑系统环境变量：\n"),t("ol",[t("li",[s._v("vim /etc/profile")]),s._v(" "),t("li",[s._v("去最底部")]),s._v(" "),t("li",[s._v("PATH=$PATH:/usr/local/jdk1.8.0_111/bin\nexport PATH")]),s._v(" "),t("li",[s._v("保存退出")])])]),s._v(" "),t("li",[s._v("编辑用户环境变量：\n"),t("ol",[t("li",[s._v("vim /root/.bash_profile")]),s._v(" "),t("li",[s._v("直接在 PATH 后 PATH=$PATH:$HOME/bin 新增")]),s._v(" "),t("li",[s._v("PATH=$PATH:$HOME/bin;/usr/local/jdk1.8.0_111/bin")])])])]),s._v(" "),t("h3",{attrs:{id:"_2-8-命令总结-03-41"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-命令总结-03-41"}},[s._v("#")]),s._v(" 2-8 命令总结 (03:41)")]),s._v(" "),t("ul",[t("li",[s._v("编辑并保存当前用户的计划任务：\n"),t("ol",[t("li",[s._v("crontab -e")]),s._v(" "),t("li",[s._v("systemctl restart crond")])])]),s._v(" "),t("li",[s._v("查看当前用户保存的计划任务：\n"),t("ol",[t("li",[s._v("crontab -l")]),s._v(" "),t("li",[s._v("cat /var/spool/cron/{username}")])])])]),s._v(" "),t("h2",{attrs:{id:"第-3-章-crontab-实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-crontab-实战"}},[s._v("#")]),s._v(" 第 3 章 Crontab 实战")]),s._v(" "),t("p",[s._v("本章主要通过几个案例讲解 crontab 的实际场景应用。")]),s._v(" "),t("h3",{attrs:{id:"_3-1-日志-03-06"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-日志-03-06"}},[s._v("#")]),s._v(" 3-1 日志 (03:06)")]),s._v(" "),t("ul",[t("li",[s._v("cron 日志保存在系统目录/var/log/cron\n"),t("ul",[t("li",[s._v("tail -n 2 /var/log/cron # 查看最近的两条日志记录")])])])]),s._v(" "),t("h3",{attrs:{id:"_3-2-清理系统日志-09-46"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-清理系统日志-09-46"}},[s._v("#")]),s._v(" 3-2 清理系统日志 (09:46)")]),s._v(" "),t("ul",[t("li",[s._v("系统日志存放目录：/var/log\n"),t("ul",[t("li",[s._v("cron：crontab 日志")]),s._v(" "),t("li",[s._v("filewalld：系统防火墙日志")]),s._v(" "),t("li",[s._v("lastlog：登录信息日志")]),s._v(" "),t("li",[s._v("messages：系统总日志")]),s._v(" "),t("li",[s._v("secure：ssh 服务日志")])])]),s._v(" "),t("li",[s._v("查看所有日志文件的大小：du -sh *")])]),s._v(" "),t("p",[s._v("tips：")]),s._v(" "),t("ol",[t("li",[s._v("crontab -e 中注释任务可以使用#")]),s._v(" "),t("li",[s._v("/dev/null 代表的是黑洞文件(空文件)")])]),s._v(" "),t("p",[s._v("比如清空 messages 文件的定时任务可以这么写：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("* 1 * * * cat /dev/null > /var/log/messages # 每天凌晨1点清空messages文件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用脚本文件清空日志：")]),s._v(" "),t("ol",[t("li",[s._v("vim /root/log_clean.sh")]),s._v(" "),t("li",[s._v("填入以下内容后保存退出")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!bin/sh    # 声明是一个shell脚本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/messages   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空messages文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/secure   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空secure文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("在 crontab 中添加以下任务后重启 crond 即可")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("* 1 * * * sh /root/log_clean.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-3-备份-source-code-09-07"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-备份-source-code-09-07"}},[s._v("#")]),s._v(" 3-3 备份 Source Code (09:07)")]),s._v(" "),t("p",[s._v("需求：定期备份网站源代码\n假定 data 目录下有三个目录,分别是 backup(备份源码)、script(备份源码的脚本)、www(网站源代码)")]),s._v(" "),t("ol",[t("li",[s._v("vim script/www_backup.sh # 编辑脚本文件")]),s._v(" "),t("li",[s._v("写入以下内容后保存退出")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("basedir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/backup\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("www_src")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v("/www_src/"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%F_%H%M"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#%F-当前日期 %H%M-时分")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$www_src")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$www_src")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 做了一个if判断,创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -jpcf "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$www_src")]),s._v("/www.tar.bz2 www  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包备份文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("crontab -e 编辑定时任务后保存退出")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("* * * * * sh /data/script/www_backup.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("重启 crond：systemctl restart crond")])]),s._v(" "),t("h3",{attrs:{id:"_3-4-iptables-上的应用-10-44"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-iptables-上的应用-10-44"}},[s._v("#")]),s._v(" 3-4 iptables 上的应用 (10:44)")]),s._v(" "),t("p",[s._v("iptables：Linux 内核防火墙,可以通过添加规则去检测、修改、转发、重定向、丢弃 ip 数据包,CentOS7 默认使用的 firewalld 内核防火墙,我们需要禁用 firewalld 并安装 iptables")]),s._v(" "),t("ol",[t("li",[s._v("systemctl status firewalld # 检查 firewalld")]),s._v(" "),t("li",[s._v("systemctl disable firewalld # 禁用 firewalld")]),s._v(" "),t("li",[s._v("systemctl stop firewalld # 停止 firewalld")]),s._v(" "),t("li",[s._v("yum install -y iptables-services # 安装 iptables")]),s._v(" "),t("li",[s._v("systemctl enable iptables # 启用 iptables")]),s._v(" "),t("li",[s._v("systemctl start iptables # 启动 iptables")]),s._v(" "),t("li",[s._v("iptables -v # 查看版本")])]),s._v(" "),t("p",[s._v("使用 iptables+crontab：")]),s._v(" "),t("ol",[t("li",[s._v("在/data/script 目录下创建一个 blacklist.txt,写一些 ip 黑名单")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("10.110.12.3\n10.123.4.59\n...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("在/data/script 目录下创建一个 firewall.sh 脚本文件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\niptables -F "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空iptables所有记录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("list")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/script/blacklist.txt\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("line")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" $list"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  iptables -I INPUT -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$line")]),s._v(" -j DROP "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DROP丢弃数据包")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$line")]),s._v(' is dropped into blacklist"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("crontab -e 添加定时任务")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("* * * * * source /etc/profile; sh /data/script/firewall.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("重启 crond：systemctl restart crond(重启后会马上执行任务)\n查看 iptables 规则："),t("code",[s._v("iptables -nvL")])])]),s._v(" "),t("h3",{attrs:{id:"_3-5-crontab-在-jenkins-上的扩展-08-02"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-crontab-在-jenkins-上的扩展-08-02"}},[s._v("#")]),s._v(" 3-5 crontab 在 Jenkins 上的扩展 (08:02)")]),s._v(" "),t("p",[s._v("Jenkins：java 编写的开源持续集成工具\n安装：yum install -y jenkins\n先查看 java 路径：which java\n再查看 java 版本：java -version\n更改 jenkins 启动配置文件： 1. vim /etc/init.d/jenkins 2. 输入/candidates 搜索设置,添加我们的 java 路径到这个配置\n"),t("code",[s._v("/usr/local/jdk1.8.0_111/bin/java")]),s._v(" 3. 保存退出\n启动 jenkins：systemctl start jenkins\n查看 jenkins 是否正常启动：lsof -i:8080\n之后就能通过 host:port 的形式进入 jenkins 了,里面也能配置 crontab 任务")]),s._v(" "),t("h2",{attrs:{id:"第-4-章-课程总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第-4-章-课程总结"}},[s._v("#")]),s._v(" 第 4 章 课程总结")]),s._v(" "),t("p",[s._v("课程总结")]),s._v(" "),t("h3",{attrs:{id:"_4-1-crontab-总结-02-08"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-crontab-总结-02-08"}},[s._v("#")]),s._v(" 4-1 crontab 总结 (02:08)")]),s._v(" "),t("p",[s._v("略")])])}),[],!1,null,null,null);a.default=n.exports}}]);