(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{790:function(s,t,a){s.exports=a.p+"assets/img/17-BTree树.5217af3a.jpg"},996:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("课程名称：aliyun-MySQL高级应用-索引和锁"),n("br"),s._v("\n课程地址：https://edu.aliyun.com/course/1762/lesson/list"),n("br"),s._v("\n尚硅谷官方课程地址(可以下载资料)：http://www.atguigu.com/download_detail.shtml?v=30"),n("br"),s._v("\n我的评价：★★★☆☆"),n("br"),s._v("\n讲师：尚硅谷周阳 2016.11V1.6\n备注：本课程不是阿里云官方的课程，是"),n("code",[s._v("尚硅谷")]),s._v("的公开课，而且还是 2016 年的远古课程（MySQL 版本还用的 5.5），另外这个是培训课程，讲师的内容对我来说有点啰嗦，是快进看的，笔记可能有遗漏。")])]),s._v(" "),n("p",[s._v("[TOC]")]),s._v(" "),n("h2",{attrs:{id:"课时1-01-课程简介12-38"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时1-01-课程简介12-38"}},[s._v("#")]),s._v(" 课时1：01.课程简介12:38")]),s._v(" "),n("p",[s._v("课程内容：")]),s._v(" "),n("ol",[n("li",[s._v("MySQL的架构介绍\n"),n("ol",[n("li",[s._v("简介")]),s._v(" "),n("li",[s._v("Linux版安装")]),s._v(" "),n("li",[s._v("配置文件")]),s._v(" "),n("li",[s._v("逻辑架构介绍")]),s._v(" "),n("li",[s._v("MySQL存储引擎")])])]),s._v(" "),n("li",[s._v("索引优化分析\n"),n("ol",[n("li",[s._v("性能下降 SQL 慢、执行时间长、等待时间长")]),s._v(" "),n("li",[s._v("常见通用 join 查询")]),s._v(" "),n("li",[s._v("索引简介")]),s._v(" "),n("li",[s._v("性能分析")]),s._v(" "),n("li",[s._v("索引优化")])])]),s._v(" "),n("li",[s._v("查询截取分析\n"),n("ol",[n("li",[s._v("查询优化")]),s._v(" "),n("li",[s._v("慢查询日志")]),s._v(" "),n("li",[s._v("批量数据脚本")]),s._v(" "),n("li",[s._v("Show Profile")]),s._v(" "),n("li",[s._v("全局查询日志")])])]),s._v(" "),n("li",[s._v("MySQL锁机制\n"),n("ol",[n("li",[s._v("概述")]),s._v(" "),n("li",[s._v("三锁：表锁（偏读）、行锁（偏写）、页锁；开销、加速速度、死锁、粒度、并发性能只能就具体应用的特点来说哪种锁更合适")])])]),s._v(" "),n("li",[s._v("主从复制\n"),n("ol",[n("li",[s._v("复制的基本原则")]),s._v(" "),n("li",[s._v("复制的最大问题")]),s._v(" "),n("li",[s._v("一主一从常见配置")])])])]),s._v(" "),n("h2",{attrs:{id:"课时2-02-mysql简介08-41"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时2-02-mysql简介08-41"}},[s._v("#")]),s._v(" 课时2：02.MySQL简介08:41")]),s._v(" "),n("h3",{attrs:{id:"mysql-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql-概述"}},[s._v("#")]),s._v(" MySQL 概述")]),s._v(" "),n("p",[s._v("一个关系型数据库，由瑞典 MySQL AB 公司开发，目前属于Oracle公司。（其他介绍内容全都省略。）")]),s._v(" "),n("h3",{attrs:{id:"高级mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#高级mysql"}},[s._v("#")]),s._v(" 高级MySQL")]),s._v(" "),n("p",[s._v("MySQL 易学难精，完整的 MySQL 优化需要很深的功底，大公司甚至有专门的 DBA。")]),s._v(" "),n("ul",[n("li",[s._v("MySQL 内核")]),s._v(" "),n("li",[s._v("SQL 优化攻城狮")]),s._v(" "),n("li",[s._v("MySQL 服务器的优化")]),s._v(" "),n("li",[s._v("各种参数常量设定")]),s._v(" "),n("li",[s._v("查询语句优化")]),s._v(" "),n("li",[s._v("主从复制")]),s._v(" "),n("li",[s._v("软硬件升级")]),s._v(" "),n("li",[s._v("容灾备份")]),s._v(" "),n("li",[s._v("SQL 编程")])]),s._v(" "),n("h2",{attrs:{id:"课时3-03-rpm安装17-46"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时3-03-rpm安装17-46"}},[s._v("#")]),s._v(" 课时3：03.RPM安装17:46")]),s._v(" "),n("p",[s._v("注意：讲师课程里用的是MySQL5.5\nrpm查询是否安装过mysql：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rpm -qa|grep -i mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("安装：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("wget https://dev.mysql.com/get/Downloads/MySQL-5.5/MySQL-server-5.5.59-1.el7.x86_64.rpm\nwget https://dev.mysql.com/get/Downloads/MySQL-5.5/MySQL-client-5.5.59-1.el7.x86_64.rpm\nrpm -ivh MySQL-server-5.5.59-1.el7.x86_64.rpm\nrpm -ivh MySQL-client-5.5.59-1.el7.x86_64.rpm\n\n# 查看mysql用户和组\ncat /etc/passwd | grep mysql\ncat /etc/group | grep mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("启动：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("service mysql start\nps -ef | grep mysql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"课时4-04-root密码设置和开机自启动07-11"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时4-04-root密码设置和开机自启动07-11"}},[s._v("#")]),s._v(" 课时4：04.ROOT密码设置和开机自启动07:11")]),s._v(" "),n("p",[s._v("修改登录密码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/usr/bin/mysqladmin -u root password 123456\n\n# 连接试试\nmysql -u root -p\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("设置mysql开机自启动：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("chkconfig mysql on\n\ncat /etc/inittab\nntsysv # 检查 mysql 前面是否有*，代表开机自启动\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"课时5-05-安装位置05-54"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时5-05-安装位置05-54"}},[s._v("#")]),s._v(" 课时5：05.安装位置05:54")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("路径")]),s._v(" "),n("th",[s._v("解释")]),s._v(" "),n("th",[s._v("备注")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[n("code",[s._v("/var/lib/mysql")])]),s._v(" "),n("td",[s._v("mysql数据库文件的存放路径")]),s._v(" "),n("td",[n("code",[s._v("/var/lib/mysql/atguigu.cloud.pid")])])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("/usr/share/mysql")])]),s._v(" "),n("td",[s._v("配置文件目录")]),s._v(" "),n("td",[n("code",[s._v("mysql.service")]),s._v("命令及配置文件")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("/usr/bin")])]),s._v(" "),n("td",[s._v("相关命名目录")]),s._v(" "),n("td",[n("code",[s._v("mysqladmin mysqldump")]),s._v("等命令")])]),s._v(" "),n("tr",[n("td",[n("code",[s._v("/etc/init.d/mysql")])]),s._v(" "),n("td",[s._v("启停相关脚本")]),s._v(" "),n("td")])])]),s._v(" "),n("h2",{attrs:{id:"课时6-06-修改字符集16-41"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时6-06-修改字符集16-41"}},[s._v("#")]),s._v(" 课时6：06.修改字符集16:41")]),s._v(" "),n("p",[s._v("复制一份配置文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("cd /usr/share/mysql\n# 5.5版本\ncp my-huge.cnf /etc/my.cnf\n\n# 5.6版本\ncp my-default.cnf /etc/my.cnf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("查看字符集：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("show variables like 'character%';\nshow variables like '%char%';\n\n# 默认情况下database和server字符集都是latin1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("修改字符集：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# vim /etc/my.cnf\n[client]\ndefault-character-set=utf8\n\n[mysqld]\ncharacter_set_server=utf8\ncharacter_set_client=utf8\ncollation-server=utf8_general_ci\n\n[mysql]\ndefault-character-set=utf8\n\n\n# 重启\nserver mysql restart\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"课时7-07-mysql配置文件08-01"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时7-07-mysql配置文件08-01"}},[s._v("#")]),s._v(" 课时7：07.MySQL配置文件08:01")]),s._v(" "),n("p",[s._v("主要配置文件：")]),s._v(" "),n("ul",[n("li",[s._v("二进制日志log-bin=mysql-bin：用于主从复制")]),s._v(" "),n("li",[s._v("错误日志log-error：默认是关闭的，记录严重的警告和错误信息，每次启动和关闭的详细信息等")]),s._v(" "),n("li",[s._v("查询日志log：默认关闭，记录查询的sql语句，如果开启会减低mysql的整体性能")]),s._v(" "),n("li",[s._v("数据文件：\n"),n("ul",[n("li",[s._v("数据库文件")]),s._v(" "),n("li",[s._v("frm文件：存放表结构")]),s._v(" "),n("li",[s._v("myd文件：存数据")]),s._v(" "),n("li",[s._v("myi文件：存索引")])])]),s._v(" "),n("li",[s._v("如何配置：\n"),n("ul",[n("li",[s._v("windows："),n("code",[s._v("my.ini")])]),s._v(" "),n("li",[s._v("Linux："),n("code",[s._v("/etc/my.cnf")])])])])]),s._v(" "),n("h2",{attrs:{id:"课时8-08-mysql逻辑架构简介19-47"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时8-08-mysql逻辑架构简介19-47"}},[s._v("#")]),s._v(" 课时8：08.MySQL逻辑架构简介19:47")]),s._v(" "),n("ol",[n("li",[s._v("连接层：最上传是一些客户端和连接服务，包含本地 sock 通信和大多数基于客户端/服务端工具实现的类似于 tcp/ip 的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。")]),s._v(" "),n("li",[s._v("服务层：第二层架构主要完成大多数的核心服务，如 SQL 接口，并完成缓存的查询，SQL 的分析和优化及部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定查询表的顺序，是否利用索引等，最后生成相应的执行操作。如果是 select 语句，服务器还会查询内部的缓存。如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。")]),s._v(" "),n("li",[s._v("引擎层：存储引擎层，存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过 API 与存储引擎进行通信。不同的存储引擎具有的功能不同，这样我们可以根据自己的实际需要进行选取，后面介绍 MyISAM 和 InnoDB。")]),s._v(" "),n("li",[s._v("存储层：数据存储层，主要是将数据存储在运行于裸设备的文件系统之上，并完成与存储引擎的交互。")])]),s._v(" "),n("h2",{attrs:{id:"课时9-09-存储引擎简介07-43"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时9-09-存储引擎简介07-43"}},[s._v("#")]),s._v(" 课时9：09.存储引擎简介07:43")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 查看 mysql 提供什么存储引擎：\nshow engines;\n\n# 查看当前默认引擎：\nshow variables like '%storage_engine%'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"myisam和innodb的对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#myisam和innodb的对比"}},[s._v("#")]),s._v(" MyISAM和InnoDB的对比")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("对比项")]),s._v(" "),n("th",[s._v("MyISAM")]),s._v(" "),n("th",[s._v("InnoDB")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("主外键")]),s._v(" "),n("td",[s._v("不支持")]),s._v(" "),n("td",[s._v("支持")])]),s._v(" "),n("tr",[n("td",[s._v("事务")]),s._v(" "),n("td",[s._v("不支持")]),s._v(" "),n("td",[s._v("支持")])]),s._v(" "),n("tr",[n("td",[s._v("行表锁")]),s._v(" "),n("td",[s._v("表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作")]),s._v(" "),n("td",[s._v("行锁，操作时只锁某一行，不对其它行有影响，适合高并发操作")])]),s._v(" "),n("tr",[n("td",[s._v("缓存")]),s._v(" "),n("td",[s._v("只缓存索引，不缓存真实数据")]),s._v(" "),n("td",[s._v("不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响")])]),s._v(" "),n("tr",[n("td",[s._v("表空间")]),s._v(" "),n("td",[s._v("小")]),s._v(" "),n("td",[s._v("大")])]),s._v(" "),n("tr",[n("td",[s._v("关注点")]),s._v(" "),n("td",[s._v("性能")]),s._v(" "),n("td",[s._v("事务")])]),s._v(" "),n("tr",[n("td",[s._v("默认安装")]),s._v(" "),n("td",[s._v("Y")]),s._v(" "),n("td",[s._v("Y")])])])]),s._v(" "),n("h3",{attrs:{id:"阿里巴巴和淘宝用哪个"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阿里巴巴和淘宝用哪个"}},[s._v("#")]),s._v(" 阿里巴巴和淘宝用哪个")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("产品")]),s._v(" "),n("th",[s._v("价格")]),s._v(" "),n("th",[s._v("目标")]),s._v(" "),n("th",[s._v("主要功能")]),s._v(" "),n("th",[s._v("是否可投入生产？")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("Percona Server")]),s._v(" "),n("td",[s._v("免费")]),s._v(" "),n("td",[s._v("提供XtraDB存储引擎的包装器和其他分析工具")]),s._v(" "),n("td",[s._v("XtraDB")]),s._v(" "),n("td",[s._v("是")])]),s._v(" "),n("tr",[n("td",[s._v("MariaDB")]),s._v(" "),n("td",[s._v("免费")]),s._v(" "),n("td",[s._v("扩展MySQL以包含XtraDB和其他性能改进")]),s._v(" "),n("td",[s._v("XtraDB")]),s._v(" "),n("td",[s._v("是")])]),s._v(" "),n("tr",[n("td",[s._v("Drizzle")]),s._v(" "),n("td",[s._v("免费")]),s._v(" "),n("td",[s._v("提供比MySQL更强大的可扩展性和性能改进")]),s._v(" "),n("td",[s._v("高可用性")]),s._v(" "),n("td",[s._v("是")])])])]),s._v(" "),n("ul",[n("li",[s._v("Percona 为 MySQL 数据库服务器进行了改进，在功能和性能上较 MySQL 有着很明显的提升。该版本提升了在高负载情况下的 InnoDB 性能、为 DBA 提供一些非常有用的性能诊断工具；另外有更多的参数和命令来控制服务器行为。")]),s._v(" "),n("li",[s._v("该公司新建了一款存储引擎脚 xtradb，完全可以替代 innodb，并且在性能和并发上做的更好。")]),s._v(" "),n("li",[s._v("阿里巴巴大部分 mysql 数据库其实是使用 percona 的原型加以修改。")]),s._v(" "),n("li",[s._v("AliSql+AliRedis")])]),s._v(" "),n("h2",{attrs:{id:"课时10-10-sql性能下降原因11-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时10-10-sql性能下降原因11-10"}},[s._v("#")]),s._v(" 课时10：10.SQL性能下降原因11:10")]),s._v(" "),n("ul",[n("li",[s._v("查询语句写的烂")]),s._v(" "),n("li",[s._v("索引失效：单值、复合"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("字段：id name email weixinNumber\n查询：select * from user where name='' and email='';\n创建单值索引：create index idx_user_name on user(name);\n创建多值索引：create index idx_user_name_email on user(name,email);\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[s._v("关联查询太多join（设计缺陷或不得已的需求）")]),s._v(" "),n("li",[s._v("服务器调优及各个参数设置（缓冲、线程数等）")])]),s._v(" "),n("h2",{attrs:{id:"课时11-11-sql执行加载顺序05-21"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时11-11-sql执行加载顺序05-21"}},[s._v("#")]),s._v(" 课时11：11.SQL执行加载顺序05:21")]),s._v(" "),n("p",[s._v("手写：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("left_table"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("join_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("right_table"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("join_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("where_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group_by_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HAVING")]),s._v(" \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("having_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("order_by_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("limit_number"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("机读：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("left_table"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("join_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("join_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("right_table"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("where_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("group_by_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HAVING")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("having_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("order_by_condition"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("limit_number"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("总结：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SQL")]),s._v("解析顺序：\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v("：笛卡尔积\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("：主表保留\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v("：不符合"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("也添加     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v("：非聚合、非"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("别名\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("：改变对标引用\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HAVING")]),s._v("：只作用分组后\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v("：可使用"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("别名\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v("："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v("、"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"课时12-12-七种join理论07-25"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时12-12-七种join理论07-25"}},[s._v("#")]),s._v(" 课时12：12.七种JOIN理论07:25")]),s._v(" "),n("p",[s._v("左右两张表：A和B")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交集")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全A")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全B")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RIGHT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A-B")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# B-A")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RIGHT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全连接：A+B")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (A-B) | (B-A)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("select_list"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Table")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" TableB B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("OR")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("h2",{attrs:{id:"课时13-13-七种join的sql编写22-40"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时13-13-七种join的sql编写22-40"}},[s._v("#")]),s._v(" 课时13：13.七种JOIN的SQL编写22:40")]),s._v(" "),n("p",[s._v("本节就是建了一张表，插入了一些数据，练习写了一下七种 join 写法，跳过。")]),s._v(" "),n("h2",{attrs:{id:"课时14-14-索引是什么25-34"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时14-14-索引是什么25-34"}},[s._v("#")]),s._v(" 课时14：14.索引是什么25:34")]),s._v(" "),n("ul",[n("li",[s._v("MySQL 官方对索引的定义为：索引（Index）是帮助 MySQL 高效获取数据的数据结构。可以得到索引的本质：索引是数据结构。")]),s._v(" "),n("li",[s._v("索引的目的在于提高查找效率，可以类比字典。")]),s._v(" "),n("li",[s._v('可以简单理解为"排好序的快速查找数据结构"。')]),s._v(" "),n("li",[s._v("一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上。\n"),n("blockquote",[n("p",[s._v("在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。")])])]),s._v(" "),n("li",[s._v("我们平常所说的索引，如果没有特别指明，都是指 B 树（多路搜索树，并不一定是二叉的）结构组织的索引。其中聚集索引、次要索引、覆盖索引、复合索引、前缀索引、唯一索引默认都是使用 B+ 树索引，统称索引。当然，除了 B+ 树这种类型的索引， 还有哈希索引（hash index）等。")])]),s._v(" "),n("h2",{attrs:{id:"课时15-15-索引优势劣势08-54"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时15-15-索引优势劣势08-54"}},[s._v("#")]),s._v(" 课时15：15.索引优势劣势08:54")]),s._v(" "),n("ul",[n("li",[s._v("优势\n"),n("ul",[n("li",[s._v("类似大学图书馆建书目索引，提高数据检索的效率，降低数据库的 IO 成本")]),s._v(" "),n("li",[s._v("通过索引列对数据进行排序，降低数据排序的成本，降低了 CPU 的消耗")])])]),s._v(" "),n("li",[s._v("劣势\n"),n("ul",[n("li",[s._v("实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，所以索引也劣势要占用空间的")]),s._v(" "),n("li",[s._v("虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行 INSERT、UPDATE 和 DELETE。因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件。每次更新添加了索引列的字段，都会调整因为更新所带来的键值变化后的索引信息。")]),s._v(" "),n("li",[s._v("索引只是提高效率的一个因素，如果你的 MySQL 有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。")])])])]),s._v(" "),n("h2",{attrs:{id:"课时16-16-索引分类和建索引命令语句06-19"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时16-16-索引分类和建索引命令语句06-19"}},[s._v("#")]),s._v(" 课时16：16.索引分类和建索引命令语句06:19")]),s._v(" "),n("ul",[n("li",[s._v("单值索引：即一个索引只包含单个列，一个表可以有多个单列索引")]),s._v(" "),n("li",[s._v("唯一索引：索引列的值必须唯一，但允许有空值")]),s._v(" "),n("li",[s._v("复合索引：即一个索引包含多个列")]),s._v(" "),n("li",[s._v("基础语法：\n"),n("ul",[n("li",[s._v("创建：")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("方式一："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" index_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" mytable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n方式二："),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" mytable "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("删除："),n("code",[s._v("DROP INDEX [index_name] ON mytable;")])]),s._v(" "),n("li",[s._v("查看："),n("code",[s._v("SHOW INDEX FROM table_name\\G")])]),s._v(" "),n("li",[s._v("使用 ALTER 命令：")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一个主键")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个唯一索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加普通索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加全文索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl_name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" FULLTEXT index_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("column_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])]),s._v(" "),n("p",[s._v("注意点：")]),s._v(" "),n("ul",[n("li",[s._v("尽量建立复合索引，而不是单值索引")]),s._v(" "),n("li",[s._v("一张表中的尽量索引不要超过5个")])]),s._v(" "),n("h2",{attrs:{id:"课时17-17-索引结构与检索原理09-08"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时17-17-索引结构与检索原理09-08"}},[s._v("#")]),s._v(" 课时17：17.索引结构与检索原理09:08")]),s._v(" "),n("h3",{attrs:{id:"btree索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#btree索引"}},[s._v("#")]),s._v(" BTree索引")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{width:"500",src:a(790)}})]),s._v(" "),n("p",[s._v("【初始化介绍】")]),s._v(" "),n("ul",[n("li",[s._v("一棵 B+ 树，浅蓝色的块就是一个磁盘块，可以看到每个磁盘块包含几个数据项（深蓝色）和指针（黄色），如磁盘块 1 包含数据项 17 和 35，包含指针 P1、P2、P3")]),s._v(" "),n("li",[s._v("P1 表示小于 17 的磁盘块，P2 表示在 17 和 35 之间的磁盘块，P3 表示大于35的磁盘块。")]),s._v(" "),n("li",[n("code",[s._v("真实的数据存在于叶子节点")]),s._v("即 3、5、9、10、13、15、28、29、36、60、75、79、90、99")]),s._v(" "),n("li",[n("code",[s._v("非叶子节点不存真实的数据，只存储指引搜索方向的数据项")]),s._v("，如 17、35 并不真实存在于数据表中")])]),s._v(" "),n("p",[s._v("【查找过程】")]),s._v(" "),n("ul",[n("li",[s._v("如果要查找数据项 29，name首先会把磁盘块 1 由磁盘加载到内存，此时发生一次 IO，在内存中用二分查找确定 29 在 17 和 35 之间，锁定磁盘块 1 的 P2 指针，内存时间因为非常短（相比磁盘的 IO）可以忽略不计，通过磁盘块 1 的 P2 指针的磁盘地址把磁盘块 3 由磁盘加载到内存，发生第二次 IO，29 在 26 和 30 之间，锁定磁盘块 3 的 P2 指针，通过指针加载磁盘块 8 到内存，发生第三次 IO，同时内存中做二分查找找到29，结束查询，总计三次 IO。")]),s._v(" "),n("li",[s._v("真实的情况是，3层的 B+ 树可以表示上百万的数据，如果上百万的数据查找只需要三次IO，性能提高将是巨大的，如果没有索引，每个数据项都要发生一次 IO，那么总共需要百万次的 IO，显然成本非常非常高。")])]),s._v(" "),n("p",[s._v("以下三个索引没讲：")]),s._v(" "),n("ul",[n("li",[s._v("Hash索引")]),s._v(" "),n("li",[s._v("full-text索引")]),s._v(" "),n("li",[s._v("R-Tree索引")])]),s._v(" "),n("h2",{attrs:{id:"课时18-18-哪些情况适合建索引04-21"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时18-18-哪些情况适合建索引04-21"}},[s._v("#")]),s._v(" 课时18：18.哪些情况适合建索引04:21")]),s._v(" "),n("ol",[n("li",[s._v("主键自动建立唯一索引")]),s._v(" "),n("li",[s._v("频繁作为查询条件的字段应该创建索引")]),s._v(" "),n("li",[s._v("查询充与其它表关联的字段，外键关系建立索引")]),s._v(" "),n("li",[s._v("频繁更新的字段不适合创建索引，因为每次更新不单单是更新了记录还会更新索引")]),s._v(" "),n("li",[s._v("where 条件里用不到的字段不创建索引")]),s._v(" "),n("li",[s._v("单键/组合索引的选择问题，who？（在高并发下倾向创建组合索引）")]),s._v(" "),n("li",[s._v("查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度")]),s._v(" "),n("li",[s._v("查询中统计或者分组字段")])]),s._v(" "),n("h2",{attrs:{id:"课时19-19-哪些情况不适合建索引03-19"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时19-19-哪些情况不适合建索引03-19"}},[s._v("#")]),s._v(" 课时19：19.哪些情况不适合建索引03:19")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("表记录太少")])]),s._v(" "),n("li",[n("p",[s._v("经常增删改的表：提高了查询速度，同时却会降低更新表的速度，如对标进行 INSERT、UPDATE 和 DELETE，因为更新表时，MySQL 不仅要保存数据，还要保存一下索引文件")])]),s._v(" "),n("li",[n("p",[s._v("数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据列建立索引。注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。")]),s._v(" "),n("blockquote",[n("p",[s._v("假如一个表有 10 万行记录，有一个字段 A 只有 T 和 F 两种值，且每个值的分布概率大约为 50%，那么对这种表 A 字段建索引一般不会提高数据库的查询速度。")])]),s._v(" "),n("blockquote",[n("p",[s._v("索引的选择性是指索引列中不同值的数目与表中记录数的比。如果一个表中有 2000 条记录，表索引列有 1980 个不同的值，那么这个索引的选择性就是 1980/2000=0.99。一个索引的选择性越接近于 1 ，这个索引的效率就越高。")])])])]),s._v(" "),n("h2",{attrs:{id:"课时20-20-性能分析前提知识05-06"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时20-20-性能分析前提知识05-06"}},[s._v("#")]),s._v(" 课时20：20.性能分析前提知识05:06")]),s._v(" "),n("ul",[n("li",[s._v("MySQL Query Optimizer\n"),n("ol",[n("li",[s._v("MySQL 中有专门负责优化 SELECT 语句的优化器模块，主要功能：通过计算分析系统中收集到的统计信息，为客户端请求的 Query 提供它认为最优的执行计划（它认为最优的数据检索方式，但不见得是DBA认为是最优的，这部分最耗费时间）")]),s._v(" "),n("li",[s._v("当客户端向 MySQL 请求一条 Query，命令解析器模块完成请球分类，区别出 SELECT 并转发给 MySQL Query Optimizer 时，MySQL Query Optimizer 首先会对整条 Query 进行优化，处理掉一些常量表达式的预算，直接换算成常量值。并对 Query 中的查询条件进行简化和转换，如去掉一些无用或显而易见的条件、结构调整等。然后分析 Query 中的 Hint 信息（如果有），看显示 Hint 信息是否可以完全确定该 Query 的执行计划。如果没有 Hint 或 Hint 信息还不足以完全确定执行计划，则会读取所涉及对象的统计信息，根据 Query 进行写相应的计算分析，然后再得出最后的执行计划。")])])]),s._v(" "),n("li",[s._v("MySQL 常见瓶颈\n"),n("ol",[n("li",[s._v("CPU：CPU在饱和的时候一般发生在数据装入内存或从磁盘上读取数据的时候")]),s._v(" "),n("li",[s._v("IO：磁盘 I/O 瓶颈发生在装入数据远大于内存容量的时候")]),s._v(" "),n("li",[s._v("服务器硬件的性能瓶颈：top，free，iostat 和 vmstat 来查看系统的性能状态")])])]),s._v(" "),n("li",[s._v("Explain")])]),s._v(" "),n("h2",{attrs:{id:"课时21-21-explain使用简介07-05"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时21-21-explain使用简介07-05"}},[s._v("#")]),s._v(" 课时21：21.explain使用简介07:05")]),s._v(" "),n("ul",[n("li",[s._v("是什么（查看执行计划）：使用 EXPLAIN 关键字可以模拟优化器执行 SQL 查询语句，从而知道 MySQL 是如何处理 SQL 语句的。分析查询语句或是表结构的性能瓶颈。")]),s._v(" "),n("li",[s._v("能干嘛\n"),n("ul",[n("li",[s._v("表的读取顺序")]),s._v(" "),n("li",[s._v("数据读取操作的操作类型")]),s._v(" "),n("li",[s._v("哪些索引可以使用")]),s._v(" "),n("li",[s._v("哪些索引被实际使用")]),s._v(" "),n("li",[s._v("表之间的引用")]),s._v(" "),n("li",[s._v("每张表有多少行被优化器查询")])])]),s._v(" "),n("li",[s._v("怎么玩\n"),n("ul",[n("li",[s._v("Explain + SQL 语句")]),s._v(" "),n("li",[s._v("执行计划包含的信息：id、select_type、table、type、possible_keys、key、key_len、ref、rows、Extra")])])]),s._v(" "),n("li",[s._v("各字段解释")]),s._v(" "),n("li",[s._v("热身 Case")])]),s._v(" "),n("h2",{attrs:{id:"课时22-22-explain之id介绍11-37"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时22-22-explain之id介绍11-37"}},[s._v("#")]),s._v(" 课时22：22.explain之id介绍11:37")]),s._v(" "),n("ul",[n("li",[s._v("select 查询的序列号，包含一组数组，表示查询中执行 select 子句或操作表的顺序")]),s._v(" "),n("li",[s._v("三种情况：\n"),n("ol",[n("li",[s._v("id相同，执行顺序由上至下")]),s._v(" "),n("li",[s._v("id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行")]),s._v(" "),n("li",[s._v("id相同不同，同时存在")])])])]),s._v(" "),n("p",[s._v("补充：table 属性中偶尔会出现 derived，意思是衍生，不是实际的表，一般来自子查询，通常会紧跟一个数字 id，比如 derived2 表示这个衍生表来自 id 为2的查询。")]),s._v(" "),n("h2",{attrs:{id:"课时23-23-explain之select-type和table介绍06-55"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时23-23-explain之select-type和table介绍06-55"}},[s._v("#")]),s._v(" 课时23：23.explain之select_type和table介绍06:55")]),s._v(" "),n("h3",{attrs:{id:"select-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#select-type"}},[s._v("#")]),s._v(" select_type")]),s._v(" "),n("ul",[n("li",[s._v("值：\n"),n("ul",[n("li",[s._v("SIMPLE")]),s._v(" "),n("li",[s._v("PRIMARY")]),s._v(" "),n("li",[s._v("SUBQUERY")]),s._v(" "),n("li",[s._v("DERIVED")]),s._v(" "),n("li",[s._v("UNION")]),s._v(" "),n("li",[s._v("UNION RESULT")])])]),s._v(" "),n("li",[s._v("查询的类型，主要是用于区别普通查询、联合查询、子查询等复杂查询\n"),n("ul",[n("li",[s._v("SIMPLE：简单的 select 查询，查询中不包含子查询或者 UNION")]),s._v(" "),n("li",[s._v("PRIMARY：查询中若包含任何复杂的子部分，最外层查询则被标记为 PRIMARY")]),s._v(" "),n("li",[s._v("SUBQUERY：在 SELECT 或 WHERE 列表中包含了子查询")]),s._v(" "),n("li",[s._v("DERIVED：在 FROM 列表中的子查询被标记为 DERIVED（衍生），MySQL 会递归执行这些子查询，把结果放在临时表里")]),s._v(" "),n("li",[s._v("UNION：若第二个 SELECT 出现在 UNION 之后，则被标记为 UNION；若 UNION 包含在 FROM 子句的子查询中，外层 SELECT 将被标记为 DERIVED")]),s._v(" "),n("li",[s._v("UNION RESULT：从 UNION 表获取结果的 SELECT")])])])]),s._v(" "),n("h3",{attrs:{id:"table"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#table"}},[s._v("#")]),s._v(" table")]),s._v(" "),n("p",[s._v("显示这一行的数据时关于哪张表的")]),s._v(" "),n("h2",{attrs:{id:"课时24-24-explain之type介绍19-50"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时24-24-explain之type介绍19-50"}},[s._v("#")]),s._v(" 课时24：24.explain之type介绍19:50")]),s._v(" "),n("ul",[n("li",[s._v("值：ALL、index、range、ref、eq_ref、const,system、NULL")]),s._v(" "),n("li",[s._v("访问类型排列")]),s._v(" "),n("li",[s._v("显示查询使用了何种类型，从最好到最差依次是："),n("code",[s._v("system > const > eq_ref > ref > range > index > ALL")])]),s._v(" "),n("li",[s._v("一般来说，得保证查询至少达到 range 级别，最好能达到 ref。")]),s._v(" "),n("li",[s._v("各个值的含义\n"),n("ul",[n("li",[s._v("system：表只有一行记录（等于系统表），这是 const 类型的特例，平时不会出现，这个也可以忽略不计")]),s._v(" "),n("li",[s._v("const：表示通过索引一次就找到了，const 用于比较 primary key 或者 unique 索引。因为只匹配一行数据，所以很快。如将主键置于 where 列表中，MySQL 就能将该查询转换为一个常量")]),s._v(" "),n("li",[s._v("eq_ref：唯一性索引扫描，对于每个索引键表中只有一条记录与之匹配。常见于主键或唯一索引扫描")]),s._v(" "),n("li",[s._v("ref：非唯一性索引扫描，返回匹配某个单独值的所有行。本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，它可能会找到多个符合条件的行，所以它应该属于查找和扫描的混合体")]),s._v(" "),n("li",[s._v("range：只检索给定范围的行，使用一个索引来选择行。key列显示使用了哪个索引，一般就是在你的 where 语句中出现了 between、<、>、in 等的查询。这种范围索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引。")]),s._v(" "),n("li",[s._v("index：Full Index Scan，index 与 ALL 区别为 index 类型只遍历索引树。这通常比 ALL 快，因为索引文件通常比数据文件小。（也就是说虽然 all 和 index 都是读全表，但 index 是从索引中读取的，而 all 是从硬盘中读的）")]),s._v(" "),n("li",[s._v("all：Full Table Scan，将遍历全表以找到匹配的行")])])])]),s._v(" "),n("h2",{attrs:{id:"课时25-25-explain之possible-keys和key介绍10-14"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时25-25-explain之possible-keys和key介绍10-14"}},[s._v("#")]),s._v(" 课时25：25.explain之possible_keys和key介绍10:14")]),s._v(" "),n("ul",[n("li",[s._v("possible_keys：显示可能应用在这张表中的索引，一个或多个。查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询实际使用。")]),s._v(" "),n("li",[s._v("key：实际使用的索引，如果为 NULL，则没有使用索引。查询中若使用了覆盖索引，则该索引仅出现在 key 列表中。\n"),n("ul",[n("li",[s._v("啥是覆盖索引？——select 后选择的字段刚好和索引字段吻合（个数和顺序完全一致），即 select 的数据列只需要从索引中获取，不需要读取数据行，简而言之就是"),n("code",[s._v("查询列被所建的索引覆盖")])])])])]),s._v(" "),n("h2",{attrs:{id:"课时26-26-explain之key-len介绍04-42"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时26-26-explain之key-len介绍04-42"}},[s._v("#")]),s._v(" 课时26：26.explain之key_len介绍04:42")]),s._v(" "),n("ul",[n("li",[s._v("表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度。在不损失精确性的情况下，长度越短越好。")]),s._v(" "),n("li",[s._v("key_len 显示的值为索引字段的最大可能长度，"),n("code",[s._v("并非实际使用长度")]),s._v("，则 key_len 是根据表定义计算而得，不是通过表内检索出的。")])]),s._v(" "),n("h2",{attrs:{id:"课时27-27-explain之ref介绍06-40"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时27-27-explain之ref介绍06-40"}},[s._v("#")]),s._v(" 课时27：27.explain之ref介绍06:40")]),s._v(" "),n("ul",[n("li",[s._v("显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值。")])]),s._v(" "),n("h2",{attrs:{id:"课时28-28-explain之rows介绍05-54"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时28-28-explain之rows介绍05-54"}},[s._v("#")]),s._v(" 课时28：28.explain之rows介绍05:54")]),s._v(" "),n("ul",[n("li",[s._v("根据表统计信息及索引选用情况，大致估算出找到所需的记录所需要读取的行数，越小越好")])]),s._v(" "),n("h2",{attrs:{id:"课时29-29-explain之extra介绍22-07"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时29-29-explain之extra介绍22-07"}},[s._v("#")]),s._v(" 课时29：29.explain之Extra介绍22:07")]),s._v(" "),n("ul",[n("li",[s._v("包含不适合在其他列中显示但十分重要的额外信息\n"),n("ol",[n("li",[s._v('Using filesort：说明 MySQL 会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取。MySQL 中无法利用索引完成的排序操作称为"文件排序"。（出现这个东西不好，尽快优化，常见的情况是 group by 的列和索引不一致）')]),s._v(" "),n("li",[s._v("Using temporary：使用了临时表保存中间结果，MySQL 在对查询结果排序时使用临时表。常见于排序 order by 和分组查询 group by。（出现这个东西更不好，有 group by 操作时，group by的列最好和索引一致，否则非常容易出现临时表）")]),s._v(" "),n("li",[s._v("Using index：表示相应的 select 操作中使用了覆盖索引（Covering Index），避免访问了表的数据行，效率不错！如果同时出现 using where，表明索引被用来执行索引键值的查找；如果没有同时出现 using where，表名索引用来读取数据而非执行查找动作。")]),s._v(" "),n("li",[s._v("Using where：表明使用了 where 过滤")]),s._v(" "),n("li",[s._v("using join buffer：使用了连接缓存")]),s._v(" "),n("li",[s._v("impossible where：where 子句的值总是 false，不能用来获取任何元组")]),s._v(" "),n("li",[s._v("select tables optimized away：在没有 GROUP BY 子句的情况下，基于索引优化 MIN/MAX 操作或者对于 MyISAM 存储引擎优化 COUNT(*) 操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化")]),s._v(" "),n("li",[s._v("distinct：优化 distinct 操作，在找到第一匹配的元组后即停止找同样值的动作")])])])]),s._v(" "),n("h2",{attrs:{id:"课时30-30-explain之热身case03-33"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时30-30-explain之热身case03-33"}},[s._v("#")]),s._v(" 课时30：30.explain之热身Case03:33")]),s._v(" "),n("p",[s._v("略")]),s._v(" "),n("h2",{attrs:{id:"课时31-31-索引单表优化案例17-14"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时31-31-索引单表优化案例17-14"}},[s._v("#")]),s._v(" 课时31：31.索引单表优化案例17:14")]),s._v(" "),n("ul",[n("li",[s._v("建表sql：无关紧要，直接略，看案例")]),s._v(" "),n("li",[s._v("查询 category_id 为 1 且 comments 大于 1 的情况下，views 最多的 article_id。"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" author_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" article "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" category_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" comments"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" views "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现 type 是 ALL，即最坏的情况。Extra 里还出现了 Using filesort，也是最快的情况，必须优化。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始优化，目标是 type 不出现 ALL，Extra里不出现 Using filesort")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.1 新建索引：三个字段的符合索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ALTER TABLE `article` ADD INDEX idx_article_ccv(`category_id`,`comments`,`views`);")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_article_ccv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" article"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("category_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("comments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再看下执行计划")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" author_id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" article "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" category_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" comments"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" views "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时 type 变成了 range，但是 extra 里仍然有 Using filesort，原因是 comments>1 属于范围查询，views 排序就无法使用索引排序了，只能文件排序")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 总结：MySQL 无法利用索引再对后面的 views 部分进行检索，即 range 类型查询字段后面的索引无效。")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 comments>1 改成 comments=1 就能去掉 Using filesort了，但是不符合业务需求，说明这个索引不合适，删掉")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_article_ccv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" article"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.2 第2次建立索引：只建立 category_id 和 views 的联合索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ALTER TABLE `article` ADD INDEX idx_article_cv(`category_id`,`views`);")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_article_cv "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" article"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("category_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时再次查看执行计划，终于完美了。type 变成了 ref，Extra 中的 Using filesort 也消失了。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时32-32-索引两表优化案例15-25"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时32-32-索引两表优化案例15-25"}},[s._v("#")]),s._v(" 课时32：32.索引两表优化案例15:25")]),s._v(" "),n("ul",[n("li",[s._v("建表sql：无关紧要，直接略，看案例（一共两张表 class 和 book，分别有 20 行数据）")]),s._v(" "),n("li",[s._v("案例："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# explain")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" class "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" book "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一共两条执行计划（分别是 class 表和 book 表），发现 type 全是 ALL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 添加索引优化，先建在 book 表")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时执行计划好了一点点：")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# class 的 type 为 ALL，rows 为 20")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# book 的 type 为 ref，rows 为 1")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是由左连接特性决定的。LEFT JOIN 条件用于确定如何从右表搜索行，左边一定都有，所以右边是我们的关键点，一定要建立索引")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 删除一下 book 的索引，把索引建在 class 表看看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" Y "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时再看下执行计划：")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# class 的 type 为 index，rows 为 20")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# book 的 type 为 ALL，rows 为 20")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tips：不管索引是建在左边表还是右边表，我们都可以灵活调换表的左右位置或者将 LEFT JOIN 改为 RIGHT JOIN 来灵活应变。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时33-33-索引三表优化案例09-08"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时33-33-索引三表优化案例09-08"}},[s._v("#")]),s._v(" 课时33：33.索引三表优化案例09:08")]),s._v(" "),n("ul",[n("li",[s._v("建表sql：无关紧要，直接略，看案例（一共三张表 phone、class、book）")]),s._v(" "),n("li",[s._v("案例："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" SELEXT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" class "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" book "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" phone "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("phone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发现三条记录的 type 全都是 ALL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始优化，建两个索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("phone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" IDNEX Z"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("book"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" IDNEX Y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时再次查看执行计划，后 2 行的 type 都是 ref 且总 rows 优化很好，效果不错。因此索引最好设置在需要经常查询的字段中。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"结论-join语句的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#结论-join语句的优化"}},[s._v("#")]),s._v(" 结论：join语句的优化")]),s._v(" "),n("ol",[n("li",[s._v('尽可能减少 Join 语句中的 NestedLoop 的循环总次数；"永远用小结果集驱动大的结果集"')]),s._v(" "),n("li",[s._v("优先优化 NestedLoop 的内层循环")]),s._v(" "),n("li",[s._v("保证 Join 语句中被驱动表上 Join 条件字段已经被索引")]),s._v(" "),n("li",[s._v("当无法保证被驱动表的 Join 条件字段被索引且内存资源充足的前提下，不要太吝啬 JoinBuffer 的设置。")])]),s._v(" "),n("h2",{attrs:{id:"课时34-34-索引优化1-17-13"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时34-34-索引优化1-17-13"}},[s._v("#")]),s._v(" 课时34：34.索引优化1 17:13")]),s._v(" "),n("p",[s._v("应该避免索引失效")]),s._v(" "),n("h3",{attrs:{id:"建表sql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建表sql"}},[s._v("#")]),s._v(" 建表sql")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'姓名'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   age "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'年龄'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   pos "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'职位'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   add_time "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TIMESTAMP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURRENT_TIMESTAMP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'入职时间'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),s._v(" utf8 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'员工记录表'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" staffs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("add_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'z3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manager'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" staffs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("add_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" staffs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("add_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NOW")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" idx_staffs_nameAgePos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例")]),s._v(" "),n("ol",[n("li",[s._v("全值匹配")]),s._v(" "),n("li",[s._v("最佳左前缀法则")]),s._v(" "),n("li",[s._v("3.在索引列上做任何操作（计算、函数、类型转换——自动or手动）会让索引失效")]),s._v(" "),n("li",[s._v("存储引擎不能使用索引中范围条件右边的列")]),s._v(" "),n("li",[s._v("尽量使用覆盖索引（只访问索引的查询——索引列和查询列一致），减少 select *")]),s._v(" "),n("li",[s._v("mysql在使用不等于（!= 或 <>）时无法使用索引（PS：我反对）")]),s._v(" "),n("li",[s._v("is null，is not null也无法使用索引（PS：我反对）")]),s._v(" "),n("li",[s._v("like 以通配符开头（'%abc...'）mysql索引也会失效")]),s._v(" "),n("li",[s._v("字符串不加单引号索引失效")]),s._v(" "),n("li",[s._v("少用or，用它来连接时索引会失效（PS：我反对）")]),s._v(" "),n("li",[s._v("总结")])]),s._v(" "),n("h3",{attrs:{id:"_1-全值匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-全值匹配"}},[s._v("#")]),s._v(" 1.全值匹配")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 能用到索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全表扫描")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原因看下面的2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"_2-最佳左前缀法则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-最佳左前缀法则"}},[s._v("#")]),s._v(" 2.最佳左前缀法则")]),s._v(" "),n("ul",[n("li",[s._v("如果索引了多列，要遵守最左前缀法则。指的是查询从索引的最左前列开始并且"),n("code",[s._v("不跳过索引中的列")]),s._v("。")]),s._v(" "),n("li",[s._v("案例1中全表扫描的原因是 where 条件丢失了索引的最左前列 name。")]),s._v(" "),n("li",[n("code",[s._v("SELECT * FROM WHERE name='July' AND pos='dev';")]),s._v("这一句由于跳过中间列 age，只会用到部分索引。")])]),s._v(" "),n("h2",{attrs:{id:"课时35-35-索引优化2-04-06"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时35-35-索引优化2-04-06"}},[s._v("#")]),s._v(" 课时35：35.索引优化2 04:06")]),s._v(" "),n("h3",{attrs:{id:"_3-在索引列上做任何操作-计算、函数、类型转换-自动or手动-会让索引失效"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-在索引列上做任何操作-计算、函数、类型转换-自动or手动-会让索引失效"}},[s._v("#")]),s._v(" 3.在索引列上做任何操作（计算、函数、类型转换——自动or手动）会让索引失效")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全表扫描")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("left")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用到索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"课时36-36-索引优化3-04-24"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时36-36-索引优化3-04-24"}},[s._v("#")]),s._v(" 课时36：36.索引优化3 04:24")]),s._v(" "),n("h3",{attrs:{id:"_4-存储引擎不能使用索引中范围条件右边的列"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-存储引擎不能使用索引中范围条件右边的列"}},[s._v("#")]),s._v(" 4.存储引擎不能使用索引中范围条件右边的列")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manager'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type是ref")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manager'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type是range，此时pos的索引是用不到的")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"课时37-37-索引优化4-04-39"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时37-37-索引优化4-04-39"}},[s._v("#")]),s._v(" 课时37：37.索引优化4 04:39")]),s._v(" "),n("h3",{attrs:{id:"_5-尽量使用覆盖索引-只访问索引的查询-索引列和查询列一致-减少-select"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-尽量使用覆盖索引-只访问索引的查询-索引列和查询列一致-减少-select"}},[s._v("#")]),s._v(" 5. 尽量使用覆盖索引（只访问索引的查询——索引列和查询列一致），减少 select *")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manager'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Extra里只有Using where")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pos "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" pos"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'manager'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Extra里多了Using index，更好")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"课时38-38-索引优化5-02-06"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时38-38-索引优化5-02-06"}},[s._v("#")]),s._v(" 课时38：38.索引优化5 02:06")]),s._v(" "),n("h3",{attrs:{id:"_6-mysql在使用不等于-或-时无法使用索引-ps-我反对"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-mysql在使用不等于-或-时无法使用索引-ps-我反对"}},[s._v("#")]),s._v(" 6.mysql在使用不等于（!= 或 <>）时无法使用索引（PS：我反对）")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 讲师这两句中的type都是ALL，key都是NULL，即没有用到索引")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"我反对"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我反对"}},[s._v("#")]),s._v(" 我反对")]),s._v(" "),n("ol",[n("li",[s._v("当不等于的条件作用于主键或者unique列时，主键索引和唯一索引有效")])]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主键")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_tb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key为PRIMARY")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unique")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_tb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("unique_column"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6666")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key为unique_column_unique_idx")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("另外对于普通索引列可以看看这篇："),n("a",{attrs:{href:"https://www.cnblogs.com/niuben/p/11197945.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL中 IS NULL、IS NOT NULL、!= 能用上索引吗？"),n("OutboundLink")],1),s._v(" ，结论如下：MySQL中决定使不使用某个索引执行查询的依据很简单：就是成本够不够小。而不是WHERE子句中是否用了IS NULL、IS NOT NULL、!= 这些条件。")])]),s._v(" "),n("h2",{attrs:{id:"课时39-39-索引优化6-01-27"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时39-39-索引优化6-01-27"}},[s._v("#")]),s._v(" 课时39：39.索引优化6 01:27")]),s._v(" "),n("h3",{attrs:{id:"_7-is-null-is-not-null也无法使用索引-ps-我反对"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-is-null-is-not-null也无法使用索引-ps-我反对"}},[s._v("#")]),s._v(" 7.is null，is not null也无法使用索引（PS：我反对）")]),s._v(" "),n("p",[s._v("我的吐槽——这讲师不知道在搞什么，举两个的例子sql如下：")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行计划显示 type 和 key 都是 NULL")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这sql例子都举得有问题，课时34的建表语句都写了name列不能为null")]),s._v("\n   name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'姓名'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"我反对-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我反对-2"}},[s._v("#")]),s._v(" 我反对")]),s._v(" "),n("p",[s._v("建议返回去看38课时最后推荐的文章")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下是我在本地MySQL的执行记录，test_db表总记录数为293条")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("can_null_column"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 29")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("can_null_column"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 264")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("can_null_column"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，key为can_null_column_idx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("can_null_column"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ALL，key为null")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("本课时和上一课时有关 is null，is not null，<> 的内容都是以偏概全。")]),s._v(" "),n("h2",{attrs:{id:"课时40-40-索引优化7-16-44"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时40-40-索引优化7-16-44"}},[s._v("#")]),s._v(" 课时40：40.索引优化7 16:44")]),s._v(" "),n("h3",{attrs:{id:"_8-like-以通配符开头-abc-mysql索引也会失效"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-like-以通配符开头-abc-mysql索引也会失效"}},[s._v("#")]),s._v(" 8. like 以通配符开头（'%abc...'）mysql索引也会失效")]),s._v(" "),n("p",[s._v("例外情况："),n("code",[s._v("like %xxx%")]),s._v("查询覆盖索引的情况下可以用到索引；")]),s._v(" "),n("h2",{attrs:{id:"课时41-41-索引优化8-08-28"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时41-41-索引优化8-08-28"}},[s._v("#")]),s._v(" 课时41：41.索引优化8 08:28")]),s._v(" "),n("h3",{attrs:{id:"_9-字符串不加单引号索引失效"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-字符串不加单引号索引失效"}},[s._v("#")]),s._v(" 9. 字符串不加单引号索引失效")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，key为idx_staffs_nameAgePos")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ALL，key为NULL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原因是存在隐式类型转换")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"_10-少用or-用它来连接时索引会失效-我返对"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-少用or-用它来连接时索引会失效-我返对"}},[s._v("#")]),s._v(" 10. 少用or，用它来连接时索引会失效（我返对）")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 讲师的sql和执行计划")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" staffs "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'July'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'z3'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ALL，key为NULL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我反对，以下是我本地执行的结果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_tb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key用到了user_id索引，Extra为Using index condition")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_tb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为index_merge，key同时用到了两个列索引，Extra里出现了Using union")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# avatar列没有索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("zhaocaibao"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("wwdz_account"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("or")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("avatar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'666666'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ALL，key为NULL")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"_11-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-总结"}},[s._v("#")]),s._v(" 11. 总结")]),s._v(" "),n("p",[s._v("就是出了一些题目，假设 index(a,b,c)，备注：课时43内容和这里重复，多了一点例题")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("Where语句")]),s._v(" "),n("th",[s._v("索引是否被使用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("where a=3")]),s._v(" "),n("td",[s._v("Y，使用到a")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b=5")]),s._v(" "),n("td",[s._v("Y，使用到a，b")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b=5 and c=4")]),s._v(" "),n("td",[s._v("Y，使用到a，b，c")])]),s._v(" "),n("tr",[n("td",[s._v("where b=3或者where b=3 and c=4或者where c=4")]),s._v(" "),n("td",[s._v("N")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and c=5")]),s._v(" "),n("td",[s._v("使用到a，但是c不可以，b中间断了")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b>4 and c=5")]),s._v(" "),n("td",[s._v("使用到a和b，c不能用在范围之后")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b like 'kk%' and c=4")]),s._v(" "),n("td",[s._v("Y，使用到a，b，c")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b like '%kk' and c=4")]),s._v(" "),n("td",[s._v("Y，使用到a")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b like '%kk%' and c=4")]),s._v(" "),n("td",[s._v("Y，使用到a")])]),s._v(" "),n("tr",[n("td",[s._v("where a=3 and b like 'k%kk%' and c=4")]),s._v(" "),n("td",[s._v("Y，使用到a，b，c")])])])]),s._v(" "),n("h3",{attrs:{id:"我的总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我的总结"}},[s._v("#")]),s._v(" 我的总结")]),s._v(" "),n("p",[s._v("以上索引失效相关知识我个人觉得还是仅供参考，实际情况一切以生产环境的执行计划为准!!!")]),s._v(" "),n("h2",{attrs:{id:"课时42-42-索引优化9-05-16"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时42-42-索引优化9-05-16"}},[s._v("#")]),s._v(" 课时42：42.索引优化9 05:16")]),s._v(" "),n("p",[s._v("这里讲的还是"),n("code",[s._v("字符串不加单引号索引失效")]),s._v("，内容和41课时重复。")]),s._v(" "),n("h2",{attrs:{id:"课时43-43-索引优化10-03-07"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时43-43-索引优化10-03-07"}},[s._v("#")]),s._v(" 课时43：43.索引优化10 03:07")]),s._v(" "),n("p",[s._v("这里讲的是"),n("code",[s._v("总结")]),s._v("，内容和41课时重复。")]),s._v(" "),n("h2",{attrs:{id:"课时44-44-索引面试题分析31-56"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时44-44-索引面试题分析31-56"}},[s._v("#")]),s._v(" 课时44：44.索引面试题分析31:56")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建表语句：略")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" inx_test03_c1234 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" test03"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a3'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key为idx_test03_c1234，ref为const,const,const,const")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a3'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key为idx_test03_c1234，ref为const,const,const,const")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a3'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为range，key为idx_test03_c1234，ref为NULL")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，const，这里c3有起排序的作用")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，const，和上一条完全一致")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，const，但是Extra里出现了Using filesort")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a5'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，只用到c1索引，c2和c3排序去了，没有filesort")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a5'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，Extra出现了Using filesort")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，red为const，cosnt，没有filesort")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a5'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，red为const，cosnt，没有filesort，这里的c5条件没影响")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a2'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c5"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a5'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里没有出现filesort，原因是ORDER BY里的c2已经是一个WHERE常量了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# type为ref，ref为const，没有filesort")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test03 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a1'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" c4"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a4'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GROUP")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Extra同时出现了Using temporary和Using filesort")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GROUP BY分组，基本都需要排序，所以使用和优化原则基本和ORDER BY一致")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br")])]),n("h2",{attrs:{id:"课时45-45-索引优化答疑补充和总结口诀08-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时45-45-索引优化答疑补充和总结口诀08-10"}},[s._v("#")]),s._v(" 课时45：45.索引优化答疑补充和总结口诀08:10")]),s._v(" "),n("p",[s._v("一般性建议：")]),s._v(" "),n("ol",[n("li",[s._v("对于单键索引，尽量选择针对当前 query 过滤性更好的索引")]),s._v(" "),n("li",[s._v("在选择组合索引的时候，当前 query 中过滤性最好的字段在索引字段顺序中，位置越靠前越好")]),s._v(" "),n("li",[s._v("在选择组合索引的时候，尽量选择可以能够包含当前 query 中的 where 子句中更多字段的索引")]),s._v(" "),n("li",[s._v("尽可能通过分析统计信息和调整 query 的写法来达到选择合适索引的目的")])]),s._v(" "),n("h2",{attrs:{id:"课时46-46-小表驱动大表15-42"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时46-46-小表驱动大表15-42"}},[s._v("#")]),s._v(" 课时46：46.小表驱动大表15:42")]),s._v(" "),n("h3",{attrs:{id:"查询截取分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询截取分析"}},[s._v("#")]),s._v(" 查询截取分析")]),s._v(" "),n("ul",[n("li",[s._v("查询优化")]),s._v(" "),n("li",[s._v("慢查询日志")]),s._v(" "),n("li",[s._v("批量数据脚本")]),s._v(" "),n("li",[s._v("Show Profile")]),s._v(" "),n("li",[s._v("全局查询日志")])]),s._v(" "),n("p",[s._v("分析步骤：")]),s._v(" "),n("ol",[n("li",[s._v("观察，至少跑1天，看看生产的慢 sql 情况")]),s._v(" "),n("li",[s._v("开启慢查询日志，设置阈值，比如超过几秒钟的就是慢 sql，并将它抓取出来")]),s._v(" "),n("li",[s._v("explain + 慢 sql 分析")]),s._v(" "),n("li",[s._v("show profile")]),s._v(" "),n("li",[s._v("运维经理 or DBA，进行 sql 数据库服务器的参数调优")])]),s._v(" "),n("p",[s._v("总结：")]),s._v(" "),n("ol",[n("li",[s._v("慢查询的开启并捕获")]),s._v(" "),n("li",[s._v("explain + 慢 sql 分析")]),s._v(" "),n("li",[s._v("show profile查询 sql 在 mysql服务器里面的执行细节和生命周期情况")]),s._v(" "),n("li",[s._v("sql 数据库服务器的参数调优")])]),s._v(" "),n("h3",{attrs:{id:"查询优化-小表驱动大表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询优化-小表驱动大表"}},[s._v("#")]),s._v(" 查询优化——小表驱动大表")]),s._v(" "),n("p",[s._v("优化原则：小表驱动大表，即小的数据集驱动大的数据集。")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n等价于：\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n\n但B表的数据集小于A表的数据集时，用"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v("优于"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n等价于：\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" A\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" B "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("A"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n\n当A表的数据集小于B表的数据集时，用"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v("优于"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v("\n\n注意：A表与B表的ID字段应当建立索引\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"exists"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#exists"}},[s._v("#")]),s._v(" EXISTS")]),s._v(" "),n("ul",[n("li",[s._v("用法："),n("code",[s._v("SELECT ... FROM table WHERE EXISTS (subquery)")])]),s._v(" "),n("li",[s._v("该语法可以理解为：将主查询的数据，放到子查询中做条件验证，根据验证结果（TRUE或FALSE）来决定主查询的数据结果是否得以保留")]),s._v(" "),n("li",[s._v("提示：\n"),n("ol",[n("li",[s._v("EXISTS(subquery) 只返回 TRUE 或 FALSE，因此子查询中的 EELECT * 也可以是 SELECT 1 或其他，官方说法是实际执行时会忽略 SELECT 清单，因此没有区别")]),s._v(" "),n("li",[s._v("EXISTS 子查询的实际执行过程可能经过了优化而不是我们理解上的逐条对比，如果担忧效率问题，可进行实际检验以确定是否有效率问题")]),s._v(" "),n("li",[s._v("EXISTS 子查询往往也可以用条件表达式、其他子查询或者 JOIN 来替代，何种最优需要具体问题具体分析")])])])]),s._v(" "),n("h2",{attrs:{id:"课时47-47-in和exists03-12"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时47-47-in和exists03-12"}},[s._v("#")]),s._v(" 课时47：47.in和exists03:12")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tb1_emp e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptId "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tb1_dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n等同于\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tb1_emp e "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exists")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tb1_dept d "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("deptId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"课时48-48-为排序使用索引orderby优化25-22"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时48-48-为排序使用索引orderby优化25-22"}},[s._v("#")]),s._v(" 课时48：48.为排序使用索引OrderBy优化25:22")]),s._v(" "),n("h3",{attrs:{id:"orderby-优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#orderby-优化"}},[s._v("#")]),s._v(" ORDERBY 优化")]),s._v(" "),n("ul",[n("li",[s._v("ORDER BY 子句，尽量使用 Index 方式排序，避免使用 FileSort 方式排序\n"),n("ul",[n("li",[s._v("MySQL 支持二种方式的排序，Filesort 和 Index，Index 效率高，它指 MySQL 扫描索引本身完成排序，Filesort 效率较低.")]),s._v(" "),n("li",[s._v("ORDER BY 满足两种情况会使用 Index 方式排序：\n"),n("ol",[n("li",[s._v("ORDER BY 语句使用索引最左前列")]),s._v(" "),n("li",[s._v("使用 where 子句与 Order By 子句条件列组合满足索引最左前列")])])])])]),s._v(" "),n("li",[s._v("尽可能在索引列上完成排序操作，遵照索引建的最佳左前缀")]),s._v(" "),n("li",[s._v("如果不在索引列上，filesort 有两种算法：双路排序和单路排序\n"),n("ul",[n("li",[s._v("双路排序：mysql4.1 之前是使用双路排序，字面意思就是两次扫描磁盘，最终得到数据，读取行指针和 orderby 列，对他们进行排序，然后扫描已经排序好的列表，按照列表中的值重新从列表中读取对应的数据输出；从磁盘取排序字段，在 buffer 进行排序，再从磁盘取其他字段。")]),s._v(" "),n("li",[s._v("取一批数据，要对磁盘进行两次扫描，I/O 是很耗时的，所以在 mysql4.1 之后，出现了第二种改进的算法，就是单路排序")]),s._v(" "),n("li",[s._v("单路排序：从磁盘读取查询需要的所有列，按照 orderby 列在 buffer 对它们进行排序，然后扫描排序后的列表进行输出，它的效率更快一些，避免了第二次读取数据，并且把随机 IO 编程了顺序 IO，但是它会使用更多的空间，因为把每一行数据都保存在内存中了。")]),s._v(" "),n("li",[s._v("结论及引申出的问题：由于单路是后出的，总体而言好过双路；但是用单路有问题，如下：\n"),n("blockquote",[n("p",[s._v("在 sort_buffer 中，单路要比双路多占用很多空间，因为单路是把所有字段都取出，所以有可能取出的数据大小超出了 sort_buffer 的容量，导致每次只能取 sort_buffer 容量大小的数据进行排除（创建tmp文件，多路合并），排完再取 sort_buffer 容量大小的数据，周而复始...从而导致多次 I/O。此时单路算法得不偿失。")])])])])]),s._v(" "),n("li",[s._v("优化策略\n"),n("ul",[n("li",[s._v("增大 sort_buffer_sort 参数的设置")]),s._v(" "),n("li",[s._v("增大 max_length_for_sort_data 参数的设置")]),s._v(" "),n("li",[s._v("why：\n"),n("ol",[n("li",[s._v("Order by 时 select * 是一个大忌，只 Query 需要的字段，这点非常重要。 在这里的影响是:\n1.1 当 Query 的字段大小总和小于 max_length_for_sort_data 而且排序字段不是 TEXT|BLOB 类型时，会用改进后的算法一一单路排序，否则用老算法——多路排序。\n1.2 两种算法的数据都有可能超出 sort_buffer 的容量，超出之后，会创建 tmp 文件进行合并排序，导致多次I/O，但是用单路排序算法的风险会更大一些，所以要提高sort_buffer_size。")]),s._v(" "),n("li",[s._v("尝试提高 sort_buffer_size：不管用哪种算法，提高这个参数都会提高效率，当然，要根据系统的能力去提高，因为这个参数是针对每个进程的")]),s._v(" "),n("li",[s._v("尝试提高 max_length_for_sort_data：提高这个参数，会增加用改进算法的概率。 但是如果设的太高，数据总容量超出 sort_buffer_size 的概率就增大，明显症状是高的磁盘I/O活动和低的处理器使用率.")])])])])]),s._v(" "),n("li",[s._v("小总结"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[s._v("MySQL 两种排序方式：文件排序或扫描有序索引排序\nMySQL 能为排序与查询使用相同的索引\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" a_b_c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# order by 能使用索引最左前缀")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果 WHERE 使用索引的最左前缀定义为常量，则 order by 能使用索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" b "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能使用索引进行排序")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ASC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DESC")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 排序不一致")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 丢失a索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" c     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 丢失b索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# d不是索引的一部分")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于排序来说，多个相等条件也是范围查询")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时49-49-慢查询日志19-07"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时49-49-慢查询日志19-07"}},[s._v("#")]),s._v(" 课时49：49.慢查询日志19:07")]),s._v(" "),n("h3",{attrs:{id:"groupby-优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#groupby-优化"}},[s._v("#")]),s._v(" GROUPBY 优化")]),s._v(" "),n("p",[s._v("基本和 order by 一致")]),s._v(" "),n("ol",[n("li",[s._v("group by 实质是先排序后分组，遵照索引建的最佳左前缀")]),s._v(" "),n("li",[s._v("当无法使用索引列，增大 max_length_for_sort_data 参数的设置 + 增大sort_buffer_size 参数的设置")]),s._v(" "),n("li",[s._v("where 高于 having，能写在 where 的限定条件就不要去 having 限定了")])]),s._v(" "),n("h3",{attrs:{id:"慢查询日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#慢查询日志"}},[s._v("#")]),s._v(" 慢查询日志")]),s._v(" "),n("h4",{attrs:{id:"是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[s._v("#")]),s._v(" 是什么")]),s._v(" "),n("ul",[n("li",[s._v("MySQL 的慢查询日志是 MySQL 提供的一种日志记录，它用来记录在 MySQL 中响应时间超过阀值的语句，具体指运行时间超过 long_query_time 值的 SQL，则会被记录到慢查询日志中。")]),s._v(" "),n("li",[s._v("long_query_time的默认值为 10，意思是运行10秒以上的语句。（PS：我买的阿里云 RDS MySQL 默认是 1 秒）")]),s._v(" "),n("li",[s._v("由他来查看哪些 SQL 超出了我们的最大忍耐时间值，比如一条 SQL 执行超过 5 秒钟，我们就算慢 SQL，希望能收集超过 5 秒的 sql，结合之前 explain 进行全面分析。")])]),s._v(" "),n("h4",{attrs:{id:"怎么玩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#怎么玩"}},[s._v("#")]),s._v(" 怎么玩")]),s._v(" "),n("ul",[n("li",[s._v("说明：\n"),n("ul",[n("li",[n("code",[s._v("默认情况下，MySQL 数据库没有开启慢查询日志，")]),s._v("需要我们手动来设置这个参数")]),s._v(" "),n("li",[n("code",[s._v("当然，如果不是调优需要的话，一般不建议启动该参数，")]),s._v("因为开启慢查询日志会或多或少带来一定的性能影响。慢查询日志支持将日志记录写入文件")])])]),s._v(" "),n("li",[s._v("查看是否开启以及如何开启：\n"),n("ul",[n("li",[s._v("默认："),n("code",[s._v("SHOW VARIABLES LIKE '%slow_query_log%';")])]),s._v(" "),n("li",[s._v("开启："),n("code",[s._v("set global slow_query_log=1;")]),s._v("，只对当前数据库有效，MySQL 重启就会失效。如果要永久生效，就要修改 my.cnf 文件。")])])]),s._v(" "),n("li",[s._v("开启慢查询日志后，什么样的 SQL 才会记录到慢查询日志呢？\n"),n("ul",[n("li",[s._v("这个是由参数 long_query_time 控制，默认情况下 long_query_time 的值为 10 秒。")]),s._v(" "),n("li",[s._v("查看命令："),n("code",[s._v("SHOW VARIABLES LIKE 'long_query_time%';")])]),s._v(" "),n("li",[s._v("修改：可以用命令修改，也可以修改 my.cnf。")]),s._v(" "),n("li",[s._v("注意：假如运行时间刚好等于 long_query_time，并不会记录，因为 MySQL 源码里是判断大于，而不是大于等于。")])])]),s._v(" "),n("li",[s._v("设置慢的阈值时间："),n("code",[s._v("set global long_query_time=3;")])]),s._v(" "),n("li",[s._v("为什么设置后看不出变化：需要重新连接或新开一个会话才能看到修改值，或者使用"),n("code",[s._v("SHOW GLOBAL VARIABLES LIKE 'long_query_time%';")])]),s._v(" "),n("li",[s._v("记录慢 SQL 并后续分析：\n"),n("ul",[n("li",[s._v("伪造慢 SQL："),n("code",[s._v("select sleep(4);")])]),s._v(" "),n("li",[s._v("查看慢 SQL："),n("code",[s._v("cat /var/lib/mysql/xxx-slow.log")])])])]),s._v(" "),n("li",[s._v("查询当前系统中有多少条慢查询记录："),n("code",[s._v("show global status like '%Slow_queries%';")])]),s._v(" "),n("li",[s._v("my.cnf 配置版："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# [mysqld]下配置\n[mysqld]\nslow_query_log=1;\nslow_query_log_file=/var/lib/mysql/atguigu-slow.log\nlong_query_time=3;\nlog_ouput=FILE;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"日志分析工具-mysqldumpslow"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志分析工具-mysqldumpslow"}},[s._v("#")]),s._v(" 日志分析工具 mysqldumpslow")]),s._v(" "),n("p",[s._v("在生产环境中，如果要手工分析日志，查找、分析 SQL，显然是个体力活，MySQL 提供了日志分析工具 mysqldumpslow。")]),s._v(" "),n("ul",[n("li",[s._v("查看 mysqldumpslow 的帮助信息："),n("code",[s._v("mysqldumpslow --help")]),s._v(" "),n("ul",[n("li",[s._v("s：表示按照何种方式排序")]),s._v(" "),n("li",[s._v("c：访问次数")]),s._v(" "),n("li",[s._v("l：锁定时间")]),s._v(" "),n("li",[s._v("r：返回记录")]),s._v(" "),n("li",[s._v("t：查询时间")]),s._v(" "),n("li",[s._v("al：平均锁定时间")]),s._v(" "),n("li",[s._v("ar：平均返回记录数")]),s._v(" "),n("li",[s._v("at：平均查询时间")]),s._v(" "),n("li",[s._v("t：即为返回前面多少条的数据")]),s._v(" "),n("li",[s._v("g：后边搭配一个正则匹配模式，大小写不敏感的")])])]),s._v(" "),n("li",[s._v("工作常用参考："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 得到返回记录集最多的10个SQL\nmysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log\n# 得到访问次数最多的10个SQL\nmysqldumpslow -s c -t 10 /var/lib/mysql/atguigu-slow.log\n# 得到按照时间排序的前10条里面含有左连接的查询语句\nmysqldumpslow -s t -t 10 -g "left join" /var/lib/mysql/atguigu-slow.log\n# 另外建议在使用这些命令时结合 | 和 more 使用，否则可能出现爆屏情况\nmysqldumpslow -s r -t 10 /var/lib/mysql/atguigu-slow.log | more\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时50-50-批量插入数据脚本21-36"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时50-50-批量插入数据脚本21-36"}},[s._v("#")]),s._v(" 课时50：50.批量插入数据脚本21:36")]),s._v(" "),n("p",[s._v("往表里插入 1000W 数据")]),s._v(" "),n("ol",[n("li",[s._v("建表"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.建表dept")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   deptno "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MEDIUMINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   dname "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   loc "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("GBK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.建表emp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" emp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   empno "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MEDIUMINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   ename "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   job "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   mgr "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MEDIUMINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*上级编号*/")]),s._v("\n   hiredate "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*入职时间*/")]),s._v("\n   sal "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*薪水*/")]),s._v("\n   comm "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECIMAL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*红利*/")]),s._v("\n   deptno "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MEDIUMINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*部门编号*/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("GBK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])])]),s._v(" "),n("li",[s._v("设置参数 log_bin_trust_function_creators，原因是开启了慢查询日志和 binlog，我们必须为函数指定一个参数，否则在创建函数是会报错："),n("code",[s._v("This function has none of DETERMINISTIC...")]),s._v("，可以通过设置该参数解决问题。"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" variables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_bin_trust_function_creators'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" log_bin_trust_function_creators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 想要永久生效就设置到my.cnf里")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[s._v("创建函数，保证每条数据都不同\n"),n("ul",[n("li",[s._v("创建随机产生字符串的函数："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $$\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" rand_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURNS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" chars_str "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" return_str "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" O"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("nDO\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" return_str"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CONCAT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("return_str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" SUBSTRING"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("chars_str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" FLOOR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("RAND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURN")]),s._v(" return_str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" $$\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])]),s._v(" "),n("li",[s._v("创建随机上传部门编号的函数："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $$\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" rand_num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURNS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" FLOOR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("RAND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURN")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" $$\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])])]),s._v(" "),n("li",[s._v("创建存储过程\n"),n("ul",[n("li",[s._v("创建往 emp 表中插入数据的存储过程"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $$\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" insert_emp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" max_num "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" emp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("job"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mgr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("hiredate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("comm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("deptno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("rand_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SALESMAN'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CURDATE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("rand_num"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   UNTIL i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("max_num\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      \n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMIT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" $$\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])]),s._v(" "),n("li",[s._v("创建往 dept 表中插入数据的存储过程"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $$\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" insert_dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" max_num "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("deptno"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("loc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("rand_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("rand_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   UNTIL i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("max_num\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPEAT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      \n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMIT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" $$\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])])])]),s._v(" "),n("li",[s._v("调用存储过程"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" insert_dept"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" insert_emp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时51-51-用show-profile进行sql分析23-55"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时51-51-用show-profile进行sql分析23-55"}},[s._v("#")]),s._v(" 课时51：51.用Show Profile进行sql分析23:55")]),s._v(" "),n("h3",{attrs:{id:"show-profile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#show-profile"}},[s._v("#")]),s._v(" Show Profile")]),s._v(" "),n("ul",[n("li",[s._v("是什么：是 mysql 提供可以用来分析当前会话中语句执行的资源消耗情况。可以用于 SQL 的调优的测量")]),s._v(" "),n("li",[s._v("官网：http://dev.mysql.com/doc/refman/5.5/en/show-profile.html")]),s._v(" "),n("li",[s._v("默认情况下，参数处于关闭状态，并保存最近15次的运行结果")]),s._v(" "),n("li",[s._v("分析步骤：\n"),n("ol",[n("li",[s._v("是否支持，看看当前的 mysql 版本是否支持："),n("code",[s._v("show variables like 'profiling';")])]),s._v(" "),n("li",[s._v("开启功能，默认是关闭，使用前需要开启："),n("code",[s._v("set profiling=on;")])]),s._v(" "),n("li",[s._v("运行sql：\n"),n("ul",[n("li",[n("code",[s._v("select * from emp group by id%10 limit 150000;")])]),s._v(" "),n("li",[n("code",[s._v("select * from emp group by id%20 order by 5;")])])])]),s._v(" "),n("li",[s._v("查看结果："),n("code",[s._v("show profiles;")])]),s._v(" "),n("li",[s._v("诊断 SQL，"),n("code",[s._v("show profile cpu,block io for query {上一步前面问题 SQL id}")]),s._v("；")]),s._v(" "),n("li",[s._v("日常开发需要注意的结论：下面这四个出现任何一个都应该优化了\n"),n("ul",[n("li",[s._v("converting HEAP to MyISAM 查询结果太大，内存都不够用了，直接往磁盘上搬")]),s._v(" "),n("li",[s._v("Creating tmp table 创建临时表：拷贝数据到临时表，用完再删除")]),s._v(" "),n("li",[s._v("Copying to tmp table on disk：把内存中临时表复制到磁盘，危险")]),s._v(" "),n("li",[s._v("locked")])])])])])]),s._v(" "),n("h2",{attrs:{id:"课时52-52-全局查询日志04-18"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时52-52-全局查询日志04-18"}},[s._v("#")]),s._v(" 课时52：52.全局查询日志04:18")]),s._v(" "),n("ul",[n("li",[s._v("配置启用："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("在 mysql 的 my.cnf 中，设置如下：\n# 开启\ngeneral_log=1\n# 记录日志文件的路径\ngeneral_log_file=/path/logfile\n# 输出格式\nlog_output=FILE\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])]),s._v(" "),n("li",[s._v("编码启动："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("set global general_log=1;\nset global log_output='TABLE';\n# 此后，所有sql语句都会记录到mysql库里的general_log表，可以用下面的命令查看\nselect * from mysql.general_log limit 50;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])])]),s._v(" "),n("li",[n("strong",[s._v("注意：永远不要在生产环境开启这个功能！！！")])])]),s._v(" "),n("h2",{attrs:{id:"课时53-53-数据库锁理论概述04-52"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时53-53-数据库锁理论概述04-52"}},[s._v("#")]),s._v(" 课时53：53.数据库锁理论概述04:52")]),s._v(" "),n("ul",[n("li",[s._v("锁的定义：\n"),n("ul",[n("li",[s._v("锁是计算机协调多个进程或线程并发访问某一资源的机制。")]),s._v(" "),n("li",[s._v("在数据库中，除传统的计算资源（如 CPU、RAM、I/O等）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。")])])]),s._v(" "),n("li",[s._v("锁的分类：\n"),n("ul",[n("li",[s._v("从对数据操作的类型（读/写）分：\n"),n("ul",[n("li",[s._v("读锁（共享锁）：针对同一份数据，多个读操作可以同时进行而不会互相影响。")]),s._v(" "),n("li",[s._v("写锁（排他锁）：当前写操作没有完成前，它会阻断其他写锁和读锁。")])])]),s._v(" "),n("li",[s._v("从对数据操作的粒度分：\n"),n("ul",[n("li",[s._v("表锁")]),s._v(" "),n("li",[s._v("行锁")])])])])])]),s._v(" "),n("h2",{attrs:{id:"课时54-54-读锁案例讲解1-7-13"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时54-54-读锁案例讲解1-7-13"}},[s._v("#")]),s._v(" 课时54：54.读锁案例讲解1 7:13")]),s._v(" "),n("p",[s._v("三锁：表锁、行锁、页锁")]),s._v(" "),n("h3",{attrs:{id:"表锁-偏读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表锁-偏读"}},[s._v("#")]),s._v(" 表锁（偏读）")]),s._v(" "),n("ul",[n("li",[s._v("特点：偏向 MyISAM 存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突概率最高，并发度最低。")]),s._v(" "),n("li",[s._v("案例分析：\n"),n("ul",[n("li",[s._v("建表 SQL：略")]),s._v(" "),n("li",[s._v("查看表上加过的锁："),n("code",[s._v("show open tables;")])]),s._v(" "),n("li",[s._v("加读/写锁："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写法：lock table {表1名} {read|write},{表2名} {read|write},...;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 案例")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" mylock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("book "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看锁")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("open")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解锁")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unlock")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])])])]),s._v(" "),n("h3",{attrs:{id:"案例讲解1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例讲解1"}},[s._v("#")]),s._v(" 案例讲解1")]),s._v(" "),n("ul",[n("li",[s._v("session1 给 mylock 表加读锁："),n("code",[s._v("lock table mylock read;")]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("session1 可以读 mylock 表，但不能写（执行update/insert）\nsession1 不可以读其他的表，比如 book 表，select 会报错 Table `book` not locked with LOCK TABLES\n\nsession2 可以读 mylock 表，执行写操作（如update/insert 语句）时会阻塞，直到 session1 释放读锁\nsession2 可以读其他的表，比如 book 表\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时55-55-读锁案例讲解2-10-01"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时55-55-读锁案例讲解2-10-01"}},[s._v("#")]),s._v(" 课时55：55.读锁案例讲解2 10:01")]),s._v(" "),n("h3",{attrs:{id:"案例讲解2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例讲解2"}},[s._v("#")]),s._v(" 案例讲解2")]),s._v(" "),n("ul",[n("li",[s._v("session1 给 mylock 表加写锁："),n("code",[s._v("lock table mylock write;")]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("session1 可以读写 mylock\nsession1 不可以读其他的表，比如 book 表，这里和加读锁的效果一样会报错\n\nsession2 可以读其他的表，比如 book 表\nsession2 对 mylock 表执行 select 操作也会阻塞，直到锁释放\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"案例结论"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例结论"}},[s._v("#")]),s._v(" 案例结论")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("MyISAM 在执行查询语句（SELECT）前，会自动给涉及的所有表加读锁，在执行增刪改操作前，会自动给涉及的表加写锁。")])]),s._v(" "),n("li",[n("p",[s._v("MySQL 的表级锁有两种模式:")]),s._v(" "),n("ul",[n("li",[s._v("表共享读锁(Table Read Lock)")]),s._v(" "),n("li",[s._v("表独占写锁(Table Write Lock)|")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("锁类型")]),s._v(" "),n("th",[s._v("可否兼容")]),s._v(" "),n("th",[s._v("读锁")]),s._v(" "),n("th",[s._v("写锁")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("读锁")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("否")])]),s._v(" "),n("tr",[n("td",[s._v("写锁")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("否")])])])])]),s._v(" "),n("li",[n("p",[s._v("结论:结合上表，所以对 MyISAM 表进行操作，会有以下情况:")]),s._v(" "),n("ol",[n("li",[s._v("对 MyISAM 表的读操作(加读锁)，不会阻塞其他进程对同一表的读请求，但会阻塞对同一表的写请求。只有当读锁释放后，才会执行其它进程的写操作。")]),s._v(" "),n("li",[s._v("对 MyISAM 表的写操作(加写锁)，会阻塞其他进程对同一表的读和写操作，只有当写锁释放后，才会执行其它进程的读写操。")])])]),s._v(" "),n("li",[n("p",[s._v("简而言之，读锁会阻塞写，但不会阻塞读；而写锁则会把读和写都阻塞。")])])]),s._v(" "),n("h3",{attrs:{id:"表锁分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表锁分析"}},[s._v("#")]),s._v(" 表锁分析")]),s._v(" "),n("ul",[n("li",[s._v("看看哪些表被加锁了："),n("code",[s._v("show open tables;")])]),s._v(" "),n("li",[s._v("如何分析表锁定：\n"),n("ul",[n("li",[s._v("可以通过检查 table_locks_waited 和 table_locks_immediate 状态变量来分析系统上的表锁定；sql为"),n("code",[s._v("show status like 'table%';")])]),s._v(" "),n("li",[s._v("这两个状态变脸记录 MySQL 内部表级锁定的情况，说明如下：\n"),n("ul",[n("li",[s._v("table_locks_immediate：产生表级锁定的次数，表示可以立即获取锁的查询次数，每立即获取锁值加 1；")]),s._v(" "),n("li",[s._v("table_locks_waited：出现表级锁定争用而发生等待的次数（不能立即后去锁的次数，每等待一次锁值加 1），此值高则说明存在着较严重的表级锁争用情况；")])])]),s._v(" "),n("li",[s._v("此外，MyISAM 的读写锁调度是写优先，这也是 MyISAM 不适合做写为主的引擎。因为写锁后，其他线程不能做任何操作，大量的更新会使查询很难得到锁，从而造成长久阻塞。")])])])]),s._v(" "),n("h2",{attrs:{id:"课时56-56-行锁理论07-04"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时56-56-行锁理论07-04"}},[s._v("#")]),s._v(" 课时56：56.行锁理论07:04")]),s._v(" "),n("h3",{attrs:{id:"行锁-偏写"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#行锁-偏写"}},[s._v("#")]),s._v(" 行锁（偏写）")]),s._v(" "),n("ul",[n("li",[s._v("特点：\n"),n("ul",[n("li",[s._v("偏向 InnoDB 存储引擎，开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。")]),s._v(" "),n("li",[s._v("InnoDB 与 MyISAM 的最大不同有两点：一是支持事务（TRANSACTION）；二是采用了行级锁")])])]),s._v(" "),n("li",[s._v("复制老知识，由于行锁支持事务：\n"),n("ul",[n("li",[n("p",[s._v("事务及其 ACID 属性：原子性（Atomicity）、一致性（Consistent）、隔离性（Isolation）、持久性（Dutable）")])]),s._v(" "),n("li",[n("p",[s._v("并发事务处理带来的问题：更新丢失（同时更新同一条记录）、脏读（读到了其他事务已修改但未提交的数据）、不可重复读（读到了其他事务已提交的修改数据）、幻读（读到了其他事务提交的新增数据）")])]),s._v(" "),n("li",[n("p",[s._v("事务隔离级别：脏读、不可重复读、幻读，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("隔离级别")]),s._v(" "),n("th",[s._v("读数据一致性")]),s._v(" "),n("th",[s._v("脏读")]),s._v(" "),n("th",[s._v("不可重复读")]),s._v(" "),n("th",[s._v("幻读")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("未提交读")]),s._v(" "),n("td",[s._v("最低级别，只能保证不读取物理上损坏的数据")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("是")])]),s._v(" "),n("tr",[n("td",[s._v("已提交读")]),s._v(" "),n("td",[s._v("语句级")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("是")]),s._v(" "),n("td",[s._v("是")])]),s._v(" "),n("tr",[n("td",[s._v("可重复读")]),s._v(" "),n("td",[s._v("事务级")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("是")])]),s._v(" "),n("tr",[n("td",[s._v("可序列化")]),s._v(" "),n("td",[s._v("最高级别，事务级")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("否")]),s._v(" "),n("td",[s._v("否")])])])]),s._v(" "),n("ul",[n("li",[s._v('数据库的事务隔离越严格，并发副作用越小，但付出的代价也就越大，因为事务隔离实质上就是使事务在一定程度上"串行化"进行，这显然与"并发"是矛盾的。同时，不同的应用对读一致性和事务隔离程度的要求也是不同的，比如许多应用对"不可重复读"和"幻读"并不敏感，可能更关心数据并发访问的能力。')]),s._v(" "),n("li",[s._v("查看当前数据的事务隔离级别："),n("code",[s._v("show variables like 'tx_isolation';")]),s._v("，MySQL 的默认隔离级别是可重复读（Repeatable read）。")])])])])])]),s._v(" "),n("h2",{attrs:{id:"课时57-57-行锁案例讲解15-38"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时57-57-行锁案例讲解15-38"}},[s._v("#")]),s._v(" 课时57：57.行锁案例讲解15:38")]),s._v(" "),n("h3",{attrs:{id:"案例分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例分析"}},[s._v("#")]),s._v(" 案例分析")]),s._v(" "),n("ul",[n("li",[s._v("建表 sql：略")]),s._v(" "),n("li",[s._v("行表锁的基本演示"),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备：session1和session2都先关闭自动提交")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 演示一：读取更新的数据")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时session1执行一条update语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4001'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1 执行 select 语句发现数据变了，session2 执行 select 读不到session1 修改的数据")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1 执行一下 commit;，发现 session2 还是读不到新数据，原因是session2 也需要 commit; 一下，然后 session2 就能 select 到新数据了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 演示二：两个会话更新同一条记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1执行一条update语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4001'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session2更新同一条记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4003'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时会发现session2的执行阻塞，直到session1执行了commit;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 演示三：两个会话更新不同的记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1执行一条update语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4005'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session2更新不同记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9001'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并没有执行阻塞")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"课时58-58-行锁演示答疑补充05-12"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时58-58-行锁演示答疑补充05-12"}},[s._v("#")]),s._v(" 课时58：58.行锁演示答疑补充05:12")]),s._v(" "),n("p",[s._v("两个设置了"),n("code",[s._v("set autocommit=0;")]),s._v("的 session 之间如果要读取对方修改后的数据，需要执行一下"),n("code",[s._v("commit;")]),s._v("才能读到。")]),s._v(" "),n("h2",{attrs:{id:"课时59-59-索引失效行锁变表锁07-05"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时59-59-索引失效行锁变表锁07-05"}},[s._v("#")]),s._v(" 课时59：59.索引失效行锁变表锁07:05")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 说明：a 列类型是 int，b 列类型是 varchar，都建了索引")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备：session1和session2都先关闭自动提交")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 索引正常的情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9001'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 没有任何问题")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 都执行下commit;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 索引失效的情况：varchar不加引号")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'9001'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里直接阻塞了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时 session2 的 update 正常执行。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"课时60-60-间隙锁危害05-31"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时60-60-间隙锁危害05-31"}},[s._v("#")]),s._v(" 课时60：60.间隙锁危害05:31")]),s._v(" "),n("h3",{attrs:{id:"间隙锁演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#间隙锁演示"}},[s._v("#")]),s._v(" 间隙锁演示")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前提：test_innodb_lock 表中还没有 a=2 的记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备：session1和session2都先关闭自动提交")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" autocommit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0629'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接阻塞，原因是被 sessin1 的间隙锁锁住了")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时 session2 正常执行；")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"什么是间隙锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是间隙锁"}},[s._v("#")]),s._v(" 什么是间隙锁")]),s._v(" "),n("ul",[n("li",[s._v('当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB 会给符合条件的已有数据记录的索引项加锁；对于键值在条件范围内但并不存在的记录，叫做"间隙（GAP）"，InnoDB 也会对这个"间隙"加锁，这种锁机制就是所谓的间隙锁（Next-Key锁）。')])]),s._v(" "),n("h3",{attrs:{id:"间隙锁危害"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#间隙锁危害"}},[s._v("#")]),s._v(" 间隙锁危害")]),s._v(" "),n("ul",[n("li",[s._v("因为 Query 执行过程中通过范围查找的话，他会锁定整个范围内所有的索引键值，即使这个键值并不存在。")]),s._v(" "),n("li",[s._v("间隙锁有一个比较致命的弱点，就是当锁定一个范围键值之后，即使某些不存在的键值也会被无辜的锁定，而造成在锁定的时候无法插入锁定键值范围内的任何数据。在某些场景下这可能会对性能造成很大的危害。")])]),s._v(" "),n("h2",{attrs:{id:"课时61-61-如何锁定一行04-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时61-61-如何锁定一行04-10"}},[s._v("#")]),s._v(" 课时61：61.如何锁定一行04:10")]),s._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如何锁定行，通过for update")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# session1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("begin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("commit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在session1执行commit之前，session2对a=8这条记录的任何操作都会阻塞，比如update")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_innodb_lock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果session1还没commit，会一直阻塞")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"课时62-62-行锁总结06-29"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时62-62-行锁总结06-29"}},[s._v("#")]),s._v(" 课时62：62.行锁总结06:29")]),s._v(" "),n("h3",{attrs:{id:"案例结论-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例结论-2"}},[s._v("#")]),s._v(" 案例结论")]),s._v(" "),n("ul",[n("li",[s._v("Innodb 存储引擎由于实现了行级锁定，虽然在锁定机制的实现方面所带来的性能损耗可能比表级锁定会要更高一些，但是在整体并发处理能力方面要远远优于 MyISAM 的表级锁定的。当系统并发量较高的时候，Innodb 的整体性能和 MyISAM 相比就会有比较明显的优势了。")]),s._v(" "),n("li",[s._v("但是，Innodb的行级锁定同样也有其脆弱的一面，当我们使用不当的时候，可能会让 Innodb 的整体性能表现不仅不能比 MyISAM 高，甚至可能会更差。")])]),s._v(" "),n("h3",{attrs:{id:"如何分析行锁定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何分析行锁定"}},[s._v("#")]),s._v(" 如何分析行锁定")]),s._v(" "),n("ul",[n("li",[s._v("通过检查 innodb_row_lock 状态变量来分析系统上的行锁的争夺情况\n"),n("ul",[n("li",[n("code",[s._v("show status like 'innodb_row_lock%';")])])])]),s._v(" "),n("li",[s._v("各个状态量说明如下：\n"),n("ul",[n("li",[s._v("innodb_row_lock_current_waits：当前正在等待锁定的数量；")]),s._v(" "),n("li",[s._v("innodb_row_lock_time：从系统启动到现在锁定总时间长度；")]),s._v(" "),n("li",[s._v("innodb_row_lock_time_avg：每次等待所花费平均时间；")]),s._v(" "),n("li",[s._v("innodb_row_lock_time_max：从系统启动到现在等待最长的一次时间；")]),s._v(" "),n("li",[s._v("innodb_row_lock_waits：系统启动后到现在总共等待的次数；")])])]),s._v(" "),n("li",[s._v("对于这 5 个状态变量，比较重要的是：innodb_row_lock_time_avg、innodb_row_lock_waits、innodb_row_lock_time，尤其是当等待次数很高，而且每次等待时长也不小的时候，我们就需要分析系统中为什么会有如此多的等待，然后根据根系结果着手制定优化计划。")])]),s._v(" "),n("h3",{attrs:{id:"优化建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化建议"}},[s._v("#")]),s._v(" 优化建议")]),s._v(" "),n("ol",[n("li",[s._v("尽可能让所有数据检索都通过索引来完成，避免无索引行锁升级为表锁。")]),s._v(" "),n("li",[s._v("合理设计索引，尽量缩小锁的范围")]),s._v(" "),n("li",[s._v("尽可能较少检索条件，避免间隙锁")]),s._v(" "),n("li",[s._v("尽量控制事务大小，减少锁定资源量和时间长度")]),s._v(" "),n("li",[s._v("尽可能低级别事务隔离")])]),s._v(" "),n("h3",{attrs:{id:"页锁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#页锁"}},[s._v("#")]),s._v(" 页锁")]),s._v(" "),n("ul",[n("li",[s._v("开销和加速时间介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般。")]),s._v(" "),n("li",[s._v("了解一下即可")])]),s._v(" "),n("h2",{attrs:{id:"课时63-63-主从复制30-31"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课时63-63-主从复制30-31"}},[s._v("#")]),s._v(" 课时63：63.主从复制30:31")]),s._v(" "),n("ul",[n("li",[s._v("复制的基本原理：slave 会从 master 读取 binlog 来进行数据同步")]),s._v(" "),n("li",[s._v("MySQL 主从复制三步骤：\n"),n("ol",[n("li",[s._v("master 将改变记录到二进制日志（binary log）。这些记录过程叫做二进制日志事件，binary log event；")]),s._v(" "),n("li",[s._v("slave 将 master 的 binary log events 拷贝到它的中继日志（relay log）；")]),s._v(" "),n("li",[s._v("slave 重做中继日志中的事件，将改变应用到自己的数据库中。MySQL 的复制是异步且串行化的。")])])]),s._v(" "),n("li",[s._v("复制的基本原则：\n"),n("ul",[n("li",[s._v("每个 slave 只有一个 master")]),s._v(" "),n("li",[s._v("每个 slave 只能有一个唯一的 server-id")]),s._v(" "),n("li",[s._v("没和 master 可以有多个 slave")])])]),s._v(" "),n("li",[s._v("复制的最大问题：延时")]),s._v(" "),n("li",[s._v("一主一从常见配置\n"),n("ul",[n("li",[s._v("mysql 版本一直且后台以服务运行")]),s._v(" "),n("li",[s._v("主从都配置在"),n("code",[s._v("[mysqld]")]),s._v("节点下，都是小写")]),s._v(" "),n("li",[s._v("主机修改"),n("code",[s._v("my.ini/my.cnf")]),s._v("配置文件：\n"),n("ol",[n("li",[s._v("【必须】主服务器唯一ID：server-id=1")]),s._v(" "),n("li",[s._v("【必须】启用二进制日志：")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- log-bin=自己本地的路径/mysqlbin\n- 例子：log-bin=D:/devSoft/MySQLServer5.5/data/mysqlbin\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("【可选】启动错误日志")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- log-err=自己的本地路径/mysqlerr\n- 例子：log-bin=D:/devSoft/MySQLServer5.5/data/mysqlberr\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("【可选】根目录")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- basedir=自己的本地路径  \n- 例子：basedir=D:/devSoft/MySQLServer5.5/\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[s._v("【可选】临时目录")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- tmpdir=自己的本地路径  \n- 例子：basedir=D:/devSoft/MySQLServer5.5/\n")])])]),n("ol",{attrs:{start:"6"}},[n("li",[s._v("【可选】数据目录")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- datadir=自己的本地路径/Data/\n- 例子：basedir=D:/devSoft/MySQLServer5.5/Data/\n")])])]),n("ol",{attrs:{start:"7"}},[n("li",[s._v("read-onlu=0：主机，读写都可以")]),s._v(" "),n("li",[s._v("【可选】设置不要复制的数据库")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- binlog-ignore-db=mysql\n")])])]),n("ol",{attrs:{start:"9"}},[n("li",[s._v("【可选】设置需要复制的数据库")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("- binlog-do-db=需要复制的主数据库名字\n")])])])]),s._v(" "),n("li",[s._v("从机修改"),n("code",[s._v("my.ini/my.cnf")]),s._v("文件\n"),n("ul",[n("li",[s._v("【必须】从服务器唯一id")]),s._v(" "),n("li",[s._v("【可选】启用二进制日志")])])]),s._v(" "),n("li",[s._v("因修改过配置文件，主机和从机都需要重启mysql服务")]),s._v(" "),n("li",[s._v("主机从机都关闭防火墙\n"),n("ul",[n("li",[s._v("windows 手动关闭")]),s._v(" "),n("li",[s._v("关闭 linux 防火墙：service iptables stop")])])]),s._v(" "),n("li",[s._v("在主机上建立账户并授权 slave："),n("div",{staticClass:"language-SQL line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'从机IP'")]),s._v(" IDENTIFIED "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询 master 的状态")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记录一下File和Position的值")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以上步骤执行完之后不要再操作主服务器 MySQL，防止主服务器状态值变化")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])]),s._v(" "),n("li",[s._v("在从机上配置需要复制的主机："),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置复制信息")]),s._v("\nCHANGE MASTER "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" MASTER_HOST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'主机IP'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_USER"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangsan'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_PASSWORD"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_LOG_FILE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'File名字'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_LOG_POS"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Position数字"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动从服务器复制功能")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v("\\G "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面两个参数都是 Yes，则说明配置成功")]),s._v("\n  Slave_IO_Running：Yes\n  Slave_SQL_Running：Yes\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])])]),s._v(" "),n("li",[s._v("检查主从复制是否可用：主机新建库、新建表、insert记录，看看从机效果")]),s._v(" "),n("li",[s._v("如何通知从服务复制功能："),n("code",[s._v("stop slave;")])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);