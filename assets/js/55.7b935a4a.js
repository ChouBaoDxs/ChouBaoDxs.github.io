(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{755:function(s,a,e){s.exports=e.p+"assets/img/stream-图解.5b832d87.jpg"},991:function(s,a,e){"use strict";e.r(a);var r=e(12),t=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"title"}),r("p",[s._v("课程名称：Redis5.0 之 12 项新特性"),r("br"),s._v("\n课程地址：https://www.imooc.com/learn/1089"),r("br"),s._v("\n简介：本次课程主要讲解 Redis5.0 的重要配置项，讲解 Stream 数据类型，新的 Sorted Set 命令，内存碎片整理以及用新的集群管理器搭建一个简单的集群，重点放在 Stream 数据类型上面，其它新特性会讲解理论知识和应用场景。"),r("br"),s._v("\n我的评价：★★★★☆")])]),s._v(" "),r("p",[s._v("[TOC]")]),s._v(" "),r("h2",{attrs:{id:"第-1-章-课程介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-1-章-课程介绍"}},[s._v("#")]),s._v(" 第 1 章 课程介绍")]),s._v(" "),r("p",[s._v("介绍本次课程的主要学习内容，Redis5.0 的应用场景，重点内容以及课程安排。")]),s._v(" "),r("h3",{attrs:{id:"_1-1-课程介绍-02-07"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-课程介绍-02-07"}},[s._v("#")]),s._v(" 1-1 课程介绍 (02:07)")]),s._v(" "),r("h4",{attrs:{id:"你将可以学到如下知识"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#你将可以学到如下知识"}},[s._v("#")]),s._v(" 你将可以学到如下知识")]),s._v(" "),r("ol",[r("li",[s._v("redis 的重要配置项(终点)")]),s._v(" "),r("li",[s._v("stream 数据类型(重点)")]),s._v(" "),r("li",[s._v("help 子命令")]),s._v(" "),r("li",[s._v("更方便的搭建 redis 集群(重点)")]),s._v(" "),r("li",[s._v("新的 Sorted Set 命令")]),s._v(" "),r("li",[s._v("如何整理内存碎片和如何查看内存报告")])]),s._v(" "),r("p",[s._v("tips——redis5 搭建集群不再需要安装 Ruby 并且可以整理内存碎片了。")]),s._v(" "),r("h3",{attrs:{id:"_1-2-初识-redis5-0-之-12-项新特性-05-14"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-初识-redis5-0-之-12-项新特性-05-14"}},[s._v("#")]),s._v(" 1-2 初识 Redis5.0 之 12 项新特性 (05:14)")]),s._v(" "),r("ol",[r("li",[s._v("新的 Stream 数据类型"),r("br"),s._v("\n也就是说现在有 string、list、hash、set、sort set、stream 六种")]),s._v(" "),r("li",[s._v("新的 Redis 模块 API：Timers and Cluster API")]),s._v(" "),r("li",[s._v("RDB 现在存储 LFU 和 LRU 信息")]),s._v(" "),r("li",[s._v("集群管理从 Ruby(redis-trib.rb)移植到 C 代码")]),s._v(" "),r("li",[s._v("新的 sorted set 命令：ZPOPMIN/MAX 的阻塞变种")]),s._v(" "),r("li",[s._v("主动碎片整理 V2")]),s._v(" "),r("li",[s._v("增强 HyperLogLog 实现")]),s._v(" "),r("li",[s._v("更好的内存统计报告")]),s._v(" "),r("li",[s._v("许多带有子命令的命令现在都有一个 HELP 子命令")]),s._v(" "),r("li",[s._v("客户经常连接和断开时性能更好")]),s._v(" "),r("li",[s._v("错误修复和改进")]),s._v(" "),r("li",[s._v("Jemalloc 升级到 5.1(Jemalloc 是一个内存分配器)")])]),s._v(" "),r("h3",{attrs:{id:"_1-3-stream-数据类型概述-04-10"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-stream-数据类型概述-04-10"}},[s._v("#")]),s._v(" 1-3 stream 数据类型概述 (04:10)")]),s._v(" "),r("p",[s._v("什么是 stream 数据类型：")]),s._v(" "),r("ul",[r("li",[s._v("stream 翻译过来的意思是小河")]),s._v(" "),r("li",[s._v("本质是一个抽象日志")]),s._v(" "),r("li",[s._v("redis 现在又=有 string、list、hash、set、sort set、stream 六种数据类型")])]),s._v(" "),r("p",[s._v("为什么要学习 stream")]),s._v(" "),r("ol",[r("li",[s._v("其它 5 中数据接口不能直接实现的需求，可直接用 stream 实现")]),s._v(" "),r("li",[s._v("直接贴近业务需求，提升开发效率")]),s._v(" "),r("li",[s._v("物联网，各种传感器产生时间序列数据，定位未来")])]),s._v(" "),r("h2",{attrs:{id:"第-2-章-redis5-0-配置文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-2-章-redis5-0-配置文件"}},[s._v("#")]),s._v(" 第 2 章 Redis5.0 配置文件")]),s._v(" "),r("p",[s._v("讲解 Redis5.0 redis.conf 中的一些重要的配置项。")]),s._v(" "),r("h3",{attrs:{id:"_2-1-redis5-0-的重要配置项-15-24"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-redis5-0-的重要配置项-15-24"}},[s._v("#")]),s._v(" 2-1 redis5.0 的重要配置项 (15:24)")]),s._v(" "),r("p",[s._v("安装环境：")]),s._v(" "),r("ol",[r("li",[s._v("操作系统：CentOS Linux release 7.4")]),s._v(" "),r("li",[s._v("redis 版本：5.0-rc3，"),r("a",{attrs:{href:"https://github.com/antirez/redis/archive/5.0-rc3.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),r("OutboundLink")],1)])]),s._v(" "),r("p",[s._v("安装方法：")]),s._v(" "),r("ol",[r("li",[s._v("下载：\n"),r("code",[s._v("wget -O redis-5.0-rc3.tar.gz https://github.com/antirez/redis/archive/5.0-rc3.tar.gz")])]),s._v(" "),r("li",[s._v("解压：\n"),r("code",[s._v("tar -zxvf redis-5.0-rc3.tar.gz -C /usr/local/src")])]),s._v(" "),r("li",[s._v("编译并安装：make & make install")]),s._v(" "),r("li",[s._v("修改配置文件"),r("code",[s._v("redis.conf")])]),s._v(" "),r("li",[s._v("启动 redis5.0：/usr/local/src/redis-5.0-rc3/src/redis-server /usr/local/src/redis-5.0-rc3/redis.conf")]),s._v(" "),r("li",[s._v("关闭 redis：redis-cli shutdown")])]),s._v(" "),r("h3",{attrs:{id:"配置讲解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置讲解"}},[s._v("#")]),s._v(" 配置讲解")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("daemonize yes # 守护进程(后台运行),设置为no的话，只是在当前终端下运行，ctrl+c会退出\nprotected-mode yes # 安全模式，不想外网访问就设置yes\n# 下面三个是RDB相关\nsave 900 1  # 900秒内有1个key发生变化\nsave 300 10 # 300秒内有10个key发生变化\nsave 60 10000 # 60秒内有10000个key发生变化\n\n# 下面是开启集群\ncluster-enabled yes # 开启集群\ncluster-config-file # 集群用到的配置文件，我们无法修改，redis用来保存集群状态用的\ncluster-node-timeout 15000 # 集群节点失联最大时间，如果主节点失联超过这个时间，将会有个子节点升级成主节点\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h2",{attrs:{id:"第-3-章-stream-数据类型详解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-stream-数据类型详解"}},[s._v("#")]),s._v(" 第 3 章 Stream 数据类型详解")]),s._v(" "),r("p",[s._v("讲解 Stream 的存储结构，并详细讲到 Consumer Group 和 Consumer 之间的关系以及数据的取用方法，以及讲解一些常用命令的使用方法。")]),s._v(" "),r("h3",{attrs:{id:"_3-1-图解-stream-数据类型-02-51"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-图解-stream-数据类型-02-51"}},[s._v("#")]),s._v(" 3-1 图解 stream 数据类型 (02:51)")]),s._v(" "),r("div",{attrs:{align:"center"}},[r("img",{attrs:{width:"640",src:e(755)}})]),s._v(" "),r("h3",{attrs:{id:"_3-2-xadd、xlen-和-xdel-用法详解-06-26"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-xadd、xlen-和-xdel-用法详解-06-26"}},[s._v("#")]),s._v(" 3-2 XADD、XLEN 和 XDEL 用法详解 (06:26)")]),s._v(" "),r("h4",{attrs:{id:"xadd"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xadd"}},[s._v("#")]),s._v(" XADD")]),s._v(" "),r("p",[s._v("作用：创建一个 stream\n用法：XADD key ID field string [field string ...]\nID：毫秒的 unix 时间戳-sequence(同一毫秒的序列号)组成\n例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XADD LOL * slain quadra_kill # *代表id默认\n1539093800437-0\n127.0.0.1:6379> XADD LOL * slain pent_kill\n1539093831396-0\n127.0.0.1:6379> XADD wangzhe 0-1 hero xiaoqiao # 自定义id\n0-1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h4",{attrs:{id:"xlen"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xlen"}},[s._v("#")]),s._v(" XLEN")]),s._v(" "),r("p",[s._v("作用：返回 stream 中元素的个数\n用法：XLEN key")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XLEN LOL\n(integer) 2\n127.0.0.1:6379> XLEN wangzhe\n(integer) 1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br")])]),r("p",[s._v("#####XDEL\n作用：删除一个 ID\n用法：XDEL ket ID")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XDEL LOL 1539093800437-0\n(integer) 1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("h3",{attrs:{id:"_3-3-xrange-和-xread-用法详解-06-09"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-xrange-和-xread-用法详解-06-09"}},[s._v("#")]),s._v(" 3-3 XRANGE 和 XREAD 用法详解 (06:09)")]),s._v(" "),r("h4",{attrs:{id:"xrange"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xrange"}},[s._v("#")]),s._v(" XRANGE")]),s._v(" "),r("p",[s._v("作用：返回给定 ID 范围内的 stream 数据\n用法：XRANGE ket start end [COUNT count]\n特殊 ID："),r("code",[s._v("+")]),s._v("代表最大 ID，"),r("code",[s._v("-")]),s._v("代表最小 ID\n例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XADD LOL * slain double_kill\n127.0.0.1:6379> XADD LOL * slain triple_kill\n127.0.0.1:6379> XADD LOL * slain quadra_kill\n127.0.0.1:6379> XRANGE LOL - +\n127.0.0.1:6379> XRANGE LOL - + COUNT 1\n127.0.0.1:6379> XRANGE LOL 1539093800437-0 1539093831396-0\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("h4",{attrs:{id:"xread"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xread"}},[s._v("#")]),s._v(" XREAD")]),s._v(" "),r("p",[s._v("作用：从一个或多个 stream 读取数据\n用法：XREAD [COUNT count][block milliseconds] STREAMS key [key ...] ID [ID ...]\n关键词："),r("code",[s._v("BLOCK 0")]),s._v("永久阻塞；"),r("code",[s._v("$")]),s._v("获取最新的数据\n例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XREAD STREMS LOL 1539093800437-0 # 读取这个ID之后的数据\n127.0.0.1:6379> XREAD COUNT 1 STREMS LOL 1539093800437-0 # 只读1条\n127.0.0.1:6379> XREAD BLOCK 0 STREAMS LOL $ # 阻塞住不输出结果，直到新的一条记录进来马上打印出来\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h3",{attrs:{id:"_3-4-xgroup-和-xreadgroup-用法详解-06-18"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-xgroup-和-xreadgroup-用法详解-06-18"}},[s._v("#")]),s._v(" 3-4 XGROUP 和 XREADGROUP 用法详解 (06:18)")]),s._v(" "),r("p",[s._v("创建消息组：XGROUP\n读取消息组：XREADGROUP")]),s._v(" "),r("h4",{attrs:{id:"xgroup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xgroup"}},[s._v("#")]),s._v(" XGROUP")]),s._v(" "),r("p",[s._v("作用：创建一个 Consumer Group\n用法：XGROUP CREATE key groupname ID\n例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XADD wangzhe * hero luban\n1539182362587-0\n127.0.0.1:6379> XADD wangzhe * hero daji\n1539182367086-0\n127.0.0.1:6379> XADD wangzhe * hero xiaoqiao\n1539182372217-0\n127.0.0.1:6379> XADD wangzhe * hero diaochan\n1539182377070-0\n127.0.0.1:6379> XGROUP CREATE wangzhe fashi 1539182362587-0 # 1539182362587-0之后的数据，不包括1539182362587-0\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br")])]),r("h4",{attrs:{id:"xreadgroup"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#xreadgroup"}},[s._v("#")]),s._v(" XREADGROUP")]),s._v(" "),r("p",[s._v("作用：从 Consumer Grouop 中读取数据\n用法：XREADGROUP GROUP groupname consumer [COUNT count][block milliseconds] STREAMS key [key ...] ID [ID ...]\n例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XREAD GROUP fashi chuanrong STREAMS wangzhe > # 读取最新的消息\n127.0.0.1:6379> XREAD GROUP fashi chuanrong STREAMS wangzhe > # 由于已经被读取过了，再次执行结果为空nil\n127.0.0.1:6379> XREAD GROUP fashi chuanrong STREAMS wangzhe  1539182367086-0 # 读取指定的ID\n127.0.0.1:6379> XREAD GROUP fashi chuanrong COUNT 1 STREAMS wangzhe 1539182367086-0 # 读取指定的ID #只读取一条\n127.0.0.1:6379> XREAD GROUP fashi chuanrong BLOCK 0 STREAMS wangzhe # 阻塞读取最新数据\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h2",{attrs:{id:"第-4-章-新的-sorted-set-命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-4-章-新的-sorted-set-命令"}},[s._v("#")]),s._v(" 第 4 章 新的 Sorted Set 命令")]),s._v(" "),r("p",[s._v("用代码演示的方法讲解 ZPOPMAX、ZPOPMIN、BZPOPMAX 和 BZPOPMIN 四个命令的详细使用方法。")]),s._v(" "),r("h3",{attrs:{id:"_4-1-help-子命令详解-03-54"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-help-子命令详解-03-54"}},[s._v("#")]),s._v(" 4-1 help 子命令详解 (03:54)")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> XINFO help # 查看stream相关命令帮助\n127.0.0.1:6379> XINFO CONSUMERS wangzhe fashi\n127.0.0.1:6379> PUBSUB help\n127.0.0.1:6379> GROUP help\n127.0.0.1:6379> XADD help # 会报错，因为XADD没有子命令\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h2",{attrs:{id:"第-5-章-碎片整理和内存报告"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-5-章-碎片整理和内存报告"}},[s._v("#")]),s._v(" 第 5 章 碎片整理和内存报告")]),s._v(" "),r("p",[s._v("讲解主动内存碎片整理 Active defragmentation 升级到了 Version 2，Jemalloc 版本升级至 5.1，以及查看更加详尽的内存报告。")]),s._v(" "),r("h3",{attrs:{id:"_5-1-搭建-cluster-集群-18-24"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-搭建-cluster-集群-18-24"}},[s._v("#")]),s._v(" 5-1 搭建 cluster 集群 (18:24)")]),s._v(" "),r("h4",{attrs:{id:"集群模拟"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#集群模拟"}},[s._v("#")]),s._v(" 集群模拟")]),s._v(" "),r("p",[s._v("搭建集群需要多台服务器，讲师这里用创建集群数据存储文件夹的方式模拟一哈")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("mkdir -p /usr/local/redis-cluster\ncd /usr/local/redis-cluster\nmkdir 5001 5002 5003 5004 5005 5006 # 集群最少都是三主三从，所以要6个\n# 将配置文件分别复制到以上6个目录分别启动即可\ncp /etc/redis/redis.conf 5001/redis.conf\ncd 5001\nvim redis.conf\n# 修改端口\n# 修改pidfile（比如改成/var/fun/redis_5001.pid）\n# 修改日志文件logfile（比如/usr/local/redis-luster/5001/redis.log）\n# 配置数据文件位置dir，把./改成/usr/local/redis-cluster/5001/\n# 打开appendonly yes和appendfsync everysec\n# 打开cluster-enabled yes\n# 打开cluster-config-file nodes-5001.conf\n# 打开cluster-node-timeout 15000\n# 保存后启动\n/usr/local/src/redis-5.0-rc3/src/redis-server /usr/local/redis-cluster/5001/redis.conf\n# 查看\nps aux | grep redis\n# 将这份配置文件复制到其它目录\ncp redis.conf ../5002/redis.conf\ncp redis.conf ../5003/redis.conf\ncp redis.conf ../5004/redis.conf\ncp redis.conf ../5005/redis.conf\ncp redis.conf ../5006/redis.conf\n# 全局替换5001即可(vim的命令：`$s/5001/5002/g`  #全局替换5001为5002)\n# 分别启动这些redis\n/usr/local/src/redis-5.0-rc3/src/redis-server /usr/local/redis-cluster/5002/redis.conf\n...\n/usr/local/src/redis-5.0-rc3/src/redis-server /usr/local/redis-cluster/5006/redis.conf\n# 查看\nps aux | grep redis\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br")])]),r("h4",{attrs:{id:"创建六个子节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建六个子节点"}},[s._v("#")]),s._v(" 创建六个子节点")]),s._v(" "),r("ol",[r("li",[s._v("ruby 创建方法：redis-trib.rb create --replicas 1 192.168.4.147:500*")]),s._v(" "),r("li",[s._v("新特性创建方法：redis-cli --cluster create 1 192.168.4.147:500* --cluster-replicas 1")]),s._v(" "),r("li",[s._v("主/从=1：cluster-replicas 1 # 主从比例")])]),s._v(" "),r("p",[s._v("创建：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("cd /usr/local/src/redis-5.0-rc3/src/\nredis-cli --cluster create 192.168.4.147:5001 192.168.4.147:5002 192.168.4.147:5003 192.168.4.147:5004 192.168.4.147:5005 192.168.4.147:5006 --cluster-replicas 1\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br")])]),r("p",[s._v("查看效果：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v('redis-cli -c -h 192.168.4.147 -p 5001\n192.168.4.147:5001> set name imooc\n-> Redirected to slot [5798] located at 192.168.4.147:5002\nOK\n192.168.4.147:5002> get name\n"imooc"\n192.168.4.147:5002> cluster info    # 查看集群信息\n192.168.4.147:5002> cluster nodes    # 查看集群列表\n')])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("h3",{attrs:{id:"_5-2-cluster-集群添加节点-动态扩容-11-15"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-cluster-集群添加节点-动态扩容-11-15"}},[s._v("#")]),s._v(" 5-2 cluster 集群添加节点-动态扩容 (11:15)")]),s._v(" "),r("h4",{attrs:{id:"动态添加-从-节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#动态添加-从-节点"}},[s._v("#")]),s._v(" 动态添加(从)节点")]),s._v(" "),r("ol",[r("li",[s._v("ruby 添加节点：redis-trib.rb add-node 192.168.4.147:5007 192.168.4.147:5001")]),s._v(" "),r("li",[s._v("新特性添加节点：redis-cli --cluster add-node 192.168.4.147:5007 192.168.4.147:5001")]),s._v(" "),r("li",[s._v("添加从节点：redis-cli --cluster add-node 192.168.4.147:5008 192.168.4.147:5008")])]),s._v(" "),r("h4",{attrs:{id:"分片-即添加主节点-将集群中已经存在的主节点-slot-分一些给新节点-因为新节点要作为主节点而非从节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分片-即添加主节点-将集群中已经存在的主节点-slot-分一些给新节点-因为新节点要作为主节点而非从节点"}},[s._v("#")]),s._v(" 分片(即添加主节点，将集群中已经存在的主节点 slot 分一些给新节点-因为新节点要作为主节点而非从节点)")]),s._v(" "),r("ol",[r("li",[s._v("ruby 分片方法：redis-trib.rb reshard 192.168.4.147:5007")]),s._v(" "),r("li",[s._v("新特性分片方法：redis-cli --cluster redhard 192.168.4.147:5007")])]),s._v(" "),r("h4",{attrs:{id:"实际操作-添加两个节点-5007、5008"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实际操作-添加两个节点-5007、5008"}},[s._v("#")]),s._v(" 实际操作，添加两个节点 5007、5008")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("cd /usr/local/redis-cluster/\nmkdir 5007\nmkdir 5008\ncp 5001/redis.conf 5007/redis.conf\ncp 5001/redis.conf 5008/redis.conf\n# 同样地修改配置文件，将5001替换掉\n# 启动\ncd /usr/local/src/redis-5.0-rc3/src\nredis-server /usr/local/redis-cluster/5007/redis.conf\nredis-server /usr/local/redis-cluster/5008/redis.conf\n# 开始添加节点到集群中\nreidis-cli --cluster add-node 192.168.4.147:5007 192.168.4.147:5001 # 将5007添加到集群中,此时5007是没有数据槽slot的\n# 下面进行分片，分一些slot给5007\nredis-cli --cluster rehard 192.168.4.147:5007 # 回车后会询问需要分配多少个数据槽，讲师弄的500，之后一步一步进行\n# 进入客户端查看效果\nredis-cli -c -h 192.168.4.147 -p 5007\ncluster nodes\n# 此时，5007就是一个主节点了，下面来添加5008作为从节点\nredis-cli --cluster add-node 192.168.4.147:5008 192.168.4.147:5001\nredis-cli -c -h 192.168.4.147 -p 5008 # 进入看看效果\ncluster nodes\ncluster replicate {node_id} # 将5008指定给某个主节点\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br")])]),r("h3",{attrs:{id:"_5-3-cluster-集群删除节点-06-25"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-cluster-集群删除节点-06-25"}},[s._v("#")]),s._v(" 5-3 cluster 集群删除节点 (06:25)")]),s._v(" "),r("h4",{attrs:{id:"删除从节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#删除从节点"}},[s._v("#")]),s._v(" 删除从节点")]),s._v(" "),r("ol",[r("li",[s._v("ruby 删除方法：redis-trib.rb del-node 192.168.4.147:5008")]),s._v(" "),r("li",[s._v("新特性删除方法：redis-cli --cluster del-node 192.168.4.147:5008 {node_id}")])]),s._v(" "),r("h4",{attrs:{id:"删除主节点-需要将数据槽移给其它主节点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#删除主节点-需要将数据槽移给其它主节点"}},[s._v("#")]),s._v(" 删除主节点(需要将数据槽移给其它主节点)")]),s._v(" "),r("ol",[r("li",[s._v("ruby 删除方法：redis-trib.rb reshard 192.168.4.147:5007")]),s._v(" "),r("li",[s._v("新特性删除方法：redis-cli --cluster redhard 192.168.4.147:5007")]),s._v(" "),r("li",[s._v("然后再调用从节点的删除方法即可")])]),s._v(" "),r("p",[s._v("例子：")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("redis-cli --cluster del-node 192.168.4.147:5008 {node_id} # 删除从节点\nredis-cli --cluster reshard 192.168.4.147:5007 # 输入500(上面创建时拿过来的插槽数)，然后一步一步操作\nredis-cli -c -h 192.168.4.147 -p 5001 # 进入集群\ncluster nodes # 查看集群节点信息，可以发现5007没有了slot\nredis-cli --cluster del-node 192.168.4.147:5007 {node_id} # 正式删除5007节点\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br")])]),r("h2",{attrs:{id:"第-6-章-c-语言下的集群管理器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-6-章-c-语言下的集群管理器"}},[s._v("#")]),s._v(" 第 6 章 C 语言下的集群管理器")]),s._v(" "),r("p",[s._v("原来的集群管理器是用 Ruby 搭建的，现在改为 C 代码，讲解如何用 redis-cli --cluster 搭建集群以及此改方法的好处。")]),s._v(" "),r("h3",{attrs:{id:"_6-1-sorted-set-回顾及新增命令的应用场景-02-57"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-sorted-set-回顾及新增命令的应用场景-02-57"}},[s._v("#")]),s._v(" 6-1 Sorted Set 回顾及新增命令的应用场景 (02:57)")]),s._v(" "),r("h4",{attrs:{id:"新的-sorted-set-命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#新的-sorted-set-命令"}},[s._v("#")]),s._v(" 新的 sorted set 命令")]),s._v(" "),r("p",[s._v("应用场景")]),s._v(" "),r("ol",[r("li",[s._v("成绩排名：第一名和最后一名")]),s._v(" "),r("li",[s._v("网站热搜：当下最火搜索")])]),s._v(" "),r("h5",{attrs:{id:"zpopmax"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#zpopmax"}},[s._v("#")]),s._v(" ZPOPMAX")]),s._v(" "),r("p",[s._v("作用：删除返回集合中分值最高的元素\n用法：ZPOPMAX key [count]")]),s._v(" "),r("h5",{attrs:{id:"zpopmin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#zpopmin"}},[s._v("#")]),s._v(" ZPOPMIN")]),s._v(" "),r("p",[s._v("作用：删除返回集合中分值最低的元素\n用法：ZPOPMIN key [count]")]),s._v(" "),r("h5",{attrs:{id:"bzpopmax"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bzpopmax"}},[s._v("#")]),s._v(" BZPOPMAX")]),s._v(" "),r("p",[s._v("作用：ZPOPMAX 的阻塞版\n用法：BZPOPMAX key [key ...] timeout # timeout 为 0 时表示永久阻塞")]),s._v(" "),r("h5",{attrs:{id:"bzpopmin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bzpopmin"}},[s._v("#")]),s._v(" BZPOPMIN")]),s._v(" "),r("p",[s._v("作用：ZPOPMIN 的阻塞版\n用法：BZPOPMIN key [key ...] timeout # timeout 为 0 时表示永久阻塞")]),s._v(" "),r("h3",{attrs:{id:"_6-2-zpopmax、zpopmin、bzpopmax-和-bzpopmin-用法详解-04-47"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-zpopmax、zpopmin、bzpopmax-和-bzpopmin-用法详解-04-47"}},[s._v("#")]),s._v(" 6-2 ZPOPMAX、ZPOPMIN、BZPOPMAX 和 BZPOPMIN 用法详解 (04:47)")]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("127.0.0.1:6379> ZADD exam 100 daji\n127.0.0.1:6379> ZADD exam 99 xiaoqiao\n127.0.0.1:6379> ZADD exam 98 zhenji\n127.0.0.1:6379> ZADD exam 97 anqila\n127.0.0.1:6379> ZRANGE exam 0 -1 WITHSCORES # 查看\n127.0.0.1:6379> ZPOPMAX exam # 删除并返回score最大的元素\n127.0.0.1:6379> ZRANGE exam 0 -1 WITHSCORES # 查看\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br")])]),r("h2",{attrs:{id:"第-7-章-redis5-0-其它新特性"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-7-章-redis5-0-其它新特性"}},[s._v("#")]),s._v(" 第 7 章 Redis5.0 其它新特性")]),s._v(" "),r("p",[s._v("讲解 help 子命令，版本功能改进及其它新特性的理论知识及应用场景。")]),s._v(" "),r("h3",{attrs:{id:"_7-1-碎片整理和内存报告-06-32"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-碎片整理和内存报告-06-32"}},[s._v("#")]),s._v(" 7-1 碎片整理和内存报告 (06:32)")]),s._v(" "),r("p",[s._v("新增 key——>redis 分配内存，删除 key——>redis 并不一定会将内存返还")]),s._v(" "),r("p",[s._v("应用场景：")]),s._v(" "),r("ol",[r("li",[s._v("在运行期间进行自动内存碎片清理，释放内存空间")]),s._v(" "),r("li",[s._v("通过内存报告了解整个系统的内存使用情况")])]),s._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("# 需要打开redis.conf的碎片整理功能\n# 打开以下配置\nactivedefrag yes\nactive-defrag-ignore-bytes 100mb\nactive-defrag-threshold-lower 10\n\n# 启动redis\nredis-server /etc/redis/redis/conf\n# 进入redis\nredis-cli\n# 生成测试数据\n127.0.0.1:6379> debug populate 300000 imooc 1000\n127.0.0.1:6379> info memory # 查看内存使用情况\n127.0.0.1:6379> MEMORY STATS # 这条也可以查看内存情况\n127.0.0.1:6379> memory usage imooc:1 # 查看生成的第一个测试数据占用内存大小\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br")])]),r("h2",{attrs:{id:"第-8-章-课程回顾与总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#第-8-章-课程回顾与总结"}},[s._v("#")]),s._v(" 第 8 章 课程回顾与总结")]),s._v(" "),r("p",[s._v("回顾和总结本次课程，详细说明本次课程的重难点以及以后的学习建议。")]),s._v(" "),r("h3",{attrs:{id:"_8-1-课程回顾与总结-01-38"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-课程回顾与总结-01-38"}},[s._v("#")]),s._v(" 8-1 课程回顾与总结 (01:38)")]),s._v(" "),r("ul",[r("li",[s._v("redis 的重要配置项")]),s._v(" "),r("li",[s._v("讲解 stream 数据类型")]),s._v(" "),r("li",[s._v("讲解 help 子命令")]),s._v(" "),r("li",[s._v("更方便的搭建 redis 集群")]),s._v(" "),r("li",[s._v("新的 sorted set 命令")]),s._v(" "),r("li",[s._v("碎片整理和内存报告")])])])}),[],!1,null,null,null);a.default=t.exports}}]);