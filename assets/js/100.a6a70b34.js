(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{997:function(s,t,a){"use strict";a.r(t);var n=a(12),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"title"}),a("p",[s._v("B 站地址：https://space.bilibili.com/359351574"),a("br"),s._v("\n课程名称：IT老齐架构300讲"),a("br"),s._v("\n主讲人：齐毅，前京东资深架构师，Java 方向")]),s._v(" "),a("p",[s._v("我的评价：★★★★★")])]),s._v(" "),a("p",[s._v("[TOC]")]),s._v(" "),a("h2",{attrs:{id:"【it老齐001】聊一聊被培训机构神话的架构师"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐001】聊一聊被培训机构神话的架构师"}},[s._v("#")]),s._v(" 【IT老齐001】聊一聊被培训机构神话的架构师")]),s._v(" "),a("p",[s._v("架构模式：")]),s._v(" "),a("ul",[a("li",[s._v("单机架构模式")]),s._v(" "),a("li",[s._v("分布式架构")]),s._v(" "),a("li",[s._v("微服务架构")]),s._v(" "),a("li",[s._v("服务网格模式")])]),s._v(" "),a("p",[s._v("架构需要考虑的：人、事、物、钱")]),s._v(" "),a("p",[s._v("不谈场景的架构设计都是耍流氓；架构没有对不对，只有合适不合适")]),s._v(" "),a("p",[s._v("常见的优化手段：")]),s._v(" "),a("ul",[a("li",[s._v("Web 容器层面增加拦截器阻挡垃圾重复无效的请求穿透到数据库")]),s._v(" "),a("li",[s._v("分析业务代码中 sql 是否存在全表扫描以及索引选择性问题")]),s._v(" "),a("li",[s._v("增加 InnoDB 引擎的 Buffer_Pool 让查询拥有更多的缓存命中率")]),s._v(" "),a("li",[s._v("在操作系统层面，增加文件系统缓存，减少文件 IO 次数")])]),s._v(" "),a("p",[s._v("架构与框架的区别：Spring、MyBatis、Tomcat、Nginx")]),s._v(" "),a("p",[s._v("架构是指软件目标的宏观设计，比如为了支撑 1000 人同时在线，要构建一套流媒体的直播系统：服务器该如何部署，模块如何切分，数据如何流转，带宽需要多少，人员怎样组织，数据库选型和集群...这些都是属于宏观设计，属于架构层面。")]),s._v(" "),a("p",[s._v("架构师宏观设计的标准，框架是具体实现的规则。")]),s._v(" "),a("p",[s._v("架构是一门取舍与权衡的艺术。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐002】十分钟说明白mysql集群模式与应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐002】十分钟说明白mysql集群模式与应用场景"}},[s._v("#")]),s._v(" 【IT老齐002】十分钟说明白MySQL集群模式与应用场景")]),s._v(" "),a("p",[s._v("单库模式：")]),s._v(" "),a("ul",[a("li",[s._v("简单粗暴")]),s._v(" "),a("li",[s._v("适合数据量千万以下小型应用")]),s._v(" "),a("li",[s._v("企业网站，创业公司首选")]),s._v(" "),a("li",[s._v("不具备可用性与并发性")])]),s._v(" "),a("p",[s._v("读写分离集群模式：")]),s._v(" "),a("ul",[a("li",[s._v("写走主库，读走从库，通过 binlog 同步数据到从库")]),s._v(" "),a("li",[s._v("java 里常用读写分离分片中间件：MyCat、ShardingSphere")]),s._v(" "),a("li",[s._v("特点：\n"),a("ul",[a("li",[s._v("架构复杂度提升，成本提高")]),s._v(" "),a("li",[s._v("所有节点数据均保持同步")]),s._v(" "),a("li",[s._v("适用于读多写少，单表不过千万的互联网应用")]),s._v(" "),a("li",[s._v("配合 MHA 中间件方案实现高可用性")])])])]),s._v(" "),a("p",[s._v("分库分表（分片）集群模式：")]),s._v(" "),a("ul",[a("li",[s._v("java 里常用分库分表分片中间件：MyCat、ShardingSphere")]),s._v(" "),a("li",[s._v("特点：\n"),a("ul",[a("li",[s._v("架构复杂度提升，成本提高")]),s._v(" "),a("li",[s._v("每个节点数据时所有数据的子集")]),s._v(" "),a("li",[s._v("适用于十亿级数据总量大型应用")]),s._v(" "),a("li",[s._v("不具备高可用特性")]),s._v(" "),a("li",[s._v("数据量达到百亿千亿时：采用 NoSQL，比如 HBase、ClickHouse 等大数据处理方案。阿里的 OceanBase 是基于 MySQL 改造后的东西，支撑淘宝。")])])]),s._v(" "),a("li",[s._v("分片算法：\n"),a("ul",[a("li",[s._v("范围法：结构简单，扩展容易；适合范围检索；数据分布不均匀，局部负载压力大；适用于流水账应用。")]),s._v(" "),a("li",[s._v("Hash 法：分为取模与一致性 Hash。数据分配均匀；节点扩展复杂，数据迁移难度大；建议提前部署足够的节点；适用于预算充足的大型互联网应用。")])])])]),s._v(" "),a("p",[s._v("互联网主流 MySQL 集群架构：读写分离+分片组合使用")]),s._v(" "),a("h2",{attrs:{id:"【it老齐003】为什么大厂要做数据垂直分表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐003】为什么大厂要做数据垂直分表"}},[s._v("#")]),s._v(" 【IT老齐003】为什么大厂要做数据垂直分表?")]),s._v(" "),a("p",[s._v("在银行工作了很多年，有些业务表字段达上百个，对业务处理非常不友好。")]),s._v(" "),a("p",[s._v("水平分表：解决数据量大的存储问题，表的结构一致")]),s._v(" "),a("ul",[a("li",[s._v("范围法：1000000-2000000，2000000-3000000，3000000-4000000...")]),s._v(" "),a("li",[s._v("HASH 法：id % 3")])]),s._v(" "),a("p",[s._v('垂直分表：将一张大表按"列"拆分为 2 张以上的小表，通过主外键关联来获取数据')]),s._v(" "),a("ul",[a("li",[s._v("商品表 ——> 商品基本信息表 + 商品详细信息表")]),s._v(" "),a("li",[s._v("原因：mysql 中，一行一行的数据存储为 row，管理 row 数据的基本单位为 page（页），每一页的默认大小为 16k，管理页的单位为区（Extent），默认大小为 1M。innodb 1.0 以后引入了压缩页的特性，可以让页存储更多的 row 数据，但是有数据的解压缩过程。在跨页解压缩的时候执行效率并不是特别高，所以要求我们在设计表时保证每一页尽可能地多存储一些行数据，这样可以减少跨页检索并且提高页内数据检索效率。")]),s._v(" "),a("li",[s._v("结论：通过将重要字段单独剥离出一张小表，让每一页能够容纳更多的行，进而缩小数据扫描的范围，达到提高执行效率的目的。")]),s._v(" "),a("li",[s._v("什么时候垂直分表？\n"),a("ul",[a("li",[s._v("单表数据量未来可能千万")]),s._v(" "),a("li",[s._v("字段超20个，且包含了超长的 varchar、clob、blob 等字段")])])]),s._v(" "),a("li",[s._v("什么字段放小表：数据查询、排序时需要的字段，如分类编号、商户id、品牌编号、逻辑删除标志位等；高频访问的小字段，如商品名称、子标题、价格、厂商基本信息等")]),s._v(" "),a("li",[s._v("什么字段放大表：低频访问字段，如配送信息、售后声明、最后更新时间等；大字段，如商品图文详情、图片 BLOB、JSON 元数据等")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐004】为什么架构师对多级缓存架构情有独钟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐004】为什么架构师对多级缓存架构情有独钟"}},[s._v("#")]),s._v(" 【IT老齐004】为什么架构师对多级缓存架构情有独钟？")]),s._v(" "),a("ul",[a("li",[s._v("客户端缓存")]),s._v(" "),a("li",[s._v("应用层缓存\n"),a("ul",[a("li",[s._v("CDN 内容分发网络：智能 DNS 服务、首次访问资源就回源获取并缓存以便后续访问直接返回\n"),a("ul",[a("li",[s._v("响应头 Expires 指定某个时间点缓存到期")]),s._v(" "),a("li",[s._v("响应头 Cache-Control 表示缓存有效期的时长")])])]),s._v(" "),a("li",[s._v("Nginx 缓存")])])]),s._v(" "),a("li",[s._v("服务层缓存\n"),a("ul",[a("li",[s._v("进程外缓存：比如分布式缓存，典型代表 Redis\n"),a("ul",[a("li",[s._v("数据一致性问题：消息队列推送")])])]),s._v(" "),a("li",[s._v("进程内缓存")])])])]),s._v(" "),a("p",[s._v("什么场景适合引入多级缓存：")]),s._v(" "),a("ul",[a("li",[s._v("第一种，缓存的数据是稳定的")]),s._v(" "),a("li",[s._v("第二种，瞬时可能会产生极高并发的场景")]),s._v(" "),a("li",[s._v("第三种，一定程度上允许数据不一致")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐008】布隆过滤器在亿级流量系统中的应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐008】布隆过滤器在亿级流量系统中的应用"}},[s._v("#")]),s._v(" 【IT老齐008】布隆过滤器在亿级流量系统中的应用")]),s._v(" "),a("p",[a("strong",[s._v("预防缓存穿透")]),s._v("\n缓存穿透攻击是指恶意用户在短时内大量查询不存在的数据，导致大量请求被送达数据库进行查询，当请求数量超过数据库负载上限时，使系统响应出现高延迟甚至瘫痪的攻击行为。")]),s._v(" "),a("p",[s._v("预防缓存穿透可以使用布隆过滤器。")]),s._v(" "),a("p",[s._v("减少误判的措施：")]),s._v(" "),a("ul",[a("li",[s._v("增加二进制数组位数")]),s._v(" "),a("li",[s._v("增加 Hash 次数")])]),s._v(" "),a("p",[s._v("假如缓存数据被删除（比如商品被删除）该怎么办")]),s._v(" "),a("ul",[a("li",[s._v("布隆过滤器因为某一位二进制可能被多个编号Hash引用,因此布隆过滤器无法直接处理删除数据的情况")]),s._v(" "),a("li",[s._v("解决方案1：定时异步重建布隆过滤器")]),s._v(" "),a("li",[s._v("解决方案2：采用计数式 Bloom Fliter")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐009】为啥架构设计禁止ip直连"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐009】为啥架构设计禁止ip直连"}},[s._v("#")]),s._v(" 【IT老齐009】为啥架构设计禁止IP直连")]),s._v(" "),a("p",[s._v("IP 直连：")]),s._v(" "),a("ul",[a("li",[s._v("jdbc:mysql://202.99.183.21:3306/db")]),s._v(" "),a("li",[s._v("http://192.168.31.205/webapp")])]),s._v(" "),a("p",[s._v("非 IP 直连：")]),s._v(" "),a("ul",[a("li",[s._v("jdbc:mysql://rm-2zedsl7662jlm54g9zo.mysql.rds.aliyuncs.com:3306/db")]),s._v(" "),a("li",[s._v("http://webhost/webapp")])]),s._v(" "),a("p",[s._v("IP 直连强耦合，如果目标 ip 变化，需要修改代码重新发布")]),s._v(" "),a("p",[s._v("解决措施：")]),s._v(" "),a("ol",[a("li",[s._v("引入内部 DNS：简单粗暴；但没有故障发现与转移；多IP只有轮询规则")]),s._v(" "),a("li",[s._v("加入注册中心 Nacos / Eureka / Consul：支持故障发现与故障转移；多种负载均衡规则；架构复杂度增加")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐020】京东金融幂等性解决方案-消息表去重法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐020】京东金融幂等性解决方案-消息表去重法"}},[s._v("#")]),s._v(" 【IT老齐020】京东金融幂等性解决方案：消息表去重法")]),s._v(" "),a("p",[s._v("幂等性是啥？——发一次接口调用与发多次相同的接口消息都能得到与预期相符的结果")]),s._v(" "),a("p",[s._v("为了提高通信的可靠性，通信框架 / MQ 可能会向数据服务推送多条相同的结果")]),s._v(" "),a("p",[a("strong",[s._v("修改员工工资的例子")])]),s._v(" "),a("ol",[a("li",[s._v('接口调用：PUT https://xxxxx.com/employee/salary {"id" : "1,"incr_salary":500}')]),s._v(" "),a("li",[s._v("后端逻辑：")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//查询1号员工数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Employee")]),s._v(" employee "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" employeeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("selectById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//更新工资")]),s._v("\nemployee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setSalary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("employee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSalary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" incrSalary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//执行更新语句")]),s._v("\nemployeeService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("update")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("employee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("存在的问题：每重发一次请求1号工资就会+500，幂等性就被破坏了")]),s._v(" "),a("p",[s._v("怎么解决？")]),s._v(" "),a("ul",[a("li",[s._v("传统办法是代码增加前置判断： if(!员工已调薪){进行调薪}\n"),a("ul",[a("li",[s._v("缺陷：需要前置判断的地方太多了，一不留神就漏了，这种技术问题不应该成为干扰程序员写业务代码的因素")])])])]),s._v(" "),a("p",[s._v("我们需要一种无侵入的幂等解决方案，构建"),a("strong",[s._v("幂等表")]),s._v("是我们的通用解决方案")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("应用系统请求头强制要求附加 RequestId（比如 18a720c083b6f），调用 RESTful 请求经过 应用网关时，通过 nginx+lua 检查 RequestId（Redis 操作 setnx）保证并发性。设置如下的 key：\n|键|值|存活时间|\n|-|-|-|\n|SYS1-123456789|OK|3分钟|\n|SYS1-18a720c083b6f|PROC|5分钟|")])]),s._v(" "),a("li",[a("p",[s._v('假如应用系统触发了消息重发，使用 RequestId（18a720c083b6f）调用了一次 RESTful 接口，此时nginx+lua 检查 Redis 里有 key 了，直接返回响应 {code:"201", message:"repeated"} 给应用系统')])]),s._v(" "),a("li",[a("p",[s._v("nginx 背后的数据服务处理完请求之后，需要将 redis 里的 key（SYS1-18a720c083b6f） 的 值从 PROC 改为 OK。Spring 里可以通过 AOP After 通知 Redis 更新状态：")])])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/abc/bcd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 利用 AOP After 通知，更新 Redis 状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Idempontent")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" 接口方法"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 处理方法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("总结：")]),s._v(" "),a("ul",[a("li",[s._v("优点：后台服务无代码侵入，无需修改业务逻辑")]),s._v(" "),a("li",[s._v("缺点：前台应用要针对幂等进行改造")]),s._v(" "),a("li",[s._v("架构复杂度增加，需要额外部署Nginx、Redis")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐021】京东金融是如何通过乐观锁解决并发数据冲突的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐021】京东金融是如何通过乐观锁解决并发数据冲突的"}},[s._v("#")]),s._v(" 【IT老齐021】京东金融是如何通过乐观锁解决并发数据冲突的？")]),s._v(" "),a("p",[s._v("为什么会产生并发冲突？——两个事务短时间内同时进行")]),s._v(" "),a("ul",[a("li",[s._v("事务一："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\nselect * from acc where id = 1001\n获取账户对象，原余额400 + 500\nupdate acc set bal = 900 where id = 1001\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[s._v("事务二："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\nselect * from acc where id = 1001\n获取账户对象，原余额400 + 100\nupdate acc set bal = 500 where id = 1001\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[s._v("可能导致 bal 结果错误")])]),s._v(" "),a("p",[a("strong",[s._v("悲观锁 select ... for update")])]),s._v(" "),a("ul",[a("li",[s._v("事务一："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from acc where id = 1001 for update\n获取账户对象，原余额500 + 500\nupdate acc set bal = 1000 where id = 1001\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[s._v("事务二："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\nselect * from acc where id = 1001 for update\n获取账户对象，原余额400 + 100\nupdate acc set bal = 500 where id = 1001\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])]),s._v(" "),a("p",[s._v("缺陷：悲观锁并发性太差，高并发场景用户体验差")]),s._v(" "),a("p",[a("strong",[s._v("实现目标：既要保证用户体验也要实现数据可靠")]),s._v("\n在表中加一个代表数据版本的字段：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("id")]),s._v(" "),a("th",[s._v("bal")]),s._v(" "),a("th",[s._v("_version")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("1001")]),s._v(" "),a("td",[s._v("400")]),s._v(" "),a("td",[s._v("1")])])])]),s._v(" "),a("p",[s._v("事务处理：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\n\nselect id,bal,_version from acc where id = 1001\n\n获取账户对象，原余额400 + 100 ,_version = 1\n\n#成功更新1条数据\nupdate acc set bal = 500 , _version=_version + 1 where id = 1001 and _version=1 \n\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("结果：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("id")]),s._v(" "),a("th",[s._v("bal")]),s._v(" "),a("th",[s._v("_version")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("1001")]),s._v(" "),a("td",[s._v("500")]),s._v(" "),a("td",[s._v("2")])])])]),s._v(" "),a("p",[s._v("此时假如有两个事务同时开始：")]),s._v(" "),a("ul",[a("li",[s._v("事务一："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\n\nselect * from acc where id = 1001\n\n获取账户对象，原余额400 + 100 , _version=1\n\n#成功更新1条数据，更新后_version=2\nupdate acc set bal = 500 , _version=_version + 1 where id = 1001 and _version=1\n\n提交\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])]),s._v(" "),a("li",[s._v("事务二："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("开始事务\n\nselect * from acc where id = 1001\n\n获取账户对象，原余额400 + 500,_version = 1\n\n#更新前_version=2，因此where查询不到数据\n#没有更新到数据，update语句返回0\nupdate acc set bal = 900 , _version=_version + 1 where id = 1001 and _version=1\n\n提交 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])])])]),s._v(" "),a("p",[s._v("事务二会由于版本不一致导致更新失败，遇到这种冲突之后该怎么办？")]),s._v(" "),a("ol",[a("li",[s._v("前端应用提示“数据正在处理，请稍后再试！”")]),s._v(" "),a("li",[s._v("附加spring-retry在service上进行方法重试")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Transactional")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Retryable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" maxAttempts "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateBal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Account")]),s._v(" acc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("  执行：”select id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("bal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_version from acc where id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v("”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    acc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setBal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("acc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 执行：“update acc set bal "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("acc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" _version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n    where id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" and _version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("acc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("”；\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VersionException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("“产生并发异常”"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("；\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"【it老齐022】阿里开发规范解读-为啥禁用外键约束"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐022】阿里开发规范解读-为啥禁用外键约束"}},[s._v("#")]),s._v(" 【IT老齐022】阿里开发规范解读，为啥禁用外键约束？")]),s._v(" "),a("p",[a("strong",[s._v("禁用外键约束")])]),s._v(" "),a("ul",[a("li",[s._v("【阿里JAVA规范】不得使用外键与级联，一切外键概念必须在应用层解决。")]),s._v(" "),a("li",[s._v("优点：保证数据的完整性和一致性，级联操作方便数据一致性交给数据库，代码量小\n"),a("ul",[a("li",[s._v("订单表：订单id，总价")]),s._v(" "),a("li",[s._v("订单明细表：订单明细id，订单id，商品id")])])]),s._v(" "),a("li",[s._v("缺点：\n"),a("ol",[a("li",[s._v("每次做 DELETE 或者 UPDATE 都必须考虑外键约束，会导致开发的时候很痛苦，测试数据极为不方便")]),s._v(" "),a("li",[s._v("性能问题，额外的数据一致性校验查询")]),s._v(" "),a("li",[s._v("并发问题，外界约束会启用行级锁，主表写入时会进入阻塞")]),s._v(" "),a("li",[s._v("级联删除问题，多层级联删除会让数据变得不可控，触发器也严格被禁用\n"),a("ul",[a("li",[s._v("订单表：订单id，总价，订单类型id")]),s._v(" "),a("li",[s._v("订单类型表：类型id")]),s._v(" "),a("li",[s._v("订单明细表：订单明细id，订单id，商品id")])])]),s._v(" "),a("li",[s._v("数据耦合，数据库层面数据关系产生耦合，数据迁移维护困难\n"),a("ul",[a("li",[a("code",[s._v("<MySQl>")]),s._v("订单表 <——> "),a("code",[s._v("<HBASE>")]),s._v("订单明细表")])])])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐023】阿里开发规范解读-存储过程-阿里我tmd谢谢你啊"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐023】阿里开发规范解读-存储过程-阿里我tmd谢谢你啊"}},[s._v("#")]),s._v(" 【IT老齐023】阿里开发规范解读，存储过程：阿里我tmd谢谢你啊！")]),s._v(" "),a("p",[s._v("阿里开发规范原文：【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。")]),s._v(" "),a("p",[s._v("来自某乎的阿里大佬评论：我这里举个例真实例子，那时我还在阿里当DBA，某日下午帐务团队发版，要更新一个帐务库里面某个存过，存过的 sql 写得有问题，更新后，卧槽，load 瞬间就起来了，马上找到上一版存过代码覆盖去，卧槽，更新失败,因为一堆会话都在执行这个存过，杀会话，不行，新的请求进来，触发新建会话，不完，关监听杀会话，帐务就不能连db，赶紧回滚存过，开监听，请求浪涌般进来，又是一轮load飙升，幸好db顶住了，不至于全库故障，后续就是一堆差错处理的数据订正，再后来帐务团队主动把这个存过下掉，改用 java 实现其逻辑，从此再无业务存过在数据库中了。")]),s._v(" "),a("p",[a("strong",[s._v("1. 为什么银行都在用存储过程")]),s._v("\n银行业务以数据为核心")]),s._v(" "),a("ul",[a("li",[s._v("Oracle、DB2一统江湖，存储过程与语言无关")]),s._v(" "),a("li",[s._v("预算充足，好多个W采购小型机满足性能要求")]),s._v(" "),a("li",[s._v("存储过程几乎是每一个信息科技处开发员工的入职要求")])]),s._v(" "),a("p",[s._v("银行被Oracle、DB2绑架")]),s._v(" "),a("ul",[a("li",[s._v("数据好迁移，存储过程要全部重写")]),s._v(" "),a("li",[s._v("谁来/谁敢承担核心业务的风险？")])]),s._v(" "),a("p",[a("strong",[s._v("2. 存储过程为什么成为互联网弃子")]),s._v("\n存储过程在互联网分布式场景的问题")]),s._v(" "),a("ul",[a("li",[s._v("分片场景下存储过程只能作用在局部数据")]),s._v(" "),a("li",[s._v("互联网场景下，存储过程还会导致数据库压力激增")]),s._v(" "),a("li",[s._v("无法保证分布式全局事务")]),s._v(" "),a("li",[s._v("存储过程难以调试，没有内置的版本管理方案")]),s._v(" "),a("li",[s._v("业务执行碎片化：\n"),a("ul",[a("li",[s._v("存储过程：前置处理、执行存储过程、获得结果是错误的——>步骤1：删除数据、步骤2：新增数据、步骤3：统计分析")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐028】大厂必备技能-白话redis-cluster集群模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐028】大厂必备技能-白话redis-cluster集群模式"}},[s._v("#")]),s._v(" 【IT老齐028】大厂必备技能，白话Redis Cluster集群模式")]),s._v(" "),a("p",[s._v("Redis Cluster：")]),s._v(" "),a("ul",[a("li",[s._v("Cluster模式是Redis3.0开始推出")]),s._v(" "),a("li",[s._v("采用无中心结构，每个节点保存数据和整个集群状态, 每个节点都和其他所有节点连接")]),s._v(" "),a("li",[s._v("官方要求：至少6个节点才可以保证高可用，即3主3从；扩展性强、更好做到高可用")]),s._v(" "),a("li",[s._v("各个节点会互相通信，采用gossip协议交换节点元数据信息")]),s._v(" "),a("li",[s._v("数据分散存储到各个节点上")])]),s._v(" "),a("p",[s._v("Redis Cluster 集群 与 Redis Sentinel 有什么不同？")]),s._v(" "),a("ul",[a("li",[s._v("Redis Sentinel：哨兵集群，每个节点持有全量数据，且数据保持一致")]),s._v(" "),a("li",[s._v("Redis Cluster：每个节点主数据不同，是数据的子集，利用多台服务器构建集群提高超大规模数据处理能力，同时提供高可用支持")])]),s._v(" "),a("p",[s._v("Redis Cluster 集群如何将数据分散存储？")]),s._v(" "),a("ul",[a("li",[s._v("Redis Cluster 集群采用Hash Slot（哈希槽）分配。Redis集群预分好16384个槽，初始化集群时平均规划给每一台Redis Master")])]),s._v(" "),a("p",[s._v("为什么是16384？")]),s._v(" "),a("ul",[a("li",[s._v("在 Redis 集群中槽分配的元数据会不间断的在Redis集群中分发，以保证所有节点都知晓槽的分配情况\n16384=16k，在发送心跳包时使用 char 进行 bitmap 压缩后是 2k（2 * 8 (8 bit) * 1024(1k) = 16K）通常我们不同部署超过 10000 个Redis主节点，因此 16384 就够用了")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐029】mysql脏读、幻读、不可重复读你分清了吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐029】mysql脏读、幻读、不可重复读你分清了吗"}},[s._v("#")]),s._v(" 【IT老齐029】MySQL脏读、幻读、不可重复读你分清了吗？")]),s._v(" "),a("p",[a("strong",[s._v("基本概念")])]),s._v(" "),a("ul",[a("li",[s._v("脏读是指事务读取到其他事务没提交的数据（其他事务还没 commit）")]),s._v(" "),a("li",[s._v("不可重复读是指在同一次事务中前后两次相同查询语句结果不一致的问题（其他事务 commit 了）")]),s._v(" "),a("li",[s._v('幻读是一次事务中前后数据量发生变化用户产生不可预料的问题：比如当前事务删除了用户"张三"，其他事务此时又创建了"张三"，当前事务再次查询发现"张三"用户又出现了。')])]),s._v(" "),a("p",[a("strong",[s._v("总结")])]),s._v(" "),a("ul",[a("li",[s._v("脏读指读取到其他事务正在处理的未提交数据")]),s._v(" "),a("li",[s._v("不可重复读指并发更新时，另一个事务前后查询相同数据时的数据不符合预期")]),s._v(" "),a("li",[s._v("幻读指并发新增、删除这种会产生数量变化的操作时，另一个事务前后查询相同数据时的不符合预期")])]),s._v(" "),a("p",[a("strong",[s._v("事务隔离级别")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("隔离级别")]),s._v(" "),a("th",[s._v("脏读可能性")]),s._v(" "),a("th",[s._v("不可重复读可能性")]),s._v(" "),a("th",[s._v("幻读可能性")]),s._v(" "),a("th",[s._v("加读锁")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("READ-UNCOMMITTED")]),s._v(" "),a("td",[s._v("√")]),s._v(" "),a("td",[s._v("√")]),s._v(" "),a("td",[s._v("√")]),s._v(" "),a("td",[s._v("×")])]),s._v(" "),a("tr",[a("td",[s._v("READ-COMMITTED")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("√")]),s._v(" "),a("td",[s._v("√")]),s._v(" "),a("td",[s._v("×")])]),s._v(" "),a("tr",[a("td",[s._v("REPEATABLE-READ")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("√(innodb除外，不会幻读)")]),s._v(" "),a("td",[s._v("×")])]),s._v(" "),a("tr",[a("td",[s._v("SERIALIZABLE")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("×")]),s._v(" "),a("td",[s._v("√")])])])]),s._v(" "),a("p",[s._v("MySQL 默认事务隔离级别是 Repeatable Read(RR)-可重复读。MySQL 5.1 之后默认存储引擎就是 InnoDB，不会有幻读问题。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐030】这可能是最直白的mysql-mvcc机制讲解啦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐030】这可能是最直白的mysql-mvcc机制讲解啦"}},[s._v("#")]),s._v(" 【IT老齐030】这可能是最直白的MySQL MVCC机制讲解啦")]),s._v(" "),a("p",[s._v('在 MySQL InnoDB 存储引擎下 RC、RR 基于 MVCC（多版本并发控制）进行并发事务控制。MVCC 是基于"数据版本"对并发事务进行访问。')]),s._v(" "),a("p",[s._v("基于 undo_log 版本链进行版本控制。")]),s._v(" "),a("ul",[a("li",[s._v("undo_log 不是会被删除吗？中间数据万一被删了版本链不就断了？\n"),a("ul",[a("li",[s._v('undo_log 版本链不是立即删除，MySQL 确保版本链数据不再被"引用"后再进行删除。')])])])]),s._v(" "),a("p",[s._v("ReadView 是什么：")]),s._v(" "),a("ul",[a("li",[s._v('ReadView 是"快照读" SQL 执行时 MVCC 提取数据的依据，快照读就是最普通的 Select 查询SQL语句。')]),s._v(" "),a("li",[s._v("当前读指代执行下列语句时进行数据读取的方式：\n"),a("ul",[a("li",[a("code",[s._v("Insert、Update、Delete")])]),s._v(" "),a("li",[a("code",[s._v("Select...for update")])]),s._v(" "),a("li",[a("code",[s._v("Select...lock in share mode")])])])]),s._v(" "),a("li",[s._v("ReadView 是一个数据结构，包含4个字段\n"),a("ul",[a("li",[s._v("m_ids: 当前活跃的事务编号集合")]),s._v(" "),a("li",[s._v("min_trx_id: 最小活跃事务编号")]),s._v(" "),a("li",[s._v("max_trx_id: 预分配事务编号，当前最大事务编号+1")]),s._v(" "),a("li",[s._v("creator_trx_id: ReadView 创建者的事务编号")])])]),s._v(" "),a("li",[s._v("读已提交（RC）：在每一次执行快照读时生成 ReadView")]),s._v(" "),a("li",[s._v("版本链数据访问规则：根据当前事务 id、m_ids、min_trx_id、max_trx_id、creator_trx_id 综合判断")]),s._v(" "),a("li",[s._v("可重复读（RR）：仅在第一次执行快照读时生成 ReadView，后续快照读复用\n（有例外：后面会说）\n"),a("ul",[a("li",[s._v("RR 级别下使用 MVCC 能避免幻读吗？\n"),a("ul",[a("li",[s._v("能，但不完全能")])])]),s._v(" "),a("li",[s._v("连续多次快照读，ReadView 会产生复用，没有幻读问题\n"),a("ul",[a("li",[s._v("特例：当两次快照读之间存在当前读，ReadView 会重新生成，导致产生幻读")])])])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐031】当下火爆的微服务架构到底是个啥玩意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐031】当下火爆的微服务架构到底是个啥玩意"}},[s._v("#")]),s._v(" 【IT老齐031】当下火爆的微服务架构到底是个啥玩意？")]),s._v(" "),a("ul",[a("li",[s._v("了解分布式架构的发展过程")]),s._v(" "),a("li",[s._v("到底怎么才能算微服务架构")]),s._v(" "),a("li",[s._v("宜信落地的分布式架构体系")])]),s._v(" "),a("p",[s._v("单体阶段")]),s._v(" "),a("ul",[a("li",[s._v("紧耦合")]),s._v(" "),a("li",[s._v("系统复杂，牵一发动全局")]),s._v(" "),a("li",[s._v("所有模块耦合在一个进程中")]),s._v(" "),a("li",[s._v("完全封闭架构")]),s._v(" "),a("li",[s._v("业务发展初期，快速满足客户需求")])]),s._v(" "),a("p",[s._v("垂直拆分阶段")]),s._v(" "),a("ul",[a("li",[s._v("紧耦合")]),s._v(" "),a("li",[s._v("垂直拆分系统，竖井式架构子系统之间没有直接关联重复造轮子∶ OS，DB， Midderware")]),s._v(" "),a("li",[s._v("存在大量的重复代码拷贝")]),s._v(" "),a("li",[s._v("完全封闭架构业务")]),s._v(" "),a("li",[s._v("快速增长时，以应用系统为中心的架构模式")])]),s._v(" "),a("p",[s._v("RPC通信阶段")]),s._v(" "),a("ul",[a("li",[s._v("紧耦合（共享分布式对象实现远程方法调用））")]),s._v(" "),a("li",[s._v("系统交互采用RPC私有TCP协议")]),s._v(" "),a("li",[s._v("服务生产者消费者存在强代码依赖")]),s._v(" "),a("li",[s._v("异构系统集成不友好")]),s._v(" "),a("li",[s._v("高并发场景，性能比较好")])]),s._v(" "),a("p",[s._v("ESB服务总线阶段")]),s._v(" "),a("ul",[a("li",[s._v("松耦合")]),s._v(" "),a("li",[s._v("ESB 消息总线技术实现异构系统集成集中式架构管理")]),s._v(" "),a("li",[s._v("基于 WebService 技术，重量级的消息通讯机制")]),s._v(" "),a("li",[s._v("业务功能重用，粒度粗")]),s._v(" "),a("li",[s._v("智能管道哑终端")]),s._v(" "),a("li",[s._v("面向服务架构，团队规模大时，集成异构系统，提供统一服务解决方案。")])]),s._v(" "),a("p",[s._v("微服务\n")]),a("div",{attrs:{algin:"center"}},[a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEBc8e772c37bb482c1e7fc31a470070dec?method=download&shareKey=e5fe2f95325cac527e9502fad832ec7c"}})]),a("p"),s._v(" "),a("blockquote",[a("p",[s._v("詹姆斯·里维斯 & 马丁·弗勒：所谓微服务架构风格是一种将单个应用程序开发为一组小型服务的方法，每个小服务运行在自己的进程中，并以轻量级的机制(通常是HTTP RESTful API)的方式进行通信，这些服务围绕着业务能力所建立的，并且可以由完全自动化的部署机构独立部署，这些服务的集中管理只有最低限度，可以用不同的编程语言编写并使用不同的数据库存储技术。")])]),s._v(" "),a("p",[s._v("宜信落地的分布式架构体系：\n")]),a("div",{attrs:{algin:"center"}},[a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEB9375d88665f36c35ab0bd891817d2cb5?method=download&shareKey=91a90daafa827fdc8e8065fb3247bfaa"}})]),a("p"),s._v(" "),a("h2",{attrs:{id:"【it老齐035】到底什么是蓝绿、红黑、灰度发布-留给发布部署的颜色不多啦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐035】到底什么是蓝绿、红黑、灰度发布-留给发布部署的颜色不多啦"}},[s._v("#")]),s._v(" 【IT老齐035】到底什么是蓝绿、红黑、灰度发布？留给发布部署的颜色不多啦！")]),s._v(" "),a("p",[s._v("科学部署的意义：")]),s._v(" "),a("ul",[a("li",[s._v("尽可能减少服务停机时间")]),s._v(" "),a("li",[s._v("控制新版本带来的质量风险")])]),s._v(" "),a("p",[s._v("发布类型：")]),s._v(" "),a("ul",[a("li",[s._v("全量发布：\n"),a("ul",[a("li",[s._v("蓝绿部署（Blue-green Deployment）")]),s._v(" "),a("li",[s._v("红黑部署（Red-black Deployment）")])])]),s._v(" "),a("li",[s._v("增量发布：灰度发布（Gray Release）")])]),s._v(" "),a("p",[a("strong",[s._v("蓝绿发布")]),s._v("\n正常业务下有两个相同功能的集群 A 和 B。在没有发布新版本的情况下，A 和 B 版本相同。需要发布新版本时，流程如下：")]),s._v(" "),a("ol",[a("li",[s._v("从负载均衡器中删除 A，将 A 集群升级到新版本")]),s._v(" "),a("li",[s._v("将负载均衡器指向 A，删除 B")]),s._v(" "),a("li",[s._v("将 B 集群升级到新版本，加入负载均衡器")])]),s._v(" "),a("p",[a("strong",[s._v("红黑发布")]),s._v("\n正常业务下只有一个集群 A。发布新版本流程如下：")]),s._v(" "),a("ol",[a("li",[s._v("创建一个集群 B，版本为新版本")]),s._v(" "),a("li",[s._v("将负载均衡器指向集群 B")]),s._v(" "),a("li",[s._v("释放集群 A 所有资源")])]),s._v(" "),a("p",[s._v("与蓝绿部署相比，红黑部署充分利用了云计算的弹性伸缩优势，从而获得了两个收益：")]),s._v(" "),a("ol",[a("li",[s._v("一是，简化了流程；")]),s._v(" "),a("li",[s._v("二是，避免了在升级的过程中，由于只有一半的服务器提供服务，而可能导致的系统过载问题。")])]),s._v(" "),a("p",[a("strong",[s._v("灰度发布")]),s._v("\n灰度发布，也被叫作金丝雀发布。与蓝绿部署、红黑部署不同的是，灰度发布属于增量发布方法。也就是说，服务升级的过程中，新旧版本会同时为用户提供服务。")]),s._v(" "),a("ul",[a("li",[s._v("灰度发布遇到的挑战 1\n"),a("blockquote",[a("p",[s._v("考虑数据库变更对旧版本的兼容性影响\n例如：某数据表有 a，b 两个字段\n程序猿小甲的 SQL 是： insert into t values('a','b');\n但 v1.1 版本中在数据表增加了 c 字段，就版本运行就会报错\n因此在考虑未来灰度发布的情况，要求团队成员写 SQL 必须明确字段\ninsert into t(a,b) values('a','b');\nTIPS：任何删除、更新字段信息的操作都要格外谨慎")])])]),s._v(" "),a("li",[s._v("灰度发布遇到的挑战2\n"),a("blockquote",[a("p",[s._v("灰度发布用户群的选择\n不能直接采用类似于 Nginx 的权重 Weight\n会导致一个用户不同请求在新旧版本间反复横跳，出现无法预期的 Bug\n解决方法：利用 Nginx + Lua 脚本化\n基于 IP 或者 UA 等用户稳定特性然后 Hash 取模来决定访问新旧版本\nHash(192.168.31.102) % 10 = 7 #送给旧版本\nHash(192.168.31.108) % 10 = 9 #送给新版本")])])]),s._v(" "),a("li",[s._v("灰度发布遇到的挑战3\n"),a("blockquote",[a("p",[s._v("什么时候才可以提升分配比例\n在发布过程中，我们应该注意监测用户请求失败率、用户请求处理时长和异常出现数量这几个信息，以保证快速发现问题并及时回滚。\n在灰度发布的时候，可以部署相对较小的集群，让集群保持在高压力确认新版应用的性能情况，之后再酌情进行扩容。\nTIPS：推荐了解下 SkyWalking，国产开源监控系统，简单粗暴")])])])]),s._v(" "),a("p",[a("strong",[s._v("对于新旧版本无法协同作业的情况")])]),s._v(" "),a("ul",[a("li",[s._v("方案一：放弃灰度，采用红黑方式全量发布")]),s._v(" "),a("li",[s._v("方案二（了解一下即可，项目几乎不会考虑）：可以考虑独立部署数据源进行迁移，为新旧版本分配独立的数据源，但新旧数据源之间数据同步会更考验架构师与 DBA 的智慧")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐036】阿里开发规范解读-小心mysql索引选择性陷阱"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐036】阿里开发规范解读-小心mysql索引选择性陷阱"}},[s._v("#")]),s._v(" 【IT老齐036】阿里开发规范解读，小心MySQL索引选择性陷阱")]),s._v(" "),a("p",[s._v("阿里开发规范：")]),s._v(" "),a("blockquote",[a("p",[s._v("[强制]页面搜索严禁左模糊或者全模糊,如果需要请走搜索引|擎来解决。\n说明:索引文件具有B-Tree的最左前缀匹配特性,如果左边的值未确定,那么无法使用此索引。")])]),s._v(" "),a("p",[s._v('like 查询时，头匹配命中索引（like "xxx%"，索引选择性太差时也可能导致全表扫描），尾匹配与任意匹配全表扫描。')]),s._v(" "),a("p",[s._v("不严谨解释：命中的索引值超过总量 25%，就可能产生索引选择性陷阱，导致全表扫描")]),s._v(" "),a("ul",[a("li",[s._v("PS：一切以Explain执行计划为准")])]),s._v(" "),a("p",[s._v("常见案例：")]),s._v(" "),a("ul",[a("li",[s._v("在业务表只查询逻辑删=0数据 "),a("code",[s._v("select * from t where is_delete = 0或1")])]),s._v(" "),a("li",[s._v("查询格力集团月薪<=5万的人员工资")]),s._v(" "),a("li",[s._v("医院护士表查询性别=女的工作人员")])]),s._v(" "),a("p",[s._v("索引选择性差解决办法：")]),s._v(" "),a("ul",[a("li",[s._v("通过组合索引提高选择性（业务相关）"),a("code",[s._v("select * from 护士表 where 科室='妇科' and 性别='女'")])]),s._v(" "),a("li",[s._v("引入搜索引擎：如 ES 或者 Solr（更换数据源）\n"),a("ul",[a("li",[s._v("例如：将护士表导入 ElasticSearch，ES 基于分片多线程检索，解决查询慢的问题")])])]),s._v(" "),a("li",[s._v("强制使用索引（有时会有奇效,以实际运行效果为准）\n"),a("ul",[a("li",[a("code",[s._v("explain select * from question force index(answer) where answer = 'A'")])]),s._v(" "),a("li",[s._v("增加缓存，提高全表扫描速度（钞能力）\n"),a("ul",[a("li",[s._v("innodb_buffer_pool_size=16G")]),s._v(" "),a("li",[s._v("innodb_buffer_pool_instances=2")])])])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐038】mq中间件是如何实现可靠性投递的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐038】mq中间件是如何实现可靠性投递的"}},[s._v("#")]),s._v(" 【IT老齐038】MQ中间件是如何实现可靠性投递的？")]),s._v(" "),a("p",[s._v("ＭＱ中间件的通用消息投递过程，有哪些情况可能会造成丢数据")]),s._v(" "),a("ul",[a("li",[s._v("发送阶段，遇到高延迟，Producer 会多次重发消息，直到 Broker ack 确认，过程中 Broker 会自动去重，超时 Producer 产生异常，应用进行捕获提示。")]),s._v(" "),a("li",[s._v("存储阶段，Broker 先刷盘再 ack 确认，即便 ack 失败消息不会丢失，多次重试直到 Producer 接收，会导致消息积压。")]),s._v(" "),a("li",[s._v("消费阶段，Broker 向 Consumer 发数据，一段时间未接收，自动重发，直到 Consumer Ack 确认，Consumer 注意幂等处理。")])]),s._v(" "),a("p",[s._v("措施：")]),s._v(" "),a("ol",[a("li",[s._v("异步刷盘(NSYNC_FLUSH)，改同步刷盘")]),s._v(" "),a("li",[s._v("存储介质损坏，建议采用 RAID10 或分布式存储")]),s._v(" "),a("li",[s._v("不要启用自动 Ack，RabbitMQ 存在此问题")]),s._v(" "),a("li",[s._v("避开都市传说 ActiveMQ")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐039】京东是如何实现应用发布与持续集成-ci-的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐039】京东是如何实现应用发布与持续集成-ci-的"}},[s._v("#")]),s._v(" 【IT老齐039】京东是如何实现应用发布与持续集成(CI)的？")]),s._v(" "),a("div",{attrs:{algin:"center"}},[a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEB6a13635a75dcf5292866659836efaf42?method=download&shareKey=66d49042d8cc7c44079926f958c0210f"}})]),s._v(" "),a("h2",{attrs:{id:"【it老齐040】面试官-为什么表的主键要使用代理主键-自增编号-不建议使用自然主键"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐040】面试官-为什么表的主键要使用代理主键-自增编号-不建议使用自然主键"}},[s._v("#")]),s._v(" 【IT老齐040】面试官：为什么表的主键要使用代理主键（自增编号），不建议使用自然主键？")]),s._v(" "),a("ol",[a("li",[s._v("业务主键更浪费空间")]),s._v(" "),a("li",[s._v("业务主键无顺序，可能会造成写入数据时需要更长组织索引")]),s._v(" "),a("li",[s._v("业务主键如果是字符串，在分库分表时，无法直接取模运算，需要先转换为数字，处理更麻烦了。")]),s._v(" "),a("li",[s._v("有时候业务上可能需要保存两条相同的业务主键数据，此时处理比较麻烦")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐046】项目案例分享-宜信如何利用rabbitmq死信队列解决消息积压问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐046】项目案例分享-宜信如何利用rabbitmq死信队列解决消息积压问题"}},[s._v("#")]),s._v(" 【IT老齐046】项目案例分享，宜信如何利用RabbitMQ死信队列解决消息积压问题")]),s._v(" "),a("p",[s._v("场景：每天上午10点，全国2万多名客户经理集中录入上一日JK单据到BorrowSale系统，峰值能达到500单/s，但信审系统任务重，最多只支持到60单/s，每日会导致大量消息积压")]),s._v(" "),a("p",[s._v("最简单办法：RabbitMQ改为工作队列模式，将消息送给9个信审系统实例并行完成。这样资源浪费严重。")]),s._v(" "),a("p",[s._v("解决办法：依赖RabbitMQ的“死信队列”特性，将死信消息自动送达死信队列中，BS前台接收到死信消息后将其保存到死信消息表，1小时后重新发送，等待闲时由信审系统进行处理。这样便实现了在不增加资源的前提下，对信审系统资源进行“削峰填谷”。")]),s._v(" "),a("p",[s._v("什么是死信？")]),s._v(" "),a("ul",[a("li",[s._v("即过期或无法处理的消息。")])]),s._v(" "),a("p",[s._v("死信是怎么产生的？")]),s._v(" "),a("ul",[a("li",[s._v("消费者拒绝接受，且没有重新入列的消息")]),s._v(" "),a("li",[s._v("队列满了，无法入列的消息")]),s._v(" "),a("li",[s._v("消息设置了TTL过期时间，超过有效时间后的消息")]),s._v(" "),a("li",[s._v("队列设置了TTL过期时间，超过有效时间后的消息")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐047】避坑分享-财z部金财平台用主键用了uuid后-我们都疯了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐047】避坑分享-财z部金财平台用主键用了uuid后-我们都疯了"}},[s._v("#")]),s._v(" 【IT老齐047】避坑分享，财Z部金财平台用主键用了UUID后，我们都疯了！")]),s._v(" "),a("p",[s._v("问题背景：财政部金财工程平台在代理行日终结算时，经常出现磁盘的IO异常，导致经常出现高延迟。这个问题一直困扰我们很长时间，对比发现在大量数据新增时磁盘IO居高不下，多次测试后发现是UUID主键在搞鬼。")]),s._v(" "),a("p",[a("strong",[s._v("UUId：Universally Unique Identifier")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("版本")]),s._v(" "),a("th",[s._v("说明")]),s._v(" "),a("th",[s._v("特点")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("UUID1")]),s._v(" "),a("td",[s._v("基于时间的 UUID")]),s._v(" "),a("td",[s._v("能保证不同设备UUID是唯一的"),a("br"),s._v("在同一设备上生成UUID可能重复")])]),s._v(" "),a("tr",[a("td",[s._v("UUID2")]),s._v(" "),a("td",[s._v("DCE 安全的 UUID")]),s._v(" "),a("td",[s._v("DCE(身份验证和安全服务)"),a("br"),s._v("涉及侵犯用户隐私"),a("br"),s._v("有损时间戳导致精度丢失")])]),s._v(" "),a("tr",[a("td",[s._v("UUID3")]),s._v(" "),a("td",[s._v("基于名字的 UUID（MD5）")]),s._v(" "),a("td",[s._v("在相同的命名空间下可能会出现UUID冲突")])]),s._v(" "),a("tr",[a("td",[s._v("UUID4")]),s._v(" "),a("td",[s._v("随机生成的 UUID")]),s._v(" "),a("td",[s._v("完全随机生成，会存在极小概率重复的情况"),a("br"),s._v("与外部环境无关，不涉及环境信息"),a("br"),s._v("生成内容无序无规律"),a("br"),s._v("目前的主流做法")])]),s._v(" "),a("tr",[a("td",[s._v("UUID5")]),s._v(" "),a("td",[s._v("基于名字的 UUID（SH1）")]),s._v(" "),a("td",[s._v("在相同的命名空间下可能会出现UUID冲突")])])])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UUID\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UUID")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("randomUUID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 7bf13c38-00a1-489e-b1d3-80c4b9b2fa66")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("为什么 UUID 会引起IO异常")]),s._v("\nUUID 模式：")]),s._v(" "),a("ul",[a("li",[s._v("全局唯一性 √")]),s._v(" "),a("li",[s._v("信息安全 √")]),s._v(" "),a("li",[s._v("趋势递增 ×")]),s._v(" "),a("li",[s._v("索引效率 ×")])]),s._v(" "),a("p",[s._v("UUID 是无序的，当 UUID 可能在索引中间某一页插入数据时，新增记录所在的数据页已满，数据库需要申请一个新的数据页存储数据，这种现象被称为“页分裂”。页分裂确保后一个数据页中的所有的 ID 值一定比数据页中的 ID 值大，在大并发环境环境下增加了磁盘IO的压力，无序ID才是罪魁祸首。")]),s._v(" "),a("p",[s._v("解决办法：改为有序的数字主键生成策略就可以了")]),s._v(" "),a("ul",[a("li",[s._v("如美团 Leaf / 推特 Snowflake")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐048】为什么kafka这么快-解密kafka高性能背后的秘密"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐048】为什么kafka这么快-解密kafka高性能背后的秘密"}},[s._v("#")]),s._v(" 【IT老齐048】为什么Kafka这么快，解密Kafka高性能背后的秘密")]),s._v(" "),a("p",[s._v("Kafka 快的秘密：")]),s._v(" "),a("ul",[a("li",[s._v("磁盘顺序读写")]),s._v(" "),a("li",[s._v("页缓存")]),s._v(" "),a("li",[s._v("零拷贝")]),s._v(" "),a("li",[s._v("批量操作")])]),s._v(" "),a("p",[s._v("Kafka 避免使用 JVM 直接使用操作系统的页缓存特性提高处理速度，进而避免了 JVM GC 带来的性能损耗。Kafka采用字节紧密存储，避免产生对象，这样可以进一步提高空间利用率。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐049】十分钟说明白列式存储数据库查询性能这么牛逼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐049】十分钟说明白列式存储数据库查询性能这么牛逼"}},[s._v("#")]),s._v(" 【IT老齐049】十分钟说明白列式存储数据库查询性能这么牛逼")]),s._v(" "),a("p",[s._v("列式数据库是以列相关存储架构进行数据存储的数据库。")]),s._v(" "),a("p",[s._v("应用场景：批量处理、超大规模即时查询")]),s._v(" "),a("p",[s._v("常见列式存储数据库：Hbase、cassandra")]),s._v(" "),a("p",[s._v("特性：")]),s._v(" "),a("ol",[a("li",[s._v("数据库不读取无效数据：只查询指定列上的数据、只返回指定列上的数据、磁盘I/O效率高")]),s._v(" "),a("li",[s._v("数据压缩比大：数据相关性大、压缩比高、利用 Cache I/O")])]),s._v(" "),a("p",[s._v("列式存储遗留问题：")]),s._v(" "),a("ol",[a("li",[s._v("如何高效新增？——多个列族，并发写磁盘")]),s._v(" "),a("li",[s._v("如何高效更新？——添加一个新版本号的数据，不修改老数据")]),s._v(" "),a("li",[s._v("如何高效删除？——添加删除标记 keyType=Delete")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐050】cpu、内存、硬盘三大件-mysql服务器该如何选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐050】cpu、内存、硬盘三大件-mysql服务器该如何选择"}},[s._v("#")]),s._v(" 【IT老齐050】CPU、内存、硬盘三大件，MySQL服务器该如何选择")]),s._v(" "),a("p",[a("strong",[s._v("CPU优先选大核还是选多核？")])]),s._v(" "),a("ul",[a("li",[s._v("MySQL 5.6 之后对多核 CPU 进行了优化")]),s._v(" "),a("li",[s._v("MySQL 不支持多 CPU 对同一 SQL 并发处理")])]),s._v(" "),a("p",[s._v("总结：")]),s._v(" "),a("ul",[a("li",[s._v("64 位的 CPU 一定要工作在 64 位的系统下")]),s._v(" "),a("li",[s._v("对于并发比较高的场景，CPU 的数量比频率重要")]),s._v(" "),a("li",[s._v("对于 CPU 密集型场景和复杂 SQL 则频率越高越好")])]),s._v(" "),a("p",[a("strong",[s._v("物理内存多大合适？")])]),s._v(" "),a("ul",[a("li",[s._v("InnoDB 会把索引和数据缓存到内存")])]),s._v(" "),a("p",[s._v("总结：")]),s._v(" "),a("ul",[a("li",[s._v("理想的选择是服务器的内存大于数据总量")]),s._v(" "),a("li",[s._v("内存频率越高处理速度越快")]),s._v(" "),a("li",[s._v("内存总量小要合理组织热点数据，保证内存覆盖")]),s._v(" "),a("li",[s._v("内存对写操作也有重要的性能影响")])]),s._v(" "),a("p",[a("strong",[s._v("硬盘RAID该怎么选？")]),s._v("\n三种介质：高速 SSD、混合硬盘（SSD 和机械的组合）、机械硬盘（转速越高越快）")]),s._v(" "),a("p",[s._v("RAID 介绍：RAID 是磁盘冗余队列的简称（Redundant Arrays of Independent Disks）。简单来说就 RAID 的作用就是可以把多个容量较小的磁盘组成一组容量更大的磁盘，并提供数据冗余来保证数据完整性的技术。")]),s._v(" "),a("p",[s._v("RAID 0：RAID 0 是最早出现的 RAID 模式，也称之为数据条带。是组建磁盘阵列中最简单的一种形式，只需要 2 块以上的硬盘即可，成本低，可以提高整个磁盘的性能和吞吐量。RAID 0 没有提供冗余或错误修复能力，但是实现成本是最低的。")]),s._v(" "),a("p",[s._v("RAID 1：又称磁盘镜像，原理是把一个磁盘的数据镜像到另一个磁盘上，也就是说数据在写入一块磁盘的同时，会在另一块闲置的磁盘上生成镜像文件，在不影响性能的情况下最大限度保证系统的可靠性和可修复性。")]),s._v(" "),a("p",[s._v("RAID 5：又称为分布式奇偶校验磁盘阵列。通过分布式奇偶校验块把数据分散到多个磁盘上，这样如果任何一个盘数据失效，都可以从奇偶校验块中重建。但是如果两块从磁盘失效，则整个卷的数据都无法恢复。")]),s._v(" "),a("p",[s._v("RAID 10（读作一零）：又称分片的镜像。它是对磁盘先做 RAID 1 之后对两组 RAID 1 的磁盘再做 RAID 0，所以对读写都有良好的性能，相对于 RAID 5 重建起来更简单，速度也更快。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("等级")]),s._v(" "),a("th",[s._v("特点")]),s._v(" "),a("th",[s._v("是否冗余")]),s._v(" "),a("th",[s._v("盘数")]),s._v(" "),a("th",[s._v("读")]),s._v(" "),a("th",[s._v("写")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("RAID 0")]),s._v(" "),a("td",[s._v("便宜，快速，危险")]),s._v(" "),a("td",[s._v("否")]),s._v(" "),a("td",[s._v("N")]),s._v(" "),a("td",[s._v("快")]),s._v(" "),a("td",[s._v("快")])]),s._v(" "),a("tr",[a("td",[s._v("RAID 1")]),s._v(" "),a("td",[s._v("高速度，简单，安全")]),s._v(" "),a("td",[s._v("有")]),s._v(" "),a("td",[s._v("2N")]),s._v(" "),a("td",[s._v("快")]),s._v(" "),a("td",[s._v("慢")])]),s._v(" "),a("tr",[a("td",[s._v("RAID 5")]),s._v(" "),a("td",[s._v("安全，成本折中")]),s._v(" "),a("td",[s._v("有")]),s._v(" "),a("td",[s._v("N+1")]),s._v(" "),a("td",[s._v("快")]),s._v(" "),a("td",[s._v("取决于最慢的盘")])]),s._v(" "),a("tr",[a("td",[s._v("RAID 10")]),s._v(" "),a("td",[s._v("贵，高速，安全")]),s._v(" "),a("td",[s._v("有")]),s._v(" "),a("td",[s._v("2N")]),s._v(" "),a("td",[s._v("快")]),s._v(" "),a("td",[s._v("快")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐051】你是微博的架构师-大v更新动态-动态通知采用推push还是拉pull更合适"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐051】你是微博的架构师-大v更新动态-动态通知采用推push还是拉pull更合适"}},[s._v("#")]),s._v(" 【IT老齐051】你是微博的架构师，大V更新动态，动态通知采用推Push还是拉Pull更合适？")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}}),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("Push模式")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("Pull拉取模式")])])]),s._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("实时性")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("较好，通过网络管道准实时发送")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("较差，取决于定时轮询时间")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("服务器状态")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("有状态，需持久化粉丝动态队列")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("无状态，根据请求实时查询")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("风险项")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("大V动态的并发“写扩散”问题"),a("br"),s._v("大量动态队列持久化造成磁盘高 IO")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("大量粉丝准点“读扩散”问题"),a("br"),s._v("大V粉丝准点并发查询搞垮服务器")])]),s._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[s._v("应用场景")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("微信")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("微博(早期)")])])])]),s._v(" "),a("p",[s._v("写扩散（Push）优化")]),s._v(" "),a("ul",[a("li",[s._v("设置上限，微信好友 5000 个")]),s._v(" "),a("li",[s._v("限流策略，X 分钟内完成消息发布")]),s._v(" "),a("li",[s._v("优化存储策略，采用 NoSQL 或大数据方案")])]),s._v(" "),a("p",[s._v("读扩散（Pull）优化")]),s._v(" "),a("ul",[a("li",[s._v("MQ 削峰填谷，超长队列直接拒绝")]),s._v(" "),a("li",[s._v("增加轮询间隔，减少请求次数")]),s._v(" "),a("li",[s._v("服务端增加缓存，优化查询效率")]),s._v(" "),a("li",[s._v("增加验证码，分散时间，减少机器人刷票")])]),s._v(" "),a("p",[s._v("推特的混合模式")]),s._v(" "),a("ul",[a("li",[s._v("粉丝量小于X，Push 模式")]),s._v(" "),a("li",[s._v("粉丝量大于X，Pull 模式")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐052】抽push或拉pull-一字之差-差之千里。一个真实架构案例引发的思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐052】抽push或拉pull-一字之差-差之千里。一个真实架构案例引发的思考"}},[s._v("#")]),s._v(" 【IT老齐052】抽Push或拉Pull，一字之差，差之千里。一个真实架构案例引发的思考")]),s._v(" "),a("p",[s._v("背景：账户系统、四个业务系统 A、B、C、D 会从账户系统查询并存储用户信息，如何保持子系统和账户系统数据（比如用户名）尽量一致？")]),s._v(" "),a("ul",[a("li",[s._v("方案一：账户系统修改用户之后，分别调用 A、B、C、D 业务系统的接口修改用户名")]),s._v(" "),a("li",[s._v("方案二：各系统根据业务特性定时查询账户系统接口，获取最近一段时间的用户名变更情况，更新本地库")]),s._v(" "),a("li",[s._v("方案三：引入消息队列，账户系统在修改用户名时发布消息到 MQ，各个业务系统订阅 MQ 进行消费")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐053】单页10万qps-京东如何通过动静分离架构抗住超高并发访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐053】单页10万qps-京东如何通过动静分离架构抗住超高并发访问"}},[s._v("#")]),s._v(" 【IT老齐053】单页10万QPS，京东如何通过动静分离架构抗住超高并发访问")]),s._v(" "),a("p",[s._v("架构三大分离设计")]),s._v(" "),a("ul",[a("li",[s._v("读写分离")]),s._v(" "),a("li",[s._v("动静分离")]),s._v(" "),a("li",[s._v("前后台分离")])]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[s._v("静态数据是”无个性化”数据\n"),a("ul",[a("li",[s._v("静态文件: HTML/CSS/JS/图片")]),s._v(" "),a("li",[s._v("低频变动数据: 字典数据 / 地区数据 / 组织架构 / 历史数据")])])]),s._v(" "),a("li",[s._v("动态数据就是个性化/高频写数据\n"),a("ul",[a("li",[s._v("个性化推荐")]),s._v(" "),a("li",[s._v("高频写: 股市行情 / 5G信号数据 / 天气变化")])])]),s._v(" "),a("li",[s._v("有效区分页面中的动静数据是优化的关键前提")])]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[s._v("页面静态化技术\n"),a("ul",[a("li",[s._v("将动态页面”另存为”静态页面保存到本地磁盘")]),s._v(" "),a("li",[s._v("利用Nginx直接路由到磁盘文件，不再进入后端")]),s._v(" "),a("li",[s._v("文件碎片化严重，文件同步管理麻烦")])])]),s._v(" "),a("li",[s._v("页面伪静态化技术(推荐)\n"),a("ul",[a("li",[s._v("利用Redis缓存,缓存生成的页面")]),s._v(" "),a("li",[s._v("没有碎片化问题,可自动过期,数据管理轻松")]),s._v(" "),a("li",[s._v("需要大量内存存储信息")])])])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("静态化不是万能的")]),s._v(" "),a("ul",[a("li",[s._v("静态化只适合数据集有限(百万量级)的场景\n"),a("ul",[a("li",[s._v("热点商品SKU")])])]),s._v(" "),a("li",[s._v("页面集过大不适合静态化\n"),a("ul",[a("li",[s._v("商品全量SKU,文件碎片太多")]),s._v(" "),a("li",[s._v("批量同步磁盘IO瓶颈")]),s._v(" "),a("li",[s._v("伪静态化内存开销太大")])])]),s._v(" "),a("li",[s._v("动态内容是静态化遇到的新挑战")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("动静整合方案")]),s._v(" "),a("ul",[a("li",[s._v("服务端SSI法\n"),a("ul",[a("li",[s._v("利用Nginx SSI特性实现服务端动静整合")])])]),s._v(" "),a("li",[s._v("Ajax异步调用法\n"),a("ul",[a("li",[s._v("生成静态页面,动态数据部分发起Ajax异步查询")])])])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("SSI是Server Side Inclde的缩写，是一种基于服务端的网页制作技术，就是服务端包含的意思，该项目中用到了nginx中SSI模块的include命令，这个命令会包含一个页面，然后在nginx服务器中展开。")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[s._v("示意：http://item.jd.com/1101.html\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--# include file="/static/cal-1101.html" --\x3e')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--# include file="/static/title-1101.html" --\x3e')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--# include file="/dynamic/pro/1101" --\x3e')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--# include file="/static/sku-1101.html" --\x3e')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("异步请求法")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[s._v("示意：http://item.jd.com/1101.html\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("轮播HTML代码..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("标题HTML代码..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")]),s._v("promotion"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("SKU HTML代码..."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n        $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ajax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/dynamic/pro/1101'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            success "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 根据返回"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),s._v("组织活动"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTML")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"【it老齐054】分析医x云案例-为什么抛弃mysql去拥抱mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐054】分析医x云案例-为什么抛弃mysql去拥抱mongodb"}},[s._v("#")]),s._v(" 【IT老齐054】分析医X云案例，为什么抛弃MySQL去拥抱MongoDB")]),s._v(" "),a("p",[s._v("MongoDB在海量处理数据时有什么优势")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("程序使用的表达（JSON文档）和数据存储是一致的\n称为“面向对象数据模型”")]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[s._v("多形性：同一个集合中可以包含不同字段（类型）的文档对象")]),s._v(" "),a("li",[s._v("动态性：线上修改数据模式，修改时应用与数据库均无需下线\n"),a("ul",[a("li",[s._v("可动态增加新字段")])])]),s._v(" "),a("li",[s._v("数据治理：支持使用 JSON Schema 来规范数据模式。在保证模式灵活动态的前提下，提供数据治理能力。")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("JSON 模型之快速特性：")]),s._v(" "),a("ul",[a("li",[s._v("数据库引擎只需要在一个存储区读写")]),s._v(" "),a("li",[s._v("反范式、无关联的组织极大优化查询速度")]),s._v(" "),a("li",[s._v("程序 API 自然，开发快速")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("MongoDB 其他优势")]),s._v(" "),a("ul",[a("li",[s._v("Replica Set- 2 to 50 个成员")]),s._v(" "),a("li",[s._v("自恢复")]),s._v(" "),a("li",[s._v("多中心容灾能力")]),s._v(" "),a("li",[s._v("滚动服务-最小化服务终端")]),s._v(" "),a("li",[s._v("需要的时候无缝扩展")]),s._v(" "),a("li",[s._v("应用全透明")]),s._v(" "),a("li",[s._v("多种数据分布策略")]),s._v(" "),a("li",[s._v("轻松支持 TB-PB 数量级")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐058】利用zookeeper解决分布式系统商品库存超卖问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐058】利用zookeeper解决分布式系统商品库存超卖问题"}},[s._v("#")]),s._v(" 【IT老齐058】利用Zookeeper解决分布式系统商品库存超卖问题")]),s._v(" "),a("p",[s._v("并发环境扣减库存会出现问题：比如商品库存只有 10 个，高并发环境下却可以超卖不止 10 个，商品将面临损失")]),s._v(" "),a("p",[s._v("解决方案：")]),s._v(" "),a("ol",[a("li",[s._v("传统的 synchronized 是无效的，它只针对一个 JVM 进程内多个线程起到同步作用，对跨进程无效。")]),s._v(" "),a("li",[s._v("利用数据库 select ... for update 语句对库存进行锁定，依赖数据库自身特性，遇到跨库(分库分表)处理起来比较麻烦。")]),s._v(" "),a("li",[s._v("利用 Zookeeper、Redis 实现分布式锁特性，通过分布式锁调度进程处理，数据程序级别控制，处理更为灵活。")])]),s._v(" "),a("p",[a("strong",[s._v('"锁"带来的问题')])]),s._v(" "),a("p",[s._v("无论是数据库排它锁，还是 ZK、Redis 的分布式锁都属于“悲观锁”的范畴，虽然以阻塞的方式保证数据的一致性，但并发量也会直线下降，这是要付出的代价。适用分布式锁有以下几个场景：")]),s._v(" "),a("ul",[a("li",[s._v("数据价值大，必须要保证一致性的。 例如:金融业务系统间的转账汇款等。")]),s._v(" "),a("li",[s._v("并发量低但重要的业务系统。比如:各种大宗商品的分布式交易")])]),s._v(" "),a("p",[s._v("总结下：重要的但对并发要求不高的系统可以使用分布式锁，对于并发量高、数据价值小、对一致性要求没那么高的系统可以进行最终一致性(BASE)处理，保证并发的前提下通过重试、程序矫正、人工补录的方式进行处理。")]),s._v(" "),a("p",[a("strong",[s._v("什么是 Zookeeper？")]),s._v("\nZookeeper (业界简称 zk )是一-种提供配置管理、分布式协同以及命名的中心化服务，这些提供的功能都是分布式系统中非常底层且必不可少的基本功能，但是如果自己实现这些功能而且要达到高吞吐、低延迟同时还要保持一致性和可用性， 实际上非常困难。因此 zookeeper 提供了这些功能，开发者在 zookeeper 之上构建自己的各种分布式系统。")]),s._v(" "),a("p",[s._v("Zookeeper 分布式锁实现原理：采用临时有序节点，多个客户端只能按顺序获取，同一时刻只能有一个客户端持有锁")]),s._v(" "),a("p",[s._v("Zookeeper 的数据存储结构就像一颗树，这棵树由节点组成，这种节点叫做 Znode。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("zookeeper\n  config\n  quota\nlocks\n  wh-shoe\n    _c_xxxxx-lock-0000000009\n    _c_xxxxx-lock-0000000010\n    _c_xxxxx-lock-0000000011\n    _c_xxxxx-lock-0000000012\n    _c_xxxxx-lock-0000000013\n    _c_xxxxx-lock-0000000014\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("Znode 分为四种类型")])]),s._v(" "),a("ul",[a("li",[s._v("持久节点(PERSISTENT)：默认的节点类型。创建节点的客户端与zookeeper断开连接后,该节点依旧存在")]),s._v(" "),a("li",[s._v("持久节点顺序节点(PERSISTENT SEQUENTIAL)：所谓顺序节点，就是在创建节点时，Zookeeper根据创建的时间顺序给该节点名称进行编号")]),s._v(" "),a("li",[s._v("临时节点(EPHEMERAL)：和持久节点相反,当创建节点的客户端与zookeeper断开连接后，临时节点会被删除")]),s._v(" "),a("li",[s._v("临时顺序节点(EPHEMERAL SEQUENTIAL)：顾名思义，临时顺序节点结合和临时节点和顺序节点的特点；在创建节点时，Zookeeper根据创建的时间顺序给该节点名称进行编号；当创建节点的客户端与 zookeeper 断开连接后，临时节点会被删除")])]),s._v(" "),a("p",[a("strong",[s._v("为什么是临时顺序节点？")])]),s._v(" "),a("ul",[a("li",[s._v('利用临时顺序节点可以避免"惊群效应"，当某一个客户端释放锁以后，其他客户端不会一窝蜂的涌入争抢锁资源，而是按时间顺序一个一个来获取锁进行处理。')])]),s._v(" "),a("p",[a("strong",[s._v("临时顺序节点的实现原理")])]),s._v(" "),a("ul",[a("li",[s._v("每一个客户端在尝试获取锁时都自动由 ZK 创建该顺序节点的“子节点”，按 0001、0002 这样的编号标识访问顺序")]),s._v(" "),a("li",[s._v('从第二个客户端开始，ZK 不但创建 0002 子节点，还会监听前一个 0001 节点。 当客户端 1 处理完毕或者其他原因释放 0001 节点后，ZK 会通过 Watch 监听机制通知客户端 2 进行后续处理，以此保证处理的有序性,避免"惊群效应”产生。')])]),s._v(" "),a("h2",{attrs:{id:"【it老齐061】大白话聊聊base最终一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐061】大白话聊聊base最终一致性"}},[s._v("#")]),s._v(" 【IT老齐061】大白话聊聊BASE最终一致性")]),s._v(" "),a("ul",[a("li",[s._v("Basically Available（基本可用）")]),s._v(" "),a("li",[s._v("Soft state（软状态）")]),s._v(" "),a("li",[s._v("Eventually consistent（最终一致性）")])]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[s._v("基本可用就是快速实现用户的基本价值与诉求")]),s._v(" "),a("li",[s._v("软状态代表了在业务操作中没有最终完成前的中间状态")]),s._v(" "),a("li",[s._v("最终一致性代表通过技术手段，过一段时间后让数据保持完整的状态")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("保证最终一致性的手段")]),s._v(" "),a("ul",[a("li",[s._v("重试")]),s._v(" "),a("li",[s._v("数据校对程序")]),s._v(" "),a("li",[s._v("人工介入")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐063】大型电商整点秒杀业务场景下-商品库存如何预防超卖现象产生"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐063】大型电商整点秒杀业务场景下-商品库存如何预防超卖现象产生"}},[s._v("#")]),s._v(" 【IT老齐063】大型电商整点秒杀业务场景下，商品库存如何预防超卖现象产生")]),s._v(" "),a("ul",[a("li",[s._v("分析库存超卖的产生")]),s._v(" "),a("li",[s._v("秒杀场景的分析")]),s._v(" "),a("li",[s._v("高并发下预防超卖的解决方案")])]),s._v(" "),a("p",[s._v("秒杀商品库存总量固定，先到先得，瞬间并发极大，但写库量有限")]),s._v(" "),a("ol",[a("li",[s._v("利用预减库存方式杜绝超卖")]),s._v(" "),a("li",[s._v("利用 Nginx + Lua 在网关层面将无效请求阻挡")]),s._v(" "),a("li",[s._v("利用 MQ 消息队列的限流特性保证 MySQL 不会被瞬间击垮")]),s._v(" "),a("li",[s._v("APP需要额外设计轮询机制查询订单状态")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("TIPS——订单创建后，用户取消订单或未支付怎么办？")]),s._v(" "),a("ul",[a("li",[s._v('为订单设置过期时间，订单支付有效期过期或用户取消订单，LUA 执行 incr "stk-1001" 自增即可（库存数据存放到 Redis 的情况下）')])]),s._v(" "),a("h2",{attrs:{id:"【it老齐064】上了微服务就能高并发-扯淡-几张图给你讲明白微服务架构的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐064】上了微服务就能高并发-扯淡-几张图给你讲明白微服务架构的作用"}},[s._v("#")]),s._v(" 【IT老齐064】上了微服务就能高并发？扯淡，几张图给你讲明白微服务架构的作用")]),s._v(" "),a("p",[s._v("不采用微服务会遇到的问题：")]),s._v(" "),a("ul",[a("li",[s._v("系统间通信困难")]),s._v(" "),a("li",[s._v("系统内部复杂度对外暴露")]),s._v(" "),a("li",[s._v("系统间通信的逻辑复杂")]),s._v(" "),a("li",[s._v("系统的重复建设")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("微服务的定义：所谓微服务架构风格是一种将单个应用程序开发为一组"),a("strong",[s._v("小型服务")]),s._v("的方法，每个小服务运行在自己的"),a("strong",[s._v("进程")]),s._v("中，并以"),a("strong",[s._v("轻量级的机制(通常是HTTP RESTful API)"),a("strong",[s._v("的方式进行通信，这些服务围绕着业务能力所建立的，并且可以由")]),s._v("完全自动化的部署机构")]),s._v("独立部署，这些服务的集中管理只有最低限度，可以用"),a("strong",[s._v("不同的编程语言编写")]),s._v("并使用不同的"),a("strong",[s._v("数据库存储技术")]),s._v("。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("微服务的优势：")]),s._v(" "),a("ul",[a("li",[s._v("标准化的通信过程 RESTful")]),s._v(" "),a("li",[s._v("对外屏蔽系统内部复杂度")]),s._v(" "),a("li",[s._v("有序的调用链路APM")]),s._v(" "),a("li",[s._v('"大一统"的架构设计')])]),s._v(" "),a("h2",{attrs:{id:"【it老齐116】如何优雅的保存mysql数据变更历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐116】如何优雅的保存mysql数据变更历史"}},[s._v("#")]),s._v(" 【IT老齐116】如何优雅的保存mysql数据变更历史？")]),s._v(" "),a("ul",[a("li",[s._v("需求：数据审计，关键数据变动的记录")]),s._v(" "),a("li",[s._v("背景：商品类型字典表、商品表、订单表，想要记录订单表的数据变更")]),s._v(" "),a("li",[s._v("方式一：程序双写，直接否决，太重量级"),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" 订单表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 商品表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("商品名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 商品表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("价格"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 商品类型表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("类型 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" 订单表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("商品表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("商品类型表 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" 订单表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("商品id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 商品表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("商品id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" 商品表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("类型id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 商品类型表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("类型id\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("insert")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("into")]),s._v(" 订单_审计表 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[s._v("方式二：触发器；需求方现在的订单数量为 300 万，采用触发器可能会导致审计表非常臃肿，并且可能拉低 MySQL 性能。")]),s._v(" "),a("li",[s._v("方式三：通过阿里的 canal 监听 binlog 的变更，根据变更后的订单编号回查 MySQL，将变更后的完整数据按订单id % n 分片写入 MongoDB\n"),a("ul",[a("li",[s._v("使用 Mongo 的优势：\n"),a("ol",[a("li",[s._v("反方式设计，结构灵活，方便管理，存储全量快照")]),s._v(" "),a("li",[s._v("业务无关，只需在主键与时间戳简历索引效率就很好")]),s._v(" "),a("li",[s._v("天然支持 JSON，编码不要太爽")]),s._v(" "),a("li",[s._v("分布式 NoSQL，分片支持百亿数据")])])])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐139】分布式架构设计-rpc与rest两种通信方式该怎么选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐139】分布式架构设计-rpc与rest两种通信方式该怎么选"}},[s._v("#")]),s._v(" 【IT老齐139】分布式架构设计，RPC与REST两种通信方式该怎么选？")]),s._v(" "),a("p",[a("strong",[s._v("模式比较")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th",[s._v("RPC")]),s._v(" "),a("th",[s._v("REST")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("消息格式")]),s._v(" "),a("td",[s._v("二进制 Thrift、Protobuf")]),s._v(" "),a("td",[s._v("文本 XML、JSON")])]),s._v(" "),a("tr",[a("td",[s._v("通信协议")]),s._v(" "),a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("HTTP、HTTP2")])]),s._v(" "),a("tr",[a("td",[s._v("性能")]),s._v(" "),a("td",[s._v("高")]),s._v(" "),a("td",[s._v("一般")])]),s._v(" "),a("tr",[a("td",[s._v("接口契约IDL")]),s._v(" "),a("td",[s._v("Thrift、Protobuf IDL")]),s._v(" "),a("td",[s._v("Swagger")])]),s._v(" "),a("tr",[a("td",[s._v("客户端")]),s._v(" "),a("td",[s._v("强类型客户端")]),s._v(" "),a("td",[s._v("HTTP客户端即可，OKHttp、HttpClient、UrlConnection")])]),s._v(" "),a("tr",[a("td",[s._v("框架")]),s._v(" "),a("td",[s._v("Dubbo、grpc、Thrift")]),s._v(" "),a("td",[s._v("Srping MVC、Struts2等")])]),s._v(" "),a("tr",[a("td",[s._v("开发者友好")]),s._v(" "),a("td",[s._v("一般自动生成存根、客户端，使用友好。二进制消息阅读不友好")]),s._v(" "),a("td",[s._v("JSON文本，人机阅读友好")])]),s._v(" "),a("tr",[a("td",[s._v("应用场景")]),s._v(" "),a("td",[s._v("服务间通信推荐 RPC（性能要求高）/ REST（性能要求低）")]),s._v(" "),a("td",[s._v("兼容性好，对环境不敏感，对外暴露接口推荐 REST")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐140】非常实用-spring-aop与自定义注解实现共性需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐140】非常实用-spring-aop与自定义注解实现共性需求"}},[s._v("#")]),s._v(" 【IT老齐140】非常实用！Spring AOP与自定义注解实现共性需求")]),s._v(" "),a("p",[s._v("不看，https://www.bilibili.com/video/BV1VS4y127Lo")]),s._v(" "),a("h2",{attrs:{id:"【it老齐141】试试水-案例分享下我是如何分析实体与设计表关系的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐141】试试水-案例分享下我是如何分析实体与设计表关系的"}},[s._v("#")]),s._v(" 【IT老齐141】试试水，案例分享下我是如何分析实体与设计表关系的")]),s._v(" "),a("p",[s._v("实体关系分析")]),s._v(" "),a("ol",[a("li",[s._v("实体关系是指系统事物之间的联系")]),s._v(" "),a("li",[s._v("实体关系需要"),a("strong",[s._v("双向分析")])]),s._v(" "),a("li",[s._v("实体关系决定表关系")])]),s._v(" "),a("p",[s._v("实体关系的种类")]),s._v(" "),a("ol",[a("li",[s._v("一对一")]),s._v(" "),a("li",[s._v("一对多")]),s._v(" "),a("li",[s._v("多对多")])]),s._v(" "),a("p",[s._v("实体关系分析：班级、学籍档案、学生、课程")]),s._v(" "),a("ul",[a("li",[s._v("班级——学生：一个班级有多个学生，一个学生只能属于一个班级，所以是一对多")]),s._v(" "),a("li",[s._v("学籍档案——学生：双向一对一，所以是一对一")]),s._v(" "),a("li",[s._v("学生——课程：正向一对多，反向一对多，所以是多对多")])]),s._v(" "),a("p",[s._v("表关系设计原则")]),s._v(" "),a("ol",[a("li",[s._v("一对一，通过主键关联")]),s._v(" "),a("li",[s._v("一对多，在多的一方设置外键")]),s._v(" "),a("li",[s._v("多对多，增加中间表，持有双方外键")])]),s._v(" "),a("p",[s._v("表关系设计")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("学籍档案：学生编号<pk>\n班级表：班级编号<pk>\n学生表：学生编号<pk>、班级编号<fk>\n课程表：课程编号<pk>\n学生与课程对照表：对照表编号<pk>、学生编号<fk>、课程编号<fk>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("训练题")]),s._v(" "),a("ol",[a("li",[s._v("博客文章与评论：一对多")]),s._v(" "),a("li",[s._v("客户与电商订单：一对多")]),s._v(" "),a("li",[s._v("用户与微信公众号：多对多")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐155】超实用高并发优化技巧-同步转异步-单条转批量-qps2000干到8000"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐155】超实用高并发优化技巧-同步转异步-单条转批量-qps2000干到8000"}},[s._v("#")]),s._v(" 【IT老齐155】超实用高并发优化技巧，同步转异步，单条转批量，QPS2000干到8000")]),s._v(" "),a("ul",[a("li",[s._v("用户访问（/book/1830）——>查询图书并且写行为日志——>读取图书数据从 Redis，写入 n 条用户行为到行为数据表")]),s._v(" "),a("li",[s._v("用户访问（/book/1830）——>查询图书，本地缓存行为日志——>图书数据还是从 Redis 读取\n"),a("ul",[a("li",[s._v("Spring-Task 任务调度一次——>查询 List，JDBC batchUpdate 批处理写入用户行为表，清空 List")]),s._v(" "),a("li",[s._v("行为日志不是重要数据，放到内存里允许丢失")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐160】1000万卡数据从3秒提升干到21毫秒-150倍-我们如何利用bitmap优化工行储蓄卡业务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐160】1000万卡数据从3秒提升干到21毫秒-150倍-我们如何利用bitmap优化工行储蓄卡业务"}},[s._v("#")]),s._v(" 【IT老齐160】1000万卡数据从3秒提升干到21毫秒，150倍！我们如何利用bitmap优化工行储蓄卡业务")]),s._v(" "),a("p",[s._v("业务场景：")]),s._v(" "),a("p",[s._v("2005年，领导让我们收集河北省全行储蓄卡清单，要求按照区域、卡Bin(类型）进行筛选查询。")]),s._v(" "),a("p",[s._v('当时我们就遇到了情况是，全省发卡上千万张，60% 以上的卡都是“牡丹灵通卡"，超过 30% 都发行在“石家庄"区域。')]),s._v(" "),a("p",[s._v('查询按“牡丹灵通卡”，或查询"石家庄"地区时，第10页（100条/页)以后非常慢，大约需要 3 秒多才能查询到。分析原因是因为索引选择性差导致扫描范围大引起的硬盘 IO 低下，而且随着页码增加越往后越慢，这在数据库层面上受制于当时的硬件条件已经到达极限。')]),s._v(" "),a("p",[s._v("于是我们换了角度通过 bitmap（位图）优化这类业务，优化以后效果显著，从原有 3 秒多直接压缩到 21 毫秒，性能提高 150 倍。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("Bitmap 位图存储卡数据")])]),s._v(" "),a("p",[s._v("牡丹灵通卡：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("0")]),s._v(" "),a("th",[s._v("1")]),s._v(" "),a("th",[s._v("2")]),s._v(" "),a("th",[s._v("3")]),s._v(" "),a("th",[s._v("4")]),s._v(" "),a("th",[s._v("5")]),s._v(" "),a("th",[s._v("6")]),s._v(" "),a("th",[s._v("7")]),s._v(" "),a("th",[s._v("8")]),s._v(" "),a("th",[s._v("9")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("28")]),s._v(" "),a("th",[s._v("29")]),s._v(" "),a("th",[s._v("30")]),s._v(" "),a("th",[s._v("31")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")])])])]),s._v(" "),a("ul",[a("li",[s._v("4 字节表达 32 张牡丹灵通卡账户id")]),s._v(" "),a("li",[s._v("示例： i = 102881772")]),s._v(" "),a("li",[s._v("一千万数据使用 312500 个整数数组存储即可。")]),s._v(" "),a("li",[s._v("[102881772,28199,99182...]")])]),s._v(" "),a("p",[s._v("理财金账户：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("0")]),s._v(" "),a("th",[s._v("1")]),s._v(" "),a("th",[s._v("2")]),s._v(" "),a("th",[s._v("3")]),s._v(" "),a("th",[s._v("4")]),s._v(" "),a("th",[s._v("5")]),s._v(" "),a("th",[s._v("6")]),s._v(" "),a("th",[s._v("7")]),s._v(" "),a("th",[s._v("8")]),s._v(" "),a("th",[s._v("9")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("28")]),s._v(" "),a("th",[s._v("29")]),s._v(" "),a("th",[s._v("30")]),s._v(" "),a("th",[s._v("31")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")])])])]),s._v(" "),a("ul",[a("li",[s._v("4 字节表达 32 张理财金账户 id")]),s._v(" "),a("li",[s._v("示例： i = 0")]),s._v(" "),a("li",[s._v("[0,81782,817291...]")])]),s._v(" "),a("hr"),s._v(" "),a("ul",[a("li",[s._v("速算：10 亿数据（id 类型 int）\n"),a("ul",[a("li",[s._v("存储id（int）= 10亿*4字节≈3.7G内存")]),s._v(" "),a("li",[s._v("bitmap (牡丹灵通卡)≈3.7G/32≈117mb内存")]),s._v(" "),a("li",[s._v("bitmap(理财金账户)≈3.7G/32≈117mb内存")]),s._v(" "),a("li",[s._v("1亿bitmap数据≈11.7mb")]),s._v(" "),a("li",[s._v("1千万bitmap数据≈1.7mb")])])]),s._v(" "),a("li",[s._v("速算：10 亿数据（id 类型 long）\n"),a("ul",[a("li",[s._v("存储id（int）= 10亿*8字节≈7.4G内存")]),s._v(" "),a("li",[s._v("bitmap(牡丹灵通卡)≈7.4G/64≈117mb内存")]),s._v(" "),a("li",[s._v("bitmap(理财金账户)≈7.4G/64≈117mb内存")]),s._v(" "),a("li",[s._v("1亿bitmap数据≈11.7mb")]),s._v(" "),a("li",[s._v("1千万bitmap数据≈1.7mb")])])])]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("多条件运算")])]),s._v(" "),a("p",[s._v("牡丹灵通卡")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("0")]),s._v(" "),a("th",[s._v("1")]),s._v(" "),a("th",[s._v("2")]),s._v(" "),a("th",[s._v("3")]),s._v(" "),a("th",[s._v("4")]),s._v(" "),a("th",[s._v("5")]),s._v(" "),a("th",[s._v("6")]),s._v(" "),a("th",[s._v("7")]),s._v(" "),a("th",[s._v("8")]),s._v(" "),a("th",[s._v("9")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("28")]),s._v(" "),a("th",[s._v("29")]),s._v(" "),a("th",[s._v("30")]),s._v(" "),a("th",[s._v("31")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")])])])]),s._v(" "),a("p",[s._v("石家庄地区")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("0")]),s._v(" "),a("th",[s._v("1")]),s._v(" "),a("th",[s._v("2")]),s._v(" "),a("th",[s._v("3")]),s._v(" "),a("th",[s._v("4")]),s._v(" "),a("th",[s._v("5")]),s._v(" "),a("th",[s._v("6")]),s._v(" "),a("th",[s._v("7")]),s._v(" "),a("th",[s._v("8")]),s._v(" "),a("th",[s._v("9")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("28")]),s._v(" "),a("th",[s._v("29")]),s._v(" "),a("th",[s._v("30")]),s._v(" "),a("th",[s._v("31")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")])])])]),s._v(" "),a("p",[s._v("石家庄地区牡丹灵通卡结果")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("0")]),s._v(" "),a("th",[s._v("1")]),s._v(" "),a("th",[s._v("2")]),s._v(" "),a("th",[s._v("3")]),s._v(" "),a("th",[s._v("4")]),s._v(" "),a("th",[s._v("5")]),s._v(" "),a("th",[s._v("6")]),s._v(" "),a("th",[s._v("7")]),s._v(" "),a("th",[s._v("8")]),s._v(" "),a("th",[s._v("9")]),s._v(" "),a("th",[s._v("10")]),s._v(" "),a("th",[s._v("11")]),s._v(" "),a("th",[s._v("28")]),s._v(" "),a("th",[s._v("29")]),s._v(" "),a("th",[s._v("30")]),s._v(" "),a("th",[s._v("31")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("1")]),s._v(" "),a("td",[s._v("0")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td"),s._v(" "),a("td",[s._v("查询id=2的卡数据")]),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td",[s._v("查询id=6的卡数据")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("...")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("0")]),s._v(" "),a("td",[s._v("查询id=30的卡数据")]),s._v(" "),a("td",[s._v("0")])])])]),s._v(" "),a("p",[s._v("匹配规则：")]),s._v(" "),a("ul",[a("li",[s._v("如果卡bin或者石家庄区域原数据有任何一个是 0，则代表这三十二个张卡都不符合条件")]),s._v(" "),a("li",[s._v("如果“与运算”后得到整数为 0，代表这 32 张卡肯定不是石家庄区域的牡丹灵通卡")]),s._v(" "),a("li",[s._v("运算后整数不为零，将不为零的位索引提取出来就是符合要求的主键id，组织好 SQL 去数据库查询就好，按主键处理效率极高。")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐162】1-20版kubernetes-k8s-彻底放弃docker-docker还有学习的必要吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐162】1-20版kubernetes-k8s-彻底放弃docker-docker还有学习的必要吗"}},[s._v("#")]),s._v(" 【IT老齐162】1.20版Kubernetes(K8S)彻底放弃Docker，Docker还有学习的必要吗？")]),s._v(" "),a("p",[s._v("讲师的观点：")]),s._v(" "),a("ul",[a("li",[s._v("从未来知识变现出发：Docker 已是昨日黄花")]),s._v(" "),a("li",[s._v("从市场分析：库存系统迭代替换 Docker 还需时日")])]),s._v(" "),a("p",[a("strong",[s._v("原因分析")]),s._v("\nDocker 比 k8s 发布的早")]),s._v(" "),a("p",[s._v("Docker 本身不兼容 CRI 接口，官方并没有实现 CRI 的打算，同时也不支持容器的一些新需求，社区想要摆脱 Dockershim 的高维护成本。")]),s._v(" "),a("p",[s._v("k8s 不能直接与 docker 通信，只能与 CRI 运行时通信，要与 Docker 通信，就必须使用桥接服务（dockershim），k8s 要与 docker 通信是通过节点带阿里 kubelet 的 Dockershim（k8s 社区维护的）将请求转发给管理容器的 Docker 服务。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubelet——>CRI——>Dockershim——>Docker\nkubelet——>CRI——>Containerd\nkubelet——>CRI——>CRI-O\nkubelet——>CRI——>Podman # Google 官方极力推荐，和 docker 使用很像，命令几乎完全相同\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("Dockershim 一直都是 k8s 为了兼容 Docker 获得市场采取的临时方案。")]),s._v(" "),a("p",[s._v("k8s 在过去因为 Docker 的热门而选择它，现在又因为高昂的维护成本而放弃它，我们能够从这个过程中体会到容器领域的发展和进步。")]),s._v(" "),a("p",[s._v("对于已经统治市场的 k8s 来说，Docker 的支持显得非常鸡肋，移除代码也就顺理成章。")]),s._v(" "),a("p",[s._v("在集群中运行的容器运行时往往不需要 docker 这么复杂的功能，k8s 需要的只是 CRI 中定义的那些接口。")]),s._v(" "),a("p",[s._v("不用担心，Mirantis 公司未来会和 Docker 共同维护 Dockershim，并作为一个开源组件提供；对于正式生产环境还是建议采用兼容 CRI 的 containerd 之类的底层运行时。")]),s._v(" "),a("p",[s._v("Dockershim 还有个第三方替代品 cri-dockerd，但并不是 k8s 的亲儿子。")]),s._v(" "),a("p",[a("strong",[s._v("1.24 Kubernetes(k8s)的变化")]),s._v("\n自 1.20 版本被弃用之后，dockershim 组件终于在 1.24 的 kubelet 中被删除。从1.24 开始，大家需要使用其他受到支持的运行时选项（例如 PodMan、containerd）。这意味着 Docker 在官方已然成为弃子，是时候拥抱 Podman 的怀抱了。")]),s._v(" "),a("p",[a("strong",[s._v("新的选择：Podman")]),s._v("\npodman 的定位也是与 docker 兼容，因此在使用上面尽量靠近 docker。在使用方面，可以分成两个方面来说，一是系统构建者的角度，二是使用者的角度。")]),s._v(" "),a("p",[s._v("在系统构建者方面，用 podman 的默认软件，与 docker 的区别不大，只是在进程模型、进程关系方面有所区别。如果习惯了 docker 几个关联进程的调试方法，在 podman 中则需要适应。可以通过 pstree 命令查看进程的树状结构。总体来看，podman 比 docker 要简单。由于 podman 比 docker 少了一层 daemon，因此重启的机制也就不同了。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("podman run      创建并启动容器\npodman start    启动容器\npodman ps       查看容器\npodman stop     终止容器\npodman restart  重启容器\npodman attach   进入容器\npodman exec     进入容器\npodman export   导出容器\npodman import   导入容器快照\npodman rm       删除容器\npodman logs     查看日志\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("架构设计 Podman 更加扁平")]),s._v("\n在使用上还是有些许出入，Docker 少数场景无法直接迁移到 Podman，比如 docker-compose 无法直接用到 podman-compose")]),s._v(" "),a("p",[s._v("DRI(docker)——>Docker daemon——>registry、image、container、kernel")]),s._v(" "),a("p",[s._v("Podman——>Image Registry、Containers、Images、Kernel")]),s._v(" "),a("h2",{attrs:{id:"【it老齐161】日均30万订单-支持读写分离与分库分表-我会怎么做"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐161】日均30万订单-支持读写分离与分库分表-我会怎么做"}},[s._v("#")]),s._v(" 【IT老齐161】日均30万订单，支持读写分离与分库分表，我会怎么做？")]),s._v(" "),a("p",[s._v("分库分表和读写分离方案，采用 MHA 和 MGR？")]),s._v(" "),a("p",[a("strong",[s._v("MHA")]),s._v("\n兼容性最好，适合大多数 MySQL 库，与半同步复制可以保障至少有一个从库和主库是一致的。")]),s._v(" "),a("p",[s._v("非官方方案，需要额外部署控制节点，小日本子写的，他们脑回路和一般人不一样，部署确实比较恶心。")]),s._v(" "),a("ul",[a("li",[s._v("写 VIP，主（mha_node）——>多个从 mha_node")]),s._v(" "),a("li",[s._v("需要一个额外的 mha_node（mha_manage） 来监控其他节点")])]),s._v(" "),a("p",[a("strong",[s._v("MGR")]),s._v("\nMySQL5.7 以后才支持，全同步复制，每个节点状态一致，自带故障转移，部署简单。")]),s._v(" "),a("p",[s._v("对 Binlog 要求较多，最多支持 9 个节点集群，执行效率略差。")]),s._v(" "),a("p",[s._v("我自己的补充： PXC（Percona XtraDB Cluster） 和 MGR 类似，但是 PXC 性能损耗更大，并且大事务会卡住整个集群，另外需要用第三方发行版 MySQL。感觉 MGR 是大势所趋。")]),s._v(" "),a("p",[a("strong",[s._v("讲师的设计")]),s._v("\nMySQL 尽量控制单表千万级别，采用分库 + 分表形式。以年形式分库，以月形式分表。同时构建 3 个 MGR 节点保障高可用和故障转移。")]),s._v(" "),a("ul",[a("li",[s._v("分库分表：ShardingJDBC")]),s._v(" "),a("li",[s._v("读写分离：ProxySQL")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐164】以工行pos消费统计为例-海量数据下时间换时间的t-1优化方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐164】以工行pos消费统计为例-海量数据下时间换时间的t-1优化方案"}},[s._v("#")]),s._v(" 【IT老齐164】以工行POS消费统计为例，海量数据下时间换时间的T+1优化方案")]),s._v(" "),a("p",[a("strong",[s._v("时间换时间的优化策略")]),s._v("\n工行个金处每年、每季度、每月都要统计 POS 消费情况，一年河北工行 POS 消费流水数据约 1 亿，工行领导需要毫秒级查看各卡种 POS 消费情况，该如何处理？")]),s._v(" "),a("p",[s._v("原始数据：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("交易数据")]),s._v(" "),a("th",[s._v("卡号")]),s._v(" "),a("th",[s._v("卡类型")]),s._v(" "),a("th",[s._v("商户id")]),s._v(" "),a("th",[s._v("消费金额")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("xxxx-xx-xx xx:xx:xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("牡丹灵通卡")]),s._v(" "),a("td",[s._v("xxx")]),s._v(" "),a("td",[s._v("132.32")])]),s._v(" "),a("tr",[a("td",[s._v("xxxx-xx-xx xx:xx:xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("理财金账户")]),s._v(" "),a("td",[s._v("xxx")]),s._v(" "),a("td",[s._v("3361.10")])])])]),s._v(" "),a("p",[s._v("业务闲时提前统计前一天数据：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("日期")]),s._v(" "),a("th",[s._v("牡丹灵通卡")]),s._v(" "),a("th",[s._v("E时代")]),s._v(" "),a("th",[s._v("理财金账户")]),s._v(" "),a("th",[s._v("其他")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("2021.1.1")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")])]),s._v(" "),a("tr",[a("td",[s._v("2021.1.2")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")]),s._v(" "),a("td",[s._v("xx")])])])]),s._v(" "),a("p",[s._v("汇总一年的——2021年POST消费金额")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("牡丹灵通卡")]),s._v(" "),a("th",[s._v("E时代")]),s._v(" "),a("th",[s._v("理财金账户")]),s._v(" "),a("th",[s._v("其他")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("xxx")]),s._v(" "),a("td"),s._v(" "),a("td"),s._v(" "),a("td")])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐166】mongodb、elastic全家桶还能免费用吗-5分钟带你了解开源协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐166】mongodb、elastic全家桶还能免费用吗-5分钟带你了解开源协议"}},[s._v("#")]),s._v(" 【IT老齐166】MongoDB、Elastic全家桶还能免费用吗，5分钟带你了解开源协议")]),s._v(" "),a("p",[a("strong",[s._v("省流助手：")])]),s._v(" "),a("ul",[a("li",[s._v("如果你不是用 MongoDB、Elastic 作为基础服务为其他客户提供云服务")]),s._v(" "),a("li",[s._v("如果你没有修改 MongoDB、Elastic 全家桶的源码，只去使用它们")])]),s._v(" "),a("p",[s._v("结论：随便用，而且免费")]),s._v(" "),a("p",[s._v("如果违背了上述两个条件，要么开源修改的源码，要么交钱获取商业授权。")]),s._v(" "),a("div",{attrs:{algin:"center"}},[a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEB5478d00b531a8da81c0ed9130a59cab0?method=download&shareKey=ed5992514c93ef3c0b3fdc4a68b7a037"}})]),s._v(" "),a("p",[a("strong",[s._v("GNU GPL")])]),s._v(" "),a("p",[s._v("GNU GPL 具体为（GNU General Public License，GNU 通用公共许可证）")]),s._v(" "),a("p",[s._v("GPL 协议，软件的使用是免费的，也就是说，它在你使用时，是免费的，你可不用向任何人付钱，但是如果你为了让这个软件更加的灵活，那么你就可以把软件的源码下载下来二次开发，那么二次开发的软件，如果你再使用，就必须要在发布这个修改了之后的程序时，同时在发布包里，加上这个程序的修改了之后的源码。")]),s._v(" "),a("p",[s._v("【适用于开发】：适用于二次或 N 次开发，那么发布时要带上源码，让其传播，所以它最终的版权是大众的，而非某一个人的，因此不用交钱就可以使用。")]),s._v(" "),a("p",[s._v("【适用于应用】：应用 GPL 协议的软件不用交钱。")]),s._v(" "),a("p",[a("strong",[s._v("BSD协议")])]),s._v(" "),a("p",[s._v("BSD 协议具体为（Berkeley Software Distribution，伯克利软件发布版）协议。")]),s._v(" "),a("p",[s._v("BSD 协议给予用户极大的权利，用户可以使用、修改和重新发布遵循该许可的软件，并且可以将软件作为商业软件发布和销售，前提是需要满足下面三个条件：")]),s._v(" "),a("ul",[a("li",[s._v("如果再发布的软件中包含源代码，则源代码必须继续遵循 BSD 许可协议。")]),s._v(" "),a("li",[s._v("如果再发布的软件中只有二进制程序，则需要在相关文档或版权文件中声明原始代码遵循了 BSD 协议。")]),s._v(" "),a("li",[s._v("不允许用原始软件的名字、作者名字或机构名称等进行市场推广。")])]),s._v(" "),a("p",[a("strong",[s._v("BSD 对商业比较友好，很多公司在选用开源产品的时候都首选 BSD 协议")]),s._v("，因为开源完全控制这些第三方的代码，甚至在必要的时候开源修改或者二次开发。")]),s._v(" "),a("p",[a("strong",[s._v("Apache")])]),s._v(" "),a("p",[s._v("Apache 协议具体为许可证版本（Apache License Version）协议，Apache 和 BSD 类似，都适用于商业软件。")]),s._v(" "),a("p",[s._v("Apache 协议在为开发人员提供版权及专利许可的同时，允许用户拥有修改代码及再发布的自由。")]),s._v(" "),a("p",[s._v("Hadoop、Apache HTTP Server、MongoDB 等项目都是基于该许可协议研发的，程序开发人员在开发遵循该协议的软件时，要严格遵守下面的四个条件：")]),s._v(" "),a("ul",[a("li",[s._v("该软件及其衍生品必须继续使用 Apache 许可协议")]),s._v(" "),a("li",[s._v("如果修改了程序源代码，需要在文档中进行声明")]),s._v(" "),a("li",[s._v("若软件是基于他人的源代码编写而成的，则需要保留原始协议的代码、商标、专利声明及其他原作者声明的内容信息")]),s._v(" "),a("li",[s._v("如果再发布的软件中有声明文件，则需在此文件中标注 Apache 许可协议及其他许可协议")])]),s._v(" "),a("p",[s._v("Apache 协议还有以下需要说明的地方：")]),s._v(" "),a("ul",[a("li",[s._v("永久权利：一旦被授权，永久拥有")]),s._v(" "),a("li",[s._v("全球范围的权利：在一个国家获得授权，适用于所有国家")]),s._v(" "),a("li",[s._v("授权免费，且无版税：前期、后期均无任何费用")]),s._v(" "),a("li",[s._v("授权无排他性：任何人都可以获得授权")]),s._v(" "),a("li",[s._v("授权不可撤销：一旦获得授权，没有任何人可以取消。比如，你基于该产品代码开发了衍生产品，你不用担心会在某一天被禁止使用该代码")])]),s._v(" "),a("p",[a("strong",[s._v("MIT 协议")])]),s._v(" "),a("p",[s._v("MIT 协议具体为（Massachusetts Institute of Technology）协议，又称【X 条款】或【X11 条款】")]),s._v(" "),a("p",[s._v("目前限制最少的开源许可协议之一（比 BSD 和 Apache 的限制都少），只要程序的开发者在修改后的源代码中保留原作者的许可信息即可，因此普遍被商业软件所使用。")]),s._v(" "),a("p",[s._v("使用 MIT 协议的软件有 PuTTY、X Window System、Ruby on Rails、Lua 5.0 onwards、Mono 等。")]),s._v(" "),a("p",[a("strong",[s._v("GUN LGPL 协议")])]),s._v(" "),a("p",[s._v("GUN LGPL 协议具体是（GNU Lesser General Public License，GNU 宽通用公共许可证)。")]),s._v(" "),a("p",[s._v("LGPL 是 GPL 的一个衍生版本，也被称为 GPL V2，该协议主要是为类库设计的开源协议。")]),s._v(" "),a("p",[s._v("LGPL 允许商业软件通过类库引用（link）的方式使用 LGPL 类库,而不需要开源商业软件的代码。")]),s._v(" "),a("p",[s._v("这使得采用 LGPL 协议的开源代码可以被商业软件作为类库引用并发布和销售。")]),s._v(" "),a("p",[s._v("但是如果修改 LGPL 协议的代码或者衍生品，则所有修改的代码，涉及修改部分的额外代码和衍生的代码都必须采用 LGPL 协议。")]),s._v(" "),a("p",[s._v("因此 LGPL 协议的开源代码很适合作为第三方类库被商业软件引用，但不适合希望以 LGPL 协议代码为基础，通过修改和衍生的方式做二次开发的商业软件采用。")]),s._v(" "),a("p",[a("strong",[s._v("AGPL v3 协议")])]),s._v(" "),a("ul",[a("li",[s._v("除非获得商业授权，否则无论以何种方式修改或者使用代码，都需要开源")])]),s._v(" "),a("p",[a("strong",[s._v("MongoDB 与 Elastic 全家桶遵循的是 SSPL")]),s._v("\nSSPL （Server Side Public License）协议并不影响当前使用社区服务器的常规用户。但是，对于云厂商来说，想要将 MongoDB 作为公共服务运行的公司必须将他们的软件开源，或需要从 MongoDB 公司获得商业许可。")]),s._v(" "),a("p",[s._v("根据 SSPL 协议，MongoDB 公司会明确要求托管 MongoDB 实例的云计算公司要么从 MongoDB 公司获取商业许可证，要么向社区开源其服务代码。从而导致了 MongoDB 从 Linux 系统各个平台中抽离出来了。")]),s._v(" "),a("p",[a("strong",[s._v("SSPL 协议除了第 13 条，基本上和 GPL v3 是一模一样的")])]),s._v(" "),a("p",[a("strong",[s._v("正经翻译")])]),s._v(" "),a("p",[s._v('如果您使用本程序或本程序的修改版本，以服务的形式提供给第三方,你就必须按照本许可相关条款，通过网络”下载形式，免费向所有人提供服务源代码"。本条款所说的以服务形式提供给第三方”，是说第三方能够通过计算机网络与本程序或修改版本的功能进行远程交互，所提供服务的价值，全部或主要来自本程序或修改版本，或者,提供给用户的服务,来自于本程序或修订版本主要用途的履行。')]),s._v(" "),a("p",[s._v('所谓"服务源代码"，是指本程序或修改版本的源码，以及您用来使本程序或修订版本成为可用服务的所有相关程序的源码，包括但不限于管理软件，用户界面，应用程序接口，自动化软件，监视软件,备份软件,存储软件和宿主软件,也即所有你用来使用户获取服务实例的源码。')]),s._v(" "),a("p",[a("strong",[s._v("说人话")])]),s._v(" "),a("p",[a("strong",[s._v("如果你不分发本程序，而是把它弄成一个服务， 放到网上让人使用，那你必须把这个服务相关的源码免费让人下载。"),a("strong",[s._v("这里说的服务相关源码，不仅仅是本程序的源码，还包括能让这个服务很好跑起来的其他相关软件的源码，比如")]),s._v("管理软件、用户界面、应用程序接口、自动化软件、监控软件、备份软件、存储软件和宿主软件")]),s._v("。总之，这-整套软件的源码都要提供，因为它们联合起来才能为用户提供完整的服务。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐167】聊聊oltp与olap数据库的区别与应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐167】聊聊oltp与olap数据库的区别与应用场景"}},[s._v("#")]),s._v(" 【IT老齐167】聊聊OLTP与OLAP数据库的区别与应用场景")]),s._v(" "),a("p",[s._v('针对 TP、PB 级别的数据，传统的 MySQL 数据库已经力不从心，尤其是以数据分析这种典型"全盘"扫描的统计业务，大规模扫盘已让 MySQL 不堪重负，为了解决这类问题，从数据应用场景角度分为 OLTP 与 OLAP。')]),s._v(" "),a("p",[a("strong",[s._v("OLTP 和 OLAP 数据库")]),s._v("\n什么是 OLTP：")]),s._v(" "),a("ul",[a("li",[s._v("全称 OnLine Transaction Processing，联机事务处理系统，就是对数据的增删改查等操作")]),s._v(" "),a("li",[s._v("存储的是业务数据，来记录某类业务事件的发生,比如下单、支付、注册、等等")]),s._v(" "),a("li",[s._v("典型代表有 Mysql、Oracle 等数据库，对应的网站、系统应用后端数据库")]),s._v(" "),a("li",[s._v("针对事务进行操作，对响应时间要求高，面向前台应用的，应用比较简单,数据量相对较少，是GB级别的")]),s._v(" "),a("li",[s._v("面向群体：业务人员")])]),s._v(" "),a("p",[s._v("当数据积累到一定的程度，需要对过去发生的事情做一个总结分析时，就需要把过去一段时间内产生的数据拿出来进行统计分析，从中获取想要的信息，为公司做决策提供支持，这个就是做 OLAP 了。")]),s._v(" "),a("p",[s._v("什么是 OLAP：")]),s._v(" "),a("ul",[a("li",[s._v("全称 OnLine Analytical Processing，联机分析处理系统")]),s._v(" "),a("li",[s._v("存储的是历史数据,对应的风控平台、BI平台、 数据可视化等系统就属于")]),s._v(" "),a("li",[s._v("OLAP 是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策，并且提供直观易懂的查询结果")]),s._v(" "),a("li",[s._v("典型代表有 Hive、ClickHouse")]),s._v(" "),a("li",[s._v("针对基于查询的分析系统，基础数据来源于生产系统中的操作数据，数据量非常大，常规是TB级别的")]),s._v(" "),a("li",[s._v("面向群体：分析决策人员")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐179】如何实现15分钟未支付自动取消订单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐179】如何实现15分钟未支付自动取消订单"}},[s._v("#")]),s._v(" 【IT老齐179】如何实现15分钟未支付自动取消订单？")]),s._v(" "),a("p",[a("strong",[s._v("方案一：利用任务调度定时轮训订单表")])]),s._v(" "),a("ul",[a("li",[s._v("方案描述：每隔 n 分钟，搜索订单表"),a("code",[s._v("订单时间>15分钟")]),s._v("的记录，将订单状态变更为取消。")]),s._v(" "),a("li",[s._v("实现细则\n"),a("ul",[a("li",[s._v("单体应用：利用 Spring-Task 或者 Quartz 等单机任务调度工具定时执行")]),s._v(" "),a("li",[s._v("集群环境：利用分布式任务调度工具 XXL-JOB 执行分布式任务调度")])])]),s._v(" "),a("li",[s._v("优势：\n"),a("ul",[a("li",[s._v("实现简单粗暴，单机环境无需外部依赖，小应用首选")])])]),s._v(" "),a("li",[s._v("劣势：\n"),a("ul",[a("li",[s._v("时效性差，n 分钟扫描一次，订单状态不能及时更新；n 秒钟扫描一次，订单表查询压力大(执行计划：Range) ，需要做权衡。")]),s._v(" "),a("li",[s._v("XXL-JOB 这玩意儿不是每个项目都有")])])])]),s._v(" "),a("p",[a("strong",[s._v("方案二：Redis6 客户端缓存监听方案")])]),s._v(" "),a("ul",[a("li",[s._v("方案描述：Redis6 客户端缓存监听方案，监听 Redis6 数据变化")]),s._v(" "),a("li",[s._v("优势：\n"),a("ul",[a("li",[s._v("及时有效，具备主动推送功能")]),s._v(" "),a("li",[s._v("集群友好，哪个实例发起的订单哪个实例负责取消")])])]),s._v(" "),a("li",[s._v("劣势：\n"),a("ul",[a("li",[s._v("基于长链接，连接重连后客户端缓存监听机制会失效，需要手动补偿")]),s._v(" "),a("li",[s._v("实例数量发生变化，需要重新做分配")]),s._v(" "),a("li",[s._v("Redis6 新特性，需要升级 Redis")])])])]),s._v(" "),a("p",[a("strong",[s._v("方案三：利用 RocketMQ 延迟队列、死信队列实现")])]),s._v(" "),a("ul",[a("li",[s._v("延迟消息：延迟消息是指消息发送后，消费者要在一定时间后, 或者指定某个时间点才可以消费。在没有延迟消息时,基本的做法是基于定时计划任务调度，定时发送消息。在RocketMQ中只需要在发送消息时设置延迟级别即可实现。")]),s._v(" "),a("li",[s._v("死信队列：其他 MQ 比如 RabbitMQ 可以通过死信队列实现需求。")]),s._v(" "),a("li",[s._v("优势：\n"),a("ul",[a("li",[s._v("消息及时投递，集群友好，代码量小，不需要额外集群调整，也不绑定具体实例")])])]),s._v(" "),a("li",[s._v("劣势：\n"),a("ul",[a("li",[s._v("必须要有 MQ，而且要玩的溜")]),s._v(" "),a("li",[s._v("需要额外关注幂等性等 MQ 自身引起的新问题")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐189】23种设计模式之工厂模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐189】23种设计模式之工厂模式"}},[s._v("#")]),s._v(" 【IT老齐189】23种设计模式之工厂模式")]),s._v(" "),a("p",[s._v("工厂模式也称简单工厂模式，是创建型设计模式的一种，这种设计模式提供了按需创建对象的最佳方式。同时，这种创建方式不会对外暴露创建细节，并且会通过一个统一的接口创建所需对象。")]),s._v(" "),a("p",[a("strong",[s._v("工厂模式属于创建型模式的一种，其目的就是隐藏创建类的细节与过程。")]),s._v("\n以电脑店为例，我是一个纯小白，面对琳琅满目的各种电脑一脸懵X，根本无从下手~")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 电脑接口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("describe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 外星人笔记本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Alienware")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" describe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"外星人ALIENWARE m15 R7 15.6英寸高端游戏本 12代i7 32G RTX3060 QHD 240HZ 高刷屏 轻薄笔记本电脑2765QB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 高性能独显PC主机")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Desktop")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" describe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"外星人ALIENWARE R13 水冷电竞游戏高端台式机 第12代i7 32G 512GB+2T RTX3070 办公台式机 9776W"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// macbook")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Macbook")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" describe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Apple MacBook Pro 13.3 八核M1芯片 8G 256G SSD 深空灰 笔记本电脑 轻薄本 MYD82CH/A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2U 戴尔服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" describe "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"戴尔（DELL) R740 │ R750 │ 2U机架式服务器主机双路GPU深度学习 R740【1*银牌4210R 10核20线程】8G内存 │ 1TB SATA硬盘 | H350戴尔（DELL)"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("此时顾客将面对几十种不同性能，不同规格不同种类的电脑，难道顾客必须了解所有细节才能决定使用哪一个吗?")]),s._v(" "),a("p",[s._v("这里就破坏了“迪米特法则(知道的越少越好)”，大多数客户并不需要了解每一台细节，我们要把选择权交还给电脑店这一方。")]),s._v(" "),a("p",[a("strong",[s._v("控制权在顾客方是不对的")])]),s._v(" "),a("p",[s._v("我们需要一个工厂类，帮助顾客进行决策，掌握控制权，这里就是售货员 ShopAssistant。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ShopAssistant")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" computer "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("suggest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" purpose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Computer")]),s._v(" computer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purpose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"网站建设"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purpose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"电竞比赛"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Desktop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purpose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"日常办公"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Macbook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("purpose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3A游戏"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Alienware")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" computer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("strong",[s._v("实际项目例子，国际化 I18N")]),s._v("\nClient 提供 IP 地址——>I18NFactory 通过第三方（百度/高德/谷歌）查询 IP 归属——>返回中文、英语、西班牙语等内容")]),s._v(" "),a("h2",{attrs:{id:"【it老齐190】分布式架构离不开的负载均衡器到底是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐190】分布式架构离不开的负载均衡器到底是什么"}},[s._v("#")]),s._v(" 【IT老齐190】分布式架构离不开的负载均衡器到底是什么？")]),s._v(" "),a("p",[s._v("不使用负载均衡器，可能会导致多个服务器的负载不均衡，比如有的机器负载过高，有的资源闲置，业务高峰期还可能出现一连串雪崩效应。")]),s._v(" "),a("p",[a("strong",[s._v("按网络层面分类")])]),s._v(" "),a("ul",[a("li",[s._v("四层负载均衡器：TCP、UDP\n"),a("ul",[a("li",[s._v("F5、LVS、HaProxy、Nginx（1.90+ 新增 Stream 模块，支持四层负载均衡）")])])]),s._v(" "),a("li",[s._v("七层：HTTP、FTP、SMTP、POP\n"),a("ul",[a("li",[s._v("F5、HaProxy、Nginx（HTTP）")])])]),s._v(" "),a("li",[s._v("四层效率更高、功能更简单")]),s._v(" "),a("li",[s._v("七层功能更强，例如针对 HTTP 可以额外增加缓存、数据压缩、请求响应调整、HTTP 重定向等，但效率相对较低")])]),s._v(" "),a("p",[a("strong",[s._v("按软硬件分类")])]),s._v(" "),a("ul",[a("li",[s._v("硬件负载均衡器：F5、A10、深信服\n"),a("ul",[a("li",[s._v("一般硬件负载均衡器 QPS：最低 10W+，自带高可用方案")])])]),s._v(" "),a("li",[s._v("软件负载均衡器：Nginx、HaProxy、LVS\n"),a("ul",[a("li",[s._v("一般软件负载均衡器 QPS：5W 以内，需要自建高可用集群")])])]),s._v(" "),a("li",[s._v("基于云厂商的负载均衡器服务（按量付费）\n"),a("ul",[a("li",[s._v("阿里云负载均衡 SLB")])])])]),s._v(" "),a("p",[a("strong",[s._v("按用途分类")]),s._v("\n硬件负载均衡器一般作为架构顶层入口，软件负载均衡作为应用入口，例如：F5——>Nginx、HaProxy/LVS——>应用服务")]),s._v(" "),a("p",[a("strong",[s._v("中心化与去中心化")]),s._v("\n客户端负载均衡器（去中心化）：常见的就是微服务中客户端从注册中心（比如 Nacos）拉取目标服务的实例列表，通过负载均衡策略选择其中一个发起远程调用。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐191】mysql8实用底层知识-buffer-pool缓冲池-为面试增加些谈资吧"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐191】mysql8实用底层知识-buffer-pool缓冲池-为面试增加些谈资吧"}},[s._v("#")]),s._v(" 【IT老齐191】MySQL8实用底层知识，Buffer Pool缓冲池，为面试增加些谈资吧")]),s._v(" "),a("p",[s._v("原文地址：https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html")]),s._v(" "),a("p",[s._v("缓冲池处于计算机系统主存中的某个区域，用于 InnoDB 访问时缓存表以及索引数据。缓冲池允许直接从内存访问常用数据，从而加快处理速度。在专用服务器上，通常多达 80% 的物理内存分配给缓冲池。")]),s._v(" "),a("p",[s._v("为了提高大量的读取操作，缓冲池被划分成可能包含多行的页。为了有效管理这些页的数据，缓冲池被实现为以页为元素的链表。通过一种变体的LRU算法(Least Recently Used Algorithm，最近最少使用算法）使最近最少使用的数据老化(即清除不常用的缓存)。")]),s._v(" "),a("p",[s._v("缓冲池使用 LRU 算法的变体形成一个列表进行管理，结构如下图所示。当缓冲池需要添加新页的时候，最近最少使用的页会被驱逐，并且一个新页会被添加到列表的中间（注意，并不是列表的正中间，具体值由LRU算法的变体决定)。这个中点插入策略将缓冲池列表逻辑上分割成两个子列表。")]),s._v(" "),a("ul",[a("li",[s._v("列表头部至中间点的数据，被视为是最近常访问的，下文称这些为年轻页")]),s._v(" "),a("li",[s._v("中间点至列表尾部的数据，被视为最近较少访问的，下问称这些为旧页")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://dev.mysql.com/doc/refman/8.0/en/images/innodb-buffer-pool-list.png",alt:""}})]),s._v(" "),a("p",[s._v("默认情况下，操作如下:")]),s._v(" "),a("ul",[a("li",[s._v("缓冲池的 3/8 专用于旧子列表")]),s._v(" "),a("li",[s._v("列表的中点是新子列表尾部与旧子列表头部的边界")]),s._v(" "),a("li",[s._v("当 InnoDB 读取页到缓冲池时，它会初始化地将它插入到中间点（即旧子列表的头部)。一页可以被读取是因为这是用户启动的操作（比如一个 SQL 查询)或者是 InnoDB 预读操作的一部分。")]),s._v(" "),a("li",[s._v("访问旧子列表中的页会使这个页变得年轻，该页会被移动到新子列表的头部。移动的触发时机取决于页被读取的原因（用户启动的操作或者 InnoDB 的预读操作)。如果页读取是由于用户启动的操作而引起的，第一次访问页后会立即将页移动到新子列表的头部。如果页读取是 InnoDB 预读操作引起的，第一次访问页后不会立即发生移动页的操作，或者直到该页被驱逐都不会发生。")]),s._v(" "),a("li",[s._v("随着数据库的运行，缓冲池中未被访问的页会通过向列表尾部移动来“老化”(即被驱逐的概率加大)。新旧子列表的页会随着其他页的更新而被老化。旧子列表的页也会随着插到中间点的页而老化。最终，一个未使用的页面到达旧子列表的尾部并被驱逐。")])]),s._v(" "),a("p",[s._v("默认情况下，通过查询触发读取到缓冲池的页会立即移动到新子列表，这意味着这些页会停留在缓冲池的时间更长。一个 mysqldump 操作或者一个不带 where 条件的查询语句引起的全表扫描，会将大量的数据加载到缓冲池中并且驱逐相等量的旧数据，即使这些新加载进来的大量数据以后从未被使用。类似地，由后台进程预读取加载到缓冲池中的页，即使只被访问过一次，这些页都会移动到新子列表的头部。这些场景都会将经常使用的页推向旧子列表，在那里他们会成为被驱逐的对象。有关优化此行为的信息，请参阅 15.8.3.3 节，“使缓冲池具有抵抗性”和第15.8.3.4节“配置 InnoDB 缓冲池预取（预读)”。")]),s._v(" "),a("p",[s._v("你可以缓冲池的各种方面来提高性能:")]),s._v(" "),a("ul",[a("li",[s._v("理想地，你可以根据实际情况将缓冲池的大小设置得尽可能大，从而留出足够多的内存给服务器上的其他进程运行，而不会出现过多的分页。缓冲池越大，InnoDB 就越像一个内存数据库，从磁盘读取数据一次，后续的读取期间从内存访问数据。详情见配置 InnoDB 缓冲池大小")]),s._v(" "),a("li",[s._v("在具有足够内存的 64 位系统上，您可以将缓冲池拆分成多个部分，以减少并发操作之间对内存结构的争用。详情见配置多个缓冲池实例")]),s._v(" "),a("li",[s._v("你可以将经常访问的数据保留在内存中，而不管操作的活动突然激增，这些操作会将大量不常用的数据带入缓冲池。详情见使缓冲池扫描具有抵抗性")]),s._v(" "),a("li",[s._v("你可以控制如何以及何时执行预读取请求来将分页异步地预取到缓冲池中，以应对即将到来的需求。详情见配置 InnoDB 缓冲池预取（预读)")]),s._v(" "),a("li",[s._v("你可以控制后台何时刷新以及是否根据工作负载动态调整刷新速率。详情见配置缓冲池刷新")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐192】抽象工厂模式在项目开发中的应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐192】抽象工厂模式在项目开发中的应用"}},[s._v("#")]),s._v(" 【IT老齐192】抽象工厂模式在项目开发中的应用")]),s._v(" "),a("p",[s._v("以项目中接入多个云厂商的 oss 为例：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 抽象接口类")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThumb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWaterMark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEnhance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractOssFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 阿里云")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" watermark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" transparent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]图片已经上传至阿里云 OSS，URL：xxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]已生成缩略图，尺寸640x480像素"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]已为图片新增水印，水印文本："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" watermark "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"，文本颜色：#aaaaaa，背景透明："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" transparent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThumb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.aliyun.com/xxxxxx_thumb.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWaterMark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.aliyun.com/xxxxxx_watermark.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEnhance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.aliyun.com/xxxxxx_enhance.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" watermark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]视频已经上传至阿里云 OSS，URL：xxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]720P转码成功，码率：5000K"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[阿里云]10800P转码成功，码率：7000K"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.aliyun.com/xxxxxx_720p.mp4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.aliyun.com/xxxxxx_1080p.mp4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractOssFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"水印"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"水印"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 七牛云")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" watermark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" transparent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]图片已经上传至七牛云 OSS，URL：xxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]已生成缩略图，尺寸800x600像素"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]已为图片新增水印，水印文本："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" watermark "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"，文本颜色：#aaaaaa，背景透明："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" transparent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getThumb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.qiniu.com/xxxxxx_thumb.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getWaterMark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.qiniu.com/xxxxxx_watermark.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getEnhance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.qiniu.com/xxxxxx_enhance.jpg"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" watermark"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]视频已经上传至七牛云 OSS，URL：xxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]720P转码成功，码率：2500K"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[七牛云]10800P转码成功，码率：3500K"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.qiniu.com/xxxxxx_720p.mp4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://oss.qiniu.com/xxxxxx_1080p.mp4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractOssFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"水印"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("QiniuOssVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"水印"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AbstractOssFactory")]),s._v(" factory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliyunOssFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssImage")]),s._v(" ossImage "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("OssVideo")]),s._v(" ossVideo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" factory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadVideo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"【it老齐194】1000万用户电商3毫秒内抽奖100名如何实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐194】1000万用户电商3毫秒内抽奖100名如何实现"}},[s._v("#")]),s._v(" 【IT老齐194】1000万用户电商3毫秒内抽奖100名如何实现？")]),s._v(" "),a("p",[s._v("某著名水果品牌自营电商大促，11 月份关注新 DY 直播间，双11零点随机抽出 100 台最新款水果手机，预计全网超过一千万用户可能会参与此活动。同一用户不能重复参与，同一名用户不允许二次中奖。")]),s._v(" "),a("p",[a("strong",[s._v("阶段1——原始实现方法")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" 关注用户表 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("order")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" rand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("desc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("预计千万级别随机数倒排大概率性能完蛋")]),s._v(" "),a("p",[a("strong",[s._v("阶段2——执行100次下面的SQL")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" FLOOR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("RAND"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("COUNT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" 活动用户表\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" 活动用户表 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("效率可以，不过要执行两次SQL，并发环境下有原子性问题，切不能不会重复中奖")]),s._v(" "),a("p",[a("strong",[s._v("阶段3——基于 Redis Set 集合做随机弹出")]),a("br"),s._v("\n在用户关注直播间写入 MySQL 关注用户表时额外在 Redis 增加一个 userlist Set 集合，存储用户编号。")]),s._v(" "),a("p",[s._v("Redis Set 可以保证全局唯一，且数据基于 Hash 乱序存储。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sadd userlist xxxid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("预计用户编号长整型，1000W 用户占用空间约 500 MB 左右，100 万约占用 50 MB 内存，没啥压力。")]),s._v(" "),a("p",[s._v("抽奖的时候，直接使用 spop 弹出随机 100 个用户编号即可，这个操作是原子性的，先弹出再返回，再加上 Redis 命令队列单线程不存在并发问题，这样杜绝了重复获奖的可能。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("spop userlist 100\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("阶段4-摆脱 MySQL、纯 Redis 方案")]),a("br"),s._v("\n进阶方案，内存富裕可用")]),s._v(" "),a("p",[s._v("因为抽奖结果页面通常只显示用户昵称，我们还可以使用 Redis 提速，用内存换时间。具体做法是：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# sadd userlist "user_id:user_nickname"\nsadd userlist "299782834:张三"\nsadd userlist "1414167036:李四"\nsadd userlist "308857153:王五"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("估算千万用户需要 3G 左右内存，spop 提取速度完全可控制在 3ms 内完成，且不会重复。")]),s._v(" "),a("p",[s._v("TIPS：Redis 不怕 Key 多，就怕大 Key")]),s._v(" "),a("p",[s._v("注意：可能会有用户昵称修改问题，需要程序里做额外校验避免用户重复参与")]),s._v(" "),a("h2",{attrs:{id:"【it老齐196】你真的会用单例模式吗"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐196】你真的会用单例模式吗"}},[s._v("#")]),s._v(" 【IT老齐196】你真的会用单例模式吗！？")]),s._v(" "),a("p",[s._v("单例设计模式（Singleton Design Pattern）理解起来非常简单。一个类只允许创建一个对象（或者实例），那这个类就是一个单例类，这种设计模式就叫做单例设计模式，简称单例模式。")]),s._v(" "),a("p",[s._v("案例一：处理资源访问冲突。比如需要进行日志文件写入，如果对同一个文件打开了多个文件句柄同时操作，可能导致内容覆盖或者系统异常。")]),s._v(" "),a("p",[s._v("案例二：表示全局唯一类。从业务概念上，如果有些数据在系统中只应保存一份，那就比较适合设计为单例类。比如配置信息类、ID 生成器、数据库连接池等。")]),s._v(" "),a("p",[a("strong",[s._v("如何实现一个单例")]),s._v("\n概括起来，要实现一个单例，需要关注的点有下面几个：")]),s._v(" "),a("ol",[a("li",[s._v("构造函数需要是 private 访问权限的，这样才能避免外部通过 new 创建实例；")]),s._v(" "),a("li",[s._v("考虑对象创建时的线程安全问题；")]),s._v(" "),a("li",[s._v("考虑是否支持延迟加载；")]),s._v(" "),a("li",[s._v("考虑 getInstance() 性能是否高（是否加锁)。")])]),s._v(" "),a("p",[a("strong",[s._v("饿汉式")]),a("br"),s._v("\n**类加载时直接实例化单例对象。**饿汉式的实现方式比较简单。在类加载的时候，instance 静态实例就已经创建并初始化好了，所以，instance 实例的创建过程是线程安全的。不过，这样的实现方式不支持延迟加载（例如在真正用到 lIdGenerator 的时候，才创建实例)，从名字中我们也可以看出这一点。具体的代码实现如下所示:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("推荐初始化耗时比较长的单例使用饿汉式，避免在第一次使用时初始化过久。")]),s._v(" "),a("p",[a("strong",[s._v("懒汉式")]),a("br"),s._v(" "),a("strong",[s._v("第一次调用时实例化对象（延迟加载）")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("不过懒汉式的缺点也很明显，我们给 getInstance() 这个方法加了一把大锁(synchronzed)，导致这个函数的并发度很低。量化一下的话，并发度是 1，也就相当于串行操作了。而这个函数是在单例使用期间一直会被调用。如果这个单例类偶尔会被用到，那这种实现方式还可以接受。但是，如果频繁地用到，那频繁加锁、释放锁及并发度低等问题，会导致性能瓶颈，这种实现方式就不可取了。")]),s._v(" "),a("p",[a("strong",[s._v("双重校验")]),a("br"),s._v(" "),a("strong",[s._v("道理我都懂，可是鬼才会这么写")]),s._v("。"),a("br"),s._v("\n饿汉式不支持延迟加载，懒汉式有性能问题，不支持高并发。那我们再来看一种既支持延迟加载、又支持高并发的单例实现方式,也就是双重检测实现方式。在这种实现方式中，只要 instance 被创建之后，即便再调用 getInstance() 函数也不会再进入到加锁逻辑中了。所以，这种实现方式解决了懒汉式并发度低的问题。具体的代码实现如下所示:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("synchronized")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//此处为类级别的锁")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("网上有人说，这种实现方式有些问题。因为指令重排序，可能会导致 IdGenerator 对象被 new 出来，并且赋值给 instance 之后，还没来得及初始化(执行构造函数中的代码逻辑)，就被另一个线程使用了。")]),s._v(" "),a("p",[s._v("要解决这个问题，我们需要给 instance 成员变量加上 volatile 关键字，禁止指令重排序才行。实际上，只有很低版本的 Java 才会有这个问题。我们现在用的高版本的 Java 已经在 JDK 内部实现中解决了这个问题（解决的方法很简单，只要把对象 new 操作和初始化操作设计为原子操作，就自然能禁止重排序)")]),s._v(" "),a("p",[s._v("为什么需要两次判断 if(instance==null)?")]),s._v(" "),a("ul",[a("li",[s._v("第一次校验：由于单例模式只需要创建一次实例，如果后面再次调用 getInstance 方法时，则直接返回之前创建的实例，因此大部分时间不需要执行同步方法里面的代码，大大提高了性能。如果不加第一次校验的话，那跟上面的懒汉模式没什么区别，每次都要去竞争锁。")]),s._v(" "),a("li",[s._v("第二次校验：如果没有第二次校验，假设线程t1执行了第一次校验后，判断为null，这时t2也获取了CPU执行权，也执行了第一次校验，判断也为null。接下来t2获得锁，创建实例。这时t1又获得CPU执行权，由于之前已经进行了第一次校验，结果为null (不会再次判断)，获得锁后，直接创建实例。结果就会导致创建多个实例。所以需要在同步代码里面进行第二次校验，如果实例为空，则进行创建。")])]),s._v(" "),a("p",[a("strong",[s._v("静态内部类——推荐")]),s._v("\n有点类似饿汉式，但又能做到延迟加载：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" singletonHolder "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" singletonHolder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("SingletonHolder 是一个静态内部类，当外部类 ldGenerator 被加载的时候，并不会创建\nSingletonHolder 实例对象。只有当调用 getInstance() 方法时，SingletonHolder 才会被加载，这个时候才会创建 instance。instance 的唯一性、创建过程的线程安全性，都由 JVM 来保证。所以，这种实现方法既保证了线程安全，又能做到延迟加载。")]),s._v(" "),a("p",[a("strong",[s._v("枚举——最推荐")]),s._v("\n枚举对象是单例的，一种对象只会在内存中保存一份。")]),s._v(" "),a("p",[s._v("基于枚举类型的单例实现。这种实现方式通过 Java 枚举类型本身的特性，是最简单实现单例的方式，保证了实例创建的线程安全性和实例的唯一性。具体的代码如下所示:")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("concurrent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("atomic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  INSTANCE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AtomicLong")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrementAndGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),s._v(" instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IdGenerator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INSTANCE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"【it老齐197】为什么mysql单表建议不超过2000万-依据是啥-总算有人讲明白了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐197】为什么mysql单表建议不超过2000万-依据是啥-总算有人讲明白了"}},[s._v("#")]),s._v(" 【IT老齐197】为什么MySQL单表建议不超过2000万，依据是啥？总算有人讲明白了！")]),s._v(" "),a("p",[s._v("原文地址： https://juejin.cn/post/7116381265300815903")]),s._v(" "),a("p",[s._v("我自己简单总结下：")]),s._v(" "),a("p",[s._v("MySQL 一张表的数据存在名为 xxx.ibd 文件里，比如 user 表就是 user.ibd。含义是user表的innodb data文件，专业点，又叫表空间。虽然在数据表里，每行数据看起来是挨在一起的。但实际上在user.ibd里他们被分成很多小份的数据页，每份大小16k。")]),s._v(" "),a("p",[s._v("数据页的组成：")]),s._v(" "),a("ul",[a("li",[s._v("页头 120 Byte：页号、前后指针、维记录等信息")]),s._v(" "),a("li",[s._v("用户行数据")]),s._v(" "),a("li",[s._v("页目录：作用是通过二分查找的方式将查找效率从 O(n) 变成 O(lgn)")]),s._v(" "),a("li",[s._v("页尾 8Byte")])]),s._v(" "),a("p",[s._v("从页到索引：")]),s._v(" "),a("ul",[a("li",[s._v("行数量大了，性能就慢了，于是为了加速搜索，我们可以在每个数据页里选出主键id最小的record，而且只需要它们的主键id和所在页的页号。组成新的record，放入到一个新生成的一个数据页中，这个新数据页跟之前的页结构没啥区别，而且大小还是16k。")]),s._v(" "),a("li",[s._v("但为了跟之前的数据页进行区分。数据页里加入了页层级（page level） 的信息，从0开始往上算。于是页与页之间就有了上下层级的概念，就是常用的 B+ 树索引。")])]),s._v(" "),a("p",[s._v("B+ 树承载的记录数量：")]),s._v(" "),a("ul",[a("li",[s._v("B+树的最末级叶子结点里放了 record 数据。而非叶子结点里则放了用来加速查询的索引数据。同样一个16k的页，非叶子节点里每一条数据都指向一个新的页，而新的页有两种可能。\n"),a("ul",[a("li",[s._v("如果是末级叶子节点的话，那么里面放的就是一行行record数据。")]),s._v(" "),a("li",[s._v("如果是非叶子节点，那么就会循环继续指向新的数据页。")])])]),s._v(" "),a("li",[s._v("记录数量估算：\n"),a("ul",[a("li",[s._v("假设：\n"),a("ul",[a("li",[s._v("非叶子结点内指向其他内存页的指针数量为x")]),s._v(" "),a("li",[s._v("叶子节点内能容纳的record数量为y")]),s._v(" "),a("li",[s._v("B+树的层数为z")]),s._v(" "),a("li",[s._v("则棵B+树放的行数据总量等于 (x ^ (z-1)) * y。")])])]),s._v(" "),a("li",[s._v("x：非叶子节点里主要放索引查询相关的数据，放的是主键和指向页号。主键假设是bigint（8Byte），而页号在源码里叫FIL_PAGE_OFFSET（4Byte），那么非叶子节点里的一条数据是12Byte左右。整个数据页16k， 页头页尾那部分数据全加起来大概128Byte，加上页目录毛估占1k吧。那剩下的15k除以12Byte，等于1280，也就是可以指向x=1280页。")]),s._v(" "),a("li",[s._v("y：叶子节点和非叶子节点的数据结构是一样的，所以也假设剩下15kb可以发挥。叶子节点里放的是真正的行数据。假设一条行数据1kb，所以一页里能放y=15行。")]),s._v(" "),a("li",[s._v("行总数计算，已知x=1280，y=15。\n"),a("ul",[a("li",[s._v("假设B+树是两层，那z=2。则是(1280 ^ (2-1)) * 15 ≈ 2w")]),s._v(" "),a("li",[s._v("假设B+树是三层，那z=3。则是(1280 ^ (3-1)) * 15 ≈ 2.5kw")]),s._v(" "),a("li",[s._v("这个2.5kw，就是我们常说的单表建议最大行数2kw的由来。 毕竟再加一层，数据就大得有点离谱了。三层数据页对应最多三次磁盘IO，也比较合理。")]),s._v(" "),a("li",[s._v("如果每行数据大小为 250 byte，那三层B+树，单表支持的行数就是 (1280 ^ (3-1)) * 60 ≈ 1个亿")]),s._v(" "),a("li",[s._v("额外备注：数据实在过多变成 4 层也不是不行，还是要根据具体业务场景和性能要求来。")])])])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐198】一步到位-http接口安全八种对策-我帮你整理好了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐198】一步到位-http接口安全八种对策-我帮你整理好了"}},[s._v("#")]),s._v(" 【IT老齐198】一步到位，HTTP接口安全八种对策，我帮你整理好了")]),s._v(" "),a("p",[s._v("策略1：通信层面上 HTTPS 加密传输")]),s._v(" "),a("ul",[a("li",[s._v("作用：通信层面确保加密传输")])]),s._v(" "),a("p",[s._v("策略2：敏感数据加密传输")]),s._v(" "),a("ul",[a("li",[s._v("作用：关键数据自建加密规则防止泄漏")]),s._v(" "),a("li",[s._v("敏感数据（密码、隐私内容）要做非对称加密\n"),a("ul",[a("li",[s._v("非对称加密算法执行过程：客户端使用公钥加密要传输的数据，服务端使用私钥解密数据")]),s._v(" "),a("li",[s._v("常见非对称加密算法：RSA、Elgamal、背包算法、Rabin、D-H、ECC（椭圆曲线加密算法）")])])])]),s._v(" "),a("p",[s._v("策略3：数据加签验签")]),s._v(" "),a("ul",[a("li",[s._v("作用：对提交数据增加签名防止数据在传输过程中被修改")]),s._v(" "),a("li",[s._v("常见的加签验签手段：JWT")])]),s._v(" "),a("p",[s._v("策略4：基于 Token 机制传输登录用户非敏感数据")]),s._v(" "),a("ul",[a("li",[s._v("作用：前后端分离架构传递用户信息")]),s._v(" "),a("li",[s._v("比如 JWT")])]),s._v(" "),a("p",[s._v("策略5：关键接口建立 nonce 防盗用机制")]),s._v(" "),a("ul",[a("li",[s._v("作用：预防请求被抓包盗用\n"),a("ul",[a("li",[s._v("数据是很容易抓包的，假设我们使用了 https 和加签，即使中间人抓到了数据报文，它也看不到真实数据。但是有些不法者，根本不关心真实的数据，而是直接拿到抓取的数据包，进行恶意请求（比如 DOS 攻击），以搞垮系统。")])]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//www.xxx.com/api/get/nonce")]),s._v("\n# 请求\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  appKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  appSecret"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("...\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n# 响应\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  message"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    nonce"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxxxxxxxxxxxxxx"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),s._v("Redis 新建 key xxxxxxxxxxxxxxxx，value：md5(客户端user-agent/mac/ip/其他各种唯一标识的任意组合)，有效期 30 秒。"),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//www.xxx.com/api/accounts")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  其他参数"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ...\n  nonstr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxxxxxxxxxxxxxx"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),s._v("提交数据后，服务端先根据 nonstr 字符串提取用户环境 md5，然后使用相同规则对当前发来的用户特征进行校对，只有用户环境完全没有发生变化的前提下才允许执行接口。")])]),s._v(" "),a("p",[s._v("策略6：限流机制、黑名单、白名单")]),s._v(" "),a("ul",[a("li",[s._v("静态控制：基于 API 网关（Nginx、Spring Cloud Gateway）等实现静态规则编制")]),s._v(" "),a("li",[s._v("动态控制：基于 Alibaba Sentinel Dashboard 实施动态规则")])]),s._v(" "),a("p",[s._v("策略7：数据脱敏放弃规律")]),s._v(" "),a("ul",[a("li",[s._v("使用无规律的掩码预防爬虫攻击"),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("错误的做法：\nhttp://www.xxx.com/op/001.jpg\n...\nhttp://www.xxx.com/op/003.jpg\n\n正确的做法\nhttp://www.xxx.com/op/8a7f6b38c72.jpg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[s._v("业务允许前提下关键数据脱敏"),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("数据库存储：13388888888\napi 接口返回：133xxxxx888\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])]),s._v(" "),a("p",[s._v("策略8：数据后端校验")]),s._v(" "),a("ul",[a("li",[s._v("接口数据的安全性保证，简单来说就是参数校验，比如身份证长度、手机号长度、是否数字等等，永远不要相信前台传来的数据是合规合法的")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐199】颜值爆表功能强大-redis官方客户端redisinsightv2-你值得拥有"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐199】颜值爆表功能强大-redis官方客户端redisinsightv2-你值得拥有"}},[s._v("#")]),s._v(" 【IT老齐199】颜值爆表功能强大，Redis官方客户端RedisInsightV2，你值得拥有")]),s._v(" "),a("p",[s._v("官方下载地址： https://redis.com/redis-enterprise/redis-insight/#insight-form")]),s._v(" "),a("h2",{attrs:{id:"【it老齐201】小心select-for-update-有效规避索引选择性锁表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐201】小心select-for-update-有效规避索引选择性锁表"}},[s._v("#")]),s._v(" 【IT老齐201】小心select for update，有效规避索引选择性锁表")]),s._v(" "),a("p",[s._v("MySQL 在 select ... for update 语句时：")]),s._v(" "),a("ul",[a("li",[s._v("用到索引可用时使用行锁")]),s._v(" "),a("li",[s._v("索引不可用时使用表锁\n"),a("ul",[a("li",[s._v("需要注意索引选择性差的问题，有时候优化器会认为全表扫描比索引列更快，也会产生表锁。此时需要 force index 指定索引或者使用 limit 缩小数据范围。")])])])]),s._v(" "),a("p",[s._v("普通的 update 语句不会锁表，因为会转为主键索引来更新")]),s._v(" "),a("p",[s._v("最终建议：很多人工作中工作中会习惯采用 select ..for update 实现资源提前锁定，或者实现分布式锁，这里一定要关注是否能否使用到索引，一不留神就可能锁表，我的建议是改为分布式锁如Redis setNX、Zookeeper 等专物专用。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐202】设计模式之建造者模式的用途"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐202】设计模式之建造者模式的用途"}},[s._v("#")]),s._v(" 【IT老齐202】设计模式之建造者模式的用途")]),s._v(" "),a("p",[a("strong",[s._v("不用建造者有什么麻烦？")]),s._v("\n假设我们要自己开发一个 RabbitMQ 消息队列的客户端，有很多需要初始化的参数，你会怎么做？")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 基于构造方法为属性复制无法适用于灵活多变的环境，且参数太长很难使用")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" isDurable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" connectionTimeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" isDurable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" connectionTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exchange "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("isDurable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" isDurable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connectionTimeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" connectionTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工作队列模式无须设计交换机"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" queue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工作队列模式必须设置队列名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isDurable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"工作队列模式必须开启数据持久化"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 路由模式必须设置交换机，但不能设置 queue 队列")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" exchange"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("trim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"路由模式请设置交换机"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"路由模式无须设置队列名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在发送消息："')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample1")]),s._v(" client "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.210"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sample-exchange"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("p",[s._v("可能使用 set 方式：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 各种 set 方法省略")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample2")]),s._v(" client "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.210"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDuable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"queue"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("validate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v('利用 SET 方法虽然灵活，但是存在中间状态，且属性校验时有前后顺序约束，或者还需要构建额外的校验方法并且 SET 方法破坏了"不可变对象"的密闭性')]),s._v(" "),a("p",[s._v("如何保障灵活组织参数，又可以保证不会存在中间状态以及基本信息不会对外泄露呢?")]),s._v(" "),a("p",[a("strong",[s._v("建造者模式是一个好选择")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" 目标类"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//目标类的构造方法要求传入Builder对象")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" 目标类"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Builder")]),s._v(" builder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" 返回值业务方法"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("参数列表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//dosth")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Builder建造者类位于目标类内部且用static描述")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Builder建造者对象提供内置属性与各种set方法，注意set方法返回Builder对象本身")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" string xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Builder")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setXxx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xxx "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Builder建造者类提供build()方法实现目标类对象的创建")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" 目标类 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//业务校验")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" 目标类"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用时：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample3")]),s._v(" client "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RabbitMQClientSample3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Builder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.31.201"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setExchange")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test-exchange"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h2",{attrs:{id:"【it老齐204】设计模式之门面模式facade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐204】设计模式之门面模式facade"}},[s._v("#")]),s._v(" 【IT老齐204】设计模式之门面模式Facade")]),s._v(" "),a("p",[a("strong",[s._v("什么是门面模式 Facade")]),s._v("\n外观模式中提供了一个供客户端统一调用的门面（Facade），这个门面屏蔽了下游系统的复杂性，使得客户端对下游系统的调用变得更简单。")]),s._v(" "),a("ul",[a("li",[s._v("例子：病人——>接待员——>医院：门诊、挂号、划价、取药")])]),s._v(" "),a("p",[s._v("Client——>Facade——>子系统A、子系统B、子系统C")]),s._v(" "),a("ul",[a("li",[s._v("门面（Facade）角色：客户端可以调用这个角色的方法。此角色知晓相关的（一个或者多个）子系统的功能和责任。在正常情况下，本角色会将所有从客户端发来的请求委派到相应的子系统去。")]),s._v(" "),a("li",[s._v("子系统（SubSystem）角色：可以同时有一个或者多个子系统。每个子系统都不是一个单独的类，而是一个类的集合（如上面的子系统就是由ModuleA、ModuleB、ModuleC三个类组合而成）。每个子系统都可以被客户端直接调用，或者被门面角色调用。子系统并不知道门面的存在，对于子系统而言，门面仅仅是另外一个客户端而已。")])]),s._v(" "),a("p",[a("strong",[s._v("项目应用")]),s._v("\n我们现在有一个 OA 系统，OA 对外提供服务要经过三个步骤：")]),s._v(" "),a("ol",[a("li",[s._v("启动 MySQL 应用集群")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DatabaseManager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startDbCluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在远程启动 MySQL 应用集群"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("对 Redis 缓存预热")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CacheManager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在启动并预热 Redis 应用缓存"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("加载并启动 Web 应用服务器")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerManager")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadWebApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在加载并启动 Web 应用服务器"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("不使用门面模式时：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DatabaseManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startDbCluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CacheManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadWebApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("使用门面模式：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFacade")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DatabaseManager")]),s._v(" dbManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DatabaseManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CacheManager")]),s._v(" cacheManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CacheManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerManager")]),s._v(" webManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebServerManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可以随时新增其他初始化操作")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GatewayManager")]),s._v(" gatewayManager "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GatewayManager")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initSystem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dbManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startDbCluster")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    cacheManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRedis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    webManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("loadWebApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可以随时新增其他初始化操作")]),s._v("\n     gatewayManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initGateway")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationFacade")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initSystem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("strong",[s._v("优缺点")])]),s._v(" "),a("ol",[a("li",[s._v("优点")])]),s._v(" "),a("ul",[a("li",[s._v("松散耦合：门面模式松散了客户端与子系统的耦合关系，让子系统内部的模块能更容易扩展和维护。")]),s._v(" "),a("li",[s._v("简单易用：门面模式让子系统更加易用，客户端不再需要了解子系统内部的实现，也不需要跟众多子系统内部的模块进行交互，只理要银i门面类交互就可以了。")]),s._v(" "),a("li",[s._v("更好的划分访问层次：通过合理使用Facade，可以帮助我们更好地划分访问的层次。有些方法是对系统外的，有些方法是系统内部使用的。把需要暴露给外部的功能集中到门面中，这样既方便客户端使用，也很好地隐藏了内部的细节。")])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("缺点")])]),s._v(" "),a("ul",[a("li",[s._v("不符合开闭原则，如果要修改某一个子系统的功能，通常外观类也要起修改;")])]),s._v(" "),a("p",[s._v("门面模式在 Java 中的应用：日志框架 Slf4j——>Logback、Log4j、Log4j2")]),s._v(" "),a("h2",{attrs:{id:"【it老齐205】设计模式之适配器模式adapter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐205】设计模式之适配器模式adapter"}},[s._v("#")]),s._v(" 【IT老齐205】设计模式之适配器模式Adapter")]),s._v(" "),a("p",[a("strong",[s._v("设计意图")]),s._v("\n适配器模式（Adapter Pattern）是作为两个不兼容的接口之间的桥梁。这种类型的设计模式属于结构型模式，它结合了两个独立接口的功能。")]),s._v(" "),a("p",[s._v("在某些时候，客户期望获得某种功能接口但现有的接口无法满足客户的需求，例如美国的正常供电电压为 110V，一个中国人带了一款中国制造电器去美国，这个电器必须要在 220V 电压下才能充电使用。\n这种情况下，客户（中国人）的期望接口是有一个 220V 的电压为电器充电，但实际的接口是仅有一个110V 的电压供电器充电，这种情况下就需要采用一根电压转换器（适配器）使得 110V 的电压能够转换为220V 的电压，供客户使用。")]),s._v(" "),a("p",[s._v("将一个类的接口转换成客户希望的另外一个接口，这就是适配器需要做的事情，适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。")]),s._v(" "),a("p",[a("strong",[s._v("适用条件")])]),s._v(" "),a("ul",[a("li",[s._v("系统需要使用现有的类，而此类的接口不符合系统的需要(核心需求)。")]),s._v(" "),a("li",[s._v("想要建立一个可以重复使用的适配器类，用于与一些彼此之间没有太大关联的一些类，包括一些可能在将来引进的类一起工作，这些源类不一定有一致的接口，但通过适配器使得它们都具有一致的接口。")]),s._v(" "),a("li",[s._v("通过接口转换，将一个类插入另一个类系中。(比如老虎和飞禽，现在多了一个飞虎，在不增加实体的需求下，增加一个适配器，在里面包容一个虎对象，实现飞的接口。)")])]),s._v(" "),a("p",[a("strong",[s._v("设计")])]),s._v(" "),a("ul",[a("li",[s._v("通常有两种方式实现适配器模式，一种是类适配器，类适配器目前已不太使用，另一种实现方式是对象适配器，通常情况下采用对象适配器会使得代码更易扩展与维护。")]),s._v(" "),a("li",[s._v("不管采用何种方式，其基本的实现思想都是：对现有接口的实现类进行扩展，使其实现客户期望的目标接口。")]),s._v(" "),a("li",[s._v("类适配器通过继承现有接口类并实现目标接口，这样的话会使得现有接口类完全对适配器暴露，使得适配器具有现有接口类的全部功能，破坏了封装性。此外从逻辑上来说，这也是不符合常理的，适配器要做的是扩展现有接口类的功能而不是替代，类适配器只有在特定条件下会被使用。")]),s._v(" "),a("li",[s._v("对象适配器持有现有接口类一个实例，并扩展其功能，实现目标接口。这是推荐的方式，优先采用组合而不是继承，会使得代码更利于维护。此外，这也是非常符合常理的——“给我一根线，让我来给他加长到 5m，我并不需要知道这跟线是什么组成的，因为我的工作就是让线加长到 5m”——我们扩展了相应功能而并不关心其具体实现。")])]),s._v(" "),a("p",[a("strong",[s._v("对象适配器")])]),s._v(" "),a("ul",[a("li",[s._v("Target：客户期望获得的功能接口(220V电压供电)。")]),s._v(" "),a("li",[s._v("Cilent：客户，期望访问Target接口(客户期望能有220V电压)。")]),s._v(" "),a("li",[s._v("Adaptee：现有接口，这个接口需要被适配(现有110V电压供电，需要被适配至220V)。")]),s._v(" "),a("li",[s._v("Adapter：适配器类，适配现有接口使其符合客户需求接口(适配110V电压，使其变为220V电压)。")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" map "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedHashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zahngsan"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" map "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedHashMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Random")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nextInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("map"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 目标接口，期望返回 json 字符串")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findByJId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findJUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserServiceAdapter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" userService "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserServiceAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("userService "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findByJId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Gson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findJUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Gson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserService")]),s._v(" userService "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserService")]),s._v(" specUserService "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserServiceAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("specUserService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findJUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[a("strong",[s._v("类适配器")]),s._v("\n多了继承")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserServiceAdapter")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserServiceImpl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserService")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findByJId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 破坏里氏代换原则")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Gson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findJUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" users "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Gson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Client")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserService")]),s._v(" specUserService "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpecUserServiceAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("specUserService"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findJUsers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[a("strong",[s._v("适配器模式总结")])]),s._v(" "),a("ol",[a("li",[s._v("优点：")])]),s._v(" "),a("ul",[a("li",[s._v("可以让任何两个没有关联的类一起运行。")]),s._v(" "),a("li",[s._v("提高了类的复用，可以一致化多个不同接口。")]),s._v(" "),a("li",[s._v("将现有接口实现类隐藏，增加了类的透明度。")]),s._v(" "),a("li",[s._v("灵活性高，可自由适配。")])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("缺点：")])]),s._v(" "),a("ul",[a("li",[s._v("过多地使用适配器，会让系统非常零乱，不易整体进行把握。比如，明明看到调用的是 A 接口，其实内部被适配成了 B 接口的实现，一个系统如果太多出现这种情况，无异于一场灾难。因此如果不是很有必要，可以不使用适配器，而是直接对系统进行重构。")]),s._v(" "),a("li",[s._v("某些适配工作可能非常困难，例如让房子飞起来。")]),s._v(" "),a("li",[s._v("当我们有动机地修改一个正常运行的系统的接口，这时应该考虑使用适配器模式。")])]),s._v(" "),a("p",[s._v("注意事项：适配器不是在详细设计时添加的，而是解决正在服役的项目的问题，即现有接口可能无法改变（去美国不可能把人家 110V 电压供给改成 220V 电压供给）。")]),s._v(" "),a("p",[a("strong",[s._v("剖析适配器模式在 Java 日志中的应用")]),s._v("\nJava 中有很多日志框架，在项目开发中，我们常常用它们来打印日志信息。其中，比较常用的有log4j、logback，以及 JDK 提供的 JUL(java.util.logging) 和 Apache 的 JCL(Jakarta Commons Logging)等。")]),s._v(" "),a("p",[s._v("大部分日志框架都提供了相似的功能，比如按照不同级别(debug、info、warn、erro.…）打印日志等，但它们却并没有实现统的接口。这主要可能是历史的原因，它不像JDBC那样，一开始就制定了数据库操作的接口规范。")]),s._v(" "),a("p",[s._v("Slf4J 中就有适配器 Log4jLoggerAdapter 和 LogbackLoggerAdapter 来对接 Log4j 或 Logback。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐206】经典设计-如何让rabbitmq支持消息延迟投递"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐206】经典设计-如何让rabbitmq支持消息延迟投递"}},[s._v("#")]),s._v(" 【IT老齐206】经典设计！如何让RabbitMQ支持消息延迟投递")]),s._v(" "),a("p",[s._v("什么是延时队列？顾名思义：首先它要具有队列的特性,再给它附加一个延迟消费队列消息的功能，也就是说可以指定队列中的消息在哪个时间点被消费。")]),s._v(" "),a("p",[s._v("延时队列在项目中的应用还是比较多的，尤其像电商类平台：")]),s._v(" "),a("ol",[a("li",[s._v("订单成功后，在30分钟内没有支付，自动取消订单")]),s._v(" "),a("li",[s._v("外卖平台发送订餐通知，下单成功后60s给用户推送短信。")]),s._v(" "),a("li",[s._v("如果订单- -直处于某- 个未完结状态时, 及时处理关单,并退还库存")]),s._v(" "),a("li",[s._v("淘宝新建商户- -个月内还没上传商品信息，将冻结商铺等")])]),s._v(" "),a("p",[s._v("遗憾的是，RabbitMQ中并未提供延迟队列特性， 但我们可以利用RabbitMQ死信队列超时转发的特性间接实现。")]),s._v(" "),a("p",[a("strong",[s._v("Dead Letter Exchanges (DLX)")]),s._v("\nDLX 即死信交换机，绑定在死信交换机上的即死信队列。RabbitMQ的 Queue（队列）可以配置两个参数 x-dead-letter-exchange 和 x-dead-letter-routing-key （可选），一旦队列内出现了 Dead Letter（死信），则按照这两个参数可以将消息重新路由到另一个Exchange (交换机)，让消息重新被消费。")]),s._v(" "),a("p",[a("strong",[s._v("队列出现Dead Letter的情况有")])]),s._v(" "),a("ul",[a("li",[s._v("消息或者队列的TTL过期")]),s._v(" "),a("li",[s._v("队列达到最大长度")]),s._v(" "),a("li",[s._v("消息被消费端拒绝(basic.reject or basic.nack)")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐208】数据向上追溯场景该如何优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐208】数据向上追溯场景该如何优化"}},[s._v("#")]),s._v(" 【IT老齐208】数据向上追溯场景该如何优化？")]),s._v(" "),a("p",[s._v("粮食指导价——场景例子：")]),s._v(" "),a("ul",[a("li",[s._v("国家 1.7")]),s._v(" "),a("li",[s._v("海南省 2.2")]),s._v(" "),a("li",[s._v("河北省 2.1\n"),a("ul",[a("li",[s._v("石家庄市 2.15\n"),a("ul",[a("li",[s._v("灵寿县 2.25")]),s._v(" "),a("li",[s._v("赵县 2.3")])])])])])]),s._v(" "),a("p",[s._v("在没有优化的前提下，如果海南省下属的某些县市并没有明确粮食指导价，在读取数据时，要向上追溯 3 次 IO 才可以获取到指导价数据（县市省），这对于大规模并发系统不利。")]),s._v(" "),a("p",[s._v('此时可以利用"空间换时间"的策略，在生成数据时根据海南省行政区划复制省级粮食指导价。')]),s._v(" "),a("ul",[a("li",[s._v("国家 1.7\n"),a("ul",[a("li",[s._v("海南省 2.2\n"),a("ul",[a("li",[s._v("其他市 2.2")]),s._v(" "),a("li",[s._v("三亚市 2.2\n"),a("ul",[a("li",[s._v("吉阳镇 2.2")]),s._v(" "),a("li",[s._v("凤凰镇 2.2")])])])])])])])]),s._v(" "),a("p",[s._v("这样一次 IO 便可获取数据，提高提取速度。如果未来三亚市推出自己的粮食指导价，只需要根据辖区更新即可。")]),s._v(" "),a("ul",[a("li",[s._v("国家 1.7\n"),a("ul",[a("li",[s._v("海南省 2.2\n"),a("ul",[a("li",[s._v("其他市 2.2")]),s._v(" "),a("li",[s._v("三亚市 2.3\n"),a("ul",[a("li",[s._v("吉阳镇 2.3")]),s._v(" "),a("li",[s._v("凤凰镇 2.3")])])])])])])])]),s._v(" "),a("p",[a("strong",[s._v("类似的方案还有")])]),s._v(" "),a("ul",[a("li",[s._v("省市县多级代理的定价机制")]),s._v(" "),a("li",[s._v("上级给下级各类消息通知与投递")])]),s._v(" "),a("p",[a("strong",[s._v("不适用场景")])]),s._v(" "),a("ul",[a("li",[s._v("数据量超大的树形结构")]),s._v(" "),a("li",[s._v("层级较短没必要")]),s._v(" "),a("li",[s._v("节点父子关系不稳定的情况")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐209】爷爷-爷爷-你10年前用的redis支持json啦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐209】爷爷-爷爷-你10年前用的redis支持json啦"}},[s._v("#")]),s._v(" 【IT老齐209】爷爷！爷爷！你10年前用的Redis支持JSON啦~")]),s._v(" "),a("p",[s._v("RedisJSON 的支持与安装")]),s._v(" "),a("ul",[a("li",[s._v("版本：Redis6+")]),s._v(" "),a("li",[s._v("JSON 不能超过 128 层")]),s._v(" "),a("li",[s._v("github：https://github.com/RedisJSON/RedisJSON")]),s._v(" "),a("li",[s._v("文档：https://redis.io/docs/stack/json/")]),s._v(" "),a("li",[s._v("启动：\n"),a("ul",[a("li",[s._v("docker："),a("code",[s._v("docker run -p 6379:6379 --name redis-stack redis/redis-stack:latest")])]),s._v(" "),a("li",[s._v("命令行启动 server："),a("code",[s._v("redis-server --loadmodule ./target/release/librejson.so")])])])])]),s._v(" "),a("p",[s._v("命令行操作：文档例子——https://redis.io/docs/stack/json/path/")]),s._v(" "),a("ul",[a("li",[s._v("设置 key："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('JSON.SET key $ \'{"a":"a","b":[{"c":"c"}]}\'\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[s._v("获取值："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("JSON.GET key $.b.*\nJSON.GET key $.b[*].c\nJSON.GET key $..c\nJSON.GET key $..b[0:2].c\nJSON.GET key $..b[0:2]\n\n# 官方文档的复杂筛选\nJSON.GET store $.inventory.*[?(@.free-shipping==true)].name\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"【it老齐214】为什么大厂都在做devops-和cicd有什么关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐214】为什么大厂都在做devops-和cicd有什么关系"}},[s._v("#")]),s._v(" 【IT老齐214】为什么大厂都在做DevOps，和CICD有什么关系？")]),s._v(" "),a("p",[s._v("DevOps 是 Development（开发）和 Operations（运维）的组合，是一种方法论，是一组过程、方法与系统的统称，用于促进应用开发、应用运维和质量保障（QA）部门之间的沟通、协作与整合，以期打破传统开发和运营之间的壁垒和鸿沟；")]),s._v(" "),a("p",[s._v("DevOps 是一种重视软件开发人员（Dev）和 IT 运维技术人员 （Ops） 之间沟通合作的文化、运动或惯例，通过自动化软件交付和架构变更的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠；具体来说，就是在软件交付和部署过程中提高沟通与协作的效率，旨在更快、更可靠的的发布更高质量的产品；")]),s._v(" "),a("p",[s._v("也就是说 DevOps 是一组过程和方法的统称，并不指代某一特定的软件工具或软件工具组合；各种工具软件或软件组合可以实现 DevOps 的概念方法，其本质是一整套的方法论，而不是指某种或某些工具集合，与软件开发中设计到的 OOP、AOP、IOC（或 DI）等类似，是一种理论或过程或方法的抽象或代称。")]),s._v(" "),a("p",[s._v("当下"),a("strong",[s._v("容器化技术与K8S")]),s._v("是 DevOps 的核心")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("CI/CD")])]),s._v(" "),a("p",[s._v("CI/CD 是一种通过将自动化引入应用程序开发阶段来频繁向客户交付应用程序的方法。CI/CD 的主要概念是持续集成、持续交付和持续部署。CI/CD 是解决集成新代码可能给开发和运营团队带来的问题(又名“集成地狱”）的解决方案。")]),s._v(" "),a("p",[s._v("首字母缩略词 CI/CD 有几个不同的含义。CI/CD 中的“CI”总是指持续集成，它是开发人员的自动化过程。成功的 CI 意味着对应程序的新代码更改会定期构建、测试并合并到共享存储库。这是解决同时开发的应用程序有太多分支可能相互冲突的问题的解决方案。")]),s._v(" "),a("p",[s._v("CI/CD 中的“CD”指的是持续交付（Continuous Delivery）/持续部署（Continuous Deployment），它们是有时可以互换使用的相关概念。两者都是关于自动化流水线的进一步阶段，但有时会单独使用它们来说明正在发生的自动化程度。")]),s._v(" "),a("p",[s._v("持续交付通常意味着开发人员对应用程序的更改会自动进行错误测试并上传到存储库（如 GitHub 或容器注册表），然后运维团队可以将它们部署到实时生产环境中。这是对开发团队和业务团队之间可见性和沟通不佳问题的解决方案。为此，持续交付的目的是确保以最少的努力部署新代码。")]),s._v(" "),a("p",[s._v("持续部署（另一种可能的“CD”）可以指自动将开发人员的更改从存储库发布到生产环境，供客户使用。它解决了频繁的应用程序人工部署使运维团队超载的问题。它通过自动化管道中的下一阶段来构建持续交付的优势。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("持续集成 CI")])]),s._v(" "),a("p",[s._v("在现代应用程序开发中，目标是让多个开发人员同时开发同一个应用程序的不同功能。但是，如果一个组织被设置为在某一天（称为“合并日”）将所有分支源代码合并在一起，那么最终的工作可能是乏味的、手动的和耗时的。这是因为当一个单独工作的开发人员对应用程序进行更改时，它可能会与其他开发人员同时进行的不同更改发生冲突。如果每个开发人员都定制了他们自己的本地集成开发环境（IDE），而不是团队就一个基于云的 IDE 达成一致，这个问题可能会更加复杂。")]),s._v(" "),a("p",[s._v("持续集成（CI）帮助开发人员更频繁地将他们的代码更改合并回共享分支或“主干”——有时甚至每天。合并开发人员对应用程序的更改后，将通过自动构建应用程序并运行不同级别的自动化测试（通常是单元测试和集成测试）来验证这些更改，以确保更改不会破坏应用程序。这意味着测试从类和函数到构成整个应用程序的不同模块的所有内容。如果自动化测试发现新代码和现有代码之间存在冲突，CI 可以更轻松地快速、频繁地修复这些错误。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("持续交付 CD")])]),s._v(" "),a("p",[s._v("在 CI 中的构建和单元和集成测试目动化之后，次序交付的目标是拥有一个始终准备好部署到生产环境的代码库。__付过程，CI已经内置到您的开发管道中是很重要的。持续交付的目标是拥有")]),s._v(" "),a("p",[s._v("在持续交付中，从合并代码更改到交付生产就绪版本的每个阶段都涉及测试自动化和代码发布自动化。在该过程结束时，运维团队能够快速轻松地将应用程序部署到生产环境。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("持续部署CD")])]),s._v(" "),a("p",[s._v("成熟的 CI/CD 管道的最后阶段是持续部署。作为持续交付的扩展，它可以自动将生产就绪的构建发布到代码存储库，持续部署可以自动将应用程序发布到生产环境。因为在生产前的流水线阶段没有人工门，持续部署在很大程度上依赖于精心设计的测试自动化。")]),s._v(" "),a("p",[s._v("在实践中，持续部署意味着开发人员对云应用程序的更改可以在编写后几分钟内生效（假设它通过了自动化测试)。这使得持续接收和整合用户反馈变得更加容易。总而言之，所有这些连接的CI/CD实践降低了应用程序部署的风险，从而更容易以小块的形式发布对应用程序的更改，而不是一次全部发布。不过，也有很多前期投资，因为需要编写自动化测试以适应 CI/CD 管道中的各种测试和发布阶段。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("CICD 方案：")]),s._v(" "),a("ul",[a("li",[s._v("Jenkins")]),s._v(" "),a("li",[s._v("Gitlab CI/CD")]),s._v(" "),a("li",[s._v("Helm 与 Helm Chart")])]),s._v(" "),a("h2",{attrs:{id:"【it老齐213】k8s如何管理应用的数据文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐213】k8s如何管理应用的数据文件"}},[s._v("#")]),s._v(" 【IT老齐213】K8S如何管理应用的数据文件？")]),s._v(" "),a("p",[s._v("Persistent Volume （PV）描述的，是持久化存储数据卷。这个 API 对象主要定义的是一个持久化存储在宿主机上的目录，比如一个 NFS 的挂载目录。")]),s._v(" "),a("p",[s._v("Persistent Volume Claim （PVC）描述的，则是 Pod 所希望使用的持久化存储的属性。比如，Volume 存储的大小、可读写权限等等。")]),s._v(" "),a("p",[s._v("PVC 可以理解为持久化存储的“接口”，它提供了对某种持久化存储的描述，但不提供具体的实现；而这个持久化存储的实现部分则由 PV 负责完成。")]),s._v(" "),a("h2",{attrs:{id:"【it老齐215】几千万数据量大表做mysql主从崩了-该如何优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐215】几千万数据量大表做mysql主从崩了-该如何优化"}},[s._v("#")]),s._v(" 【IT老齐215】几千万数据量大表做MySQL主从崩了，该如何优化？")]),s._v(" "),a("p",[s._v("网友的问题：主从同步出现延迟，想要回复主从，是只能将主库的数据同步到从库，然后再重建同步吗？现在主库的数据有点多，同步到从库也要花一定的时间，有什么办法能快速恢复。")]),s._v(" "),a("p",[s._v("问题分析，MySQL 主从是通过单线程 Binlog 传递实现数据复制，几千万数据同步简直是灾难。")]),s._v(" "),a("p",[s._v("方案：利用数据迁移工具并发迁移（Datax）+ Binlog Offset 偏移量快速转移")]),s._v(" "),a("p",[a("strong",[s._v("第一步，利用数据迁移工具、任务调度等，如 DataX/Kattle 等完成数据迁移")])]),s._v(" "),a("p",[s._v("DataX 是一个异构数据源离线同步工具，致力于实现包括关系型数据库（MySQL、Oracle等）、HDFS、Hive、ODPS、HBase、FTP等各种异构数据源之间稳定高效的数据同步功能。")]),s._v(" "),a("p",[s._v("DataX 本身作为离线数据同步框架，采用 Framework + plugin 架构构建。将数据源读取和写入抽象成为 Reader/Writer 插件，纳入到整个同步框架中。")]),s._v(" "),a("ul",[a("li",[s._v("Reader: Reader 为数据采集模块，负责采集数据源的数据，将数据发送给 Framework。")]),s._v(" "),a("li",[s._v("Writer: Writer 为数据写入模块，负责不断向 Framework 取数据，并将数据写入到目的端。")]),s._v(" "),a("li",[s._v("Framework: Framework 用于连接 reader 和 writer，作为两者的数据传输通道，并处理缓冲，流控，并发，数据转换等核心技术问题。")])]),s._v(" "),a("p",[a("strong",[s._v("第二步，建立主从关系，从主库最新 Offset 开始同步写入")]),s._v("\n确认主库 Binlog 文件名与偏移量")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("USER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" IDENTIFIED "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" mysql_native_password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("REPLICATION")]),s._v(" SLAVE "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("To")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" MASTER "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看主库 binlog 文件名与偏移量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- File             Postition Binlog_Do_DB Binlog_Ignore_DB Executed_Gtid_Set")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- mysql-bin.000003 3025")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("在从库同步时附加偏移量")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("RESET master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nCHANGE MASTER "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" MASTER_HOST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168,31.196'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_USER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_PASSWORD"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_LOG_FIIE"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000003'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("MASTER_LOG_POS"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3025")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"【it老齐216】白话设计模式之状态模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【it老齐216】白话设计模式之状态模式"}},[s._v("#")]),s._v(" 【IT老齐216】白话设计模式之状态模式")]),s._v(" "),a("p",[s._v("状态模式 State 是一种行为设计模式，让你能在一个对象的内部状态变化时改变其行为，使其看上去就像改变了自身所属的类一样。")]),s._v(" "),a("p",[s._v("User")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),s._v(" userState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" uname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" uname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uname "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" uname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("userState "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuestState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// this.userState.setUser(this);")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("registe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("userState "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MemberState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// this.userState.setUser(this);")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("openVIP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("userState "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VipState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// this.userState.setUser(this);")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    userState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    userState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    userState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("UserState")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("protected")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("abstract")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("GuestState")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuestState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("GuestState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"游客禁止播放4K视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放720P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"游客禁止播放1080P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("MemberState")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MemberState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MemberState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throw")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RuntimeException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"普通会员禁止播放4K视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放720P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放1080P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("VipState")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VipState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserState")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("VipState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("User")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play4K")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放4K视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play720P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放720P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("play1080P")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getUname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"正在播放1080P视频"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("hr"),s._v(" "),a("p",[s._v("状态模式优点")]),s._v(" "),a("ul",[a("li",[s._v("将所有与某个状态有关的行为放到一个类中。并且可以方便地增加新的状态，只需要改变对象状态即可改变对象的行为。")])]),s._v(" "),a("p",[s._v("状态模式缺点")]),s._v(" "),a("ul",[a("li",[s._v("状态模式的使用必然会增加系统类和对象的个数。")]),s._v(" "),a("li",[s._v('状态模式对"开闭原则"的支持并不太好，对于可以切换状态的状态模式，增加新的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需修改对应类的源代码。')])]),s._v(" "),a("p",[s._v("状态模式的使用场景")]),s._v(" "),a("ul",[a("li",[s._v("代码中包含大量与对象状态有关的条件语句，可消除大量的if...else...判断，将其剥离为一个个状态。")])]),s._v(" "),a("p",[s._v("状态模式与策略模式的区别\n-状态模式强调不同情况下对目标方法的控制，有的方法甚至不会执行例如抛异常)。策略模式的算法都是等价的，可以平替，不同算法虽然计算过程不同，但产生的是一致的。")]),s._v(" "),a("ul",[a("li",[s._v("状态模式不会对 Client 暴露状态，是在上下文对象内部不断变化，而策略模式则是由 Client 自主决定使用哪种算法。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);