(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{1007:function(s,a,t){"use strict";t.r(a);var e=t(12),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("课程名称：中小型企业通用自动化运维架构"),t("br"),s._v("\n课程地址：https://coding.imooc.com/class/239.html\n我的评价：★★★★★")])]),s._v(" "),t("p",[s._v("[TOC]")]),s._v(" "),t("h2",{attrs:{id:"_5-1-jumpserver介绍-07-37"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-jumpserver介绍-07-37"}},[s._v("#")]),s._v(" 5-1 JumpServer介绍  (07:37)")]),s._v(" "),t("h3",{attrs:{id:"什么是jumpserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是jumpserver"}},[s._v("#")]),s._v(" 什么是Jumpserver")]),s._v(" "),t("ul",[t("li",[s._v("全球首款完全开源的堡垒机")]),s._v(" "),t("li",[s._v("使用Python/Django进行开发")]),s._v(" "),t("li",[s._v("支持多机房跨区域部署")])]),s._v(" "),t("h3",{attrs:{id:"jumpserver特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jumpserver特点"}},[s._v("#")]),s._v(" Jumpserver特点")]),s._v(" "),t("ul",[t("li",[s._v("完全开源")]),s._v(" "),t("li",[s._v("符合4A的专业运维审计")]),s._v(" "),t("li",[s._v("分布式架构")]),s._v(" "),t("li",[s._v("横向扩展")])]),s._v(" "),t("h3",{attrs:{id:"jumpserver架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jumpserver架构"}},[s._v("#")]),s._v(" Jumpserver架构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://github.com/ChouBaoDxs/MyResources/blob/master/image/%E8%BF%90%E7%BB%B4/Jumpserver/jumpserver%E6%9E%B6%E6%9E%84.jpg?raw=true",alt:"jumpserver架构"}})]),s._v(" "),t("ul",[t("li",[s._v("Jumpserver：web服务核心，django")]),s._v(" "),t("li",[s._v("Luna：Web Terminal")]),s._v(" "),t("li",[s._v("Coco：ssh、websocket")]),s._v(" "),t("li",[s._v("Guacamole：管理windows需要的模块")]),s._v(" "),t("li",[s._v("Ansible API：管理资产")]),s._v(" "),t("li",[s._v("Jumpserver-Python-SDK：通过python代码直接调用api")])]),s._v(" "),t("h3",{attrs:{id:"jumpserver功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jumpserver功能"}},[s._v("#")]),s._v(" Jumpserver功能")]),s._v(" "),t("ul",[t("li",[s._v("身份验证")]),s._v(" "),t("li",[s._v("账号管理")]),s._v(" "),t("li",[s._v("授权控制")]),s._v(" "),t("li",[s._v("安全审计")]),s._v(" "),t("li",[s._v("Web Terminal")])]),s._v(" "),t("h2",{attrs:{id:"_5-2-jumpserver安装配置-17-28"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-jumpserver安装配置-17-28"}},[s._v("#")]),s._v(" 5-2 JumpServer安装配置  (17:28)")]),s._v(" "),t("h3",{attrs:{id:"安装步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),t("ul",[t("li",[s._v("操作系统环境配置\n"),t("ul",[t("li",[s._v("关闭Selinux")]),s._v(" "),t("li",[s._v("关闭Iptables")]),s._v(" "),t("li",[s._v("修改字符集")])])]),s._v(" "),t("li",[s._v("Python环境配置\n"),t("ul",[t("li",[s._v("安装依赖包")]),s._v(" "),t("li",[s._v("安装Python3.6")]),s._v(" "),t("li",[s._v("配置Python虚拟运行环境")])])]),s._v(" "),t("li",[s._v("JumpServer源码获取安装\n"),t("ul",[t("li",[s._v("获取JumpServer源码")]),s._v(" "),t("li",[s._v("安装RPM依赖包")]),s._v(" "),t("li",[s._v("安装Python依赖包")]),s._v(" "),t("li",[s._v("安装Redis")]),s._v(" "),t("li",[s._v("安装配置MySQL数据库")]),s._v(" "),t("li",[s._v("修改JumpServer配置文件")])])]),s._v(" "),t("li",[s._v("JumpServer运行\n"),t("ul",[t("li",[s._v("生成数据库表结构和初始化数据")]),s._v(" "),t("li",[s._v("运行JumpServer")])])]),s._v(" "),t("li",[s._v("JumpServer组件安装\n"),t("ul",[t("li",[s._v("安装SSH Server和WebSocket Server：Coco")]),s._v(" "),t("li",[s._v("安装Web Terminal前端：Luna")])])])]),s._v(" "),t("h3",{attrs:{id:"开始操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始操作"}},[s._v("#")]),s._v(" 开始操作")]),s._v(" "),t("p",[t("strong",[s._v("注意")]),s._v("：最新版的jumpserver安装变化非常大，建议参考官方文档：https://jumpserver.readthedocs.io/zh/master/step_by_step.html ，下面操作步骤是讲师演示的老版jumpserver。另外，官方文档和讲师的主要操作目录都是"),t("code",[s._v("/opt")]),s._v("注意一下。")]),s._v(" "),t("ol",[t("li",[s._v("运行install_jumpserver.sh：这个脚本只配置了基础环境，安装了Python3.6.5，安装了redis和mariadb，git clone了jumpserver和coco源代码并安装了pip依赖。\n注意：最新版的jumpserver，coco已经改名为koko")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# install_jumpserver.sh\nsetenforce 0  # 可以设置配置文件永久关闭\nsystemctl stop iptables.service\nsystemctl stop firewalld.service\n\nlocaledef -c -f UTF-8 -i zh_CN zh_CN.UTF-8\nexport LC_ALL=zh_CN.UTF-8\necho 'LANG=\"zh_CN.UTF-8\"' > /etc/locale.conf\n\nyum -y install wget sqlite-devel xz gcc automake zlib-devel openssl-devel epel-release git\n\nmkdir download && cd download\nwget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tar.xz\ntar xf Python-3.6.5.tar.xz  && cd Python-3.6.5\n./configure --prefix=/usr/local/python && make && make install\n\necho 'export PATH=/usr/local/python/bin:$PATH' >> ~/.bashrc\nsource ~/.bashrc\n\ncd /opt && git clone --depth=1 https://github.com/jumpserver/jumpserver.git && cd jumpserver && git checkout master\ncd requirements && yum -y install $(cat rpm_requirements.txt)  && /usr/local/python/bin/pip3 install -r requirements.txt\n\nyum -y install redis && systemctl start redis && yum -y install mariadb mariadb-devel mariadb-server && systemctl enable mariadb && systemctl start mariadb\nmysql -uroot -e \"create database jumpserver default charset 'utf8';grant all on jumpserver.* to 'jumpserver'@'127.0.0.1' identified by 'aabbcc';flush privileges;\"\n\ncd /opt\ngit clone https://github.com/jumpserver/coco.git && cd coco && git checkout master && cd /opt/coco/requirements && yum -y  install $(cat rpm_requirements.txt) && /usr/local/python/bin/pip3 install -r requirements.txt\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("设置配置文件")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd jumpserver\ncp config_example.py config.py\nvim config.py # 设置一下接配置：主要是MySQL、Redis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("初始化数据库")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd jumpserver\ncd utils\nbash make_migrations.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("运行jumpserver")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd jumpserver\n./jms start #停止的话就是./jms stop，但是好像有时候不起作用\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("打开浏览器访问：默认端口就是8080，账号密码是admin")]),s._v(" "),t("li",[s._v("一般启动都是指定后台运行："),t("code",[s._v("./jms start -d")])]),s._v(" "),t("li",[s._v("配置coco(最新版已改名koko)")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd coco\ncp conf_example.py conf.py # 酌情修改配置\n# 启动coco\n./cocod start -d # 默认监听2222端口\n# 此时，需要在jumpserver管理页面中，左侧会话管理->终端管理点击接受，不这样的话，coco是无法连接到8080的核心组件的\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ol",{attrs:{start:"8"}},[t("li",[s._v("如何在终端登录跳板机？")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1. 比如当前是admin管理员，进入jumpserver，点击右上角头像进入个人信息设置页面\n2. 在右侧点击`重置并下载SSH密钥`\n3. 设置这个下载下来的ssh私钥权限：chmod 600 ~/Downloads/admin-jumpserver.pem\n4. 终端登录跳板机：ssh admin@192.168.1.55 -p 2222 -i ~/Downloads/admin-jumpserver.pem\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"课程总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#课程总结"}},[s._v("#")]),s._v(" 课程总结")]),s._v(" "),t("ul",[t("li",[s._v("介绍JumpServer的特点、安装方法、配置方法")]),s._v(" "),t("li",[s._v("介绍JumpServer架构和模块流程")]),s._v(" "),t("li",[s._v("介绍JumpServer组件")])]),s._v(" "),t("h2",{attrs:{id:"_5-3-jumpserver的资产管理、用户管理、权限管理-22-04"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-jumpserver的资产管理、用户管理、权限管理-22-04"}},[s._v("#")]),s._v(" 5-3 Jumpserver的资产管理、用户管理、权限管理  (22:04)")]),s._v(" "),t("h3",{attrs:{id:"luna的安装配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#luna的安装配置"}},[s._v("#")]),s._v(" Luna的安装配置")]),s._v(" "),t("ol",[t("li",[s._v("官方文档中下载luna源码包：https://jumpserver.readthedocs.io/zh/master/setup_by_centos7.html")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 安装 Web Terminal 前端: Luna  需要 Nginx 来运行访问 访问(https://github.com/jumpserver/luna/releases)下载对应版本的 release 包, 直接解压, 不需要编译\n$ cd /opt\n$ wget https://github.com/jumpserver/luna/releases/download/1.5.0/luna.tar.gz\n\n# 如果网络有问题导致下载无法完成可以使用下面地址\n$ wget https://demo.jumpserver.org/download/luna/1.5.0/luna.tar.gz\n\n$ tar xf luna.tar.gz\n$ chown -R root:root luna\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("需要安装配置Nginx")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yum install nginx\nvim /etc/nginx/nginx.conf \n# 个人不建议直接修改nginx.conf，应当按照官方文档来：vi /etc/nginx/conf.d/jumpserver.conf\n# 具体内容可以直接从官方文档复制：https://jumpserver.readthedocs.io/zh/master/setup_by_centos7.html\n\n# 重启nginx\nnginx -t   # 确保配置没有问题, 有问题请先解决\nsystemctl start nginx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("现在访问jumpserver就不需要带端口了，默认就是80")])]),s._v(" "),t("h3",{attrs:{id:"jumpserver使用教程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jumpserver使用教程"}},[s._v("#")]),s._v(" JumpServer使用教程")]),s._v(" "),t("h4",{attrs:{id:"邮件smtp服务器配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#邮件smtp服务器配置"}},[s._v("#")]),s._v(" 邮件SMTP服务器配置")]),s._v(" "),t("ol",{attrs:{start:"0"}},[t("li",[s._v("这个配置主要是用来让jumpserver发邮件用的")]),s._v(" "),t("li",[s._v("系统设置——>邮件配置——>SMTP服务器")]),s._v(" "),t("li",[s._v("如果需要搭建免费的邮件服务器，可以用：Mailgun，一个月2万封，自己么随便QQ、163用用好了")]),s._v(" "),t("li",[s._v("admin账号修改完邮件设置，需要重启一下jumpserver："),t("code",[s._v("./jms restart")])])]),s._v(" "),t("h4",{attrs:{id:"用户管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),t("p",[s._v("添加新用户："),t("code",[s._v("用户管理——>用户列表——>创建用户")]),t("br"),s._v("\n用户组管理："),t("code",[s._v("用户管理——>用户组——>创建用户组")])]),s._v(" "),t("h4",{attrs:{id:"资产管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资产管理"}},[s._v("#")]),s._v(" 资产管理")]),s._v(" "),t("p",[t("code",[s._v("资产管理——>资产列表——>创建资产")]),s._v("，注意-这里有一项是管理用户必填，可以先在"),t("code",[s._v("资产管理——>管理用户")]),s._v("创建一个")]),s._v(" "),t("h4",{attrs:{id:"授权管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#授权管理"}},[s._v("#")]),s._v(" 授权管理")]),s._v(" "),t("p",[t("code",[s._v("权限管理——>资产授权——>创建权限规则")]),s._v("，注意-这里有一项系统用户必填，可以先在"),t("code",[s._v("资产管理——>系统用户")]),s._v("创建一个，这里创建的系统用户会被jumpserver通过ansible推送到目标主机")]),s._v(" "),t("h4",{attrs:{id:"管理用户和系统用户的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#管理用户和系统用户的区别"}},[s._v("#")]),s._v(" 管理用户和系统用户的区别")]),s._v(" "),t("p",[s._v("jumpserver对应页面有解释：")]),s._v(" "),t("ul",[t("li",[s._v("管理用户：是服务器的root，或拥有NOPASSWDL:ALL sudo权限的用户，Jumpserver使用该用户来进行Ansible各种操作：比如推送系统用户、获取基本信息")]),s._v(" "),t("li",[s._v("系统用户：是jumpserver跳转登录资产时使用的用户，可以理解为登录资产用户。简单来说：用户使用自己的用户名登录jumpserver，jumpserver使用系统用户登录资产。")])]),s._v(" "),t("h4",{attrs:{id:"ssh登录流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh登录流程"}},[s._v("#")]),s._v(" ssh登录流程")]),s._v(" "),t("p",[s._v("ssh登录——>查看主机——>登录目标主机")]),s._v(" "),t("h4",{attrs:{id:"审计日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#审计日志"}},[s._v("#")]),s._v(" 审计日志")]),s._v(" "),t("ul",[t("li",[s._v("仪表盘：仪表盘")]),s._v(" "),t("li",[s._v("用户登录日志：用户管理——>登录日志")]),s._v(" "),t("li",[s._v("命令记录：会话管理——>命令记录")])]),s._v(" "),t("h4",{attrs:{id:"课程总结-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#课程总结-2"}},[s._v("#")]),s._v(" 课程总结")]),s._v(" "),t("ul",[t("li",[s._v("JumpServer使用教程")]),s._v(" "),t("li",[s._v("ssh登录流程")]),s._v(" "),t("li",[s._v("JumpServer审计日志介绍")])]),s._v(" "),t("h2",{attrs:{id:"_5-4-jumpserver-api使用教程-21-13"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-jumpserver-api使用教程-21-13"}},[s._v("#")]),s._v(" 5-4 JumpServer API使用教程  (21:13)")]),s._v(" "),t("p",[s._v("Jumpserver提供了一些rest api给我们调用。\n课程目标：api介绍、获取调用api token、编写python代码批量添加资产")]),s._v(" "),t("h3",{attrs:{id:"查看jumpserver提供的api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看jumpserver提供的api"}},[s._v("#")]),s._v(" 查看jumpserver提供的api")]),s._v(" "),t("ul",[t("li",[s._v("官方文档：http://docs.jumpserver.org/zh/docs/user_api.html")]),s._v(" "),t("li",[s._v("需要设置django的debug=True")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("通过访问 http://Jumpserver的URL地址/docs 来访问( 如 http://192.168.244.144/docs )\n注：需要打开 debug 模式\n\n$ vi jumpserver/config.yml\n\n...\nDebug: true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("各种功能：\n"),t("ul",[t("li",[s._v("asserts：jumpserver信息管理")]),s._v(" "),t("li",[s._v("audits：ftp日志")]),s._v(" "),t("li",[s._v("common：Django设置信息")]),s._v(" "),t("li",[s._v("ops：操作记录")]),s._v(" "),t("li",[s._v("perms：权限和验证日志")]),s._v(" "),t("li",[s._v("terminal：终端相关(coco)")]),s._v(" "),t("li",[s._v("users：用户信息相关")])])])]),s._v(" "),t("h3",{attrs:{id:"获取调用api-token"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取调用api-token"}},[s._v("#")]),s._v(" 获取调用API token")]),s._v(" "),t("ul",[t("li",[s._v("官方文档也有讲：http://docs.jumpserver.org/zh/docs/user_api.html")]),s._v(" "),t("li",[s._v("讲师使用的是创建永久的private_token："),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# 也可以创建一个永久 private_token, 避免二次认证\n$ source /opt/py3/bin/activate\n$ cd /opt/jumpserver/apps\n$ python manage.py shell\n>>> from users.models import User\n>>> u = User.objects.get(username='admin')\n>>> u.create_private_token()\n937b38011acf499eb474e2fecb424ab3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"编写python代码批量添加资产"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写python代码批量添加资产"}},[s._v("#")]),s._v(" 编写python代码批量添加资产")]),s._v(" "),t("ul",[t("li",[s._v("调用API：/api/assets/v1/assets")]),s._v(" "),t("li",[s._v("HTTP方法：post")]),s._v(" "),t("li",[s._v("编写add_vm.py")])]),s._v(" "),t("div",{staticClass:"language-py line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-py"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#coding=utf-8")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" requests\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" json\n\ntoken "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4ed7b7cdd47d7a3617cb14cdb740b0fd9c9d97da'")]),s._v("\nheader "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-CSRFToken'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ePQdasmlAI4y6ASA2A2nbrx01bgAzJWg6dryB8IZlW5FEK9nrCDZIDXfkEe7F56D'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Authorization'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Token '")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("token\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nparams "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ip"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.1.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hostname"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mukkee"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"platform"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Linux"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is_active"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"public_ip"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.9.9.9"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin_user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b3c9702d-680a-4851-8f83-a7d28a05fa89"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个是用户的id，可以通过/api/assets/v1/admin-user/的get接口获取")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"92f83f8d-10fc-4b68-a6c0-1aab01c29e41"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个id可以通过/api/assets/v1/nodes/的get接口获取")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\nurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://192.168.1.55/api/assets/v1/assets/'")]),s._v("\n\nr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("json"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" headers"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("status_code"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);