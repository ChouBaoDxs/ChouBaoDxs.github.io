(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{1017:function(s,a,t){"use strict";t.r(a);var n=t(12),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"title"}),n("p",[s._v("课程名称：python 自动化运维篇\n课程地址：http://www.imooc.com/learn/853\n简介：随着技术的进步、业务需求的快速增长，一个运维人员通常要管理上百、上千台服务器，运维工作也变的重复、繁杂。把运维工作自动化，能够把运维人员从服务器的管理中解放出来，让运维工作变得简单、快速、准确\n我的评价：★★★★★")])]),s._v(" "),n("p",[s._v("[TOC]")]),s._v(" "),n("h2",{attrs:{id:"第-1-章-课程介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-1-章-课程介绍"}},[s._v("#")]),s._v(" 第 1 章 课程介绍")]),s._v(" "),n("p",[s._v("本章主要介绍 python 自动化运维的基础知识以及为什么需要用自动化运维，介绍自动化运维的基础架构，为接下几章做预习。")]),s._v(" "),n("h3",{attrs:{id:"_1-1-python-运维-课程简介及基础-11-52"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-python-运维-课程简介及基础-11-52"}},[s._v("#")]),s._v(" 1-1 python 运维-课程简介及基础 (11:52)")]),s._v(" "),n("p",[s._v("课程目标：")]),s._v(" "),n("ul",[n("li",[s._v("了解自动化运维的概念")]),s._v(" "),n("li",[s._v("了解主流自动化运维工具的使用")]),s._v(" "),n("li",[s._v("掌握使用 python 编写自动化运维脚本")])]),s._v(" "),n("p",[s._v("课程技能要求：")]),s._v(" "),n("ul",[n("li",[s._v("了解 Python 基础知识")]),s._v(" "),n("li",[s._v("了解运维的基础知识")]),s._v(" "),n("li",[s._v("运行环境：Python 2.7")])]),s._v(" "),n("p",[s._v("\b 运维发展的不同阶段：")]),s._v(" "),n("ul",[n("li",[s._v("传统运维：\n"),n("ul",[n("li",[s._v("命令行")]),s._v(" "),n("li",[s._v("批量脚本")])])]),s._v(" "),n("li",[s._v("自动化运维")]),s._v(" "),n("li",[s._v("云运维")])]),s._v(" "),n("p",[s._v("传统运维特点：")]),s._v(" "),n("ul",[n("li",[s._v("资源少")]),s._v(" "),n("li",[s._v("业务结构简单")]),s._v(" "),n("li",[s._v("运维工作简单")]),s._v(" "),n("li",[s._v("缺点：效率低、无法跨平台、资源分散、无标准")])]),s._v(" "),n("p",[s._v("什么是自动化运维：")]),s._v(" "),n("ul",[n("li",[s._v("错误的观点：把运维日常需要登陆机器的操作，完全 \bWeb 化，以后只需要点一下鼠标就搞定。")]),s._v(" "),n("li",[s._v("运维自动化是一组将静态的设备结构转化为根据 IT 服务需求动态弹性响应的策略，目的就是实现 IT 运维的质量，降低成本。")])]),s._v(" "),n("p",[s._v("运维自动化优点：高效率、平台化、标准化、流程化\n自动化运维工具： - 部署类：jenkins - 环境类：ansible - 监控类：nagios")]),s._v(" "),n("p",[s._v("运维自动化设计思想：")]),s._v(" "),n("ul",[n("li",[s._v("管理体系化")]),s._v(" "),n("li",[s._v("工作流程化")]),s._v(" "),n("li",[s._v("人员专业化")]),s._v(" "),n("li",[s._v("任务自动化\n"),n("ul",[n("li",[s._v("环境定义自动化")]),s._v(" "),n("li",[s._v("部署自动化")]),s._v(" "),n("li",[s._v("监控自动化")])])])]),s._v(" "),n("p",[s._v("为什么选 Python 做自动化运维？")]),s._v(" "),n("ul",[n("li",[s._v("自动化运维关系的问题：自动化、易实现、跨平台、轻量级")]),s._v(" "),n("li",[s._v("运维人员的技能：编程能力偏弱、熟悉运维、算法能力偏弱")]),s._v(" "),n("li",[s._v("适合自动化运维编程语言特点：丰富的第三方库、学习成本低、跨平台、轻量级")]),s._v(" "),n("li",[s._v("为什么是 Python：\n"),n("ul",[n("li",[s._v("《python 简明教程》半天课学完")]),s._v(" "),n("li",[s._v("丰富的库，如 ansible")]),s._v(" "),n("li",[s._v("大量 python 编写的运维工具，如 salt")]),s._v(" "),n("li",[s._v("跨平台，安装 python 虚拟机即可运行")])])])]),s._v(" "),n("p",[s._v("小试牛刀：编写一个自动安装 python 的脚本\n功能需求：下载指定版本的 Python 源码；安装 Python 需要的依赖库；编译安装 Python\n伪代码版本：判断 root——>等待用户输入 Python 版本——>执行 shell 命令下载源码包——>安装依赖开发包——>编译安装 \bPython\n主要函数讲解：")]),s._v(" "),n("ul",[n("li",[s._v("os.system\n"),n("ul",[n("li",[s._v("功能：执行命令")]),s._v(" "),n("li",[s._v("返回：命令的返回值")]),s._v(" "),n("li",[s._v("补充：命令的输出会输出到标准输出")])])]),s._v(" "),n("li",[s._v("raw_input\n"),n("ul",[n("li",[s._v("功能：暂停程序运行，等待用户输入")]),s._v(" "),n("li",[s._v("返回：用户输入的内容")])])])]),s._v(" "),n("h3",{attrs:{id:"_1-2-python-运维-自动化运维脚本编写-16-21"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-python-运维-自动化运维脚本编写-16-21"}},[s._v("#")]),s._v(" 1-2 python 运维-自动化运维脚本编写 (16:21)")]),s._v(" "),n("p",[s._v("自动化安装 Python 的脚本：")]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# coding=utf-8")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sys\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("getuid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Mac OS下,root用户uid是0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("getuid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'当用用户不是root用户,请以root用户执行脚本'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sys.exit(1)")]),s._v("\n\nversion_url_mapper "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2.7'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.python.org/ftp/python/2.7.12/Python-2.7.12.tgz'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.6'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.python.org/ftp/python/3.6.7/Python-3.6.7.tgz'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.7'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.python.org/ftp/python/3.7.1/Python-3.7.1.tgz'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nwanna_python_version "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'请输入你想安装的Python版本(2.7/3.6/3.7):'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" wanna_python_version "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" version_url_mapper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'您输入的版本号有误,程序退出'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nurl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" version_url_mapper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wanna_python_version'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wget '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" url\nres "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'下载源码包失败!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nfile_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("split"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Python-3.6.7.tgz")]),s._v("\ncmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'tar xf '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" file_name\nres "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm '")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'解压源码包失败,请重新运行这个脚本下载源码包!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nprefix_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" suffix_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("splitext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cd '")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("prefix_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("' && ./configure --prefix=/usr/local/python && make && make install'")]),s._v("\nres "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" res "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'编译Python源码失败,请检查是否缺少依赖库'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("p",[s._v("自动化运维缺点：")]),s._v(" "),n("ul",[n("li",[s._v("数据无法共享")]),s._v(" "),n("li",[s._v("无法主动式发现问题")]),s._v(" "),n("li",[s._v("部署成本高")]),s._v(" "),n("li",[s._v("标准不统一")])]),s._v(" "),n("p",[s._v("云运维简介：")]),s._v(" "),n("ul",[n("li",[s._v("资源数据共享")]),s._v(" "),n("li",[s._v("主动发现问题")]),s._v(" "),n("li",[s._v("统一标准")]),s._v(" "),n("li",[s._v("成本低")])]),s._v(" "),n("p",[s._v("总结：")]),s._v(" "),n("ul",[n("li",[s._v("运维发展的不同阶段")]),s._v(" "),n("li",[s._v("Python 适合自动化运维的原因")]),s._v(" "),n("li",[s._v("学以致用，编写一个脚本")]),s._v(" "),n("li",[s._v("基础基础基础")])]),s._v(" "),n("h2",{attrs:{id:"第-2-章-ansible-教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-2-章-ansible-教程"}},[s._v("#")]),s._v(" 第 2 章 ansible 教程")]),s._v(" "),n("p",[s._v("本章主要讲解服务器管理工具 Ansible 的搭建、使用，以及 API 的入门")]),s._v(" "),n("h3",{attrs:{id:"_2-1-python-自动化运维-ansible-教程-ansible-介绍-11-15"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-python-自动化运维-ansible-教程-ansible-介绍-11-15"}},[s._v("#")]),s._v(" 2-1 python 自动化运维-Ansible 教程-Ansible 介绍 (11:15)")]),s._v(" "),n("p",[s._v("课程目标")]),s._v(" "),n("ul",[n("li",[s._v("了解 Ansible")]),s._v(" "),n("li",[s._v("学习使用 Ansible 管理 IT 资源")]),s._v(" "),n("li",[s._v("学习 Ansible API")]),s._v(" "),n("li",[s._v("阅读 Ansible 部分源码")]),s._v(" "),n("li",[s._v("注意：Web 管理功能 Ansible 是收费的")])]),s._v(" "),n("p",[s._v("Ansible 是什么")]),s._v(" "),n("ul",[n("li",[s._v("Ansible 是一个自动化管理 IT 资源的工具\n"),n("ul",[n("li",[s._v("自动化")]),s._v(" "),n("li",[s._v("管理")]),s._v(" "),n("li",[s._v("IT 资源")])])]),s._v(" "),n("li",[s._v("Ansible 功能有哪些\n"),n("ul",[n("li",[s._v("系统环境配置")]),s._v(" "),n("li",[s._v("安装软件")]),s._v(" "),n("li",[s._v("持续集成")]),s._v(" "),n("li",[s._v("热回滚")])])]),s._v(" "),n("li",[s._v("Ansible 优点\n"),n("ul",[n("li",[s._v("无客户端")]),s._v(" "),n("li",[s._v("推送式")]),s._v(" "),n("li",[s._v("丰富的 module")]),s._v(" "),n("li",[s._v("\b 基于 YAML 的 Playbook")]),s._v(" "),n("li",[s._v("商业化支持")])])]),s._v(" "),n("li",[s._v("Ansible 缺点\n"),n("ul",[n("li",[s._v("效率低、易 \b 挂起")]),s._v(" "),n("li",[s._v("并发性能差")])])])]),s._v(" "),n("p",[s._v("Ansible 与其他软件对比")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[s._v("对比项目")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("Puppet")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("Chef")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("Salt")]),s._v(" "),n("th",{staticStyle:{"text-align":"center"}},[s._v("Ansible")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("客户端")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("无")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("通信方式")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("socket")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("ssh")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("Rabbitmq")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("ssh")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("Web 页面")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("效率")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("一般")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("一般")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("高")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("低")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("易用性")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("低")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("高")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("\b 高")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("高")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("实现语言")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("ruby")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("python")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("python")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("python")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("API")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("有")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[s._v("开源社区")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("4219")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("4479")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("6998")]),s._v(" "),n("td",{staticStyle:{"text-align":"center"}},[s._v("19504")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-2-python-自动化运维-ansible-教程-ansible-配置运行-1-16-08"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-python-自动化运维-ansible-教程-ansible-配置运行-1-16-08"}},[s._v("#")]),s._v(" 2-2 python 自动化运维-Ansible 教程-Ansible 配置运行 1 (16:08)")]),s._v(" "),n("p",[s._v("课程目标：学会 Ansible 安装、学会运行 Ansible、\b 了解 Ansible\b 配置项\n环境准备：Python、Setuptools、Pip\nAnsible 快速安装：")]),s._v(" "),n("ul",[n("li",[s._v("安装 pip：easy_install pip")]),s._v(" "),n("li",[s._v("安装 Ansible：pip install ansibble")])]),s._v(" "),n("p",[s._v("Ansible 源码安装：")]),s._v(" "),n("ul",[n("li",[s._v("获取源码：https://github.com/ansible/ansible")]),s._v(" "),n("li",[s._v("解压源码")]),s._v(" "),n("li",[s._v("进入源码目录")]),s._v(" "),n("li",[s._v("\b 执行 source ./hacking/env-setup")])]),s._v(" "),n("p",[s._v("系统源安装：")]),s._v(" "),n("ul",[n("li",[s._v("CentOS：yum install ansible")]),s._v(" "),n("li",[s._v("Ubuntu：\n"),n("ol",[n("li",[s._v("apit-get install software-properties-common")]),s._v(" "),n("li",[s._v("apt-add-repository ppa:ansible/ansible")]),s._v(" "),n("li",[s._v("apt-get update")]),s._v(" "),n("li",[s._v("apt-get install ansible")])])])]),s._v(" "),n("p",[s._v("Ansible 运行：Ansible——>ssh——>ssh——>shell\nAnsible 配置文件路径优先级：")]),s._v(" "),n("ul",[n("li",[s._v("export ANSIBLE_CONFIG")]),s._v(" "),n("li",[s._v("./ansible.cfg")]),s._v(" "),n("li",[s._v("~/.ansible.cfg")]),s._v(" "),n("li",[s._v("/etc/ansible/ansible.cfg")]),s._v(" "),n("li",[s._v("默认配置")])]),s._v(" "),n("p",[s._v("Ansible 配置文件获取：")]),s._v(" "),n("ul",[n("li",[s._v("通过源安装的：/etc/ansible")]),s._v(" "),n("li",[s._v("其他方式安：https://github.com/ansible/ansible/blob/devel/examples/ansible.cfg")])]),s._v(" "),n("p",[s._v("Ansible 配置详解：")]),s._v(" "),n("ul",[n("li",[s._v("default：默认配置项")]),s._v(" "),n("li",[s._v("privilege_escalation：执行命令的 \b 用户权限设置")]),s._v(" "),n("li",[s._v("paramiko_connection paramika：插件设置")]),s._v(" "),n("li",[s._v("ssh_connection：ssh 连接设置")]),s._v(" "),n("li",[s._v("accelerate")]),s._v(" "),n("li",[s._v("selinux(防火墙) & colors(输出颜色)")]),s._v(" "),n("li",[s._v("ask_pass & ask_sudo_pass：\n"),n("ul",[n("li",[s._v("ask_pass：可以控制，Ansible 剧本 playbook 是否会自动默认弹出密码")]),s._v(" "),n("li",[s._v("ask_sudo_pass：用户使用的系统平台开启了 sudo 密码的话，应该开绿这一参数")])])]),s._v(" "),n("li",[s._v("gather_subset：设置收集的内容(all、network、hardware、virtual、facter、ohai)")]),s._v(" "),n("li",[s._v("remote_port&remote_tmp&remote_user：客户机的设置，登录的用户、端口、临时目录等")]),s._v(" "),n("li",[s._v("sudo_exe&sudo_flags&sudo_user：sudo 命令路径、sudo 参数、可以 sudo 的用户")]),s._v(" "),n("li",[s._v("action_plugins&callback_plugins&connection_plugins&filter_plugins&lookup_plugins&vars_plugins：开发者中心的插件相关功能，开发者可以开发相应的插件，来实现自己想要的功能。分别对应的功能为：激活事件、回调、连接、过滤器、加载路径、任何地方加载")]),s._v(" "),n("li",[s._v("forks：最大开辟的进程数，这个数不易过大，过大性能耗费高，不易过小，过小的话，并发性能低，一般设置的方法是 cpu 核数*2")])]),s._v(" "),n("h3",{attrs:{id:"_2-3-python-自动化运维-ansible-教程-ansible-配置运行-2-09-54"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-python-自动化运维-ansible-教程-ansible-配置运行-2-09-54"}},[s._v("#")]),s._v(" 2-3 python 自动化运维-Ansible 教程-Ansible 配置运行 2 (09:54)")]),s._v(" "),n("ul",[n("li",[s._v("module_name：这个是/usr/bin/ansible 的默认模块名(-m).默认是'command'模块。之前提到过，command 模块不支持 shell 变量，管道，配额。所以也许你希望吧这个参数改为'shell'。")]),s._v(" "),n("li",[s._v("vault_password_file：这个文件也可以成为一个脚本的形式。如果你使用脚本而不是单纯文件的话，请确保它可以执行并且密码可以在不标准输出上打印出来。如果你的脚本需要提示请求数据，请求将会发到标准错误输出中。")]),s._v(" "),n("li",[s._v('pattern：如果没有 \b 提供"hosts"节点。这是 playbook 要通信的默认主机组。默认值是对所有主机通信，如果不想出事故，最好还是设置好这个选项。')]),s._v(" "),n("li",[s._v("inventory&library：分别为存放可通信主机的目录和 Ansible 默认搜寻模块路径。")])]),s._v(" "),n("p",[s._v("总结：")]),s._v(" "),n("ul",[n("li",[s._v("Ansible 安装")]),s._v(" "),n("li",[s._v("Ansible 运行流程")]),s._v(" "),n("li",[s._v("Ansible 配置详解")])]),s._v(" "),n("h3",{attrs:{id:"_2-4-python-自动化运维-ansible-使用教程-1-12-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-python-自动化运维-ansible-使用教程-1-12-10"}},[s._v("#")]),s._v(" 2-4 Python 自动化运维——Ansible 使用教程 1 (12:10)")]),s._v(" "),n("p",[s._v("课程目标：新手上路、学习 Ansible 基本模块、学习使用 Ansible Inventory、了解 Ansible Playbook")]),s._v(" "),n("h4",{attrs:{id:"如何添加一台机器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何添加一台机器"}},[s._v("#")]),s._v(" 如何添加一台机器？")]),s._v(" "),n("ol",[n("li",[s._v("编辑/etc/ansible/hosts # 没有就创建")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim /etc/ansible/hosts\n# 添加ip\n10.100.3.11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("添加本机的 pubilc SSH key 到目标机器的 authorized_keys")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim ~/.ssh/authorized_keys\n# 添加公钥\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("添加本机的私钥到 Ansible(这一步其实可以省略)")]),s._v(" "),n("li",[s._v("运行 ansible all -m ping 测试是否添加成功(返回'ping':pong)")])]),s._v(" "),n("h4",{attrs:{id:"ansible-命令格式-ansible-all-m-ping"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-命令格式-ansible-all-m-ping"}},[s._v("#")]),s._v(" Ansible 命令格式——ansible all -m ping")]),s._v(" "),n("ol",[n("li",[s._v("ansible 命令主体——ansible/ansible-palybook")]),s._v(" "),n("li",[s._v("被操作的目标 \b 机器的正则表达式——all")]),s._v(" "),n("li",[s._v("指定要使用的模块—— -m ping")]),s._v(" "),n("li",[s._v("传入的参数\n例子："),n("code",[s._v("ansible all -a 'ls' # 执行目标机子上的ls模块")])])]),s._v(" "),n("h4",{attrs:{id:"执行-ping-模块发生了什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行-ping-模块发生了什么"}},[s._v("#")]),s._v(" 执行 ping 模块发生了什么")]),s._v(" "),n("p",[n("code",[s._v("ansible all -m ping")]),s._v("：唤起 Ansible——>查询 hosts，获取指定的目标机器——>调用指定模块——>传入参数——>返回执行结果")]),s._v(" "),n("h4",{attrs:{id:"ansible-命令详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-命令详解"}},[s._v("#")]),s._v(" Ansible 命令详解")]),s._v(" "),n("p",[s._v("-a：指定传入模块的参数\n-C -D：两个一起使用，检查 hosts 规则文件的修改\n-l：限制匹配规则的主机数\n--list-hosts：显示所有匹配规则的主机数\n-m -M：指定所使用的模块和模块的路径\n--syntzx-check：检查语法\n-v：显示详细的日志")]),s._v(" "),n("h3",{attrs:{id:"_2-5-python-自动化运维-ansible-使用教程-2-14-58"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-python-自动化运维-ansible-使用教程-2-14-58"}},[s._v("#")]),s._v(" 2-5 Python 自动化运维——Ansible 使用教程 2 (14:58)")]),s._v(" "),n("p",[s._v("命令示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ansible all -a 'ls' -v\nansible all -a 'ls' --list-hosts\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"inventory-分组"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inventory-分组"}},[s._v("#")]),s._v(" Inventory(分组)")]),s._v(" "),n("p",[s._v("什么是 Inventory：Ansible 可同时操作属于一个组的多台主机，组和主机之间的关系通过 inventory 文件配置。默认的文件路径为/etc/ansible/hosts\n中文：库存\n作用：分组")]),s._v(" "),n("p",[s._v("一个简单的示例：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("one.example.com\n[webservers]\ntwo.example.com\nthree.example.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("方括号[]中是组名，一个主机可以属于不同的组，比如一台服务器可以同时属于 webserver 组和 vim 组，指定 webserver 或者 vim 组都可以操作这台主机。\n讲师演示：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim /etc/ansible/hosts\n# 添加一个test组\n10.100.3.11 # yy复制\n[test]\n10.100.3.11 # p粘贴\n# 保存后执行下面的命令\nansible test -a 'ls'    # 操作test组的主机,效果等同于ansible 10.100.3.11 -a 'ls'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"如何自定义连接端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何自定义连接端口"}},[s._v("#")]),s._v(" 如何自定义连接端口")]),s._v(" "),n("p",[s._v("在编写 hosts 文件时，在域名或 ip 地址后面，加上冒号和端口号，比如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("192.168.1.1:5000\none.example.com:6000\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"ip-域名太长了-起个别名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ip-域名太长了-起个别名"}},[s._v("#")]),s._v(" IP 域名太长了，起个别名")]),s._v(" "),n("p",[n("code",[s._v("sumper ansible_ssh_port=5555 ansible_ssh_host=192.168.1.50")])]),s._v(" "),n("h4",{attrs:{id:"不想以-root-用户登录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不想以-root-用户登录"}},[s._v("#")]),s._v(" 不想以 ROOT 用户登录")]),s._v(" "),n("p",[s._v("例如：jumper ansible_ssh_port=5555 ansible_ssh_host=192.168.1.50\nansible_ssh_user=papa")]),s._v(" "),n("h4",{attrs:{id:"机器太多-但是连续的-写起来好麻烦"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#机器太多-但是连续的-写起来好麻烦"}},[s._v("#")]),s._v(" 机器太多，但是连续的，写起来好麻烦")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[vim]\nvim[1:50].example.com # 等同于vim1.example.com vim2.example.com ...\nvim[a-f].example.com # 等同于vima.example.com vimb.example.com ...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"inventory-参数选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#inventory-参数选项"}},[s._v("#")]),s._v(" Inventory 参数选项")]),s._v(" "),n("p",[s._v("ansible_ssh_host\nansible_ssh_port\nansible_ssh_user\nansible_ssh_pass ssh 密码\nansible_sudo_pass sudo 密码\nansible_sudo_exe # sudo 命令路径\nansible_connection 与主机的连接类型。比如 local，ssh 或者 paramiko\nansible_ssh_private_key_file\nansible_shell_type 目标 \b 系统的 shell 类型\nansible_python_interpreter")]),s._v(" "),n("h4",{attrs:{id:"分文件-管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分文件-管理"}},[s._v("#")]),s._v(" 分文件 \b 管理")]),s._v(" "),n("p",[s._v("分文件——例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/etc/ansible/group_vars/vim\n/etc/ansible/group_vars/webservers\n/etc/ansible/host_vars/foosball\nvim文件中的内容大致长这样：\n    ---\n    ntp_server:acme.example.org\n    database_server:storage.example.org\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("此时文件名就是组名")]),s._v(" "),n("h4",{attrs:{id:"分文件夹-目录-管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分文件夹-目录-管理"}},[s._v("#")]),s._v(" 分文件夹(目录)管理")]),s._v(" "),n("p",[s._v("分文件——\b 例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/etc/ansible/group_vars/vim/install\n/etc/ansible/group_vars/vim/init\n/etc/ansible/host_vars/foosball\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("此时文件夹(目录)名就是组名")]),s._v(" "),n("h4",{attrs:{id:"patterns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patterns"}},[s._v("#")]),s._v(" Patterns")]),s._v(" "),n("p",[s._v("什么是 Patterns：在 Ansible 中，\bPatterns 是指我们通过类正则表达式的方式，决定与哪台主机进行交互。")]),s._v(" "),n("ol",[n("li",[s._v("所有 hosts 机器：all 或者型号(*)")]),s._v(" "),n("li",[s._v("通过域名或者 \bIP 指定一台特定的机器")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ansible one.example.com -m ping\nansible 192.168.1.2 -m ping\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[s._v("指定一组连续机器：ansible 192.168.1.* -m ping # 指定 192.168.1/24 段的所有机器")]),s._v(" "),n("li",[s._v("指定一组不相关的机器：ansible one.example.com:two.example.com -m ping # 指定 one two 两台机器")]),s._v(" "),n("li",[s._v("组也支持 \bPatterns：\n"),n("ul",[n("li",[s._v("Webservers——指定 Webservers 组")]),s._v(" "),n("li",[s._v("Webservers:Nginx——指定 Webservers 和 Nginx 两个组\n是也可以不是")]),s._v(" "),n("li",[s._v("webservers:!phonenix\b——指定在 webservers 组但不在 phonenix\b 组")]),s._v(" "),n("li",[s._v("webservers:&nginx——指定同时在 webserver 和 nginx 组")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-6-python-自动化运维-ansible-使用教程-3-13-11"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-python-自动化运维-ansible-使用教程-3-13-11"}},[s._v("#")]),s._v(" 2-6 Python 自动化运维——Ansible 使用教程 3 (13:11)")]),s._v(" "),n("p",[s._v("问题：webservers:nginx:&vim:!python:!mysql\n温馨提示 \b：匹配时从左到右依次匹配")]),s._v(" "),n("h4",{attrs:{id:"ad-hoc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ad-hoc"}},[s._v("#")]),s._v(" Ad-Hoc")]),s._v(" "),n("p",[s._v("什么是 Ad-Hoc")]),s._v(" "),n("ul",[n("li",[s._v("(这其实是一个概念性的名字,是相对于写 Ansible playbook 来说的.类似于在命令行敲入 shell 命令和写 shell scripts 两者之间的关系)...")]),s._v(" "),n("li",[s._v("如果我们敲入一些命令去比较快的完成一些事情，而不需要将这些执行的命令特别保存下来，这样的命令就叫做 ad-hoc 命令.")])]),s._v(" "),n("p",[n("code",[s._v('ansible atlanta -a "/sbin/reboot" -f 10')]),s._v("这个命令中,atlanta 是一个组，这个组里面有很多服务器，"),n("code",[s._v("/sbin/reboot")]),s._v("命令会在 atlanta 组下的所有机器上执行。这里 ssh-agent 会 fork 出 10 个子进程(bash)以并行的方式执行 reboot 命令。如前所说“每次重启 10 个”即是以这种方式实现。")]),s._v(" "),n("h4",{attrs:{id:"指定用户执行-shell-命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#指定用户执行-shell-命令"}},[s._v("#")]),s._v(" 指定用户执行 shell 命令")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible atlanta -a "/usr/bin/foo" -u username\n# 使用sudo：\nansible atlanta -a "/usr/bin/foo" -u username --sudo [--ask-sudo-pass]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"文件管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文件管理"}},[s._v("#")]),s._v(" 文件管理")]),s._v(" "),n("p",[s._v("创建文件夹：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible webservers -m file -a "dest=/path/to/c mode= 755 owner= mdehaan group=mdehaan state=directory"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("拷贝文件：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible atlanta -m copy -a "src=/etc/hosts dest=/tmp/hosts"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h4",{attrs:{id:"软件包管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#软件包管理"}},[s._v("#")]),s._v(" 软件包管理")]),s._v(" "),n("p",[s._v("确认一个软件包已经安装，但不去升级它:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible webservers -m yum -a "name= acme state=present"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("确认一个软件包的安装版本:")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible webservers -m yum -a "name= acme-1.5 state=present"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v('确认一个软件包还没有安装：ansible webservers -m yum -a "name=acme state=absent"')]),s._v(" "),n("h4",{attrs:{id:"其他模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他模块"}},[s._v("#")]),s._v(" 其他模块")]),s._v(" "),n("p",[s._v("\bgit 模块：git 相关\nservice 模块：系统服务\nsetup 模块：系统环境相关")]),s._v(" "),n("h4",{attrs:{id:"如何执行一个耗时任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何执行一个耗时任务"}},[s._v("#")]),s._v(" 如何执行一个耗时任务")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('ansible all -B 3600 -P 0 -a "/usr/bin/long_running_operation --\ndo-stuff"\n# -B 1800表示最多运行60分钟，-P 0表示不获取状态\nansible all -B 3600 -P 60 -a "/usr/bin/long_running_operation --do-stuff"\n# -B 1800表示最多运行60分钟，-P 60表示每隔一分钟获取一 次状态\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"playbook-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#playbook-简介"}},[s._v("#")]),s._v(" Playbook 简介")]),s._v(" "),n("ul",[n("li",[s._v("简单来说,playbooks 是一种简单的配置管理系统与多机器部署系统\n的基础.与现有的其他系统有不同之处，且非常适合于复杂应用的部署.")]),s._v(" "),n("li",[s._v("Playbooks 可用于声明配置,更强大的地方在于,在 playbooks 中可\n以编排有序的执行过程,甚至于做到在多组机器间，来回有序的执行特\n别指定的步骤.并且可以同步或异步的发起任务.")])]),s._v(" "),n("p",[s._v("课程总结：Ansible 简单实用方法、Inventory(分组)、Patterns、Ad-Hoc、Playbook 简单介绍")]),s._v(" "),n("h3",{attrs:{id:"_2-7-ansible-api-使用教程-1-13-53"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-ansible-api-使用教程-1-13-53"}},[s._v("#")]),s._v(" 2-7 Ansible-API 使用教程 1 (13:53)")]),s._v(" "),n("p",[s._v("课程目标：学习 Ansible API 的使用、学习编写自定义 Ansible Module、了解如何开发 Ansible Plugin")]),s._v(" "),n("h4",{attrs:{id:"ansible-api-提供了哪些功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-api-提供了哪些功能"}},[s._v("#")]),s._v(" Ansible API 提供了哪些功能")]),s._v(" "),n("ol",[n("li",[s._v("调用 Ansible 模块")]),s._v(" "),n("li",[s._v("开发动态的 Inventory 数据源")]),s._v(" "),n("li",[s._v("更好的控制 playbook 等功能的运行")])]),s._v(" "),n("h4",{attrs:{id:"如何调用-ansible-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何调用-ansible-模块"}},[s._v("#")]),s._v(" \b 如何调用 Ansible 模块")]),s._v(" "),n("ol",[n("li",[s._v("引入 Ansible runner 库")]),s._v(" "),n("li",[s._v("初始化 runner 对象，传入相关参数")]),s._v(" "),n("li",[s._v("运行 runner 对象的 run 函数\n\b 示例代码")])]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("runner\n\nrunner "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    module_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ping'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    module_args"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    pattern"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web*'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    forks"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndatastructure "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" runner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("是不是很简单？是不是运行不了？谁的错？——Ansible2.0 不适用以上代码")]),s._v(" "),n("h4",{attrs:{id:"如何调用-ansible2-0-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何调用-ansible2-0-api"}},[s._v("#")]),s._v(" 如何调用 Ansible2.0 API")]),s._v(" "),n("ol",[n("li",[s._v("定义一个结果对象")]),s._v(" "),n("li",[s._v("初始化 Ansible 节点对象")]),s._v(" "),n("li",[s._v("初始化结果对象")]),s._v(" "),n("li",[s._v("创建一个任务")]),s._v(" "),n("li",[s._v("运行 ansible 节点")])]),s._v(" "),n("p",[s._v("具体代码例子百度一下...")]),s._v(" "),n("h3",{attrs:{id:"_2-8-ansible-api-使用教程-2-15-00"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-8-ansible-api-使用教程-2-15-00"}},[s._v("#")]),s._v(" 2-8 Ansible-API 使用教程 2 (15:00)")]),s._v(" "),n("h4",{attrs:{id:"自定义-ansible-module"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-ansible-module"}},[s._v("#")]),s._v(" 自定义 Ansible Module")]),s._v(" "),n("p",[s._v("编写一个自定义 module")]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" json\n\n\ndate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" date\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("重点：print 出来的一定要是一个 json 字符串")]),s._v(" "),n("h4",{attrs:{id:"测试自己写的-module"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试自己写的-module"}},[s._v("#")]),s._v(" 测试自己写的 module")]),s._v(" "),n("p",[s._v("把 module 文件 test.py 放到 Ansible module 文件夹，运行 ansible one.example.com -m test")]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读入参数(1)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sys\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" json\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" shlex\n\n\nargs_file "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nargs_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\narguments "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" shlex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("split"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("args_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读入参数(2)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" arg "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    arg "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" arg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("split"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            rc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'date -s \"%s\"'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" rc "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"failed setting the time"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            date "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changed"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            sys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h4",{attrs:{id:"ansible-提供的插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-提供的插件"}},[s._v("#")]),s._v(" Ansible 提供的插件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Callback Plugins\nConnection Plugins\nLookup Plugins\nVars Plugins\nFilter Plugins\nTest Plugins\nDistributing Plugins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"自定义-ansible-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-ansible-plugin"}},[s._v("#")]),s._v(" 自定义 Ansible Plugin")]),s._v(" "),n("p",[s._v("导入 CallbackBase——>继承——>覆盖父类方法")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from ansible.plugins.callback import CallbackBase\nfrom ansible import constants as C\nclass CallbackModule(CallbackBase):\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("课程总结：Ansible API、Ansible Module、Ansible Plugin")]),s._v(" "),n("h2",{attrs:{id:"第-3-章-saltstack-教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-3-章-saltstack-教程"}},[s._v("#")]),s._v(" 第 3 章 saltstack 教程")]),s._v(" "),n("p",[s._v("本章主要讲解服务器管理工具 saltstack 使用以及 API 的使用")]),s._v(" "),n("h3",{attrs:{id:"_3-1-python-自动化运维-saltstack-介绍-09-01"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-python-自动化运维-saltstack-介绍-09-01"}},[s._v("#")]),s._v(" 3-1 Python 自动化运维-Saltstack 介绍 (09:01)")]),s._v(" "),n("h4",{attrs:{id:"课程目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("了解 SaltStack 是什么")]),s._v(" "),n("li",[s._v("了解 SaltStack 服务架构")]),s._v(" "),n("li",[s._v("了解 SaltStack 的优缺点")]),s._v(" "),n("li",[s._v("了解 ZeroMQ")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-概念"}},[s._v("#")]),s._v(" SaltStack 概念")]),s._v(" "),n("ol",[n("li",[s._v("一个配置管理系统，能够维护预定义状态的远程节点(这一点和 ansible 差不多)")]),s._v(" "),n("li",[s._v("一个分布式远程执行系统，用来在远程节点上执行命令和查询数据(由于 ansible 是基于 ssh 的，所以分布式方面 ansible 差一点)")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-特点"}},[s._v("#")]),s._v(" SaltStack 特点")]),s._v(" "),n("ol",[n("li",[s._v("简单(相对于 Puppet，比 ansible 复杂点)")]),s._v(" "),n("li",[s._v("并行执行")]),s._v(" "),n("li",[s._v("基于成熟技术(ZeroMQ、AES)")]),s._v(" "),n("li",[s._v("有 Python API")]),s._v(" "),n("li",[s._v("灵活、开放(有开源版和商用版)")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-服务架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-服务架构"}},[s._v("#")]),s._v(" SaltStack 服务架构")]),s._v(" "),n("ol",[n("li",[s._v("Master——负责管理所有节点")]),s._v(" "),n("li",[s._v("Minion——节点服务")]),s._v(" "),n("li",[s._v("ZeroMQ——通信服务")]),s._v(" "),n("li",[s._v("AES——数据加密方法")])]),s._v(" "),n("p",[s._v("Master(ZeroMQ)——>AES——>Minion(ZeroMQ)")]),s._v(" "),n("h4",{attrs:{id:"saltstack-缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-缺点"}},[s._v("#")]),s._v(" SaltStack 缺点")]),s._v(" "),n("ol",[n("li",[s._v("需要单独安装客户端")]),s._v(" "),n("li",[s._v("安全隐患大(有些操作需要 root)")])]),s._v(" "),n("h4",{attrs:{id:"zeromq-简述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#zeromq-简述"}},[s._v("#")]),s._v(" ZeroMQ 简述")]),s._v(" "),n("p",[s._v("ZeroMQ 以嵌入式网络编程库的形式实现了一个并行开发框架，能够提供进程内、进程间、网络和广播方式的消息信道支持扇出、发布-订阅、任务分发、请求/响应等通信模式。")]),s._v(" "),n("h3",{attrs:{id:"_3-2-python-自动化运维-saltstack-安装配置运行-1-15-08"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-python-自动化运维-saltstack-安装配置运行-1-15-08"}},[s._v("#")]),s._v(" 3-2 Python 自动化运维-SaltStack 安装配置运行 1 (15:08)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-2"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("学会 SaltStack 安装")]),s._v(" "),n("li",[s._v("了解 SaltStack 的配置方法")]),s._v(" "),n("li",[s._v("运行 SaltStack")]),s._v(" "),n("li",[s._v("了解 SaltStack 配置项")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-安装"}},[s._v("#")]),s._v(" SaltStack 安装")]),s._v(" "),n("p",[s._v("依赖：")]),s._v(" "),n("ol",[n("li",[s._v("python2.6~python3.0")]),s._v(" "),n("li",[s._v("ZeroMQ or RAET")]),s._v(" "),n("li",[s._v("mako(可选)：一个可选的 Salt States 解析器")]),s._v(" "),n("li",[s._v("gcc(可选，源码安装时才需要)")])]),s._v(" "),n("p",[s._v("Mac OS 安装方法：\n方法一：brew install saltstack\n方法二：sudo port install salt\n方法三：sudo pip install salt\n建议按官网的来：https://repo.saltstack.com/#osx")]),s._v(" "),n("p",[s._v("Ubuntu 安装方法：https://repo.saltstack.com/#ubuntu\nCentOS 安装方法：https://repo.saltstack.com/#rhel")]),s._v(" "),n("p",[s._v("我在我的腾讯云 CentOS7 主机上的操作：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("sudo yum install https://repo.saltstack.com/yum/redhat/salt-repo-latest.el7.noarch.rpm -y\nsudo yum clean expire-cache\nsudo yum install salt-master -y\nsudo yum install salt-minion -y\n# 另外需要配置一下安全组，开放4505和4506端口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"saltstack-启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-启动"}},[s._v("#")]),s._v(" SaltStack 启动")]),s._v(" "),n("ol",[n("li",[s._v("运行 Master 节点")]),s._v(" "),n("li",[s._v("修改 Minion 节点配置，填入 Master 节点信息")]),s._v(" "),n("li",[s._v("启动 Minion")]),s._v(" "),n("li",[s._v("Master 节点添加 Minion")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-测试"}},[s._v("#")]),s._v(" SaltStack 测试")]),s._v(" "),n("ol",[n("li",[s._v("运行命令：salt minion-id test.ping")]),s._v(" "),n("li",[s._v("期望返回："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("minion-id：\n    True\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("p",[s._v("讲师的操作：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install -y salt-master # 提示已经安装过了\n# 启动master\n/etc/init.d/salt-master restart\n# 修改minion配置\nvim /etc/salt/minion\n    找到16行master: 127.0.0.1，修改成master主机的ip，讲师这里没改，就是本机\n    找到78行id，给这个minion起一个容易辨别的名称，讲师这里是mylocal\n\n# 查看有哪些机器请求到本机master\nsalt-key -L # 可以看到mylocal在Unaccepted Keys列表里\n# 选择接受mylocal\nsalt-key -a mylocal\n\n# 测试一下，这里讲师好像翻车了，反正我成功了\nsalt mylocal test.ping\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("我在我腾讯云的操作结果：")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{width:"500",src:t(908)}})]),s._v(" "),n("h4",{attrs:{id:"saltstack-masrer-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-masrer-配置"}},[s._v("#")]),s._v(" SaltStack Masrer 配置")]),s._v(" "),n("p",[s._v("通用配置项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("interface：监听的IPv4地址\nIPv6：监听的Ipv6的地址\nPUBLISH_PORT：与Minion通信的端口\nMASTER_ID：当前Master节点的ID\nUSER：启动Master服务的用户\nMAX_OPEN_FILES：每一个连接到Master的Minion，Master都会打开一个文件描述符，该选项定义打开的最大文件数。可能报错：Too many open files。\nWORKER_THREADS：最大工作线程数\nRET_PORT：获取Minion返回结果的端口\nPIDFILE：Master进程的pid文件\nROOT_DIR：Master运行的根目录\nCONF_FILE：Master配置文件路径\nPKI_DIR：pki验证秘钥存放路径\nMODULE_DIRS：salt模块搜索路径\nCACHEDIR：默认缓存路径\nKEEP_JOBS：旧的任务信息保留多少个小时\nGATHER_JOB_TIMEOUT：Minion获取任务超时时间\nTIMEOUT：Salt API、command执行的超时时间\nOUTPUT_FILE：SaltStack command输出文件\nCLI_SUMMARY：显示客户端的概要信息，目标的Minion数，返回的数目，没返回的数目\nMAX_MINIONS：最大管理的Minions\nTRANSPORT：通信模块，默认ZeroMQ\nTRANSPORT_OPTS：通信模块的参数\nMAX_EVENT_SIZE：最大的事件数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("安全配置项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("OPEN_MODE：开发模式，如果设置为true，则任何minion都能连上Master，无需验证\nAUTO_ACCEPT：接受所有客户端的公钥\nTOKEN_EXPIRE：Master新生成token的存活时间\nAUTOSIGN_TIMEOUT：如果Minion的keyid出现在pki_dir/minion_autosign/keyid中，Master会自动接受该Minion的链接，这个配置项，定义这个自动接受的持续时间，超时的时候要重新验证接受。\nAUTOSIGN_FILE：自动接受Minion keyid存放文件，可以看成是白名单\nAUTOREJECT_FILE：与AUTOSIGN_FILE相反，可以看出成黑名单\nPUBLISHER_ACL：对指定Minion可执行指定的命令，可以类比iptables的ACL\nPUBLISHER_ACL_BLACKLIST：与PUBLISHER_ACL相反\nEXTERNAL_AUTH：指定验证方法\nFILE_RECV：允许minion向master发送文件，这个设置有点危险\nFILE_RECV_MAX_SIZE：允许minion向master发送的最大文件(MB)\nROTATE_AES_KEY：轮换AES key\nMASTER_SIGN_PUBKEY：网络通信签名相关\nMASTER_SIGN_KEY_NAM：网络通信签名相关\nMASTER_PUBKEY_SIGNATURE：网络通信签名相关\nMASTER_USE_PUBKEY_SIGNATURE：网络通信签名相关\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"_3-3-python-自动化运维-saltstack-安装配置运行-2-15-13"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-python-自动化运维-saltstack-安装配置运行-2-15-13"}},[s._v("#")]),s._v(" 3-3 Python 自动化运维-SaltStack 安装配置运行 2 (15:13)")]),s._v(" "),n("p",[s._v("本节前半部分视频主要还是讲解 Master 配置项，都列在 3-2 节里了。")]),s._v(" "),n("h4",{attrs:{id:"saltstack-minion-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-minion-配置"}},[s._v("#")]),s._v(" Saltstack Minion 配置")]),s._v(" "),n("p",[s._v("通用配置项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("MASTER：master的hostname，可以是多个\nMASTER_TYPE：str——一对一；failover——容错的，这种情况下，master必须是多个，minion会逐个通信；func：动态生成的\nMAX_EVENT_SIZE：最多接受master推送过来的事件数目\nMASTER_FAILBACK：回滚，如果设置为true，此时master_type必须是failover\nMASTER_ALIVE_INTERVAL：心跳检测\nRANDOM_MASTER：如果master是多个，则随机选择一个\nMASTER_PORT：Master端口\nUSER：SaltStack启动用户\nSUDO_USER：可以获取sudo权限的用户\nID：Minion的ID，会出现的Master的连接Minion的列表中\nMASRER_TRIES：重连Master的次数\nAUTH_TRIES：auth重试次数\nAUTH_TIMEOUT：auth超时时间\nTCP_PUB_PORT：发布消息端口\nTCP_PULL_PORT：获取消息端口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("安全配置项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("OPEN_MODE：可以用来清理master key——先改为true，重启，再改为false，重启\nMASTER_FINGER：master指纹，用来验证master，在master宿主机上运行salt-key -F master获取\nVERIFY_MASTER_PUBKEY_SIGN：与master相对\nMASTER_SIGN_KEY_NAME：签名文件\nALWAYS_VERIFY_SIGNATURE：是否必须验证\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3-4-python-自动化编程-salt-使用教程-1-10-19"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-python-自动化编程-salt-使用教程-1-10-19"}},[s._v("#")]),s._v(" 3-4 python 自动化编程——salt 使用教程 1 (10:19)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-3"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("学会 SaltStack 的基本使用方法")]),s._v(" "),n("li",[s._v("了解 SaltStack 的命令行工具")]),s._v(" "),n("li",[s._v("了解 SaltStack 的远程执行命令")]),s._v(" "),n("li",[s._v("了解 SaltStack 的模块")])]),s._v(" "),n("h4",{attrs:{id:"配置一个测试环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置一个测试环境"}},[s._v("#")]),s._v(" 配置一个测试环境")]),s._v(" "),n("p",[s._v("Master 和 Minion 最好不要同一台机器")]),s._v(" "),n("ol",[n("li",[s._v("启动 Salt-Master")]),s._v(" "),n("li",[s._v("配置 Salt-Minion，指定 Master IP")]),s._v(" "),n("li",[s._v("启动 Salt-Minion")]),s._v(" "),n("li",[s._v("测试连通性："),n("code",[s._v("salt mylocal test.ping")])])]),s._v(" "),n("h4",{attrs:{id:"grains"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#grains"}},[s._v("#")]),s._v(" Grains")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("什么是 Grains")]),s._v(" "),n("ol",[n("li",[s._v("Grains 是 minion 启动的时候采集的系统静态，包括 CPU、操作系统、文件系统、硬盘等")]),s._v(" "),n("li",[s._v("显示所有 Grains 信息分类："),n("code",[s._v("salt '*' grains.ls")])]),s._v(" "),n("li",[s._v("显示所有静态信息："),n("code",[s._v("salt '*' grains.items")])])])]),s._v(" "),n("li",[n("p",[s._v("Grains 应用场景")]),s._v(" "),n("ol",[n("li",[s._v("获取系统信息")]),s._v(" "),n("li",[s._v("用于分类查找 minion")]),s._v(" "),n("li",[s._v("与其他模块结合完成更灵活的 minion 控制：比如 SLS")])])]),s._v(" "),n("li",[n("p",[s._v("自定义 Grains：以下三个优先级逐渐增加")]),s._v(" "),n("ol",[n("li",[s._v("/etc/salt/grains")]),s._v(" "),n("li",[s._v("/etc/salt.minion")]),s._v(" "),n("li",[s._v("_grains 目录自定义 grain，同步到 minions")])])])]),s._v(" "),n("h4",{attrs:{id:"pillar"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pillar"}},[s._v("#")]),s._v(" Pillar")]),s._v(" "),n("ul",[n("li",[s._v("什么是 Pillar\n"),n("ol",[n("li",[s._v("Pillar 跟 grains 类似，可以将 minion 数据通过 key/value 的格式进行存储")]),s._v(" "),n("li",[s._v("Pillar 使用独立的加密 session，所以 Pillar 可以用来传递敏感的数据，例如 ssh-key，加密证书等")])])])]),s._v(" "),n("h3",{attrs:{id:"_3-5-python-自动化编程-salt-使用教程-2-09-27"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-python-自动化编程-salt-使用教程-2-09-27"}},[s._v("#")]),s._v(" 3-5 python 自动化编程——salt 使用教程 2 (09:27)")]),s._v(" "),n("h4",{attrs:{id:"targeting-minions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#targeting-minions"}},[s._v("#")]),s._v(" Targeting Minions")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("什么是 Targeting Minions")]),s._v(" "),n("ol",[n("li",[s._v("为 salt 指定 minion 的方法(我自己感觉就像 ansible 挑选主机的 pattern)")]),s._v(" "),n("li",[s._v("例如："),n("code",[s._v("salt web1 apache.signal restart")])])])]),s._v(" "),n("li",[n("p",[s._v("Targeting With Grains")]),s._v(" "),n("ol",[n("li",[n("code",[s._v("salt -G 'os:CentOS' test.ping")])]),s._v(" "),n("li",[s._v("后去 Grains 数据的方法："),n("code",[s._v("salt '*' grains.items")])])])]),s._v(" "),n("li",[n("p",[s._v("Compound Targeting\n"),n("code",[s._v("salt -c 'G@os:Debian and webser* or E@db.*' test.ping")])]),s._v(" "),n("ol",[n("li",[s._v("G@指定了 grains")]),s._v(" "),n("li",[s._v("webser 指定了 ID 以 webser 开头的 minion")]),s._v(" "),n("li",[s._v("E@是以正则的方式指定 minion 的 ID")]),s._v(" "),n("li",[s._v("以上效果就是匹配操作系统为 Debian，id 以 webser 开头或符合 db.*的主机")])])])]),s._v(" "),n("h4",{attrs:{id:"node-group-targeting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-group-targeting"}},[s._v("#")]),s._v(" Node Group Targeting")]),s._v(" "),n("p",[s._v("在 salt-master 的配置文件汇总增加 nodegroups 配置项")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("group1: 'L@f.d.com,b.d.com,b.do.c or bl*.do.com'\ngroup2: 'G@os:D and f.n.com'\ngroup3: 'G@os:Dian and N@group1'\ngroup4:\n    - 'G@foo:bar'\n    - 'or'\n    - 'G@foo:baz'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"_3-6-python-自动化编程-salt-使用教程-3-16-25"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-python-自动化编程-salt-使用教程-3-16-25"}},[s._v("#")]),s._v(" 3-6 python 自动化编程——salt 使用教程 3 (16:25)")]),s._v(" "),n("h4",{attrs:{id:"salt-runners"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#salt-runners"}},[s._v("#")]),s._v(" Salt Runners")]),s._v(" "),n("ol",[n("li",[s._v("salt runnsers 是在 master 上运行命令的方法，区别于 salt execution model")]),s._v(" "),n("li",[s._v("salt runner 模块包括：\ncache：返回 minion 缓存数据\nddns：动态 DNS\nfileserver：salt fileserver 插件管理等等")])]),s._v(" "),n("h4",{attrs:{id:"自定义-salt-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义-salt-runner"}},[s._v("#")]),s._v(" 自定义 Salt Runner")]),s._v(" "),n("ol",[n("li",[s._v("添加一个目录到 salt-master 配置文件 run_dirs 配置项")]),s._v(" "),n("li",[s._v("创建该目录")]),s._v(" "),n("li",[s._v("添加 python 文件到该目录")])]),s._v(" "),n("p",[s._v("讲师演示：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vim /etc/salt/master\n    runner_dirs: ['/srv/salt/_runners']  # 318行\n\nvim /srv/salt/_runners/test.py\n    def test():\n        print 'Hello world'\n        return 'How do you do'  # 和ansible不同，不一定返回json字符串\n\nsalt-run test.test   # 文件名.方法名\nHello world   # 输出，字体颜色是白色\nHow do you do # 输出，字体颜色是黄色\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"remote-execution"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#remote-execution"}},[s._v("#")]),s._v(" Remote Execution")]),s._v(" "),n("p",[s._v("Target：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("salt '*.example.org' test.ping\nsalt -G 'os:Ubuntu' test.ping\nsalt -E 'virtmach[0-9]' test.ping\nsalt -E 'virtmach[0-9]' test.ping\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("Function：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("salt '*' sys.doc\nsalt '*' test.ping\nsalt '*' cmd.run 'uname -a' # 远程执行命令全靠这个cmd.run模块\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("Arguments：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("salt '*' cmd.exec_code python 'import sys;print sys.version' # 执行python代码\nsalt '*' pip.install salt timeout=5 upgrade=True\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"salt-commadn-line"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#salt-commadn-line"}},[s._v("#")]),s._v(" Salt Commadn Line")]),s._v(" "),n("p",[s._v("Salt：options")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("--version：打印salt版本号\n-h，--help：打印帮助信息\n-c，--config-dir：指定配置文件\n-t，--timeout：与minion通信配置文件\n-s，--static：打印返回信息格式\n--async：异步执行\n--hide-timeout：指定只打印可以连通的minion信息\n-b，--batch-size：分批执行\n-a，--auth：指定认证方式，ldap/pam\n-T，--make-token：和-a一起使用，生成一个token\n--return：指定returner模块\n-d，--doc，--document：打印文档模块信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("Salt：logging")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-l，--log-level：打印日志类型\n--log-file：日志输出文件\n--log-file-level：输出到文件的日志类型\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("Salt：target：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-E，--pcre：正则方法\n-l，--list：数组\n-G，--grain：以grains方法\n--grains-pcre：以正则方法匹配grains变量\n-N，--nodegroup：nodegroup方法\n-R，--range：指定一个范围，形如：%test\n-C，--compound：and or方法指定\n-I，--pillar：pillar方法\n-S，--ipcidr：子网掩码的方式\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"_3-7-python-自动化运维-saltstack-教程-saltstackapi-使用-1-06-55"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-python-自动化运维-saltstack-教程-saltstackapi-使用-1-06-55"}},[s._v("#")]),s._v(" 3-7 python 自动化运维-Saltstack 教程-SaltstackAPI 使用 1 (06:55)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-4"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("了解 SaltStack 自定义模块")]),s._v(" "),n("li",[s._v("了解 SaltStack HTTP API 使用")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-自定义模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-自定义模块"}},[s._v("#")]),s._v(" SaltStack 自定义模块")]),s._v(" "),n("ol",[n("li",[s._v("SaltStack 模块是指能被 salt 调用的 python 函数")]),s._v(" "),n("li",[s._v("默认模块路径："),n("code",[s._v("/srv/salt/_modules")]),s._v("，这个目录可能不存在，我在自己腾讯云 CentOS7 上新建了一个")]),s._v(" "),n("li",[s._v("调用方法："),n("code",[s._v("salt * 文件名.函数名")])]),s._v(" "),n("li",[s._v("支持 python 和 Cython，python 以.py，Cython 以.pyx")])]),s._v(" "),n("p",[s._v("写完模块后，要同步模块到 minion，下面任选一种：")]),s._v(" "),n("ol",[n("li",[n("code",[s._v("salt '*' state.apply")])]),s._v(" "),n("li",[n("code",[s._v("salt '*' saltutil.sync_modules")])]),s._v(" "),n("li",[n("code",[s._v("salt '*' altutil.sync_all")])])]),s._v(" "),n("h3",{attrs:{id:"_3-8-python-自动化运维-saltstack-教程-saltstackapi-使用-2-11-07"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-python-自动化运维-saltstack-教程-saltstackapi-使用-2-11-07"}},[s._v("#")]),s._v(" 3-8 python 自动化运维-Saltstack 教程-SaltstackAPI 使用 2 (11:07)")]),s._v(" "),n("h4",{attrs:{id:"自定义模块演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义模块演示"}},[s._v("#")]),s._v(" 自定义模块演示")]),s._v(" "),n("ol",[n("li",[s._v("编写一个自定义模块："),n("code",[s._v("vim /srv/salt/_modules/temp.py")])])]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"How do you do"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[s._v("同步："),n("code",[s._v("salt '*' saltutil.sync_modules")]),s._v("，会输出以下内容"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mylocal:\n    - modules.temp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[s._v("执行："),n("code",[s._v("salt '*' temp.test")]),s._v("，会输出以下内容："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("mylocal:\n    How do you do\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"调用-salt-module"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#调用-salt-module"}},[s._v("#")]),s._v(" 调用 Salt module")]),s._v(" "),n("ol",[n("li",[s._v("salt 提供了一个"),n("code",[s._v("dict __salt__")])]),s._v(" "),n("li",[s._v("调用 cmd.run 模块，则为"),n("code",[s._v("__salt__['cmd.run']")])]),s._v(" "),n("li",[s._v("想传参数 a，则为"),n("code",[s._v("__salt__['cmd.run']['a']")])])]),s._v(" "),n("h4",{attrs:{id:"virtual"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#virtual"}},[s._v("#")]),s._v(" "),n("code",[s._v("__virtual__")])]),s._v(" "),n("p",[s._v("可以给自定义模块取别名，这样就可以不通过文件名调用了(文件名调用会失效)。")]),s._v(" "),n("ol",[n("li",[s._v("string：该 string 为模块名")]),s._v(" "),n("li",[s._v("True：默认模块名")]),s._v(" "),n("li",[s._v("False：模块加载失败")]),s._v(" "),n("li",[s._v("False, error__str：加载失败并返回 error_str")])]),s._v(" "),n("p",[s._v("讲师例子："),n("code",[s._v("vim /srv/salt/_modules/test.py")])]),s._v(" "),n("div",{staticClass:"language-py line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-py"}},[n("code",[s._v("__virtualname__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__virtual__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主要是实现这个函数")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" __virtualname__\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello world, this is test custom modules'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("调用该模块："),n("code",[s._v("salt '*' hello.test")]),s._v("，原本的调用方式是"),n("code",[s._v("salt '*' test.test")])]),s._v(" "),n("h4",{attrs:{id:"saltstack-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-api"}},[s._v("#")]),s._v(" SaltStack API")]),s._v(" "),n("p",[s._v("salt 的 api 是单独的 python web 服务(框架是 cherry)，和 ansible 的 python sdk 完全不同。")]),s._v(" "),n("p",[s._v("配置：")]),s._v(" "),n("ol",[n("li",[s._v("安装 salt-api")]),s._v(" "),n("li",[s._v("添加调用 API 用户")]),s._v(" "),n("li",[s._v("生成加密证书")]),s._v(" "),n("li",[s._v("修改配置文件")])]),s._v(" "),n("h3",{attrs:{id:"_3-9-python-自动化运维-saltstack-教程-saltstackapi-使用-3-16-40"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-9-python-自动化运维-saltstack-教程-saltstackapi-使用-3-16-40"}},[s._v("#")]),s._v(" 3-9 python 自动化运维-Saltstack 教程-SaltstackAPI 使用 3 (16:40)")]),s._v(" "),n("h4",{attrs:{id:"saltstack-api-使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-api-使用"}},[s._v("#")]),s._v(" SaltStack API 使用")]),s._v(" "),n("p",[s._v("安装 salt-api 示例：CentOS")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1. yum install -y salt-api\n2. useradd -M test && passwd test\n3. salt-call --local tls.create_self_signed_cert   # 默认证书放到/etc/pki/tls/certs/localhost.crt\n4. vim /etc/salt/master # 配置文件示例在后面\n5. service salt-api restart # 很奇葩，命名是api，配置却从master读取\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("master 配置文件示例(追加到原配置文件结尾即可)：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("rest_cherrypy:\n    port: 8000\n    debug: True\n    ssl_crt: /etc/pki/tls/certs/localhost.crt\n    ssl_key: /etc/pki/tls/certs/localhost.key\nexternal_auth:\n    pam:    # 认证模式，pam指的是用Linux本身的用户认证模式，想要其他认证模式可以看官方文档\n        pingguo:    # Linux系统中真实存在的用户名\n            - .*    # 设置用户的权限，允许该用户操作哪些主机，*代表全部\n                - test.* # 允许操作的模块及方法\n                - cmd.*\n            - '@wheel'\n            - '@runner'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("登录获取 token：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -sSk https://localhost:8000/login \\\n    -H 'Accept: application/x-yaml' \\\n    -d username=pingguo \\\n    -d password=pingguo_pass \\\n    -d eauth=pam\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("拿到 token 之后就能调接口了：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("curl -sSk https://localhost:8000/ \\\n    -H 'Accept: application/x-yaml' \\\n    -H 'X-Auth-Token: xxxxxxxxxxxxxxxxxxxxxxx' \\\n    -d client=local \\\n    -d tgt='*' \\\n    -d fun=test.ping\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"saltstack-api-功能介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#saltstack-api-功能介绍"}},[s._v("#")]),s._v(" SaltStack API 功能介绍")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/minions：获取minion信息或执行命令\n/jobs：获取jobs相关信息(GET)\n/run：runner相关(POST)\n/events：获取events相关信息\n/ws：建立一个websocket，后去event相关信息\n/stats：获取API server相关信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h4",{attrs:{id:"salt-dashboard"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#salt-dashboard"}},[s._v("#")]),s._v(" salt dashboard")]),s._v(" "),n("p",[s._v("相比 ansible，salt 有免费的 web ui，自己百度谷歌搭一下就好")]),s._v(" "),n("h2",{attrs:{id:"第-4-章-nagios-教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-4-章-nagios-教程"}},[s._v("#")]),s._v(" 第 4 章 nagios 教程")]),s._v(" "),n("p",[s._v("本章主要讲解监控工具 nagios 的使用，监控方法。")]),s._v(" "),n("h3",{attrs:{id:"_4-1-python-自动化运维-nagios-介绍-x264-10-44"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-python-自动化运维-nagios-介绍-x264-10-44"}},[s._v("#")]),s._v(" 4-1 Python 自动化运维-Nagios 介绍_x264 (10:44)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-5"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("了解 Nagios 基本概念")]),s._v(" "),n("li",[s._v("Nagios 优缺点")]),s._v(" "),n("li",[s._v("Nagios 原理简介")])]),s._v(" "),n("h4",{attrs:{id:"nagios-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-是什么"}},[s._v("#")]),s._v(" Nagios 是什么")]),s._v(" "),n("p",[s._v("一款免费的开源 IT 基础设施监控系统，其功能强大、灵活性强，能有效监控 Windows、Linux、 VMware 和 Unix 主机状态，交换机、路由器等网络设置等。\n我的补充：nagios 和 zabbix 一样，是 php 写的")]),s._v(" "),n("p",[s._v("结构上分为两部分：核心功能，插件")]),s._v(" "),n("p",[s._v("特性：")]),s._v(" "),n("ol",[n("li",[s._v("监控网络服务")]),s._v(" "),n("li",[s._v("监控主机资源")]),s._v(" "),n("li",[s._v("主动通知")]),s._v(" "),n("li",[s._v("web 页面")]),s._v(" "),n("li",[s._v("可扩展")])]),s._v(" "),n("p",[s._v("Nagios 优点：")]),s._v(" "),n("ol",[n("li",[s._v("轻量级，架构简单")]),s._v(" "),n("li",[s._v("容易部署")]),s._v(" "),n("li",[s._v("文档健全")]),s._v(" "),n("li",[s._v("灵活、全面")])]),s._v(" "),n("p",[s._v("Nagios 缺点：")]),s._v(" "),n("ol",[n("li",[s._v("修改配置麻烦，web 页面上改不了")]),s._v(" "),n("li",[s._v("太灵活，学习成本高")]),s._v(" "),n("li",[s._v("监控报警缺乏历史数据")]),s._v(" "),n("li",[s._v("严重依赖外部插件")])]),s._v(" "),n("h5",{attrs:{id:"nagios-原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-原理"}},[s._v("#")]),s._v(" Nagios 原理")]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{width:"500",src:t(909)}})]),s._v(" "),n("ol",[n("li",[s._v("Nagios 执行安装在它里面的 check_nrpe 插件，并告诉 check_nrpe 去检测哪些服务。")]),s._v(" "),n("li",[s._v("通过 SSL，check_nrpe 连接远端机子上的 NRPE daemon")]),s._v(" "),n("li",[s._v("NRPE 运行本地的各种插件去检测本地的服务和状态(check_disk,...etc)")]),s._v(" "),n("li",[s._v("最后，NRPE 把检测的结果传给主机端的 check_nrpe，cherk_nrpe 再把结果送到 Nagios 状态队列中")]),s._v(" "),n("li",[s._v("Nagios 依次读取队列中的信息，再把结果显示出来")])]),s._v(" "),n("h3",{attrs:{id:"_4-2-python-自动化运维-nagios-配置-x264-23-56"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-python-自动化运维-nagios-配置-x264-23-56"}},[s._v("#")]),s._v(" 4-2 python 自动化运维——nagios 配置_x264 (23:56)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-6"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-6"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("理解 nagios 的主要配置项")]),s._v(" "),n("li",[s._v("了解 nagios 的对象")])]),s._v(" "),n("h4",{attrs:{id:"nagios-安装和配置讲解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-安装和配置讲解"}},[s._v("#")]),s._v(" Nagios 安装和配置讲解")]),s._v(" "),n("ol",[n("li",[s._v("centos：yum install nagios-devel -y")]),s._v(" "),n("li",[s._v("ubuntu：sudo apit-get install apache2 nagios3 nagios-nrpe-plugin")])]),s._v(" "),n("p",[s._v("讲师操作：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install nagios-devel -y\nls /etc/init.d/nagios\nls /etc/nagios/ # 列出nagios的配置文件，输出如下：\n    .\n    |-- cgi.cfg # 控制cgi访问的配置文件\n    |-- nagios.cfg  # nagios主配置文件\n    |-- objects # 这个目录下有多个配置文件，用于定义nagios对象\n    |   |-- commands.cfg    # 定义命令的配置文件，可以被其他文件引用\n    |   |-- contacts.cfg    # 定义联系人和联系人组\n    |   |-- localhost.cfg   # 定义监控本机的配置文件，也可以监控其他机器\n    |   |-- printer.cfg     # 定义监控打印机配置文件，默认不启用\n    |   |-- switch.cfg      # 监控路由器的配置文件，默认不启用\n    |   |-- templates.cfg   # 模板配置文件\n    |   |-- timeperiods.cfg # 定义监控时间段的配置文件\n    |   `-- windows.cfg     # 监控windows主机的一个配置文件模板，默认不启用\n    |-- passwd\n    `-- private\n        `-- resource.cfg    # 资源文件，在此文件中定义的变量可以在其他配置文件中引用\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h4",{attrs:{id:"nagios-主配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-主配置文件"}},[s._v("#")]),s._v(" Nagios 主配置文件")]),s._v(" "),n("p",[n("strong",[s._v("对象配置文件模块")]),s._v("：")]),s._v(" "),n("ol",[n("li",[s._v("定义主机、主机组、联系人、联系人组、服务等")]),s._v(" "),n("li",[s._v("cfg_file 指明的配置文件分开定义")]),s._v(" "),n("li",[s._v("Nagios 将会读取并且处理所有这些配置文件")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#cfg_file=/etc/nagios/timeperiods.cfg\n#cfg_dir=/etc/nagios/servers\n#cfg_dir=/etc/nagios/printers\n#cfg_dir=/etc/nagios/switchs\n#cfg_dir=/etc/nagios/routers\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("对象缓存文件")]),s._v("：\n这些选项将决定当 Nagios 启动时或重启时，对象定义将被缓存在什么地方。CGI 将从这个对象文件中读取对象的定义，而不是在之前的对象配置文件路径中去找。这样做是为了避免修改 Nagios 配置文件后引起的不一致问题。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("object_cache_file=/var/log/nagios/objects.cache\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("状态文件")]),s._v("：\n这个文件将保存着目前检测到的服务和主机数据信息。这个文件当中的内容是被 CGI 读取并处理的，而它也是在每次 Nagios 重新启动的时候被删除清空的。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("status_file=/var/log/nagios/status.dat\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("Nagios 进程运行用户和用户组")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("nagios_user=nagios\nnagios_group=nagios\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("外部命令行")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("check_exterbal_commands=1：设置Nagios是否对外部命令进行检查，因为有些命令是非常危险的，开启这个选项也可能导致某些字符被转义\ncommand_check_intervals=15：外部命令检测时间间隔\ncommand_file=/var/log/nagios/rw/nagios.cmd：这是Nagios用来检查外部命令请求的文件。这个文件同样也是用户操作提交与CGI命令写入的地方\nexternal_command_buffer_slots=4096：外部命令缓冲\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("运行文件")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("downtime_file=/var/log/nagios/downtime.dat：这是Nagios用来记录主机和服务故障停机时间数据的文件。\nlock_file=/var/run/nagios.pid：设定Nagios的PID文件。\ntemp_file=/var/log/nagios/nagios.tmp：设定临时文件的路径。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("日志")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("log_file：设定Nagios的主日志文件路径\nlog_rotation_method：写主日志记录时的循环记录方式\nlog_archive_path：设定日志归档路径\nuse_syslog：默认设定Nagio信息加入系统日志\nlog_botifications：默认设定Nagios的通知信息是记录的\nlog_service_retries：默认设定记录服务重启信息\nlog_host_retries：默认设定记录主机重启信息\nlog_event_handlers：默认启用记录时间处理程序信息\nlog_initial_states：默认不记录初始化状态信息\nlog_external_commands：默认设定记录外部命令信息\nlog_passive_checks：默认设定记录被动检查信息\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("主服务间内部检查之间延时的方式")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("service_inter_check_delay_method：默认设定服务间检查间隔采用smart算法。\n值n表示none，不做任何任何延迟。\n值d表示dump，表示在两个相邻的检查之间做1秒钟的延迟。\n值s表示smart，表示默认精简方式安排延迟。\n值x.xx表示手动定制每相邻的检查之间固定的x.xx秒延迟。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_4-3-python-自动化运维-nagios-安装使用-1-10-57"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-python-自动化运维-nagios-安装使用-1-10-57"}},[s._v("#")]),s._v(" 4-3 python 自动化运维-nagios 安装使用 1 (10:57)")]),s._v(" "),n("p",[s._v("合并到下一节")]),s._v(" "),n("h3",{attrs:{id:"_4-4-python-自动化运维-nagios-安装使用-2-17-37"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-python-自动化运维-nagios-安装使用-2-17-37"}},[s._v("#")]),s._v(" 4-4 python 自动化运维-nagios 安装使用 2 (17:37)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-7"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-7"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("搭建 Nagios 测试环境")]),s._v(" "),n("li",[s._v("了解 Nagios 监控的使用")]),s._v(" "),n("li",[s._v("学习 Nagios 插件的使用")])]),s._v(" "),n("h4",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("p",[s._v("我的腾讯云 CentOS 执行"),n("code",[s._v("yum install nagios-devel -y")]),s._v("就成了")]),s._v(" "),n("h4",{attrs:{id:"nagios-配置-web-页面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-配置-web-页面"}},[s._v("#")]),s._v(" Nagios 配置 web 页面")]),s._v(" "),n("ol",[n("li",[s._v("安装 web server(nginx/apache 等)"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yum install -y nginx\n或者\nyum install -y httpd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[s._v("配置 web server 到 nagios")]),s._v(" "),n("li",[s._v("启动 php-fpm，perl-fcgi")]),s._v(" "),n("li",[s._v("启动 web server")])]),s._v(" "),n("h4",{attrs:{id:"nagios-添加一个监控主机"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-添加一个监控主机"}},[s._v("#")]),s._v(" Nagios 添加一个监控主机")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("编辑/etc/nagios/objects/contacts.cfg，增加报警联系人信息")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 定义一个联系人\ndefine contact {\n    contact_name            nagiosadmin\n    use                     generic-contact\n    alias                   Nagios Admin\n    email                   nagios@localhost\n}\n\n# 定义联系人组\ndefine contactgroup {\n    contactgroup_name       admins\n    alias                   Nagios Administrators\n    members                 nagiosadmin,nagiosadmin2\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("编辑/etc/nagios/objects/templates.cfg，增加报警策略信息")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("define host {\n    name                            linux-server\n    use                             generic-host\n    check_period                    24x7   ; 检查时间\n    check_interval                  5      ; 检查的时间间隔\n    retry_interval                  1\n    max_check_attempts              10\n    check_command                   check-host-alive  #  这个定义在commands.cfg里\n    notification_period             workhours  ; 通知时间，这个定义在timeperiods.cfg里\n    notification_interval           120     # 通知间隔\n    notification_options            d,u,r  ; 这个定义在templates.cfg里\n    contact_groups                  admins\n    register                        0\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("编辑/etc/nagios/objects/localhost.cfg，增加被监控主机信息")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 被监控主机\ndefine host {\n    use                     linux-server\n    host_name               localhost\n    alias                   localhost\n    address                 127.0.0.1\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])]),s._v(" "),n("h4",{attrs:{id:"nagios-检测配置文件是否正确"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-检测配置文件是否正确"}},[s._v("#")]),s._v(" Nagios 检测配置文件是否正确")]),s._v(" "),n("ol",[n("li",[s._v("配置文件有错误时，启动会报错：Running configuration check... CONFIG ERROR！Restart aborted.Check your Nagios configuration")]),s._v(" "),n("li",[s._v("检测配置文件：nagios -v /etc/nagios/nagios.cfg")])]),s._v(" "),n("h4",{attrs:{id:"nagios-客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-客户端"}},[s._v("#")]),s._v(" Nagios 客户端")]),s._v(" "),n("ol",[n("li",[s._v("在被监控的机器上安装 nagios：yum install nagios")]),s._v(" "),n("li",[s._v("启动：/etc/init.d/nagios start")]),s._v(" "),n("li",[s._v("在被监控的机器上安装 nrpe：yum install nrpe")]),s._v(" "),n("li",[s._v("启动 nrpe：/etc/init.d/nrpe start")]),s._v(" "),n("li",[s._v("修改/etc/nagios/cgi.cfg 配置文件里的 use_authentication 为 0")]),s._v(" "),n("li",[s._v("重启 nagios：/etc/init.d/nagios restart")])]),s._v(" "),n("h4",{attrs:{id:"nagios-图形化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-图形化"}},[s._v("#")]),s._v(" Nagios 图形化")]),s._v(" "),n("ol",[n("li",[s._v("nagiosQL：图形化配置管理工具")]),s._v(" "),n("li",[s._v("pnp4ngios：监控信息图表工具")]),s._v(" "),n("li",[s._v("nagiosgraph：监控信息图标工具")])]),s._v(" "),n("h4",{attrs:{id:"nagios-插件下载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-插件下载"}},[s._v("#")]),s._v(" Nagios 插件下载")]),s._v(" "),n("p",[s._v("官方：https://exchange.nagios.org\n第三方：https://www.monitoringexchange.org")]),s._v(" "),n("h4",{attrs:{id:"nagios-插件使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nagios-插件使用"}},[s._v("#")]),s._v(" Nagios 插件使用")]),s._v(" "),n("ol",{attrs:{start:"0"}},[n("li",[s._v("将插件下载到本地")]),s._v(" "),n("li",[s._v("编辑 command.cfg，增加一个 command")]),s._v(" "),n("li",[s._v("在 localhosts.cfg 文件中使用这个 command")])]),s._v(" "),n("h2",{attrs:{id:"第-5-章-buildbot-教程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第-5-章-buildbot-教程"}},[s._v("#")]),s._v(" 第 5 章 buildbot 教程")]),s._v(" "),n("p",[s._v("本章主要自动化部署工具 buildbot 的使用、部署的方法。\nPS：常用的持续集成工具是 Jenkins，这个 buildbot 是 python 实现的持续集成工具。")]),s._v(" "),n("h3",{attrs:{id:"_5-1-python-自动化运维-buildbot-简介-x264-12-36"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-python-自动化运维-buildbot-简介-x264-12-36"}},[s._v("#")]),s._v(" 5-1 python 自动化运维——buildbot 简介_x264 (12:36)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-8"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-8"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("了解 Buildbot")]),s._v(" "),n("li",[s._v("Buildbot 架构")]),s._v(" "),n("li",[s._v("Buildbot 优缺点")])]),s._v(" "),n("h4",{attrs:{id:"buildbot-是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-是什么"}},[s._v("#")]),s._v(" Buildbot 是什么")]),s._v(" "),n("p",[s._v("Buildbot 是一个开源框架，可以自动化构建、测试和发布代码等过程。每当代码有改变，服务器要求不同平台上的客户端立即进行代码构建和测试，收集并报告不同平台的构建和测试结果。")]),s._v(" "),n("h4",{attrs:{id:"buildbot-功能模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-功能模块"}},[s._v("#")]),s._v(" Buildbot 功能模块")]),s._v(" "),n("ol",[n("li",[s._v("Repository：代码管理库")]),s._v(" "),n("li",[s._v("Buildmaster：决策中心")]),s._v(" "),n("li",[s._v("BuildSlave：执行模块")]),s._v(" "),n("li",[s._v("Notifiers：消息通知")])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{width:"500",src:t(910)}})]),s._v(" "),n("h4",{attrs:{id:"buildbot-通讯方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-通讯方式"}},[s._v("#")]),s._v(" Buildbot 通讯方式")]),s._v(" "),n("ol",[n("li",[s._v("BuildSlave 运行在需要测试的机器")]),s._v(" "),n("li",[s._v("TCP 通信，由 BuildSlave 主动发起")]),s._v(" "),n("li",[s._v("命令都只能由 BuildMaster 下发到 BuildSlave")]),s._v(" "),n("li",[s._v("BuildSlave 从 Repository 获取集成代码")])]),s._v(" "),n("h4",{attrs:{id:"buildbot-优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-优点"}},[s._v("#")]),s._v(" Buildbot 优点")]),s._v(" "),n("ol",[n("li",[s._v("跨平台")]),s._v(" "),n("li",[s._v("跨语言")]),s._v(" "),n("li",[s._v("环境依赖低")]),s._v(" "),n("li",[s._v("多样化通知")]),s._v(" "),n("li",[s._v("配置灵活")]),s._v(" "),n("li",[s._v("分布式")])]),s._v(" "),n("h4",{attrs:{id:"buildbot-缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-缺点"}},[s._v("#")]),s._v(" Buildbot 缺点")]),s._v(" "),n("ol",[n("li",[s._v("界面丑陋(有个 google 增强版，会好一点)")]),s._v(" "),n("li",[s._v("文档缺乏，国内主要是 jenkins")]),s._v(" "),n("li",[s._v("插件缺乏(jenkins 插件库非常丰富)")]),s._v(" "),n("li",[s._v("学习成本高")])]),s._v(" "),n("h4",{attrs:{id:"buildbot-前景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-前景"}},[s._v("#")]),s._v(" Buildbot 前景")]),s._v(" "),n("p",[s._v("google、firefox")]),s._v(" "),n("h3",{attrs:{id:"_5-2-buildbot-安装配置-1-17-21"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-buildbot-安装配置-1-17-21"}},[s._v("#")]),s._v(" 5-2 buildbot 安装配置(1) (17:21)")]),s._v(" "),n("h4",{attrs:{id:"课程目标-9"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#课程目标-9"}},[s._v("#")]),s._v(" 课程目标")]),s._v(" "),n("ol",[n("li",[s._v("安装 Buildbot")]),s._v(" "),n("li",[s._v("了解 Buildbot 配置文件")])]),s._v(" "),n("h4",{attrs:{id:"buildbot-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-安装"}},[s._v("#")]),s._v(" Buildbot 安装")]),s._v(" "),n("ol",[n("li",[s._v("安装 Master："),n("code",[s._v("pip install buildbot")])]),s._v(" "),n("li",[s._v("安装 Worker："),n("code",[s._v("pip install buildbot-worker")])])]),s._v(" "),n("h4",{attrs:{id:"buildbot-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-配置文件"}},[s._v("#")]),s._v(" Buildbot 配置文件")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("创建 master 节点：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("1. buildbot create-master master(名称)\n2. master目录下：master.cfg.sample\n3. mv master.cfg.sample master.cfg\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("Buildbot 配置项：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("数据库：c['db_url']\n    1. sqlite:///state.sqlite\n    2. mysql://user/pass@host/data?max_idle=30\n    3. postgresql://username@host/dbname\n\n多Master功能配置项MQ：\n    c['mq']={'type':'sample','debug':False}\n    c['mq']={\n        'type':'wamp',\n        'router_url':'ws://url/to/crossbar',\n        'realm':'buildbot',\n        'debug':False,\n        'debug_websockets':False,\n        'debug_lowlevel':'False',\n    }\n\n多个主进程，通过database共享数据：\n    c['multiMaster'] = True\n\nweb网页设置：\n    c['title']='Buildbot'\n    c['titleUrl']='http://example.com'\n\n日志处理：\n    c['logCompressionLimit'] = 16384\n    c['logCompressionMethod'] = 'gz'\n    c['logMaxSize'] = 1024*1024 # 1M\n    c['logMaxTailSize'] = 32768\n    c['logEncoding'] = 'utf-8'\n\n数据存活时间：\n    c['changeHorizon'] = 200 # 最小变化次数\n    c['buildHorizon'] = 100 # builder最新build次数\n    c[logHorizon] = 40 # 日志包含最小build次数\n    c['buildCacheSzie'] = 15\n\n缓存：\n    c['caches'] = {\n        'Changes': 100, # 缓存变化的对象数据\n        'Builds': 500, # 缓存builds数目\n        'chdicts': 100, # changes缓存的行数\n        'BuildRequests': 10, # 缓存BuildRequest数目\n        'SourceStamps': 20, # SouceStamp对象缓存数目\n        'ssdict': 20, # sourcetamp缓存行数\n        'objectids': 10, # object ID缓存的个数\n        'usdicts': 100 # user表缓存行数\n    }\n\n合并Builds请求：\n    c['collapseRequests'] = True\n优先级：\n    def prioritizeBuilders(buildmaster, builders):\n        ...\n    c['prioritizeBuilders'] = prioritizeBuilders\n\n设置Worker的PB端口：\n    c['protocols'] = {\n        'pb':{'port':'tcp:10:interface=127.0.0.1'}\n    }\n    PB监听TCP端口发送通知给master\n\n用户配置：\n    from buildbot.plugins import util\n    c['user_managers'] = []\n    c['user_managers'].append(util.CommandlineUserManager(username=\"user\",passwd=\"userpw\",port=9990)) # 和PB端口不能一致\n\n参数过滤：\n    import re\n    c['validation]={\n        'branch': re.compile(r'^[\\w.+/~-]*$'),\n        'revision': re.compile(r'^[\\w\\.\\-\\/]*$'),\n        'property_name': re.compile(r'^[\\w\\.\\-\\/\\~:]*$'),\n        'property_value': re.compiler(r'^[\\w\\.\\-\\/\\~:]*$')\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br")])])])]),s._v(" "),n("div",{attrs:{align:"center"}},[n("img",{attrs:{width:"500",src:t(911)}})]),s._v(" "),n("h4",{attrs:{id:"buildbot-worker-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#buildbot-worker-配置"}},[s._v("#")]),s._v(" Buildbot Worker 配置")]),s._v(" "),n("p",[s._v("定义一个 Workder：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from buildbot.plugins import worker\nc['workers'] = [\n    worker.Worker('user', 'password'),\n    worker.Worker('bot-bsd', 'dksjfds')\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("自定义 Worker 属性：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("c['workers'] = [\n    worker.Worker('bot', 'solari', properties={'os':'solaris'})\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("定义同时执行 build 数目：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('c[\'workers\'] = [\n    worker.Worker("bot-linux", "linuxpassword", max_builds=2)\n]\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("Keepalive：worker 向 master 定时发送心跳")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("c['workers'] = [\n    worker.Worker('bot-linux', 'linuxpassword', keepalive_interval=3600)\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("Worker 下线通知：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("c['workers'] = [\n    worker.Worker('bot', 'solarispasswd', notify_on_missing=[\"b@test.com\",],missing_timeout=300)\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("master 本机 worker 配置：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("from buildbot.plugins import worker\n\nc['workers'] = [\n    worker.LocalWorker('bot1'),\n    worker.LocalWorker('bot2')\n]\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("这课程没有后续了？？？")])])}),[],!1,null,null,null);a.default=e.exports},908:function(s,a,t){s.exports=t.p+"assets/img/3-2我的腾讯云test操作结果.3d24b598.jpg"},909:function(s,a,t){s.exports=t.p+"assets/img/4-1Nagios原理.84fce7e7.jpg"},910:function(s,a,t){s.exports=t.p+"assets/img/5-1Buildbot功能模块.6da045b0.jpg"},911:function(s,a,t){s.exports=t.p+"assets/img/5-2几种压缩算法比较.accb559b.jpg"}}]);