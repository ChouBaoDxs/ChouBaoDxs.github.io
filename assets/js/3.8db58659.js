(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{1002:function(s,a,n){"use strict";n.r(a);var e=n(12),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"title"}),e("p",[s._v("视频地址：https://www.bilibili.com/av25424954\n视频名称：【Ansible 自动化】7 小时带领你使用 Ansible 自动化一切操作\nup 的资源：")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("简书-Ansible 使用系列文章(超全)")]),s._v("：https://www.jianshu.com/p/c56a88b103f8")]),s._v(" "),e("li",[e("strong",[s._v("简书-Ansible 开发系列文章")]),s._v("：https://www.jianshu.com/p/667dabe96f04\n"),e("ul",[e("li",[s._v("模块、插件开发")]),s._v(" "),e("li",[s._v("python 调用 ansible api")]),s._v(" "),e("li",[s._v("动态主机等")])])]),s._v(" "),e("li",[e("strong",[s._v("up 主的 ansible-dev 仓库")]),s._v("：https://github.com/lework/Ansible-dev")]),s._v(" "),e("li",[e("strong",[s._v("up 主的 roles 仓库")]),s._v("：https://github.com/lework/Ansible-roles")])]),s._v(" "),e("p",[s._v("我的评价：★★★★★\n我的随堂源码：https://github.com/ChouBaoDxs/MyResources/code/运维/Ansible/【Ansible自动化】7小时带领你使用Ansible自动化一切操作")])]),s._v(" "),e("p",[s._v("[TOC]")]),s._v(" "),e("h2",{attrs:{id:"_01-ansible-介绍和安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_01-ansible-介绍和安装"}},[s._v("#")]),s._v(" 01.ansible 介绍和安装")]),s._v(" "),e("h3",{attrs:{id:"课程内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#课程内容"}},[s._v("#")]),s._v(" 课程内容")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Ansible介绍\nAnsible安装\nAnsible配置\nAnsible主机清单\nAnsible Patterns匹配\nAnsible Ad-hoc命令\nAnsible Playbook介绍\nYaml语法\nJinja2模板语法\nAnsible Playbook包含和角色\nAnsible变量\nAnsible facts\nAnsible Playbook条件判断和循环\nAnsible Playbook Block分组\nAnsible Playbook 高级功能\nAnsible Playbook 关键字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"ansible-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-介绍"}},[s._v("#")]),s._v(" Ansible 介绍")]),s._v(" "),e("ul",[e("li",[s._v("Ansible 是 2013 年推出的一种通用自动化工具，可用于配置管理或工作流自动化。")]),s._v(" "),e("li",[s._v("在 2015 年被 Redhat 公司收购。")]),s._v(" "),e("li",[s._v("使用 python 编程，通过 ssh 在不同机器上执行命令。")]),s._v(" "),e("li",[s._v('使用声明式 YML"playbook"将一组主机(从"hosts")映射到定义明确的角色。声明性用于指示 Ansible 如何设置或更改事物，Ansible 才进行必要的更改。')]),s._v(" "),e("li",[s._v("为每个人做自动化")]),s._v(" "),e("li",[s._v("Ansible 使用范围：\n"),e("ul",[e("li",[s._v("自动化部署应用")]),s._v(" "),e("li",[s._v("自动化管理配置")]),s._v(" "),e("li",[s._v("自动化持续交付")]),s._v(" "),e("li",[s._v("自动化云服务管理")]),s._v(" "),e("li",[s._v("自动化网络设备管理")])])]),s._v(" "),e("li",[s._v("18 年社区活跃：releases 210+，modules 1600+...")])]),s._v(" "),e("h3",{attrs:{id:"ansible-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-项目"}},[s._v("#")]),s._v(" Ansible 项目")]),s._v(" "),e("ul",[e("li",[s._v("Ansible Galaxy：用于查找、共享，使用 Ansible role 的在线社区(想要装什么东西，别人基本都写过了，直接拿来用)")]),s._v(" "),e("li",[s._v("Ansible Container：一个开源项目，旨在实现整个容器构建，部署和管理过程的自动化")]),s._v(" "),e("li",[s._v("Ansible Tower：官方商业项目，使用可视化仪表盘，基于角色的访问控制，作业调度，集成通知和图形库存来集中和控制 IT 基础架构")])]),s._v(" "),e("h3",{attrs:{id:"ansible-如何工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-如何工作"}},[s._v("#")]),s._v(" Ansible 如何工作")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(813)}})]),s._v(" "),e("h3",{attrs:{id:"ansible-节点要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-节点要求"}},[s._v("#")]),s._v(" Ansible 节点要求")]),s._v(" "),e("ul",[e("li",[s._v("对管理主机的要求\n目前,只要机器上安装了 Python 2 (版本 2.6 或 2.7)或 Python 3 (版本 3.5 及更高版本)都可以运行 Ansible(windows 系统不可以做管理主机)\n管理主机的系统可以是 Red Hat, Debian, CentOS, OS X, BSD 的各种版本.")]),s._v(" "),e("li",[s._v("对节点主机的要求\n通常我们使用 ssh 与节点通信,默认使用 sftp 方式.如果 sftp 不可用，可在 ansible.cfg 配置文件中配置成 scp 的方式。在节点上也需要安装 Python2(2.6 或更高版本)或 Python3(3.5 或更高版本)")])]),s._v(" "),e("h3",{attrs:{id:"ansible-与其它配置管理的对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-与其它配置管理的对比"}},[s._v("#")]),s._v(" Ansible 与其它配置管理的对比")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(814)}})]),s._v(" "),e("h3",{attrs:{id:"资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#资源"}},[s._v("#")]),s._v(" 资源")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(815)}})]),s._v(" "),e("h3",{attrs:{id:"ansible-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-安装"}},[s._v("#")]),s._v(" Ansible 安装")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- yum：yum install ansible # 会生成初始配置文件\n- pip：pip install ansible # 不会有初始配置文件和信息，需要把https://github.com/ansible/ansible/tree/devel/examples/ansible.cfg下载下来，放到/etc/ansible目录下\n- 源码安装：去github下载release包，python setup.py install # 一般不推荐源码安装\n- python安装：\n    yum install python36 python36-tools -y\n    装上python3的pip\n    pip3.6 install ansible\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"_02-ansible-配置与主机清单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_02-ansible-配置与主机清单"}},[s._v("#")]),s._v(" 02.ansible 配置与主机清单")]),s._v(" "),e("h3",{attrs:{id:"ansible-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-配置"}},[s._v("#")]),s._v(" Ansible 配置")]),s._v(" "),e("p",[s._v("配置文件存在不同的位置，但只有一个生效，在下列列表中，ansible 依次检查，检查到哪个可用就先用哪个：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1. ANSIBLE_CONFIG环境变量配置\n2. ./ansible.cfg当前工作目录\n3. ~/.ansible.cfg当前用户home目录\n4. /etc/ansible/ansible.cfg 默认目录\n\n示例文件：https://github.com/ansible/ansible/tree/devel/examples/ansible.cfg\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("up 主然后就是讲解配置文件，并把"),e("code",[s._v("host_key_checking")]),s._v("设置为了 False，这里讲了很久，跳过")]),s._v(" "),e("h3",{attrs:{id:"ansible-主机清单"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-主机清单"}},[s._v("#")]),s._v(" Ansible 主机清单")]),s._v(" "),e("p",[s._v("Ansible 可同时操作属于一个组的多台主机，组合主机之间的关系通过 inventory 文件配置，默认文件路径为/etc/ansible/hosts")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(816)}})]),s._v(" "),e("p",[s._v("想要指定连接密码："),e("code",[s._v("host5 ansible_ssh_pass=123456")]),s._v("\n想要自定义变量："),e("code",[s._v("host6 test1=134")])]),s._v(" "),e("h4",{attrs:{id:"默认组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#默认组"}},[s._v("#")]),s._v(" 默认组")]),s._v(" "),e("p",[s._v("all：所有的主机\nungrouped：所有没有组的主机\n以上这两个默认组不会出现在 group_names 之类的组列表中")]),s._v(" "),e("h4",{attrs:{id:"变量合并"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变量合并"}},[s._v("#")]),s._v(" 变量合并")]),s._v(" "),e("p",[s._v("优先顺序，all 最低，host 最高")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("all group(because it is the 'parent' of all other groups)\nparent group\nchild group\nhost\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("相同组时，可以使用 ansible_group_priority 调整优先级，数值越大优先级越高，默认为 1，相同优先级时，后者优先")]),s._v(" "),e("h4",{attrs:{id:"操作实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作实例"}},[s._v("#")]),s._v(" 操作实例")]),s._v(" "),e("p",[e("code",[s._v("/etc/ansible/hosts")]),s._v("配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# /etc/ansible/hosts\n[test]\nlocalhost ansible_connection=local\n\n[node1]\n192.168.77.134 test=134 ansible_ssh_pass=123456\n\n[test2:children]\ntest\nnode1\n[test2:vars]\ntest2=test2\ntest3=test2_test3\n\n[all:vars]\ntest3=all_test3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("操作：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible node1 -a \'ifconfig\'\nansible node1 -m debug -a "mag={{test}}" # 134\nansible test2 -m debug -a "mag={{test3}}" # test2_test3\nansible test2 -m debug -a "mag={{play_hosts}}" # play_hosts是预置变量，保存着执行的目标主机列表\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"ansible-inventory-变量参数列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-inventory-变量参数列表"}},[s._v("#")]),s._v(" Ansible Inventory 变量参数列表")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(817)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(818)}})]),s._v(" "),e("h3",{attrs:{id:"动态主机清单格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#动态主机清单格式"}},[s._v("#")]),s._v(" 动态主机清单格式")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(819)}})]),s._v(" "),e("h2",{attrs:{id:"_03-ansible-命令与-patterns-匹配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_03-ansible-命令与-patterns-匹配"}},[s._v("#")]),s._v(" 03.ansible 命令与 Patterns 匹配")]),s._v(" "),e("p",[s._v("视频地址："),e("a",{attrs:{href:"https://www.bilibili.com/video/av25424954/?p=3",target:"_blank",rel:"noopener noreferrer"}},[s._v("ansible 命令与 Patterns 匹配"),e("OutboundLink")],1),s._v("\nup 主简书笔记：\n"),e("a",{attrs:{href:"https://www.jianshu.com/p/2f28513292e4",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 三（Ansible 命令介绍）"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.jianshu.com/p/a52014afdba2",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 六（Patterns 匹配模式）"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.jianshu.com/p/289455dadfeb",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 七（Ad-hoc）"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"ansible-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-命令"}},[s._v("#")]),s._v(" Ansible 命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible：核心命令，--help查看帮助信息，-k询问ssh密码，-o输出信息为1行，-m指定模块，-f指定进程数，-l即--limit只执行指定个数的主机\n    ansible 192.168.77.135 -m ping -k -o\n    ansible all -m ping --list-hosts\n    ansible test -a 'hostname' -v # 还可以写-vv -vvv -vvvv...来显示使用插件的信息,v越多越详细\n    ansible all -m shell -a 'hostname' -f 1\nansible-console：进入ansible的shell交互界面，类似python console、django console\nansibel-doc：查看模块的帮助信息\n    ansible-doc shell # 查看shell模块的帮助信息\nansible-galaxy：用于方便的从 https://galaxy.ansible.com/ 站点下载第三方扩展模块，我们可以形象的理解其类似于centos下的yum、python下的pip或easy_install\n    ansible-galaxy search tomcat  # 查找\n    ansible-galaxy install alexanderjardim.tomcat # 安装\n    ansible-galaxy info alexanderjardim.tomcat\n    ansible-galaxy init abc # 创建一个名为abc的role模板项目\nansible-playbook：对于需反复执行的、较为复杂的任务，我们可以通过定义 Playbook 来搞定。Playbook 是 Ansible 真正强大的地方，它允许使用变量、条件、循环、以及模板，也能通过角色 及包含指令来重用既有内容。\n    ansible-playbook playbook.yml\n    ansible-playbook -i hosts ssh-addkey.yml    # 指定主机清单文件\n    ansible-playbook -i hosts ssh-addkey.yml  --list-tags   # 列出tags\n    ansible-playbook -i hosts ssh-addkey.yml  -T install  # 执行install标签的任务\nansible-pull：在被配置的机器上运行，速度很快。在这种模式下，你需要提供一个git仓库来供Ansible下载来配置你的机器。其实就是拉取远程任务在本地执行\n    ansible-pull -U <repository> [options]\n    ansible-pull -o -C master -d /tmp/test_pull -i /tmp/test_pull/hosts -U https://github.com/kuailemy123/Ansible-Pull-Example.git\nansible-config：管理ansible的配置\nansible-inventory：主机清单信息\nansible-vault：用于配置文件中含有敏感信息，又不希望他能被人看到，vault可以帮你加密/解密这个配置文件。如果加密了playbook文件，执行时需要加上 –-ask-vault-pass参数，同样需要输入密码后才能正常执行。\n    ansible-vault create /tmp/123 # 创建加密文件\n    ansible-vault view  /tmp/123 # 查看加密文件\n    ansible-vault encrypt  /tmp/abc # 加密文件\n    ansible-vault decrypt  /tmp/abc # 解密文件\n    ansible-playbook playbook.yml –-ask-vault-pass # 会询问文件密码\n    ansible-playbook playbook.yml --vault-password-file=/tmp/pass # 可以直接指定存储了密码内容的文件，避免手动输入密码\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("h3",{attrs:{id:"ansible-patterns-匹配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-patterns-匹配"}},[s._v("#")]),s._v(" Ansible Patterns 匹配")]),s._v(" "),e("p",[s._v("Patterns 是定义 Ansible 要管理的主机，但是在 palybook 中它指的是对应主机应用特定的配置或 IT 流程。\n命令格式：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible <host-pattern> [options]\nansible-plauybook -l <host-pattern> [options] playbook.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("使用示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible * -m service -a "name=httpd state=restarted"\nansible-playbook -l all playbook.yml\nansibel "192.*" -m ping\nansibel "node1:test2" -m ping\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(820)}})]),s._v(" "),e("h3",{attrs:{id:"ansible-ad-hoc-命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ansible-ad-hoc-命令"}},[s._v("#")]),s._v(" Ansible ad-hoc 命令")]),s._v(" "),e("ul",[e("li",[s._v("Ansible 提供两种方式去完成任务,一是 ad-hoc 命令，一是写 Ansible playbook。前者可以解决一些简单的任务， 后者解决较复杂的任务。")]),s._v(" "),e("li",[s._v("ad hoc——临时的，在 ansible 中是指需要快速执行，并且不需要保存的命令。说白了就是执行简单的命令—一条命令。")])]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(821)}})]),s._v(" "),e("p",[s._v("操作示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible 192.168.77.134 -m shell -a "cat /tmp/123" # 查看目标主机上某个文件的内容\n详见：https://www.jianshu.com/p/289455dadfeb\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"_04-ansible-playbook-介绍和-yaml-语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_04-ansible-playbook-介绍和-yaml-语法"}},[s._v("#")]),s._v(" 04.ansible playbook 介绍和 yaml 语法")]),s._v(" "),e("p",[s._v("简书文章：\n"),e("a",{attrs:{href:"https://www.jianshu.com/p/51a885f55a61",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 八（Yaml 语法格式）"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.jianshu.com/p/15b154c4b8cb",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 九（Playbook）"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"playbook-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-介绍"}},[s._v("#")]),s._v(" playbook 介绍")]),s._v(" "),e("p",[s._v('playbook 是由一个或多个"play"组成的列表。play 的主要功能在于将事先归并为一组的主机装扮成事先通过 ansible 中的 task 定义好的角色。从根本上来讲所谓 task 无非是调用 ansible 的一个 module。将多个 play 组织在一个 playbook 中即可以让它们联同起来按事先编排的机制同唱一台大戏。\n其主要有以下四部分构成:')]),s._v(" "),e("ul",[e("li",[s._v("Target section： 定义将要执行 playbook 的远程主机组")]),s._v(" "),e("li",[s._v("Variable section： 定义 playbook 运行时需要使用的变量")]),s._v(" "),e("li",[s._v("Task section： 定义将要在远程主机上执行的任务列表")]),s._v(" "),e("li",[s._v("Handler section： 定义 task 执行完成以后需要调用的任务")])]),s._v(" "),e("h4",{attrs:{id:"主机执行顺序-order"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主机执行顺序-order"}},[s._v("#")]),s._v(" 主机执行顺序 order")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- hosts:all\n  order:sorted\n  gather_facts:False\n  tasks:\n  - debug:\n      var:inventory_hostname\n\n# order的可选值\ninventory：默认值，按主机清单的排序执行\nreverse_inventory：按主机清单反序执行\nsorted：以主机名称按字母顺序排序\nreverse_sorted：以主机名称按字母顺序反序排序\nshuffle：随机排序\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("实际操作例子：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 新建一个playbook的yml文件\nvim order.yml\n    ---\n    - hosts: all\n      order: sorted\n      gather_facts: False\n      tasks:\n        - debug: var=inventory_hostname\n# 执行\nansible-playbook order.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h4",{attrs:{id:"playbook-执行顺序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-执行顺序"}},[s._v("#")]),s._v(" playbook 执行顺序")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(822)}})]),s._v(" "),e("p",[s._v("实际操作例子：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# workdir ansible/roles\nmkdir test\ncd test\nmkdir tasks\ncd tasks\nvim main.yml\n    ---\n\n    - debug: msg="I\'m test role"\n      changed_when: true\n      notify: test handler\ncd ..\nmkdir handlers\ncd handlers\nvim main.yml\n    ---\n\n    - name: test handler\n      debug: msg="I\'m test role handler"\n\n# workdir ansible\ntree roles/\n    roles/\n    └── test\n        ├── handlers\n        │    └── main.yml\n        └── tasks\n             └── main.yml\n\n# 编写playbook\n# workdir ansible\nvim playbook_order.yml\n\n---\n\n- hosts: localhost\n  vars:\n   - test_vars: \'test vars\'\n\n#  tasks:\n#   - debug: msg="I\'m head tasks."\n\n  pre_tasks:\n   - debug: msg="I\'m pre tasks."\n     changed_when: true\n     notify: pre handler\n   - debug: msg="I\'m sec."\n\n  roles:\n   - test\n\n  tasks:\n   - debug: "msg=\'I\'\'m first tasks.{{ test_vars }}\'"\n     changed_when: true\n     notify: task handler\n   - debug: msg="I\'m sec tasks."\n\n  post_tasks:\n   - debug: msg="I\'m post tasks."\n     changed_when: true\n     notify: post handler\n\n#  tasks:\n#   - debug: msg="I\'m last tasks."\n#     changed_when: true\n#     notify: last handler\n\n  handlers:\n   - name: pre handler\n     debug: msg="I\'m pre handler"\n\n   - name: task handler\n     debug: msg="I\'m task handler"\n\n   - name: post handler\n     debug: msg="I\'m post handler"\n\n   - name: last handler\n     debug: msg="I\'m last handler"\n\n# 在执行playbook前，可以做些检查\n# 检查palybook语法\nansible-playbook -i hosts playbook_order.yml --syntax-check\n# 列出要执行的主机\nansible-playbook -i hosts playbook_order.yml --list-hosts\n# 列出要执行的任务\nansible-playbook -i hosts playbook_order.yml --list-tasks\n\n# 执行playbook\nansible-playbook playbook_order.yml\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br")])]),e("h3",{attrs:{id:"yaml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yaml"}},[s._v("#")]),s._v(" yaml")]),s._v(" "),e("h4",{attrs:{id:"介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),e("p",[s._v('YAML 语言（发音 /ˈjæməl/ ）的设计目标，就是方便人类读写。它实质上是一种通用的数据串行化格式。\n它的基本语法规则如下。\n• 大小写敏感\n• 使用缩进表示层级关系\n• 缩进时不允许使用 Tab 键，只允许使用空格。\n• 缩进的空格数目不重要，只要相同层级的元素左侧对齐即可\n• yaml 文件以"---"作为文档的开始，"..."作为文档的结束\n• # 表示注释，从这个字符一直到行尾，都会被解析器忽略。')]),s._v(" "),e("p",[s._v("YAML 支持的数据结构有三种。\n• 对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）\n• 数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）\n• 纯量（scalars）：单个的、不可再分的值")]),s._v(" "),e("h4",{attrs:{id:"语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[s._v("#")]),s._v(" 语法")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(823)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(824)}})]),s._v(" "),e("p",[s._v("例子：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 列表\n---\nfruits:\n  - Apple\n  - Orange\n  - Strawberry\n  - Mango\n\n# 对应的python格式\n{'fruits': ['Apple', 'Orange', 'Strawberry', 'Mango']}\n\n# 可以使用行内表示法\n---\nfruits: ['Apple', 'Orange', 'Strawberry', 'Mango']\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 字典\n---\nmartin:\n  name: Martin D'vloper\n  job: Developer\n  skill: Elite\n\n# 转换为python格式\n{'martin': {'job': 'Developer', 'name': \"Martin D'vloper\", 'skill': 'Elite'}}\n\n# 可以使用行业内表示法\n---\nmartin: {name: Martin D'vloper, job: Developer, skill: Elite}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("更多参考：\n"),e("a",{attrs:{href:"https://www.jianshu.com/p/51a885f55a61",target:"_blank",rel:"noopener noreferrer"}},[s._v("up 主-Ansible 小手册系列 八（Yaml 语法格式）"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("Playbooks 采用 YMAL 语法结构，基本的 YMAL 语法请参考\nhttp://docs.ansible.com/YAMLSyntax.html\npython 利用 pyyaml 模块进行解析 yaml 语言\nhttp://pyyaml.org/wiki/PyYAMLDocumentation\nyaml 格式在线检查\nhttp://yaml-online-parser.appspot.com/")]),s._v(" "),e("h2",{attrs:{id:"_05-ansible-jinja2-语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_05-ansible-jinja2-语法"}},[s._v("#")]),s._v(" 05.ansible jinja2 语法")]),s._v(" "),e("p",[s._v("up 主简书笔记："),e("a",{attrs:{href:"https://www.jianshu.com/p/ae74f5f39828",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十三（Jinja2）"),e("OutboundLink")],1)]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(825)}})]),s._v(" "),e("p",[s._v("实际例子：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible localhost -m debug -a "msg={{ [1,2,3] | to_json }}"\n# 等同于\nvim jinja2.yml\n    ---\n    - hosts: localhost\n      gather_facts: False\n      tasks:\n       - debug: "msg={{ [1,2,3] | to_json }}"\nansible-playbook jinja2.yml\n# 等同于\nvim jinja2.j2\n    {{ [1,2,3] | to_json }}\nansible localhost -m template -a "src=/etc/ansible/jinja2.j2 dest=tmp/j"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(826)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(827)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(828)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(829)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(830)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(831)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(832)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(833)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(834)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(835)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(836)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(837)}})]),s._v(" "),e("h2",{attrs:{id:"_06-ansible-playbook-包含和角色"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_06-ansible-playbook-包含和角色"}},[s._v("#")]),s._v(" 06.ansible playbook 包含和角色")]),s._v(" "),e("p",[s._v("up 主简书文章："),e("a",{attrs:{href:"https://www.jianshu.com/p/c169032b4e69",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十（包含和角色）"),e("OutboundLink")],1)]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(838)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(839)}})]),s._v(" "),e("p",[s._v("一般情况下使用静态包含，除非要用到循环。")]),s._v(" "),e("h3",{attrs:{id:"playbook-包含-实际操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-包含-实际操作"}},[s._v("#")]),s._v(" 'playbook 包含'实际操作")]),s._v(" "),e("h4",{attrs:{id:"基本使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# test_include1.yml\n---\n\n- name: test_include1\n  debug: msg="test_include1"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# test_include.yml\n---\n\n- hosts: localhost\n  gather_facts: False\n\n  tasks:\n   - include_tasks: test_include1.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("执行："),e("code",[s._v("ansible-playbook test_include.yml")])]),s._v(" "),e("h4",{attrs:{id:"传递变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#传递变量"}},[s._v("#")]),s._v(" 传递变量")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# test_include1.yml\n---\n\n- name: test_include1\n  debug: \"'msg=test_include1, {{ test_var }}'\"\n  # debug: \"'msg=test_include1, {{ item }}'\" # item是默认循环变量，所以这样也可以\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# test_include.yml\n---\n\n- hosts: localhost\n  gather_facts: False\n\n  tasks:\n   - include_tasks: test_include1.yml test_var={{ item }}\n     with_items:\n      - 1\n      - 2\n      - 3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h3",{attrs:{id:"playbook-role-角色"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-role-角色"}},[s._v("#")]),s._v(" *playbook role 角色")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(840)}})]),s._v(" "),e("p",[s._v("结构说明：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("site.yml   主要的playbook\nwebservers.yml   webservers 得playbook\nhosts.ini     主机清单\nibrary          如果有任何自定义模块，将其放在这里（可选）\nfilter_plugins  如果有任何自定义过滤器插件，将其放在这里（可选）\n如果group_var/all存在，其中列出的变量将被添加到所有的主机组中\n如果group_var/groupname1存在，其中列出的变量将被添加到groupname1主机组中-\n如果host_vars/hostname1存在，其中列出的变量将被添加到hostname1主机组中\n\ndefaults/main.yml：角色默认变量文件，优先级最低。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("这个 playbook 为一个角色 ‘x’ 指定了如下的行为")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("如果 roles/x/tasks/main.yml 存在, 其中列出的 tasks 将被添加到 play 中\n如果 roles/x/handlers/main.yml 存在, 其中列出的 handlers 将被添加到 play 中\n如果 roles/x/vars/main.yml 存在, 其中列出的 variables 将被添加到 play 中\n如果  roles/ x/defaults /main.yml存在，其中列出的变量将被添加到play 中\n如果 roles/x/meta/main.yml 存在, 其中列出的 “角色依赖” 将被添加到 roles 列表中\n所有 copy tasks 可以引用 roles/x/files/ 中的文件，不需要指明文件的路径。\n所有 script tasks 可以引用 roles/x/files/ 中的脚本，不需要指明文件的路径。\n所有 template tasks 可以引用 roles/x/templates/ 中的文件，不需要指明文件的路径。\n所有 include tasks 可以引用 roles/x/tasks/ 中的文件，不需要指明文件的路径。\n\n如果 roles 目录下有文件不存在，这些文件将被忽略。\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(841)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(842)}})]),s._v(" "),e("p",[s._v("不加"),e("code",[s._v("allow_duplicates: true")]),s._v("的话，相同的任务只会执行一次")]),s._v(" "),e("h4",{attrs:{id:"角色的搜索路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#角色的搜索路径"}},[s._v("#")]),s._v(" 角色的搜索路径")]),s._v(" "),e("ol",[e("li",[s._v("在 playbook 同级目录下的 roles 目录")]),s._v(" "),e("li",[s._v("配置文件指定的/etc/ansible/roles 目录"),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-config dump | grep DEFAULT_ROLES_PATH\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])]),s._v(" "),e("h4",{attrs:{id:"实战-手写一个部署-docker-ce-的-role"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实战-手写一个部署-docker-ce-的-role"}},[s._v("#")]),s._v(" 实战，手写一个部署 Docker CE 的 role")]),s._v(" "),e("p",[s._v("讲师分享版 docker role：https://github.com/lework/Ansible-roles/blob/master/docker/ ，可以好好看看和视频中演示的写法区别，视频中把步骤拆的很细分到了很多个 yml 文件中，源码\n梳理安装 docker 流程：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1.清理系统默认的docker\n2.安装docker依赖包\n3.安装docker ce的repo\n4.配置docker ce的国内源\n5.配置docker的daemon.json\n6.安装docker\n7.启动docker\n8.检查docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h5",{attrs:{id:"具体步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#具体步骤"}},[s._v("#")]),s._v(" 具体步骤")]),s._v(" "),e("ol",[e("li",[s._v("初始化")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd /etc/ansible/roles # 我是cd ~/.ansible/roles\nansible-galaxy init docker\ncd docker\ncd tasks\ntouch clean_docker.yml\ntouch install_docker_repo.yml\ntouch config_docker.yml\ntouch install_docker.yml\ntouch service.yml\n\ncd ../templates\ntouch daemon.json.j2 # docker默认配置的模板文件\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("编写各个 yml")])]),s._v(" "),e("p",[s._v("main.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("---\n# tasks file for docker\n- import_tasks: clean_docker.yml\n- import_tasks: install_docker_repo.yml\n- import_tasks: config_docker.yml\n- import_tasks: install_docker.yml\n- name: manager service\n  import_tasks: service.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("clean_docker.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('---\n\n- name: Ensure docker history packages are removed.\n  yum: "name={{ item }} state=removed"\n  with_item:\n    - docker\n    - docker-common\n    - docker-selinux\n    - docker-engine\n\n- name: Clean yum cache.\n  shell: yum clean all && rm -rf /var/cache/yum/\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("install_docker_repo.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('---\n\n- name: Ensure docker packages are installed.\n  yum: "name={{ item }} state=installed  update_cache=yes"\n  with_items:\n    - lvm2\n    - yum-utils\n    - device-mapper-persistent-data\n\n- name: Install docker repo.\n  shell: "yum-config-manager --add-repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo"\n\n- name: Modify the docker software source for keda.\n  replace:\n    path: /etc/yum.repos.d/docker-ce.repo\n    regexp: \'download\\.docker\\.com\'\n    replace: "mirrors.ustc.edu.cn/docker-ce"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("install_docker.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('---\n\n- name: Ensure docker-ce are installed.\n  yum: "name={{ item }} state=installed update_cache=yes enablerepo=docker-ce-stable"\n  with_items:\n    - docker-ce\n    - docker-compose\n\n# - name: Ensure docker-ce are installed.\n#   yum:\n#     name: docker-ce\n#     state: installed\n#     update_cache: true\n#     enablerepo: docker-ce-stable\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("config_docker.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('---\n\n- name: Create Docker config directory.\n  file: path=/etc/docker state=directory\n\n- name: Configure docker startup parameters.\n  template:\n    src: daemon.json.j2\n    dest: "/etc/docker/daemon.json"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("service.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("---\n\n- name: Ensure docker is started and enabled at boot.\n  systemd: name=docker state=started enabled=true\n  when: docker_start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("daemon.json.j2")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "data-root": "/var/lib/docker",\n  "registry-mirrors": [\n    "https://docker.mirrors.ustc.edu.cn/",\n    "https://registry.docker-cn.com"\n  ],\n  "insecure-registries": []\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[s._v("编写 playbook")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd ~/.ansible\nvim test_docker.yml\n    ---\n\n    - hosts: 192.168.77.134\n    roles:\n    - docker\n\n# 检查语法是否有误\nansible-playbook test_docker.yml --syntax-check\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("这里讲师演示了一下在 yml 文件中使用变量，步骤就是将变量写到 defaults/main.yml 文件中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('---\n# defaults file for docker\ndocker_registry_mirrors: ["https://docker.mirrors.ustc.edu.cn/", "https://registry.docker-cn.com"]\ndocker_insecure_registries: []\ndocker_data_root: /var/lib/docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("然后在 daemon.json.j2 文件中使用：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "data-root": "{{ docker_data_root }}",\n  "registry-mirrors": {{ docker_registry_mirrors | to_json }},\n  "insecure-registries": {{ docker_insecure_registries | to_json }}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("最终执行 playbook：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-playbook test_docker.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("假如任务中断了执行，可以指定开始任务：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-playbook test_docker.yml --start-at-task='Ensure docker is started and enabled at boot.'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("想要覆盖 defaults/main.yml 中的变量，可以在 playbook 文件中指定：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("---\n\n- hosts: 192.168.77.135\n  vars:\n   docker_data_root: /tmp\n  roles:\n  - docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("完善一下，编写检查服务文件")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd ~/.ansible/roles/docker/tasks\nvim check.yml\n    ---\n\n    - name: Check docker socket.\n    wait_for:\n        path: /var/run/docker.sock\n        state: present\n# 可以执行ansible-doc wait_for看看使用方式\n# 然后在tasks/main.yml里import_tasks一下：\n    ...\n    - import_tasks: check.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h4",{attrs:{id:"小技巧"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小技巧"}},[s._v("#")]),s._v(" 小技巧")]),s._v(" "),e("ul",[e("li",[s._v("tasks 命名格式，类似 git 提交代码时在备注信息一开始带上"),e("code",[s._v("[update/delete/add]")]),s._v("：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: check | Check docker socket.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("执行一个 playbook 之前老老实实检查：")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-playbook test_docker.yml --syntax-check\nansible-playbook test_docker.yml --list-hosts\nansible-playbook test_docker.yml --list-tasks\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h4",{attrs:{id:"role-学习"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#role-学习"}},[s._v("#")]),s._v(" role 学习")]),s._v(" "),e("p",[s._v("https://galaxy.ansible.com\nhttps://github.com/ansible/ansible-examples\nhttps://github.com/lework/Ansible-roles\nhttps://github.com/geerlingguy\nhttps://github.com/debops")]),s._v(" "),e("h2",{attrs:{id:"_07-ansible-变量和-facts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_07-ansible-变量和-facts"}},[s._v("#")]),s._v(" 07.ansible 变量和 facts")]),s._v(" "),e("p",[s._v("up 主的简书：\n"),e("a",{attrs:{href:"https://www.jianshu.com/p/bd1e2ed2a051",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十一（变量）"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.jianshu.com/p/0cd54330e8b8",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十二（Facts）"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"变量名约束"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变量名约束"}},[s._v("#")]),s._v(" 变量名约束")]),s._v(" "),e("ul",[e("li",[s._v("变量名称应为字母，数字和下划线")]),s._v(" "),e("li",[s._v("变量应始终以字母开头")]),s._v(" "),e("li",[s._v("变量名不应与 python 属性和方法名冲突")])]),s._v(" "),e("h3",{attrs:{id:"变量使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变量使用"}},[s._v("#")]),s._v(" 变量使用")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(843)}})]),s._v(" "),e("h3",{attrs:{id:"内置变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内置变量"}},[s._v("#")]),s._v(" 内置变量")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(844)}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible 192.168.77.134 -m debug -a "msg={{ hostvars }}"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"变量优先级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变量优先级"}},[s._v("#")]),s._v(" 变量优先级")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(845)}})]),s._v(" "),e("h3",{attrs:{id:"变量范围"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#变量范围"}},[s._v("#")]),s._v(" 变量范围")]),s._v(" "),e("p",[s._v("Ansible 有 3 个主要范围：")]),s._v(" "),e("ul",[e("li",[s._v("全局：这是由 config，环境变量和命令行设置的")]),s._v(" "),e("li",[s._v("play：每个 play 和包含的结构，vars 条目，include_vars，角色默认和 vars")]),s._v(" "),e("li",[s._v("主机：直接与主机相关联的变量，像 inventory，include_vars，facts or registered")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 查看各种变量\nansible-config dump\nansible-config dump | grep KEEP\n# 可以在执行ansible命令之前临时设置上面输出的所有变量\nDEFAULT_KEEP_REMOTE_FILES=True;ansible-playbook test_fact.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"采集目标系统信息-facts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#采集目标系统信息-facts"}},[s._v("#")]),s._v(" 采集目标系统信息-Facts")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(846)}})]),s._v(" "),e("p",[s._v("想要获取自定义模板系统的 facts："),e("code",[s._v("ansible 192.168.77.134 -m setup -a 'filter=ansible_local'")])]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(847)}})]),s._v(" "),e("ul",[e("li",[s._v("这样执行完 setup 命令之后，输出会保存到指定的地方(文件、redis、memcached)")])]),s._v(" "),e("h2",{attrs:{id:"_08-ansible-条件判断和循环与-block-分组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_08-ansible-条件判断和循环与-block-分组"}},[s._v("#")]),s._v(" 08.ansible 条件判断和循环与 block 分组")]),s._v(" "),e("p",[s._v("up 主的简书文章：\n"),e("a",{attrs:{href:"https://www.jianshu.com/p/04516cbba336",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十四（条件判断和循环）"),e("OutboundLink")],1),s._v(" "),e("a",{attrs:{href:"https://www.jianshu.com/p/3a316650491f",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 十五（Blocks 分组）"),e("OutboundLink")],1)]),s._v(" "),e("h3",{attrs:{id:"playbook-条件判断"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-条件判断"}},[s._v("#")]),s._v(" playbook 条件判断")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(848)}})]),s._v(" "),e("h3",{attrs:{id:"playbook-循环"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-循环"}},[s._v("#")]),s._v(" playbook 循环")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(849)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(850)}})]),s._v(" "),e("h4",{attrs:{id:"循环控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#循环控制"}},[s._v("#")]),s._v(" 循环控制")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(851)}})]),s._v(" "),e("h3",{attrs:{id:"playbook-分组-block"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#playbook-分组-block"}},[s._v("#")]),s._v(" playbook 分组 block")]),s._v(" "),e("p",[s._v("当我们想在满足一个条件下，执行多个任务时，就需要分组了。而不再每个任务都要用 when。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tasks:\n- block:\n    - command: echo 1\n    - shell: echo 2\n    - raw: echo 3\n    when: ansible_distribution == 'CentOS'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("错误处理")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tasks:\n  - block:\n      - debug: msg='i execute normally'\n      - command: /bin/false\n      - debug: msg='i never execute, cause ERROR!'\n    rescue:\n      - debug: msg='I caught an error'\n      - command: /bin/false\n      - debug: msg='I also never execute :-('\n    always:\n      - debug: msg=\"this always executes\"\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("block 中的任务在执行中，如果有任何错误，将执行 rescue 中的任务。 无论在 block 和 rescue 中发生或没有发生错误，always 部分都运行。\n发生错误后，运行 handlers")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" tasks:\n  - block:\n      - debug: msg='i execute normally'\n        notify: run me even after an error\n      - command: /bin/false\n    rescue:\n      - name: make sure all handlers run\n        meta: flush_handlers\n handlers:\n   - name: run me even after an error\n     debug: msg='this handler runs even on error'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("测试的时候，设置 meta: flush_handlers 时，handlers 不执行，rescue 的任务还是执行的。")]),s._v(" "),e("h2",{attrs:{id:"_09-ansible-playbook-高级功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_09-ansible-playbook-高级功能"}},[s._v("#")]),s._v(" 09.ansible playbook 高级功能")]),s._v(" "),e("h3",{attrs:{id:"权限升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#权限升级"}},[s._v("#")]),s._v(" 权限升级")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(852)}})]),s._v(" "),e("p",[s._v("注意，--become 可以简写为-b")]),s._v(" "),e("h3",{attrs:{id:"异步操作和轮询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#异步操作和轮询"}},[s._v("#")]),s._v(" 异步操作和轮询")]),s._v(" "),e("p",[s._v("简书文章："),e("a",{attrs:{href:"https://www.jianshu.com/p/f4c9e424f24f",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ansible 小手册系列 二十二（异步操作和轮询）"),e("OutboundLink")],1)]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(853)}})]),s._v(" "),e("ul",[e("li",[s._v("-B 3600 启用异步，超时时间 3600,")]),s._v(" "),e("li",[s._v("-P 0 轮询时间为 0")])]),s._v(" "),e("p",[s._v("实际例子：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ansible node1 -B 3600 -P 0 -m yum -a "name=ansible" -vv\n# 执行完上面这一句之后会输出任务的基本信息(jid、任务执行结果保存路径)，里面会有一个ansible_job_id，可以通过下面命令查询任务状态\nansible node1 -m async_status -a "jid=23974611070.37468"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"检查模式-check"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查模式-check"}},[s._v("#")]),s._v(" 检查模式--check")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(854)}})]),s._v(" "),e("ul",[e("li",[s._v("当以—-check 参数来运行 ansible-playbook 时，将不会对远程的系统作出任何修改。")]),s._v(" "),e("li",[s._v("在 diff 模式下,当文件发现更变,会打印出变更文件的变更部分.")])]),s._v(" "),e("h3",{attrs:{id:"debug-功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#debug-功能"}},[s._v("#")]),s._v(" debug 功能")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(503)}})]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(855)}})]),s._v(" "),e("p",[s._v("注意："),e("code",[s._v("strategy: debug")]),s._v("运行策略 2.5 版本被移除了。strategy 默认使用 linear 策略运行，其中所欲主机都将在任何主机启动下一个任务之前运行每个任务，并使用 fork 数量(默认为 5)进行并行化。free 策略则是每个主机以尽可能快的速度运行直到结束。")]),s._v(" "),e("p",[s._v("实际操作：")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# test_debug.yml")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" localhost\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' msg="1"\n    '),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debugger")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("执行上面的 playbook 会进入 debug 交互界面："),e("code",[s._v("ansible-playbook test_debug.yml")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 在debug交互界面下：\n输入h可以查看帮助信息\n输入r可以重复执行tasks\np是打印信息(python的pprint模块效果)\n输入p task.args可以显示任务的参数\n输入p task_vars可以打印所有变量信息\np host\np result\np vars\n\n# 可以修改变量\ntask.args['msg']=2\ntask.args\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(503)}})]),s._v(" "),e("h3",{attrs:{id:"滚动执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#滚动执行"}},[s._v("#")]),s._v(" 滚动执行")]),s._v(" "),e("p",[s._v("比如一共五台主机，想要最多 3 台并行执行：")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test play\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" webservers\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serial")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持如下这种百分比写法")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# serial: "30%"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"指定最大失败数目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指定最大失败数目"}},[s._v("#")]),s._v(" 指定最大失败数目")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- hosts: webservers\n  max_fail_percentage: 30\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"委托"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#委托"}},[s._v("#")]),s._v(" 委托")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(856)}})]),s._v(" "),e("p",[s._v("delegate_to：将命令交给目标主机执行\nlocal_action：指定命令本地运行")]),s._v(" "),e("h3",{attrs:{id:"任务只执行一次"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务只执行一次"}},[s._v("#")]),s._v(" 任务只执行一次")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ifconfig\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run_once")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("假如 hosts 里有多个主机，谁先执行这个任务就完了")]),s._v(" "),e("h3",{attrs:{id:"本地执行-playbook"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地执行-playbook"}},[s._v("#")]),s._v(" 本地执行 playbook")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[s._v("ansible"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("playbook playbook.yml "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("connection=local\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在play中")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 127.0.0.1\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("connection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"设置环境变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置环境变量"}},[s._v("#")]),s._v(" 设置环境变量")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(857)}})]),s._v(" "),e("h3",{attrs:{id:"即使任务失败-handlers-也执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#即使任务失败-handlers-也执行"}},[s._v("#")]),s._v(" 即使任务失败，handlers 也执行")]),s._v(" "),e("p",[s._v("有 3 种方法：")]),s._v(" "),e("ol",[e("li",[s._v("命令行加上--force-handlers 参数")]),s._v(" "),e("li",[s._v("配置文件加上 force_handlers = True")]),s._v(" "),e("li",[s._v("playbook 里设置 force_handlers: True")])]),s._v(" "),e("h3",{attrs:{id:"忽略错误"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#忽略错误"}},[s._v("#")]),s._v(" 忽略错误")]),s._v(" "),e("p",[s._v("ignore_errors 模块可以在任务执行出错时，忽略错误并继续执行任务")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /bin/false\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ignore_errors")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' msg="false"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"prompts-运行时提示输入内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#prompts-运行时提示输入内容"}},[s._v("#")]),s._v(" prompts 运行时提示输入内容")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(858)}})]),s._v(" "),e("h3",{attrs:{id:"vault-加解密文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vault-加解密文件"}},[s._v("#")]),s._v(" vault 加解密文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-vaule encrypt /etc/ansible/hosts2\nansible -i /etc/ansible/hosts node1 -m ping --ask-vault-pass\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"任务标记-tag"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务标记-tag"}},[s._v("#")]),s._v(" 任务标记 tag")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(859)}})]),s._v(" "),e("p",[s._v("可以通过执行 tag 来选择性地执行任务：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ansible-playbook test_tags.yml --tags packages\nansible-playbook test_tags.yml --skip-tags packages # 跳过\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"wait-for"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wait-for"}},[s._v("#")]),s._v(" wait_for")]),s._v(" "),e("p",[s._v("等待端口可用才执行任务：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wait_for: port=8000 delay=10\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("等待直到锁定文件被删除：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wait_for: path=/var/lock/file.lock state=absent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"任务执行方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#任务执行方式"}},[s._v("#")]),s._v(" 任务执行方式")]),s._v(" "),e("h4",{attrs:{id:"从某个任务开始执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#从某个任务开始执行"}},[s._v("#")]),s._v(" 从某个任务开始执行")]),s._v(" "),e("p",[e("code",[s._v('ansible-playbook playbook.yml --start-at-task="install packages"')])]),s._v(" "),e("h4",{attrs:{id:"一步一步执行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一步一步执行"}},[s._v("#")]),s._v(" 一步一步执行")]),s._v(" "),e("p",[e("code",[s._v("ansible-playbook playbook.yml --step")])]),s._v(" "),e("h3",{attrs:{id:"loop-插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#loop-插件"}},[s._v("#")]),s._v(" loop 插件")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(860)}})]),s._v(" "),e("h2",{attrs:{id:"_10-ansible-playbook-关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-ansible-playbook-关键字"}},[s._v("#")]),s._v(" 10.ansible playbook 关键字")]),s._v(" "),e("h3",{attrs:{id:"在-play-上使用的关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-play-上使用的关键字"}},[s._v("#")]),s._v(" 在 play 上使用的关键字")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(861)}})]),s._v(" "),e("h3",{attrs:{id:"在-role-上使用的关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-role-上使用的关键字"}},[s._v("#")]),s._v(" 在 role 上使用的关键字")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(862)}})]),s._v(" "),e("h3",{attrs:{id:"在-block-上使用的关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-block-上使用的关键字"}},[s._v("#")]),s._v(" 在 block 上使用的关键字")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(863)}})]),s._v(" "),e("h3",{attrs:{id:"在-task-上使用的关键字"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-task-上使用的关键字"}},[s._v("#")]),s._v(" 在 task 上使用的关键字")]),s._v(" "),e("div",{attrs:{align:"center"}},[e("img",{attrs:{width:"640",src:n(864)}})]),s._v(" "),e("h2",{attrs:{id:"警告-ansible-更新迭代非常快-一切以官方文档为准"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#警告-ansible-更新迭代非常快-一切以官方文档为准"}},[s._v("#")]),s._v(" 警告：ansible 更新迭代非常快，一切以官方文档为准")])])}),[],!1,null,null,null);a.default=t.exports},503:function(s,a,n){s.exports=n.p+"assets/img/09-debug功能.5d99f58c.jpg"},813:function(s,a,n){s.exports=n.p+"assets/img/01-Ansible是如何工作的.d99613e3.jpg"},814:function(s,a,n){s.exports=n.p+"assets/img/01-Ansible与其它配置管理的对比.b838bfce.jpg"},815:function(s,a,n){s.exports=n.p+"assets/img/01-Ansible资源.4a540ebd.jpg"},816:function(s,a,n){s.exports=n.p+"assets/img/02-Ansible主机清单示例.502ac117.jpg"},817:function(s,a,n){s.exports=n.p+"assets/img/02-Inventory变量参数列表1.10d66054.jpg"},818:function(s,a,n){s.exports=n.p+"assets/img/02-Inventory变量参数列表2.06d5269b.jpg"},819:function(s,a,n){s.exports=n.p+"assets/img/02-动态主机清单格式.3d9c325d.jpg"},820:function(s,a,n){s.exports=n.p+"assets/img/03-Patterns匹配.a187b44e.jpg"},821:function(s,a,n){s.exports=n.p+"assets/img/03-ad-hoc命令.f1d1e0f1.jpg"},822:function(s,a,n){s.exports=n.p+"assets/img/04-playbook执行顺序.86fde366.jpg"},823:function(s,a,n){s.exports=n.p+"assets/img/04-yaml语法-1.6772dbcc.jpg"},824:function(s,a,n){s.exports=n.p+"assets/img/04-yaml语法-2.a7779d90.jpg"},825:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-1.65282b5d.jpg"},826:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-2.5f1fb9aa.jpg"},827:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-3.788b5184.jpg"},828:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-4.e5bf50b5.jpg"},829:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-5.62fd4f02.jpg"},830:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-测试-1.909c506e.jpg"},831:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-测试-2.cd53713d.jpg"},832:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-测试-3.3e94e91b.jpg"},833:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-变量注释转义.3e4aed1b.jpg"},834:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-控制结构.a286e8d7.jpg"},835:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-if过滤器赋值包含.7f68c00b.jpg"},836:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-字面量提示表达式if.f5ec198b.jpg"},837:function(s,a,n){s.exports=n.p+"assets/img/05-jinja2模板语法-python对象方法.f12af475.jpg"},838:function(s,a,n){s.exports=n.p+"assets/img/06-playbook包含-1.84986ed3.jpg"},839:function(s,a,n){s.exports=n.p+"assets/img/06-playbook包含-2.b6caed9b.jpg"},840:function(s,a,n){s.exports=n.p+"assets/img/06-role角色.4e5ce8d7.jpg"},841:function(s,a,n){s.exports=n.p+"assets/img/06-使用角色.ec747828.jpg"},842:function(s,a,n){s.exports=n.p+"assets/img/06-重复执行role和角色依赖.96ab277e.jpg"},843:function(s,a,n){s.exports=n.p+"assets/img/07-变量使用.fb1a1906.jpg"},844:function(s,a,n){s.exports=n.p+"assets/img/07-内置变量.76672aa9.jpg"},845:function(s,a,n){s.exports=n.p+"assets/img/07-变量优先级.efd425ac.jpg"},846:function(s,a,n){s.exports=n.p+"assets/img/07-Facts采集目标系统信息-1.5b4c39a1.jpg"},847:function(s,a,n){s.exports=n.p+"assets/img/07-Facts采集目标系统信息-2.501debeb.jpg"},848:function(s,a,n){s.exports=n.p+"assets/img/08-playbook条件判断.7928ade0.jpg"},849:function(s,a,n){s.exports=n.p+"assets/img/08-playbook循环-1.4c134aa9.jpg"},850:function(s,a,n){s.exports=n.p+"assets/img/08-playbook循环-2.fa367b40.jpg"},851:function(s,a,n){s.exports=n.p+"assets/img/08-playbook循环控制.c9e82e1b.jpg"},852:function(s,a,n){s.exports=n.p+"assets/img/09-权限升级.349c33a3.jpg"},853:function(s,a,n){s.exports=n.p+"assets/img/09-异步操作和轮询.31c4f436.jpg"},854:function(s,a,n){s.exports=n.p+"assets/img/09-检查模式.dd913f6b.jpg"},855:function(s,a,n){s.exports=n.p+"assets/img/09-debug运行策略和可用命令.c554eac4.jpg"},856:function(s,a,n){s.exports=n.p+"assets/img/09-委托.6f04b93d.jpg"},857:function(s,a,n){s.exports=n.p+"assets/img/09-设置环境变量.3a25247d.jpg"},858:function(s,a,n){s.exports=n.p+"assets/img/09-prompts运行时提示输入内容.9f8a9d2e.jpg"},859:function(s,a,n){s.exports=n.p+"assets/img/09-任务标记tag.500d3ef0.jpg"},860:function(s,a,n){s.exports=n.p+"assets/img/09-loop插件.a3bcd84f.jpg"},861:function(s,a,n){s.exports=n.p+"assets/img/10-在play上使用的关键字.a6de2f5f.jpg"},862:function(s,a,n){s.exports=n.p+"assets/img/10-在role上使用的关键字.f677f19d.jpg"},863:function(s,a,n){s.exports=n.p+"assets/img/10-在block上使用的关键字.44a0079b.jpg"},864:function(s,a,n){s.exports=n.p+"assets/img/10-在task上使用的关键字.df600019.jpg"}}]);