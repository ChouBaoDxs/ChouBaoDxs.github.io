(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{585:function(v,_,a){v.exports=a.p+"assets/img/阿里CDN系统组成.6a0a2b2d.jpg"},586:function(v,_,a){v.exports=a.p+"assets/img/日志服务器.3eae2e0f.jpg"},587:function(v,_,a){v.exports=a.p+"assets/img/调度系统.686349bd.jpg"},588:function(v,_,a){v.exports=a.p+"assets/img/监控系统.6b3ff395.jpg"},589:function(v,_,a){v.exports=a.p+"assets/img/刷新系统.1a51cbe7.jpg"},933:function(v,_,a){"use strict";a.r(_);var t=a(12),i=Object(t.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[v._v("视频名称：阿里云-Go在CDN系统的应用"),t("br"),v._v("\n视频地址：https://www.bilibili.com/video/av29930939"),t("br"),v._v("\n演讲者：吴小伟，阿里花名"),t("code",[v._v("一啸")]),t("br"),v._v("\n演讲时间：Gopher China 2016（2016-04-16）")])]),v._v(" "),t("p",[v._v("[TOC]")]),v._v(" "),t("h2",{attrs:{id:"自我介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自我介绍"}},[v._v("#")]),v._v(" 自我介绍")]),v._v(" "),t("ul",[t("li",[v._v("吴小伟，阿里花名"),t("code",[v._v("一啸")])]),v._v(" "),t("li",[v._v("2020年毕业加入淘宝网数据平台与产品部")]),v._v(" "),t("li",[v._v("2012年加入淘宝网核心系统研发部")]),v._v(" "),t("li",[v._v("2013年加入阿里云CDN事业部")])]),v._v(" "),t("h2",{attrs:{id:"阿里云cdn发展史"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里云cdn发展史"}},[v._v("#")]),v._v(" 阿里云CDN发展史")]),v._v(" "),t("ul",[t("li",[v._v("淘宝CDN（2006~2011）\n"),t("ul",[t("li",[v._v("主要为淘宝网的图片提供加速服务")])])]),v._v(" "),t("li",[v._v("阿里CDN（2011~2014）\n"),t("ul",[t("li",[v._v("开始为阿里集团所有子公司提供加速服务")])])]),v._v(" "),t("li",[v._v("阿里云CDN（2014~今天）\n"),t("ul",[t("li",[v._v("正式商业化，对外提供加速服务")])])])]),v._v(" "),t("h3",{attrs:{id:"_2009年以前"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2009年以前"}},[v._v("#")]),v._v(" 2009年以前")]),v._v(" "),t("ul",[t("li",[v._v("淘宝网自建CDN（2006年）\n"),t("ul",[t("li",[v._v("业务规模越来越大，自主研发的优势开始显露")]),v._v(" "),t("li",[v._v("3DNS、NetScaler、Squid、NetCache")])])])]),v._v(" "),t("h3",{attrs:{id:"_2009-2011"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2009-2011"}},[v._v("#")]),v._v(" 2009~2011")]),v._v(" "),t("ul",[t("li",[v._v("自建节点达103个")]),v._v(" "),t("li",[v._v("节点软件引入LVS、HAproxy")])]),v._v(" "),t("h3",{attrs:{id:"_2012-2013"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2012-2013"}},[v._v("#")]),v._v(" 2012~2013")]),v._v(" "),t("ul",[t("li",[v._v("自建节点达230个")]),v._v(" "),t("li",[v._v("缓存服务器放弃Squid，使用Traffic Server")]),v._v(" "),t("li",[v._v("到目前为止，CDN平台采用了各种语言\n"),t("ul",[t("li",[v._v("Python、Perl、PHP等")])])])]),v._v(" "),t("h3",{attrs:{id:"_2014年至今"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2014年至今"}},[v._v("#")]),v._v(" 2014年至今")]),v._v(" "),t("ul",[t("li",[v._v("全球建设500+个节点")]),v._v(" "),t("li",[v._v("10Tbps服务能力储备")]),v._v(" "),t("li",[v._v("自研缓存服务器Swift")]),v._v(" "),t("li",[v._v("自研DNS服务器Pharos2")]),v._v(" "),t("li",[v._v("引入Go语言开发后台支撑平台")])]),v._v(" "),t("h2",{attrs:{id:"系统组成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统组成"}},[v._v("#")]),v._v(" 系统组成")]),v._v(" "),t("p",[v._v("视频就720P，图片有点糊（"),t("code",[v._v("配置管理")]),v._v("左右两边分别是"),t("code",[v._v("刷新系统")]),v._v("、"),t("code",[v._v("天眼")]),v._v("，图中橘色的部分全都是Go开发的）\n")]),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:a(585)}})]),t("p"),v._v(" "),t("p",[v._v("流量流向：LVS——>Tengine——>Swift\ncrimea：日志服务器，负责记录用户请求日志，用于排错、监控、流量统计、带宽计费、业务分析\nAIM：阿里巴巴智能调度系统\nPharos：自研DNS服务器")]),v._v(" "),t("h3",{attrs:{id:"日志服务器crimea"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#日志服务器crimea"}},[v._v("#")]),v._v(" 日志服务器crimea")]),v._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:a(586)}})]),v._v(" "),t("ul",[t("li",[v._v("之前是C开发的，后来转成Go，原因是crimea主要用于实时计算，需求经常变化，C做的太慢了")]),v._v(" "),t("li",[v._v("图中Tengine的日志系统和对外开源的Tengine不一样，节点缓存机器上的Tengine日志是不写到磁盘的，直接写到远端日志服务器")]),v._v(" "),t("li",[v._v("日志服务器的数据会压缩写入磁盘，定时同步至ODPS（自主研发的分布式计算平台，原来是用的hadoop）")])]),v._v(" "),t("h3",{attrs:{id:"调度系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调度系统"}},[v._v("#")]),v._v(" 调度系统")]),v._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:a(587)}})]),v._v(" "),t("h3",{attrs:{id:"监控系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控系统"}},[v._v("#")]),v._v(" 监控系统")]),v._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:a(588)}})]),v._v(" "),t("ul",[t("li",[v._v("放弃InfluxDB，原因是规模大了之后性能下降和运维成本上升，转为OTS（OpenTSDB，基于Hbase的时间序列数据库，上层是java封装的）")])]),v._v(" "),t("h3",{attrs:{id:"刷新系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#刷新系统"}},[v._v("#")]),v._v(" 刷新系统")]),v._v(" "),t("div",{attrs:{align:"center"}},[t("img",{attrs:{src:a(589)}})]),v._v(" "),t("ul",[t("li",[v._v("之前是Python写的，用Go重构改造之后效率提升十几倍以上")])]),v._v(" "),t("h3",{attrs:{id:"继续讲系统组成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#继续讲系统组成"}},[v._v("#")]),v._v(" 继续讲系统组成")]),v._v(" "),t("ul",[t("li",[v._v("整个系统其实仍然大量采用了C语言：Tengine、Swift、Pharos，因为这些地方都需要接收高流量，不怕开发效率低。比如Pharos作为DNS服务器，是有标准Tengine和Swift的也一样，都是和业务相关度低，但是对性能有极致的要求。")]),v._v(" "),t("li",[v._v("系统组成中使用Go开发的模块，都是要求快速开发，贴近业务的。")])]),v._v(" "),t("h2",{attrs:{id:"为什么选择go"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么选择go"}},[v._v("#")]),v._v(" 为什么选择Go？")]),v._v(" "),t("ul",[t("li",[v._v("简介的语法、特性设计")]),v._v(" "),t("li",[v._v("不错的性能")]),v._v(" "),t("li",[v._v("高的开发效率")]),v._v(" "),t("li",[v._v("起初开发人员基本都C语言出身")]),v._v(" "),t("li",[v._v("业务对GC不敏感")]),v._v(" "),t("li",[v._v("新人快速上手")]),v._v(" "),t("li",[v._v("最终还是看老板(2333)，这个演讲者的领导就是Tengine的发起者之一")])]),v._v(" "),t("h3",{attrs:{id:"遇到的第一个问题-内存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遇到的第一个问题-内存"}},[v._v("#")]),v._v(" 遇到的第一个问题：内存")]),v._v(" "),t("ul",[t("li",[v._v("测量分析")]),v._v(" "),t("li",[v._v("深入代码")]),v._v(" "),t("li",[v._v("注意小对象\n"),t("ul",[t("li",[v._v("字符串、slice、map、自定义等")]),v._v(" "),t("li",[v._v("循环使用")])])]),v._v(" "),t("li",[v._v("分配大内存\n"),t("ul",[t("li",[v._v("类Nginx")])])])]),v._v(" "),t("h3",{attrs:{id:"goroutine-channel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goroutine-channel"}},[v._v("#")]),v._v(" goroutine+channel")]),v._v(" "),t("ul",[t("li",[v._v("交换数据而不交换代码：不再定义接口，只规定好协议")]),v._v(" "),t("li",[v._v("像架构系统一样去设计我们的程序")])]),v._v(" "),t("h3",{attrs:{id:"共享与通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#共享与通信"}},[v._v("#")]),v._v(" 共享与通信")]),v._v(" "),t("ul",[t("li",[v._v("channel不是银弹")]),v._v(" "),t("li",[v._v("该共享内存时应该是不犹豫")]),v._v(" "),t("li",[v._v("锁并不可怕\n"),t("ul",[t("li",[v._v("锁保护的对象是数据，而不是代码")])])])]),v._v(" "),t("h3",{attrs:{id:"回调就是『反人类』"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回调就是『反人类』"}},[v._v("#")]),v._v(" 回调就是『反人类』")]),v._v(" "),t("ul",[t("li",[v._v("并不反对回调，只是不符合人类从上到下的思维方式")]),v._v(" "),t("li",[v._v("Apache——>Nginx——>Go\n"),t("ul",[t("li",[v._v("prefork：Apache")]),v._v(" "),t("li",[v._v("事件驱动：Nginx")]),v._v(" "),t("li",[v._v("协程：Go")])])])]),v._v(" "),t("h3",{attrs:{id:"开发、打包、部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开发、打包、部署"}},[v._v("#")]),v._v(" 开发、打包、部署")]),v._v(" "),t("ul",[t("li",[v._v("开发\n"),t("ul",[t("li",[v._v("代码托管在内部GitLab")]),v._v(" "),t("li",[v._v("三方库代码维护到内部GitLab")]),v._v(" "),t("li",[v._v("定制Go源码支持我们的GitLab，并提供rpm包：go每出一个新版本就fork一份改造好支持gitlab提供给内部")])])]),v._v(" "),t("li",[v._v("打包\n"),t("ul",[t("li",[v._v("发布系统一键编译应用并打包成rpm包")])])]),v._v(" "),t("li",[v._v("部署\n"),t("ul",[t("li",[v._v("运维安装rpm包")])])])])])}),[],!1,null,null,null);_.default=i.exports}}]);